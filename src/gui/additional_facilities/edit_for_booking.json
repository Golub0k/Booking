{
  "@title": "Редактирование дополнительного оснащения для брони помещения",
  "@preload": {
    "facility": {
      "$from-context": {
        "path": "$response.body.data.items.0",
        "data": {
          "$api-data": {
            "options": {
              "observe": "response"
            },
            "workflow": "additional_facilities",
            "action": "edit",
            "id": "$ref:operation-frontend:snippets/element/_api/api-data-optional-id",
            "query": "additional_facilities/get",
            "variables": {
              "id": {
                "$query-params": {
                  "name": "id"
                }
              }
            }
          }
        }
      }
    }
  },
  "type": "object",
  "model": "#data",
  "widget": {
    "name": "container",
    "events": {
      "init": {
        "$populate": {
          "path": "#dayCount",
          "data": {
            "$sum": {
              "terms": [
                {
                  "$if": {
                    "condition": {
                      "$in": {
                        "array": {
                          "$var": {
                            "path": "#data.bookingPeriod"
                          }
                        },
                        "value": "installation"
                      }
                    },
                    "then": {
                      "$length": {
                        "data": {
                          "$from-context": {
                            "path": "@preload.facility.booking.installationDates"
                          }
                        }
                      }
                    },
                    "else": 0
                  }
                },
                {
                  "$if": {
                    "condition": {
                      "$in": {
                        "array": {
                          "$var": {
                            "path": "#data.bookingPeriod"
                          }
                        },
                        "value": "event"
                      }
                    },
                    "then": {
                      "$length": {
                        "data": {
                          "$from-context": {
                            "path": "@preload.facility.booking.eventDates"
                          }
                        }
                      }
                    },
                    "else": 0
                  }
                },
                {
                  "$if": {
                    "condition": {
                      "$in": {
                        "array": {
                          "$var": {
                            "path": "#data.bookingPeriod"
                          }
                        },
                        "value": "deinstallation"
                      }
                    },
                    "then": {
                      "$length": {
                        "data": {
                          "$from-context": {
                            "path": "@preload.facility.booking.deinstallationDates"
                          }
                        }
                      }
                    },
                    "else": 0
                  }
                }
              ]
            }
          }
        }
      }
    }
  },
  "properties": {
    "facilityInfo": {
      "type": "object",
      "model": "#facilityInfo",
      "widget": {
        "name": "dialog",
        "options": {
          "visible": false,
          "closable": true
        }
      },
      "properties": {
        "content": {
          "type": "object",
          "widget": {
            "name": "container"
          },
          "properties": {
            "header": {
              "type": "string",
              "widget": {
                "name": "container",
                "options": {
                  "label": {
                    "$switch": {
                      "condition": {
                        "$from-context": {
                          "path": "@preload.facility.type"
                        }
                      },
                      "default": "",
                      "cases": [
                        {
                          "value": "equipment",
                          "action": "Информация об использовании оборудования"
                        },
                        {
                          "value": "furniture",
                          "action": "Информация об использовании мебели"
                        }
                      ]
                    }
                  }
                },
                "kind": "container-popup-with-h1-no-form-collapsed-style"
              }
            },
            "message": {
              "type": "string",
              "widget": "html",
              "value": {
                "$switch": {
                  "condition": {
                    "$from-context": {
                      "path": "@preload.facility.type"
                    }
                  },
                  "default": "",
                  "cases": [
                    {
                      "value": "equipment",
                      "action": {
                        "$if": {
                          "condition": {
                            "$not-empty": {
                              "data": {
                                "$subs": {
                                  "path": "#bookings"
                                }
                              }
                            }
                          },
                          "then": "<p>Выбранное оборудование зарезервировано для следующих мероприятий в рамках указанного срока:<br><br></p>",
                          "else": "<p>Выбранное оборудование не зарезервировано для других мероприятий в рамках указанного срока.</p>"
                        }
                      }
                    },
                    {
                      "value": "furniture",
                      "action": {
                        "$if": {
                          "condition": {
                            "$not-empty": {
                              "data": {
                                "$subs": {
                                  "path": "#bookings"
                                }
                              }
                            }
                          },
                          "then": "<p>Выбранная мебель зарезервирована для следующих мероприятий в рамках указанного срока:<br><br></p>",
                          "else": "<p>Выбранная мебель не зарезервирована для других мероприятий в рамках указанного срока.</p>"
                        }
                      }
                    }
                  ]
                }
              }
            },
            "table": {
              "type": "array",
              "model": "#bookings",
              "value": {
                "$api-table-workflow-data": {
                  "model": "#bookings",
                  "query": "additional_facilities/get_for_info",
                  "id": {
                    "$query-params": {
                      "name": "id"
                    }
                  },
                  "variables": {
                    "$assign-object": {
                      "object": {
                        "$graphql-event-variables": {
                          "data": {
                            "$element-event": {
                              "event": "lazyLoad"
                            }
                          }
                        }
                      },
                      "data": {
                        "equipmentOrFurniture": {
                          "$switch": {
                            "condition": {
                              "$from-context": {
                                "path": "@preload.facility.type"
                              }
                            },
                            "default": "",
                            "cases": [
                              {
                                "value": "equipment",
                                "action": {
                                  "$from-context": {
                                    "path": "@preload.facility.equipmentId"
                                  }
                                }
                              },
                              {
                                "value": "furniture",
                                "action": {
                                  "$from-context": {
                                    "path": "@preload.facility.furnitureId"
                                  }
                                }
                              }
                            ]
                          }
                        },
                        "except": {
                          "$query-params": {
                            "name": "id"
                          }
                        },
                        "minDate": {
                          "$query-params": {
                            "name": "minDate"
                          }
                        },
                        "maxDate": {
                          "$query-params": {
                            "name": "maxDate"
                          }
                        }
                      },
                      "path": ""
                    }
                  },
                  "errors": {
                    "default": {
                      "$message": {
                        "severity": "error",
                        "summary": "Ошибка",
                        "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                      }
                    }
                  }
                }
              },
              "widget": {
                "name": "table-lazy",
                "options": {
                  "emptyMessage": "Не добавлено информации для отображения",
                  "first": 0,
                  "rows": 10,
                  "paginator": true,
                  "visible": {
                    "$not-empty": {
                      "data": {
                        "$api-table-workflow-data": {
                          "model": "#bookings",
                          "query": "additional_facilities/get_for_info",
                          "id": {
                            "$query-params": {
                              "name": "id"
                            }
                          },
                          "variables": {
                            "$assign-object": {
                              "object": {
                                "$graphql-event-variables": {
                                  "data": {
                                    "$element-event": {
                                      "event": "lazyLoad"
                                    }
                                  }
                                }
                              },
                              "data": {
                                "equipmentOrFurniture": {
                                  "$switch": {
                                    "condition": {
                                      "$from-context": {
                                        "path": "@preload.facility.type"
                                      }
                                    },
                                    "default": "",
                                    "cases": [
                                      {
                                        "value": "equipment",
                                        "action": {
                                          "$from-context": {
                                            "path": "@preload.facility.equipmentId"
                                          }
                                        }
                                      },
                                      {
                                        "value": "furniture",
                                        "action": {
                                          "$from-context": {
                                            "path": "@preload.facility.furnitureId"
                                          }
                                        }
                                      }
                                    ]
                                  }
                                },
                                "except": {
                                  "$query-params": {
                                    "name": "id"
                                  }
                                },
                                "minDate": {
                                  "$query-params": {
                                    "name": "minDate"
                                  }
                                },
                                "maxDate": {
                                  "$query-params": {
                                    "name": "maxDate"
                                  }
                                }
                              },
                              "path": ""
                            }
                          },
                          "errors": {
                            "default": {
                              "$message": {
                                "severity": "error",
                                "summary": "Ошибка",
                                "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "rowsPerPageOptions": [
                    10,
                    20,
                    50
                  ],
                  "routerOptions": [
                    "first",
                    "rows"
                  ],
                  "initialFilters": {
                    "$var": {
                      "path": "#bookings"
                    }
                  }
                },
                "class": {
                  "value": "data-table d-block mrg-b-lg"
                },
                "events": {
                  "lazyLoad": {
                    "$element-option": {
                      "path": "#bookings",
                      "option": "loading",
                      "value": true
                    }
                  }
                },
                "subscriptions": {
                  "reload-table": {
                    "$element-event": {
                      "event": "reload",
                      "value": true
                    }
                  }
                }
              },
              "items": {
                "type": "object",
                "properties": {
                  "number": {
                    "type": "number",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "№",
                        "viewedValue": {
                          "$collection": {
                            "action": "row-number"
                          }
                        }
                      },
                      "class": {
                        "header": "column_actions",
                        "cell": "column_actions"
                      }
                    }
                  },
                  "eventId": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    }
                  },
                  "event": {
                    "type": "object",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    },
                    "properties": {
                      "name": {
                        "type": "string",
                        "widget": {
                          "name": "hidden"
                        }
                      },
                      "state": {
                        "type": "string",
                        "widget": {
                          "name": "hidden"
                        }
                      }
                    }
                  },
                  "eventView": {
                    "type": "object",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Наименование мероприятия"
                      }
                    },
                    "properties": {
                      "name": {
                        "type": "string",
                        "widget": {
                          "name": "info",
                          "options": {
                            "visible": {
                              "$not": {
                                "data": {
                                  "$active-user-has-permission": {
                                    "permission": "event.view"
                                  }
                                }
                              }
                            },
                            "viewedValue": {
                              "$from-context": {
                                "path": "$rowData.event.name"
                              }
                            }
                          }
                        }
                      },
                      "link": {
                        "type": "string",
                        "widget": {
                          "name": "link",
                          "options": {
                            "visible": {
                              "$active-user-has-permission": {
                                "permission": "event.view"
                              }
                            },
                            "routerLink": "/cabinet/event/view",
                            "queryParams": {
                              "id": {
                                "$from-context": {
                                  "path": "$rowData.eventId"
                                }
                              }
                            },
                            "viewedValue": {
                              "$from-context": {
                                "path": "$rowData.event.name"
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "booking": {
                    "type": "object",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    },
                    "properties": {
                      "minDate": {
                        "type": "datetime",
                        "widget": {
                          "name": "hidden"
                        }
                      },
                      "maxDate": {
                        "type": "datetime",
                        "widget": {
                          "name": "hidden"
                        }
                      }
                    }
                  },
                  "bookingPeriod": {
                    "type": "object",
                    "model": false,
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Даты брони"
                      }
                    },
                    "properties": {
                      "bookingPeriodView": {
                        "type": "string",
                        "model": false,
                        "widget": {
                          "name": "info",
                          "options": {
                            "viewedValue": {
                              "$replace": {
                                "template": "{{start}} - {{end}}",
                                "data": {
                                  "start": {
                                    "$formatter": {
                                      "format": "datetime:\"DD.MM.YYYY HH:mm\"",
                                      "data": {
                                        "$from-context": {
                                          "path": "$rowData.booking.minDate"
                                        }
                                      }
                                    }
                                  },
                                  "end": {
                                    "$formatter": {
                                      "format": "datetime:\"DD.MM.YYYY HH:mm\"",
                                      "data": {
                                        "$from-context": {
                                          "path": "$rowData.booking.maxDate"
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "class": {
                            "group": "p-text-right",
                            "value": "p-jc-end"
                          }
                        }
                      }
                    }
                  },
                  "quantity": {
                    "type": "number",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    }
                  },
                  "quantityView": {
                    "type": "object",
                    "model": false,
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Количество"
                      }
                    },
                    "properties": {
                      "amount": {
                        "type": "string",
                        "model": false,
                        "widget": {
                          "name": "info",
                          "options": {
                            "viewedValue": {
                              "$subs": {
                                "path": "#bookings[].quantity"
                              }
                            }
                          },
                          "class": {
                            "group": "p-text-right",
                            "value": "p-jc-end"
                          }
                        }
                      }
                    }
                  },
                  "state": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    }
                  },
                  "status": {
                    "type": "object",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Статус"
                      }
                    },
                    "properties": {
                      "stateView": {
                        "type": "string",
                        "value": {
                          "$from-context": {
                            "path": "$rowData.event.state"
                          }
                        },
                        "widget": {
                          "name": "badge",
                          "options": {
                            "defaultLabel": "Не заполнено",
                            "displayMapping": [
                              {
                                "color": "badge_default",
                                "label": "Предварительная бронь",
                                "value": "pre_booking"
                              },
                              {
                                "color": "badge_warning",
                                "label": "Получен запрос",
                                "value": "requested"
                              },
                              {
                                "color": "badge_error",
                                "label": "Получено ТЗ",
                                "value": "task_received"
                              },
                              {
                                "color": "badge_active",
                                "label": "Согласована смета",
                                "value": "agreed"
                              },
                              {
                                "color": "badge_accent",
                                "label": "Пройден check-in",
                                "value": "check_in"
                              }
                            ]
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "breadcrumbs": {
      "type": "object",
      "model": false,
      "widget": {
        "name": "breadcrumb",
        "mobileItems": [
          {
            "label": "Главная",
            "routerLink": "/cabinet/event/list"
          }
        ],
        "items": [
          {
            "label": "Главная",
            "routerLink": "/cabinet/event/list"
          },
          {
            "label": {
              "$from-context": {
                "path": "@preload.facility.event.name"
              }
            },
            "routerLink": "/cabinet/event/view",
            "queryParams": {
              "id": {
                "$from-context": {
                  "path": "@preload.facility.eventId"
                }
              }
            }
          },
          {
            "label": "Редактирование мероприятия",
            "routerLink": "/cabinet/event/edit",
            "queryParams": {
              "id": {
                "$from-context": {
                  "path": "@preload.facility.eventId"
                }
              },
              "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"rent\"}}"
            }
          },
          {
            "label": {
              "$replace": {
                "template": "Редактирование брони помещения \"{{0}} \"",
                "data": [
                  {
                    "$from-context": {
                      "path": "@preload.facility.booking.name"
                    }
                  }
                ]
              }
            },
            "routerLink": "/cabinet/booking/edit",
            "queryParams": {
              "id": {
                "$from-context": {
                  "path": "@preload.facility.bookingId"
                }
              },
              "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"allEquipment\"}}"
            }
          },
          {
            "label": {
              "$switch": {
                "condition": {
                  "$from-context": {
                    "path": "@preload.facility.type"
                  }
                },
                "default": "",
                "cases": [
                  {
                    "value": "additional_service",
                    "action": "Редактирование бронируемой услуги"
                  },
                  {
                    "value": "equipment",
                    "action": "Редактирование бронируемого оборудования"
                  },
                  {
                    "value": "furniture",
                    "action": "Редактирование бронируемой мебели"
                  }
                ]
              }
            }
          }
        ],
        "class": {
          "group": "p-autolayout p-jc-start d-flex p-xs-auto mrg-b-md",
          "value": "p-autolayout p-jc-start d-flex"
        }
      }
    },
    "form": {
      "type": "object",
      "model": "#data",
      "value": {
        "$json-model": {
          "data": {
            "$from-context": {
              "path": "@preload.facility"
            }
          },
          "alias": "#data"
        }
      },
      "widget": {
        "name": "form",
        "options": {
          "label": {
            "$switch": {
              "condition": {
                "$from-context": {
                  "path": "@preload.facility.type"
                }
              },
              "default": "",
              "cases": [
                {
                  "value": "additional_service",
                  "action": "Редактирование бронируемой услуги"
                },
                {
                  "value": "equipment",
                  "action": "Редактирование бронируемого оборудования"
                },
                {
                  "value": "furniture",
                  "action": "Редактирование бронируемой мебели"
                }
              ]
            }
          }
        },
        "class": {
          "label": "h1 mrg-b-xl"
        }
      },
      "properties": {
        "eventState": {
          "type": "string",
          "widget": "hidden",
          "model": "#data.eventState",
          "value": {
            "$from-context": {
              "path": "@preload.facility.event.state"
            }
          }
        },
        "bookingState": {
          "type": "string",
          "widget": "hidden",
          "model": "#data.bookingState",
          "value": {
            "$from-context": {
              "path": "@preload.facility.booking.state"
            }
          }
        },
        "mainInfo": {
          "type": "object",
          "model": false,
          "widget": {
            "name": "container",
            "options": {
              "label": {
                "$switch": {
                  "condition": {
                    "$from-context": {
                      "path": "@preload.facility.type"
                    }
                  },
                  "default": "",
                  "cases": [
                    {
                      "value": "additional_service",
                      "action": "Основные сведения об услуге"
                    },
                    {
                      "value": "equipment",
                      "action": "Основные сведения об оборудования"
                    },
                    {
                      "value": "furniture",
                      "action": "Основные сведения о мебели"
                    }
                  ]
                }
              }
            },
            "class": {
              "label": "h2 mrg-b-md",
              "value": "mrg-b-xl"
            }
          },
          "properties": {
            "type": {
              "type": "string",
              "widget": {
                "name": "hidden"
              }
            },
            "additionalService": {
              "type": "object",
              "widget": {
                "name": "container",
                "options": {
                  "visible": {
                    "===": {
                      "operand1": "additional_service",
                      "operand2": {
                        "$from-context": {
                          "path": "@preload.facility.type"
                        }
                      }
                    }
                  }
                }
              },
              "properties": {
                "name": {
                  "type": "string",
                  "widget": {
                    "name": "input",
                    "options": {
                      "disabled": true,
                      "label": "Наименование услуги"
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                      "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                    }
                  }
                },
                "serviceTypeId": {
                  "type": "string",
                  "widget": {
                    "name": "dropdown",
                    "options": {
                      "label": "Тип услуги",
                      "disabled": true,
                      "dataKey": "id",
                      "valueKey": "id",
                      "optionLabel": "name",
                      "placeholder": "Выбрать",
                      "filter": true,
                      "valueOptions": {
                        "$fetch-object": {
                          "path": "data.items",
                          "data": {
                            "$api-data": {
                              "query": "services_type/get_for_select",
                              "id": {
                                "$query-params": {
                                  "name": "id"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                      "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                    }
                  }
                },
                "unit": {
                  "type": "string",
                  "widget": {
                    "name": "hidden"
                  }
                },
                "comment": {
                  "type": "string",
                  "widget": {
                    "name": "textarea",
                    "options": {
                      "disabled": true,
                      "label": "Описание",
                      "rows": 6,
                      "maxlength": 4000
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                      "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                    }
                  }
                }
              }
            },
            "equipment": {
              "type": "object",
              "widget": {
                "name": "container",
                "options": {
                  "visible": {
                    "===": {
                      "operand1": "equipment",
                      "operand2": {
                        "$from-context": {
                          "path": "@preload.facility.type"
                        }
                      }
                    }
                  }
                }
              },
              "properties": {
                "name": {
                  "type": "string",
                  "widget": {
                    "name": "input",
                    "options": {
                      "disabled": true,
                      "label": "Наименование оборудования"
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                      "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                    }
                  }
                },
                "nomenclatureNumber": {
                  "type": "string",
                  "widget": {
                    "name": "input",
                    "options": {
                      "disabled": true,
                      "label": "Номенклатурный номер"
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                      "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                    }
                  }
                },
                "comment": {
                  "type": "string",
                  "widget": {
                    "name": "textarea",
                    "options": {
                      "disabled": true,
                      "label": "Описание",
                      "rows": 6,
                      "maxlength": 4000
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                      "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                    }
                  }
                },
                "availableQuantity": {
                  "type": "number",
                  "widget": {
                    "name": "hidden"
                  }
                }
              }
            },
            "furniture": {
              "type": "object",
              "widget": {
                "name": "container",
                "options": {
                  "visible": {
                    "===": {
                      "operand1": "furniture",
                      "operand2": {
                        "$from-context": {
                          "path": "@preload.facility.type"
                        }
                      }
                    }
                  }
                }
              },
              "properties": {
                "name": {
                  "type": "string",
                  "widget": {
                    "name": "input",
                    "options": {
                      "disabled": true,
                      "label": "Наименование мебели"
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                      "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                    }
                  }
                },
                "nomenclatureNumber": {
                  "type": "string",
                  "widget": {
                    "name": "input",
                    "options": {
                      "disabled": true,
                      "label": "Номенклатурный номер"
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                      "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                    }
                  }
                },
                "comment": {
                  "type": "string",
                  "widget": {
                    "name": "textarea",
                    "options": {
                      "disabled": true,
                      "label": "Описание",
                      "rows": 6,
                      "maxlength": 4000
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                      "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                    }
                  }
                },
                "availableQuantity": {
                  "type": "number",
                  "widget": {
                    "name": "hidden"
                  }
                }
              }
            },
            "bookingComment": {
              "type": "string",
              "model": "#data.bookingComment",
              "widget": {
                "name": "textarea",
                "options": {
                  "label": "Комментарий",
                  "rows": 6,
                  "maxlength": 4000
                },
                "class": {
                  "group": "form-item p-field p-grid p-fluid",
                  "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                  "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                }
              }
            },
            "bookingPeriod": {
              "type": "string",
              "model": "#data.bookingPeriod",
              "value": {
                "$from-context": {
                  "path": "@preload.facility.bookingPeriod"
                }
              },
              "widget": {
                "name": "multiselect",
                "options": {
                  "label": "Период бронирования",
                  "dataKey": "code",
                  "valueKey": "code",
                  "optionLabel": "name",
                  "placeholder": "Выбрать",
                  "valueOptions": [
                    {
                      "code": "installation",
                      "name": "Монтаж"
                    },
                    {
                      "code": "event",
                      "name": "Мероприятие"
                    },
                    {
                      "code": "deinstallation",
                      "name": "Демонтаж"
                    }
                  ]
                },
                "events": {
                  "change": {
                    "$waterfall": {
                      "arrayFunctions": [
                        {
                          "$populate": {
                            "path": "#dayCount",
                            "data": {
                              "$sum": {
                                "terms": [
                                  {
                                    "$if": {
                                      "condition": {
                                        "$in": {
                                          "array": {
                                            "$var": {
                                              "path": "#data.bookingPeriod"
                                            }
                                          },
                                          "value": "installation"
                                        }
                                      },
                                      "then": {
                                        "$length": {
                                          "data": {
                                            "$from-context": {
                                              "path": "@preload.facility.booking.installationDates"
                                            }
                                          }
                                        }
                                      },
                                      "else": 0
                                    }
                                  },
                                  {
                                    "$if": {
                                      "condition": {
                                        "$in": {
                                          "array": {
                                            "$var": {
                                              "path": "#data.bookingPeriod"
                                            }
                                          },
                                          "value": "event"
                                        }
                                      },
                                      "then": {
                                        "$length": {
                                          "data": {
                                            "$from-context": {
                                              "path": "@preload.facility.booking.eventDates"
                                            }
                                          }
                                        }
                                      },
                                      "else": 0
                                    }
                                  },
                                  {
                                    "$if": {
                                      "condition": {
                                        "$in": {
                                          "array": {
                                            "$var": {
                                              "path": "#data.bookingPeriod"
                                            }
                                          },
                                          "value": "deinstallation"
                                        }
                                      },
                                      "then": {
                                        "$length": {
                                          "data": {
                                            "$from-context": {
                                              "path": "@preload.facility.booking.deinstallationDates"
                                            }
                                          }
                                        }
                                      },
                                      "else": 0
                                    }
                                  }
                                ]
                              }
                            }
                          }
                        },
                        {
                          "$event-bus-publish": {
                            "type": "day-count-change",
                            "publisher": "bookingPeriod",
                            "next": {
                              "$var": {
                                "path": "#dayCount"
                              }
                            }
                          }
                        }
                      ]
                    }
                  }
                },
                "class": {
                  "group": "form-item p-field p-grid p-fluid",
                  "label": "form-label form-label_required p-xs-12 p-md-4 p-xl-3",
                  "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                }
              },
              "validation": [
                {
                  "type": "schema",
                  "params": {
                    "rule": {
                      "$not-empty": {
                        "data": {
                          "$var": {
                            "path": "."
                          }
                        }
                      }
                    },
                    "message": "Поле обязательно для заполнения"
                  },
                  "events": [
                    "onUpdate"
                  ]
                }
              ]
            }
          }
        },
        "costCalculation": {
          "type": "object",
          "model": false,
          "widget": {
            "name": "container",
            "options": {
              "label": {
                "$switch": {
                  "condition": {
                    "$from-context": {
                      "path": "@preload.facility.type"
                    }
                  },
                  "default": "",
                  "cases": [
                    {
                      "value": "additional_service",
                      "action": "Расчет стоимости услуги"
                    },
                    {
                      "value": "equipment",
                      "action": "Расчет стоимости оборудования"
                    },
                    {
                      "value": "furniture",
                      "action": "Расчет стоимости мебели"
                    }
                  ]
                }
              }
            },
            "class": {
              "label": "h2 mrg-b-md",
              "value": "mrg-b-xl"
            }
          },
          "properties": {
            "dayCount": {
              "type": "number",
              "model": "#dayCount",
              "widget": {
                "name": "hidden"
              }
            },
            "quantity": {
              "type": "number",
              "widget": {
                "name": "input",
                "options": {
                  "inputmask": {
                    "alias": "integer",
                    "groupSeparator": " ",
                    "rightAlign": false,
                    "autoGroup": true,
                    "allowMinus": false,
                    "integerDigits": 10
                  },
                  "label": "Необходимое количество"
                },
                "append": {
                  "type": "object",
                  "widget": {
                    "name": "container"
                  },
                  "properties": {
                    "append2": {
                      "type": "string",
                      "value": {
                        "$switch": {
                          "condition": {
                            "$subs": {
                              "path": "#data.type"
                            }
                          },
                          "cases": [
                            {
                              "value": "equipment",
                              "action": {
                                "$replace": {
                                  "template": "{{0}}шт.",
                                  "data": [
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$subs": {
                                                "path": "#data.equipment.availableQuantity"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$replace": {
                                            "template": "из {{0}} ",
                                            "data": [
                                              {
                                                "$subs": {
                                                  "path": "#data.equipment.availableQuantity"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "else": ""
                                      }
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "value": "furniture",
                              "action": {
                                "$replace": {
                                  "template": "{{0}}шт.",
                                  "data": [
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$subs": {
                                                "path": "#data.furniture.availableQuantity"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$replace": {
                                            "template": "из {{0}} ",
                                            "data": [
                                              {
                                                "$subs": {
                                                  "path": "#data.furniture.availableQuantity"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "else": ""
                                      }
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "value": "additional_service",
                              "action": {
                                "$if": {
                                  "condition": {
                                    "$empty": {
                                      "data": {
                                        "$var": {
                                          "path": "#data.additionalService.unit"
                                        }
                                      }
                                    }
                                  },
                                  "then": "шт.",
                                  "else": {
                                    "$var": {
                                      "path": "#data.additionalService.unit"
                                    }
                                  }
                                }
                              }
                            }
                          ]
                        }
                      },
                      "widget": {
                        "name": "link",
                        "options": {
                          "visible": {
                            "!==": {
                              "operand1": "additional_service",
                              "operand2": {
                                "$subs": {
                                  "path": "#data.type"
                                }
                              }
                            }
                          }
                        },
                        "class": {
                          "group": "text-addon text-addon_right",
                          "value": "form-item-element mrg-l-xs"
                        },
                        "events": {
                          "click": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#facilityInfo",
                              "value": true
                            }
                          }
                        }
                      }
                    },
                    "append3": {
                      "type": "string",
                      "value": {
                        "$if": {
                          "condition": {
                            "$empty": {
                              "data": {
                                "$var": {
                                  "path": "#data.additionalService.unit"
                                }
                              }
                            }
                          },
                          "then": "шт.",
                          "else": {
                            "$var": {
                              "path": "#data.additionalService.unit"
                            }
                          }
                        }
                      },
                      "widget": {
                        "name": "info",
                        "options": {
                          "visible": {
                            "===": {
                              "operand1": "additional_service",
                              "operand2": {
                                "$subs": {
                                  "path": "#data.type"
                                }
                              }
                            }
                          }
                        },
                        "class": {
                          "group": "text-addon text-addon_right",
                          "value": "form-item-element mrg-l-xs"
                        }
                      }
                    }
                  }
                },
                "class": {
                  "group": "form-item p-field p-grid p-fluid",
                  "label": "form-label form-label_required p-xs-12 p-md-4 p-xl-3",
                  "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                },
                "events": {
                  "change": {
                    "$event-bus-publish": {
                      "type": "quantity-change",
                      "publisher": "quantity",
                      "next": {
                        "$var": {
                          "path": "#data.quantity"
                        }
                      }
                    }
                  }
                }
              },
              "validation": [
                {
                  "type": "schema",
                  "params": {
                    "rule": {
                      "$not-empty": {
                        "data": {
                          "$var": {
                            "path": "."
                          }
                        }
                      }
                    },
                    "message": "Поле обязательно для заполнения"
                  },
                  "events": [
                    "onUpdate",
                    "onBackend"
                  ]
                }
              ]
            },
            "discountOrMarkupFlag": {
              "type": "string",
              "widget": {
                "name": "radio-button",
                "options": {
                  "label": "Применить скидку/наценку",
                  "valueKey": "code",
                  "optionLabel": "name",
                  "valueOptions": [
                    {
                      "code": "no",
                      "name": "Не применять"
                    },
                    {
                      "code": "discount",
                      "name": "Применить скидку"
                    },
                    {
                      "code": "markup",
                      "name": "Применить наценку"
                    }
                  ]
                },
                "class": {
                  "group": "form-item form-item_radio p-field p-grid p-fluid",
                  "label": "form-label form-label mrg-t-0 p-xs-12 p-md-4 p-xl-3",
                  "value": "form-item-element p-xs-12 p-md-6 p-xl-4 p-flex-column",
                  "item": "form-item_radio__item width-100"
                },
                "events": {
                  "change": {
                    "$waterfall": {
                      "arrayFunctions": [
                        {
                          "$event-bus-publish": {
                            "type": "flag-change",
                            "publisher": "discountOrMarkupFlag",
                            "next": {
                              "$var": {
                                "path": "#data.discountOrMarkupFlag"
                              }
                            }
                          }
                        },
                        {
                          "$populate": {
                            "path": "#data.discountOrMarkup",
                            "data": ""
                          }
                        }
                      ]
                    }
                  }
                }
              }
            },
            "discountOrMarkup": {
              "type": "number",
              "widget": {
                "name": "input",
                "options": {
                  "inputmask": {
                    "alias": "integer",
                    "groupSeparator": " ",
                    "rightAlign": false,
                    "autoGroup": true,
                    "allowMinus": false,
                    "integerDigits": 3,
                    "digits": 2,
                    "radixPoint": ","
                  },
                  "label": {
                    "$switch": {
                      "condition": {
                        "$subs": {
                          "path": "#data.discountOrMarkupFlag"
                        }
                      },
                      "default": "",
                      "cases": [
                        {
                          "value": "discount",
                          "action": "Скидка"
                        },
                        {
                          "value": "markup",
                          "action": "Наценка"
                        }
                      ]
                    }
                  },
                  "visible": {
                    "!==": {
                      "operand1": {
                        "$subs": {
                          "path": "#data.discountOrMarkupFlag"
                        }
                      },
                      "operand2": "no"
                    }
                  }
                },
                "append": {
                  "type": "string",
                  "value": "%",
                  "widget": {
                    "name": "info",
                    "class": {
                      "group": "text-addon text-addon_right"
                    }
                  }
                },
                "class": {
                  "group": "form-item p-field p-grid p-fluid",
                  "label": "form-label form-label_required p-xs-12 p-md-4 p-xl-3",
                  "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                },
                "events": {
                  "change": [
                    {
                      "$populate": {
                        "path": "#data.unitPriceWithDiscountOrMarkup",
                        "emitEvent": false,
                        "data": {
                          "$math-round": {
                            "value": {
                              "$add": {
                                "multipliers": [
                                  {
                                    "$var": {
                                      "path": "#data.unitPrice"
                                    }
                                  },
                                  {
                                    "$switch": {
                                      "condition": {
                                        "$var": {
                                          "path": "#data.discountOrMarkupFlag"
                                        }
                                      },
                                      "cases": [
                                        {
                                          "value": "discount",
                                          "action": {
                                            "$subtract": {
                                              "operand1": 1,
                                              "operand2": {
                                                "$division": {
                                                  "operand1": {
                                                    "$var": {
                                                      "path": "#data.discountOrMarkup"
                                                    }
                                                  },
                                                  "operand2": 100
                                                }
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "value": "markup",
                                          "action": {
                                            "$sum": {
                                              "terms": [
                                                1,
                                                {
                                                  "$division": {
                                                    "operand1": {
                                                      "$var": {
                                                        "path": "#data.discountOrMarkup"
                                                      }
                                                    },
                                                    "operand2": 100
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        {
                                          "value": "no",
                                          "action": 1
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "exp": -2
                          }
                        }
                      }
                    },
                    {
                      "$populate": {
                        "path": "#data.totalPriceWithDiscountOrMarkup",
                        "emitEvent": false,
                        "data": {
                          "$math-round": {
                            "value": {
                              "$add": {
                                "multipliers": [
                                  {
                                    "$var": {
                                      "path": "#data.totalPrice"
                                    }
                                  },
                                  {
                                    "$switch": {
                                      "condition": {
                                        "$var": {
                                          "path": "#data.discountOrMarkupFlag"
                                        }
                                      },
                                      "cases": [
                                        {
                                          "value": "discount",
                                          "action": {
                                            "$subtract": {
                                              "operand1": 1,
                                              "operand2": {
                                                "$division": {
                                                  "operand1": {
                                                    "$var": {
                                                      "path": "#data.discountOrMarkup"
                                                    }
                                                  },
                                                  "operand2": 100
                                                }
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "value": "markup",
                                          "action": {
                                            "$sum": {
                                              "terms": [
                                                1,
                                                {
                                                  "$division": {
                                                    "operand1": {
                                                      "$var": {
                                                        "path": "#data.discountOrMarkup"
                                                      }
                                                    },
                                                    "operand2": 100
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        },
                                        {
                                          "value": "no",
                                          "action": 1
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "exp": -2
                          }
                        }
                      }
                    }
                  ]
                },
                "subscriptions": {
                  "total-price-w-change": {
                    "subscriber": "discountOrMarkup",
                    "action": {
                      "$populate": {
                        "path": "#data.discountOrMarkup",
                        "emitEvent": false,
                        "data": {
                          "$math-round": {
                            "value": {
                              "$add": {
                                "multipliers": [
                                  100,
                                  {
                                    "$switch": {
                                      "condition": {
                                        "$var": {
                                          "path": "#data.discountOrMarkupFlag"
                                        }
                                      },
                                      "cases": [
                                        {
                                          "value": "discount",
                                          "action": {
                                            "$subtract": {
                                              "operand1": 1,
                                              "operand2": {
                                                "$division": {
                                                  "operand1": {
                                                    "$var": {
                                                      "path": "#data.totalPriceWithDiscountOrMarkup"
                                                    }
                                                  },
                                                  "operand2": {
                                                    "$var": {
                                                      "path": "#data.totalPrice"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "value": "markup",
                                          "action": {
                                            "$subtract": {
                                              "operand1": {
                                                "$division": {
                                                  "operand1": {
                                                    "$var": {
                                                      "path": "#data.totalPriceWithDiscountOrMarkup"
                                                    }
                                                  },
                                                  "operand2": {
                                                    "$var": {
                                                      "path": "#data.totalPrice"
                                                    }
                                                  }
                                                }
                                              },
                                              "operand2": 1
                                            }
                                          }
                                        },
                                        {
                                          "value": "no",
                                          "action": 0
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "exp": -2
                          }
                        }
                      }
                    }
                  },
                  "unit-price-w-change": {
                    "subscriber": "discountOrMarkup",
                    "action": {
                      "$populate": {
                        "path": "#data.discountOrMarkup",
                        "emitEvent": false,
                        "data": {
                          "$math-round": {
                            "value": {
                              "$add": {
                                "multipliers": [
                                  100,
                                  {
                                    "$switch": {
                                      "condition": {
                                        "$var": {
                                          "path": "#data.discountOrMarkupFlag"
                                        }
                                      },
                                      "cases": [
                                        {
                                          "value": "discount",
                                          "action": {
                                            "$subtract": {
                                              "operand1": 1,
                                              "operand2": {
                                                "$division": {
                                                  "operand1": {
                                                    "$var": {
                                                      "path": "#data.unitPriceWithDiscountOrMarkup"
                                                    }
                                                  },
                                                  "operand2": {
                                                    "$var": {
                                                      "path": "#data.unitPrice"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "value": "markup",
                                          "action": {
                                            "$subtract": {
                                              "operand1": {
                                                "$division": {
                                                  "operand1": {
                                                    "$var": {
                                                      "path": "#data.unitPriceWithDiscountOrMarkup"
                                                    }
                                                  },
                                                  "operand2": {
                                                    "$var": {
                                                      "path": "#data.unitPrice"
                                                    }
                                                  }
                                                }
                                              },
                                              "operand2": 1
                                            }
                                          }
                                        },
                                        {
                                          "value": "no",
                                          "action": 0
                                        }
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            "exp": -2
                          }
                        }
                      }
                    }
                  }
                }
              },
              "validation": [
                {
                  "type": "schema",
                  "params": {
                    "rule": {
                      "$if": {
                        "condition": {
                          "!==": {
                            "operand1": "no",
                            "operand2": {
                              "$var": {
                                "path": "#data.discountOrMarkupFlag"
                              }
                            }
                          }
                        },
                        "then": {
                          "$not-empty": {
                            "data": {
                              "$var": {
                                "path": "."
                              }
                            }
                          }
                        },
                        "else": true
                      }
                    },
                    "message": "Поле обязательно для заполнения"
                  },
                  "events": [
                    "onUpdate"
                  ]
                },
                {
                  "type": "schema",
                  "params": {
                    "rule": {
                      "$if": {
                        "condition": {
                          "$and": {
                            "operands": [
                              {
                                "!==": {
                                  "operand1": "no",
                                  "operand2": {
                                    "$var": {
                                      "path": "#data.discountOrMarkupFlag"
                                    }
                                  }
                                }
                              },
                              {
                                "$not-empty": {
                                  "data": {
                                    "$var": {
                                      "path": "."
                                    }
                                  }
                                }
                              }
                            ]
                          }
                        },
                        "then": {
                          ">": {
                            "operand1": {
                              "$var": {
                                "path": "."
                              }
                            },
                            "operand2": 0
                          }
                        },
                        "else": true
                      }
                    },
                    "message": "Значение должно быть больше 0"
                  },
                  "events": [
                    "onUpdate"
                  ]
                },
                {
                  "type": "schema",
                  "params": {
                    "rule": {
                      "$if": {
                        "condition": {
                          "===": {
                            "operand1": "discount",
                            "operand2": {
                              "$var": {
                                "path": "#data.discountOrMarkupFlag"
                              }
                            }
                          }
                        },
                        "then": {
                          "<": {
                            "operand1": {
                              "$var": {
                                "path": "."
                              }
                            },
                            "operand2": 100
                          }
                        },
                        "else": true
                      }
                    },
                    "message": "Должно быть указано положительное число меньше 100"
                  },
                  "events": [
                    "onUpdate",
                    "onBackend"
                  ]
                }
              ]
            },
            "item-price-container": {
              "type": "object",
              "model": false,
              "widget": {
                "name": "container",
                "options": {
                  "label": "Цена за единицу"
                },
                "class": {
                  "group": "form-item p-field p-grid",
                  "label": "form-label form-label_nds-label form-label_required p-xs-12 p-md-4 p-xl-3",
                  "value": "form-item-element form-item-element_view input-height-fit-content p-xs-12 p-md-6 p-xl-4 d-flex p-flex-wrap p-flex-md-nowrap pdd-l-0 pdd-r-0"
                }
              },
              "properties": {
                "unitPrice": {
                  "type": "number",
                  "model": "#data.unitPrice",
                  "value": {
                    "$if": {
                      "condition": {
                        "$empty": {
                          "data": {
                            "$from-context": {
                              "path": "@preload.facility.unitPrice"
                            }
                          }
                        }
                      },
                      "then": {
                        "$switch": {
                          "condition": {
                            "$from-context": {
                              "path": "@preload.facility.type"
                            }
                          },
                          "default": "",
                          "cases": [
                            {
                              "value": "additional_service",
                              "action": {
                                "$from-context": {
                                  "path": "@preload.facility.additionalService.unitPrice"
                                }
                              }
                            },
                            {
                              "value": "equipment",
                              "action": {
                                "$from-context": {
                                  "path": "@preload.facility.equipment.unitPrice"
                                }
                              }
                            },
                            {
                              "value": "furniture",
                              "action": {
                                "$from-context": {
                                  "path": "@preload.facility.furniture.unitPrice"
                                }
                              }
                            }
                          ]
                        }
                      },
                      "else": {
                        "$from-context": {
                          "path": "@preload.facility.unitPrice"
                        }
                      }
                    }
                  },
                  "widget": {
                    "name": "input",
                    "options": {
                      "label": {
                        "$switch": {
                          "condition": {
                            "$subs": {
                              "path": "#data.discountOrMarkupFlag"
                            }
                          },
                          "default": " ",
                          "cases": [
                            {
                              "value": "discount",
                              "action": "без скидки"
                            },
                            {
                              "value": "markup",
                              "action": "без наценки"
                            }
                          ]
                        }
                      },
                      "disabled": true,
                      "inputmask": {
                        "alias": "integer",
                        "groupSeparator": " ",
                        "autoGroup": true,
                        "radixPoint": ",",
                        "integerDigits": 12,
                        "allowMinus": false,
                        "digits": 2
                      }
                    },
                    "append": {
                      "type": "string",
                      "value": "руб.",
                      "widget": {
                        "name": "info",
                        "class": {
                          "group": "text-addon text-addon_right"
                        }
                      }
                    },
                    "class": {
                      "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                      "label": "text-secondary fw-500 mrg-b-0"
                    }
                  }
                },
                "unitPriceWithDiscountOrMarkup": {
                  "type": "number",
                  "model": "#data.unitPriceWithDiscountOrMarkup",
                  "widget": {
                    "name": "input",
                    "options": {
                      "label": {
                        "$switch": {
                          "condition": {
                            "$subs": {
                              "path": "#data.discountOrMarkupFlag"
                            }
                          },
                          "default": "",
                          "cases": [
                            {
                              "value": "discount",
                              "action": "со скидкой"
                            },
                            {
                              "value": "markup",
                              "action": "с наценкой"
                            }
                          ]
                        }
                      },
                      "inputmask": {
                        "alias": "integer",
                        "groupSeparator": " ",
                        "autoGroup": true,
                        "radixPoint": ",",
                        "integerDigits": 12,
                        "allowMinus": false,
                        "digits": 2
                      },
                      "visible": {
                        "!==": {
                          "operand1": "no",
                          "operand2": {
                            "$subs": {
                              "path": "#data.discountOrMarkupFlag"
                            }
                          }
                        }
                      }
                    },
                    "append": {
                      "type": "string",
                      "value": "руб.",
                      "widget": {
                        "name": "info",
                        "class": {
                          "group": "text-addon text-addon_right"
                        }
                      }
                    },
                    "class": {
                      "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                      "label": "text-secondary fw-500 mrg-b-0"
                    },
                    "events": {
                      "change": [
                        {
                          "$event-bus-publish": {
                            "type": "unit-price-w-change",
                            "publisher": "unitPriceWithDiscountOrMarkup",
                            "next": {
                              "$var": {
                                "path": "#data.unitPriceWithDiscountOrMarkup"
                              }
                            }
                          }
                        }
                      ]
                    },
                    "subscriptions": {
                      "total-price-w-change": {
                        "subscriber": "unitPriceWithDiscountOrMarkup",
                        "action": {
                          "$populate": {
                            "path": "#data.unitPriceWithDiscountOrMarkup",
                            "emitEvent": false,
                            "data": {
                              "$math-round": {
                                "value": {
                                  "$division": {
                                    "operand1": {
                                      "$var": {
                                        "path": "#data.totalPriceWithDiscountOrMarkup"
                                      }
                                    },
                                    "operand2": {
                                      "$add": {
                                        "multipliers": [
                                          {
                                            "$var": {
                                              "path": "#data.quantity"
                                            }
                                          },
                                          {
                                            "$var": {
                                              "path": "#dayCount"
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  }
                                },
                                "exp": -2
                              }
                            }
                          }
                        }
                      },
                      "flag-change": {
                        "subscriber": "unitPriceWithDiscountOrMarkup",
                        "action": {
                          "$populate": {
                            "path": "#data.unitPriceWithDiscountOrMarkup",
                            "emitEvent": false,
                            "data": {
                              "$var": {
                                "path": "#data.unitPrice"
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "validation": [
                    {
                      "type": "schema",
                      "params": {
                        "rule": {
                          "$if": {
                            "condition": {
                              "===": {
                                "operand1": {
                                  "$var": {
                                    "path": "#data.discountOrMarkupFlag"
                                  }
                                },
                                "operand2": "discount"
                              }
                            },
                            "then": {
                              "<": {
                                "operand1": {
                                  "$var": {
                                    "path": "."
                                  }
                                },
                                "operand2": {
                                  "$var": {
                                    "path": "#data.unitPrice"
                                  }
                                }
                              }
                            },
                            "else": true
                          }
                        },
                        "message": "Цена за единицу со скидкой не может превышать стоимость без скидки"
                      },
                      "events": [
                        "onUpdate"
                      ]
                    },
                    {
                      "type": "schema",
                      "params": {
                        "rule": {
                          "$if": {
                            "condition": {
                              "===": {
                                "operand1": {
                                  "$var": {
                                    "path": "#data.discountOrMarkupFlag"
                                  }
                                },
                                "operand2": "markup"
                              }
                            },
                            "then": {
                              ">": {
                                "operand1": {
                                  "$var": {
                                    "path": "."
                                  }
                                },
                                "operand2": {
                                  "$var": {
                                    "path": "#data.unitPrice"
                                  }
                                }
                              }
                            },
                            "else": true
                          }
                        },
                        "message": "Цена за единицу с наценкой должна превышать стоимость без наценки"
                      },
                      "events": [
                        "onUpdate"
                      ]
                    }
                  ]
                }
              }
            },
            "total-price-container": {
              "type": "object",
              "model": false,
              "widget": {
                "name": "container",
                "options": {
                  "label": {
                    "$switch": {
                      "condition": {
                        "$from-context": {
                          "path": "@preload.facility.type"
                        }
                      },
                      "default": "",
                      "cases": [
                        {
                          "value": "additional_service",
                          "action": "Общая стоимость дополнительной услуги"
                        },
                        {
                          "value": "equipment",
                          "action": "Общая стоимость оборудования"
                        },
                        {
                          "value": "furniture",
                          "action": "Общая стоимость мебели"
                        }
                      ]
                    }
                  }
                },
                "class": {
                  "group": "form-item p-field p-grid",
                  "label": "form-label form-label_nds-label form-label_required p-xs-12 p-md-4 p-xl-3",
                  "value": "form-item-element form-item-element_view input-height-fit-content p-xs-12 p-md-6 p-xl-4 d-flex p-flex-wrap p-flex-md-nowrap pdd-l-0 pdd-r-0"
                }
              },
              "properties": {
                "totalPrice": {
                  "type": "number",
                  "model": "#data.totalPrice",
                  "widget": {
                    "name": "input",
                    "options": {
                      "label": {
                        "$switch": {
                          "condition": {
                            "$subs": {
                              "path": "#data.discountOrMarkupFlag"
                            }
                          },
                          "default": " ",
                          "cases": [
                            {
                              "value": "discount",
                              "action": "без скидки"
                            },
                            {
                              "value": "markup",
                              "action": "без наценки"
                            }
                          ]
                        }
                      },
                      "disabled": true,
                      "inputmask": {
                        "alias": "integer",
                        "groupSeparator": " ",
                        "autoGroup": true,
                        "radixPoint": ",",
                        "integerDigits": 12,
                        "allowMinus": false,
                        "digits": 2
                      }
                    },
                    "append": {
                      "type": "string",
                      "value": "руб.",
                      "widget": {
                        "name": "info",
                        "class": {
                          "group": "text-addon text-addon_right"
                        }
                      }
                    },
                    "class": {
                      "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                      "label": "text-secondary fw-500 mrg-b-0"
                    },
                    "subscriptions": {
                      "quantity-change": {
                        "subscriber": "totalPrice",
                        "action": {
                          "$populate": {
                            "path": "#data.totalPrice",
                            "emitEvent": false,
                            "data": {
                              "$math-round": {
                                "value": {
                                  "$add": {
                                    "multipliers": [
                                      {
                                        "$var": {
                                          "path": "#data.quantity"
                                        }
                                      },
                                      {
                                        "$var": {
                                          "path": "#data.unitPrice"
                                        }
                                      },
                                      {
                                        "$var": {
                                          "path": "#dayCount"
                                        }
                                      }
                                    ]
                                  }
                                },
                                "exp": -2
                              }
                            }
                          }
                        }
                      },
                      "day-count-change": {
                        "subscriber": "totalPrice",
                        "action": {
                          "$populate": {
                            "path": "#data.totalPrice",
                            "emitEvent": false,
                            "data": {
                              "$math-round": {
                                "value": {
                                  "$add": {
                                    "multipliers": [
                                      {
                                        "$var": {
                                          "path": "#data.quantity"
                                        }
                                      },
                                      {
                                        "$var": {
                                          "path": "#data.unitPrice"
                                        }
                                      },
                                      {
                                        "$var": {
                                          "path": "#dayCount"
                                        }
                                      }
                                    ]
                                  }
                                },
                                "exp": -2
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "totalPriceWithDiscountOrMarkup": {
                  "type": "number",
                  "model": "#data.totalPriceWithDiscountOrMarkup",
                  "widget": {
                    "name": "input",
                    "options": {
                      "label": {
                        "$switch": {
                          "condition": {
                            "$subs": {
                              "path": "#data.discountOrMarkupFlag"
                            }
                          },
                          "default": "",
                          "cases": [
                            {
                              "value": "discount",
                              "action": "со скидкой"
                            },
                            {
                              "value": "markup",
                              "action": "с наценкой"
                            }
                          ]
                        }
                      },
                      "inputmask": {
                        "alias": "integer",
                        "groupSeparator": " ",
                        "autoGroup": true,
                        "radixPoint": ",",
                        "integerDigits": 12,
                        "allowMinus": false,
                        "digits": 2
                      },
                      "visible": {
                        "!==": {
                          "operand1": "no",
                          "operand2": {
                            "$subs": {
                              "path": "#data.discountOrMarkupFlag"
                            }
                          }
                        }
                      }
                    },
                    "append": {
                      "type": "string",
                      "value": "руб.",
                      "widget": {
                        "name": "info",
                        "class": {
                          "group": "text-addon text-addon_right"
                        }
                      }
                    },
                    "class": {
                      "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                      "label": "text-secondary fw-500 mrg-b-0"
                    },
                    "events": {
                      "change": {
                        "$event-bus-publish": {
                          "type": "total-price-w-change",
                          "publisher": "totalPriceWithDiscountOrMarkup",
                          "next": {
                            "$var": {
                              "path": "#data.totalPriceWithDiscountOrMarkup"
                            }
                          }
                        }
                      }
                    },
                    "subscriptions": {
                      "flag-change": {
                        "subscriber": "totalPriceWithDiscountOrMarkup",
                        "action": {
                          "$populate": {
                            "path": "#data.totalPriceWithDiscountOrMarkup",
                            "emitEvent": false,
                            "data": {
                              "$var": {
                                "path": "#data.totalPrice"
                              }
                            }
                          }
                        }
                      },
                      "unit-price-w-change": {
                        "subscriber": "totalPriceWithDiscountOrMarkup",
                        "action": {
                          "$populate": {
                            "path": "#data.totalPriceWithDiscountOrMarkup",
                            "emitEvent": false,
                            "data": {
                              "$math-round": {
                                "value": {
                                  "$add": {
                                    "multipliers": [
                                      {
                                        "$var": {
                                          "path": "#data.quantity"
                                        }
                                      },
                                      {
                                        "$var": {
                                          "path": "#data.unitPriceWithDiscountOrMarkup"
                                        }
                                      },
                                      {
                                        "$var": {
                                          "path": "#dayCount"
                                        }
                                      }
                                    ]
                                  }
                                },
                                "exp": -2
                              }
                            }
                          }
                        }
                      },
                      "quantity-change": {
                        "subscriber": "totalPriceWithDiscountOrMarkup",
                        "action": {
                          "$populate": {
                            "path": "#data.totalPriceWithDiscountOrMarkup",
                            "emitEvent": false,
                            "data": {
                              "$math-round": {
                                "value": {
                                  "$add": {
                                    "multipliers": [
                                      {
                                        "$var": {
                                          "path": "#data.quantity"
                                        }
                                      },
                                      {
                                        "$var": {
                                          "path": "#data.unitPriceWithDiscountOrMarkup"
                                        }
                                      },
                                      {
                                        "$var": {
                                          "path": "#dayCount"
                                        }
                                      }
                                    ]
                                  }
                                },
                                "exp": -2
                              }
                            }
                          }
                        }
                      },
                      "day-count-change": {
                        "subscriber": "totalPriceWithDiscountOrMarkup",
                        "action": {
                          "$populate": {
                            "path": "#data.totalPriceWithDiscountOrMarkup",
                            "emitEvent": false,
                            "data": {
                              "$add": {
                                "multipliers": [
                                  {
                                    "$var": {
                                      "path": "#data.quantity"
                                    }
                                  },
                                  {
                                    "$var": {
                                      "path": "#data.unitPriceWithDiscountOrMarkup"
                                    }
                                  },
                                  {
                                    "$var": {
                                      "path": "#dayCount"
                                    }
                                  }
                                ]
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "validation": [
                    {
                      "type": "schema",
                      "params": {
                        "rule": {
                          "$if": {
                            "condition": {
                              "===": {
                                "operand1": {
                                  "$var": {
                                    "path": "#data.discountOrMarkupFlag"
                                  }
                                },
                                "operand2": "discount"
                              }
                            },
                            "then": {
                              "<": {
                                "operand1": {
                                  "$var": {
                                    "path": "."
                                  }
                                },
                                "operand2": {
                                  "$var": {
                                    "path": "#data.totalPrice"
                                  }
                                }
                              }
                            },
                            "else": true
                          }
                        },
                        "message": "Общая стоимость со скидкой не может превышать стоимость без скидки"
                      },
                      "events": [
                        "onUpdate"
                      ]
                    },
                    {
                      "type": "schema",
                      "params": {
                        "rule": {
                          "$if": {
                            "condition": {
                              "===": {
                                "operand1": {
                                  "$var": {
                                    "path": "#data.discountOrMarkupFlag"
                                  }
                                },
                                "operand2": "markup"
                              }
                            },
                            "then": {
                              ">": {
                                "operand1": {
                                  "$var": {
                                    "path": "."
                                  }
                                },
                                "operand2": {
                                  "$var": {
                                    "path": "#data.totalPrice"
                                  }
                                }
                              }
                            },
                            "else": true
                          }
                        },
                        "message": "Общая стоимость с наценкой должна превышать стоимость без наценки"
                      },
                      "events": [
                        "onUpdate"
                      ]
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "actions": {
      "type": "object",
      "model": false,
      "widget": {
        "name": "container",
        "class": {
          "group": "form-actions p-field p-grid mrg-t-lg",
          "value": "p-jc-xl-end p-autolayout"
        }
      },
      "properties": {
        "save": {
          "type": "string",
          "model": false,
          "widget": {
            "name": "button",
            "options": {
              "label": "Сохранить"
            },
            "events": {
              "click": {
                "$if": {
                  "condition": {
                    "$validate": {
                      "path": "/"
                    }
                  },
                  "then": {
                    "$if": {
                      "condition": {
                        "$or": {
                          "operands": [
                            {
                              "$and": {
                                "operands": [
                                  {
                                    "===": {
                                      "operand1": {
                                        "$var": {
                                          "path": "#data.discountOrMarkupFlag"
                                        }
                                      },
                                      "operand2": "no"
                                    }
                                  },
                                  {
                                    "$in": {
                                      "value": {
                                        "$from-context": {
                                          "path": "@preload.facility.event.state"
                                        }
                                      },
                                      "array": [
                                        "new",
                                        "draft",
                                        "pre_booking"
                                      ]
                                    }
                                  }
                                ]
                              }
                            },
                            {
                              "$and": {
                                "operands": [
                                  {
                                    "===": {
                                      "operand1": {
                                        "$from-context": {
                                          "path": "@preload.facility.booking.state"
                                        }
                                      },
                                      "operand2": "not_filled"
                                    }
                                  },
                                  {
                                    "===": {
                                      "operand1": {
                                        "$var": {
                                          "path": "#data.discountOrMarkupFlag"
                                        }
                                      },
                                      "operand2": "no"
                                    }
                                  }
                                ]
                              }
                            },
                            {
                              "$and": {
                                "operands": [
                                  {
                                    "===": {
                                      "operand1": {
                                        "$from-context": {
                                          "path": "@preload.facility.booking.state"
                                        }
                                      },
                                      "operand2": "filled"
                                    }
                                  },
                                  {
                                    "===": {
                                      "operand1": {
                                        "$from-context": {
                                          "path": "@preload.facility.state"
                                        }
                                      },
                                      "operand2": "not_filled"
                                    }
                                  },
                                  {
                                    "===": {
                                      "operand1": {
                                        "$var": {
                                          "path": "#data.discountOrMarkupFlag"
                                        }
                                      },
                                      "operand2": "no"
                                    }
                                  }
                                ]
                              }
                            },
                            {
                              "$active-user-has-permission": {
                                "permission": "request.accept.new"
                              }
                            },
                            {
                              "$and": {
                                "operands": [
                                  {
                                    "$active-user-has-permission": {
                                      "permission": "additional_facilities.edit_part"
                                    }
                                  },
                                  {
                                    "===": {
                                      "operand1": {
                                        "$var": {
                                          "path": "#data.discountOrMarkupFlag"
                                        }
                                      },
                                      "operand2": "no"
                                    }
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      },
                      "then": {
                        "$waterfall": {
                          "arrayFunctions": [
                            "$ref:operation-frontend:snippets/element/_loading/onclick-loading-enable",
                            {
                              "$http-code": {
                                "200": [
                                  {
                                    "$switch": {
                                      "condition": {
                                        "$from-context": {
                                          "path": "@preload.facility.type"
                                        }
                                      },
                                      "default": {},
                                      "cases": [
                                        {
                                          "value": "additional_service",
                                          "action": {
                                            "$message": {
                                              "severity": "success",
                                              "summary": "Редактирование брони услуги",
                                              "detail": "Бронь услуги к помещению успешно изменена"
                                            }
                                          }
                                        },
                                        {
                                          "value": "equipment",
                                          "action": {
                                            "$message": {
                                              "severity": "success",
                                              "summary": "Редактирование брони оборудования",
                                              "detail": "Бронь оборудования к помещению успешно изменена"
                                            }
                                          }
                                        },
                                        {
                                          "value": "furniture",
                                          "action": {
                                            "$message": {
                                              "severity": "success",
                                              "summary": "Редактирование брони мебели",
                                              "detail": "Бронь мебели к помещению успешно изменена"
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  {
                                    "$navigate": {
                                      "commands": [
                                        "/cabinet/booking/edit"
                                      ],
                                      "extras": {
                                        "queryParams": {
                                          "id": {
                                            "$from-context": {
                                              "path": "@preload.facility.bookingId"
                                            }
                                          },
                                          "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"allEquipment\"}}"
                                        }
                                      }
                                    }
                                  }
                                ],
                                "422": [
                                  "$ref:operation-frontend:snippets/element/_http_message/http-errors-from-response"
                                ],
                                "client": {
                                  "$api-workflow": {
                                    "options": {
                                      "observe": "response"
                                    },
                                    "workflow": "additional_facilities",
                                    "action": "edit_for_booking",
                                    "type": "post",
                                    "id": {
                                      "$query-params": {
                                        "name": "id"
                                      }
                                    },
                                    "data": {
                                      "$assign-object": {
                                        "path": "hasPermission",
                                        "data": {
                                          "$if": {
                                            "condition": {
                                              "$active-user-has-permission": {
                                                "permission": "request.accept.new"
                                              }
                                            },
                                            "then": "accept_request",
                                            "else": {
                                              "$if": {
                                                "condition": {
                                                  "$active-user-has-permission": {
                                                    "permission": "additional_facilities.edit_part"
                                                  }
                                                },
                                                "then": "edit_part",
                                                "else": "no"
                                              }
                                            }
                                          }
                                        },
                                        "object": {
                                          "$exclude": {
                                            "data": {
                                              "$var": {
                                                "path": "#data"
                                              }
                                            },
                                            "exclude": [
                                              "type",
                                              "additionalService",
                                              "equipment",
                                              "furniture"
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "finalize": "$ref:operation-frontend:snippets/element/_loading/onclick-loading-disable",
                                "default": [
                                  {
                                    "$message": {
                                      "severity": "error",
                                      "summary": {
                                        "$switch": {
                                          "condition": {
                                            "$from-context": {
                                              "path": "@preload.facility.type"
                                            }
                                          },
                                          "default": {},
                                          "cases": [
                                            {
                                              "value": "additional_service",
                                              "action": "Редактирование брони услуги"
                                            },
                                            {
                                              "value": "equipment",
                                              "action": "Редактирование брони оборудования"
                                            },
                                            {
                                              "value": "furniture",
                                              "action": "Редактирование брони мебели"
                                            }
                                          ]
                                        }
                                      },
                                      "detail": "Непредвиденная ошибка"
                                    }
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      },
                      "else": {
                        "$confirmation": {
                          "header": "Подтверждение изменений",
                          "message": {
                            "$replace": {
                              "template": "Заявка с изменениями будет направлена на согласование. Все изменения применятся к брони после подтверждения данной заявки. Желаете продолжить?"
                            }
                          },
                          "accept": {
                            "$waterfall": {
                              "arrayFunctions": [
                                "$ref:operation-frontend:snippets/element/_loading/onclick-loading-enable",
                                {
                                  "$http-code": {
                                    "200": [
                                      {
                                        "$switch": {
                                          "condition": {
                                            "$from-context": {
                                              "path": "@preload.facility.type"
                                            }
                                          },
                                          "default": {},
                                          "cases": [
                                            {
                                              "value": "additional_service",
                                              "action": {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Редактирование брони дополнительной услуги",
                                                  "detail": "Заявка на изменение брони дополнительной услуги успешно отправлена"
                                                }
                                              }
                                            },
                                            {
                                              "value": "equipment",
                                              "action": {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Редактирование брони оборудования",
                                                  "detail": "Заявка на изменение брони оборудования успешно отправлена"
                                                }
                                              }
                                            },
                                            {
                                              "value": "furniture",
                                              "action": {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Редактирование брони мебели",
                                                  "detail": "Заявка на изменение брони мебели успешно отправлена"
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      {
                                        "$navigate": {
                                          "commands": [
                                            "/cabinet/booking/edit"
                                          ],
                                          "extras": {
                                            "queryParams": {
                                              "id": {
                                                "$from-context": {
                                                  "path": "@preload.facility.bookingId"
                                                }
                                              },
                                              "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"allEquipment\"}}"
                                            }
                                          }
                                        }
                                      }
                                    ],
                                    "422": [
                                      "$ref:operation-frontend:snippets/element/_http_message/http-errors-from-response"
                                    ],
                                    "client": {
                                      "$api-workflow": {
                                        "options": {
                                          "observe": "response"
                                        },
                                        "workflow": "additional_facilities",
                                        "action": "edit_for_booking",
                                        "type": "post",
                                        "id": {
                                          "$query-params": {
                                            "name": "id"
                                          }
                                        },
                                        "data": {
                                          "$assign-object": {
                                            "path": "hasPermission",
                                            "data": {
                                              "$if": {
                                                "condition": {
                                                  "$active-user-has-permission": {
                                                    "permission": "request.accept.new"
                                                  }
                                                },
                                                "then": "accept_request",
                                                "else": {
                                                  "$if": {
                                                    "condition": {
                                                      "$active-user-has-permission": {
                                                        "permission": "additional_facilities.edit_part"
                                                      }
                                                    },
                                                    "then": "edit_part",
                                                    "else": "no"
                                                  }
                                                }
                                              }
                                            },
                                            "object": {
                                              "$exclude": {
                                                "data": {
                                                  "$var": {
                                                    "path": "#data"
                                                  }
                                                },
                                                "exclude": [
                                                  "type",
                                                  "additionalService",
                                                  "equipment",
                                                  "furniture"
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "finalize": "$ref:operation-frontend:snippets/element/_loading/onclick-loading-disable",
                                    "default": [
                                      {
                                        "$message": {
                                          "severity": "error",
                                          "summary": {
                                            "$switch": {
                                              "condition": {
                                                "$from-context": {
                                                  "path": "@preload.facility.type"
                                                }
                                              },
                                              "default": {},
                                              "cases": [
                                                {
                                                  "value": "additional_service",
                                                  "action": "Редактирование брони услуги"
                                                },
                                                {
                                                  "value": "equipment",
                                                  "action": "Редактирование брони оборудования"
                                                },
                                                {
                                                  "value": "furniture",
                                                  "action": "Редактирование брони мебели"
                                                }
                                              ]
                                            }
                                          },
                                          "detail": "Непредвиденная ошибка"
                                        }
                                      }
                                    ]
                                  }
                                }
                              ]
                            }
                          },
                          "acceptLabel": "Подтвердить",
                          "rejectLabel": "Отмена",
                          "rejectButtonStyleClass": "button_outline",
                          "reject": false
                        }
                      }
                    }
                  },
                  "else": {
                    "$form-control-mark": {
                      "key": "form"
                    }
                  }
                }
              }
            },
            "class": {
              "value": "mrg-r-sm"
            }
          }
        },
        "cancel": {
          "model": false,
          "widget": {
            "name": "button",
            "options": {
              "label": "Отмена"
            },
            "events": {
              "click": {
                "$navigate": {
                  "commands": [
                    "/cabinet/booking/edit"
                  ],
                  "extras": {
                    "queryParams": {
                      "id": {
                        "$from-context": {
                          "path": "@preload.facility.bookingId"
                        }
                      },
                      "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"allEquipment\"}}"
                    }
                  }
                }
              }
            },
            "class": {
              "value": "button_outline mrg-r-0 mrg-b-0"
            }
          }
        }
      }
    }
  }
}
