{
  "@title": "Редактирование брони помещения",
  "@preload": {
    "booking": {
      "$from-context": {
        "path": "$response.body.data.object.0",
        "data": {
          "$api-data": {
            "options": {
              "observe": "response"
            },
            "workflow": "booking",
            "action": "edit",
            "id": {
              "$query-params": {
                "name": "id"
              }
            },
            "query": "booking/get",
            "variables": {
              "id": {
                "$query-params": {
                  "name": "id"
                }
              }
            }
          }
        }
      }
    }
  },
  "type": "object",
  "widget": {
    "name": "container"
  },
  "properties": {
    "modals": {
      "model": false,
      "type": "object",
      "widget": "container",
      "properties": {
        "selectInstallationDate": {
          "type": "object",
          "model": "#modalSelectInstallationDate",
          "widget": {
            "name": "dialog",
            "options": {
              "visible": false,
              "closable": true
            }
          },
          "properties": {
            "content": {
              "type": "object",
              "model": false,
              "widget": {
                "name": "container"
              },
              "properties": {
                "positionIndex": {
                  "type": "number",
                  "widget": "hidden",
                  "model": "#modalSelectInstallationDate.positionIndex"
                },
                "header": {
                  "type": "string",
                  "model": false,
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": {
                        "$if": {
                          "condition": {
                            "$empty": {
                              "data": {
                                "$subs": {
                                  "path": "#modalSelectInstallationDate.positionIndex"
                                }
                              }
                            }
                          },
                          "then": "Добавление даты проведения монтажа",
                          "else": "Редактирование даты проведения монтажа"
                        }
                      }
                    },
                    "kind": "container-popup-with-h1-no-form-collapsed-style"
                  }
                },
                "datesInstallation": {
                  "model": false,
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Период монтажа"
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "value": "form-item p-field p-grid p-fluid row p-md-8 p-xs-12"
                    }
                  },
                  "properties": {
                    "startTime": {
                      "type": "datetime",
                      "model": "#modalSelectInstallationDate.startTime",
                      "widget": {
                        "name": "calendar",
                        "class": {
                          "group": "form-item-element calendar-range_start p-xs-12 p-md-6",
                          "label": "form-label form-label_required"
                        },
                        "events": {
                          "change": [
                            {
                              "$validate": {
                                "path": "#modalSelectInstallationDate"
                              }
                            },
                            {
                              "$if": {
                                "condition": {
                                  "$and": {
                                    "operands": [
                                      {
                                        "$empty": {
                                          "data": {
                                            "$var": {
                                              "path": "#modalSelectInstallationDate.endTime"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "$not-empty": {
                                          "data": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    ]
                                  }
                                },
                                "then": {
                                  "$populate": {
                                    "path": "#modalSelectInstallationDate.endTime",
                                    "data": {
                                      "$apply-func": {
                                        "func": "let dateTime = new Date(dateString); return dateTime.setMinutes(dateTime.getMinutes() + 30);",
                                        "args": {
                                          "dateString": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {}
                              }
                            }
                          ]
                        },
                        "kind": "calendar-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Обязательно для заполнения"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "endTime": {
                      "type": "datetime",
                      "model": "#modalSelectInstallationDate.endTime",
                      "widget": {
                        "name": "calendar",
                        "class": {
                          "group": "form-item-element calendar-range_end p-xs-12 p-md-6",
                          "label": "form-label form-label_required"
                        },
                        "events": {
                          "change": [
                            {
                              "$validate": {
                                "path": "#modalSelectInstallationDate"
                              }
                            },
                            {
                              "$if": {
                                "condition": {
                                  "$and": {
                                    "operands": [
                                      {
                                        "$empty": {
                                          "data": {
                                            "$var": {
                                              "path": "#modalSelectInstallationDate.startTime"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "$not-empty": {
                                          "data": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    ]
                                  }
                                },
                                "then": {
                                  "$populate": {
                                    "path": "#modalSelectInstallationDate.startTime",
                                    "data": {
                                      "$apply-func": {
                                        "func": "let dateTime = new Date(dateString); return dateTime.setMinutes(dateTime.getMinutes() - 30);",
                                        "args": {
                                          "dateString": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {}
                              }
                            }
                          ]
                        },
                        "kind": "calendar-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Обязательно для заполнения"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">=": {
                                    "operand1": {
                                      "$apply-func": {
                                        "func": "let dateTime = new Date(dateString); return dateTime.setMinutes(dateTime.getMinutes() - 30);",
                                        "args": {
                                          "dateString": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "operand2": {
                                      "$date-from": {
                                        "data": {
                                          "$var": {
                                            "path": "#modalSelectInstallationDate.startTime"
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Время проведения монтажных работ должно быть более 30 минут"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$apply-func": {
                                    "func": "let dateTimeStart = new Date(dateTimeStartString); let dateTimeEnd = new Date(dateTimeEndString); return ((dateTimeStart.getDate())==(dateTimeEnd.getDate()) && (dateTimeStart.getMonth())==(dateTimeEnd.getMonth()) && (dateTimeStart.getFullYear())==(dateTimeEnd.getFullYear()));",
                                    "args": {
                                      "dateTimeEndString": {
                                        "$var": {
                                          "path": "."
                                        }
                                      },
                                      "dateTimeStartString": {
                                        "$var": {
                                          "path": "#modalSelectInstallationDate.startTime"
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Монтаж должен занимать менее 24 часов в рамках одного дня"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$empty": {
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$var": {
                                            "path": "#data.installationDates"
                                          }
                                        },
                                        "filter": {
                                          "$not": {
                                            "data": {
                                              "$or": {
                                                "operands": [
                                                  {
                                                    "$if": {
                                                      "condition": {
                                                        "$not-empty": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectInstallationDate.positionIndex"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "then": {
                                                        "===": {
                                                          "operand1": {
                                                            "$type-conversion": {
                                                              "data": {
                                                                "$sum": {
                                                                  "terms": [
                                                                    1,
                                                                    {
                                                                      "$var": {
                                                                        "path": "#modalSelectInstallationDate.positionIndex"
                                                                      }
                                                                    }
                                                                  ]
                                                                }
                                                              }
                                                            }
                                                          },
                                                          "operand2": {
                                                            "$from-context": {
                                                              "path": "$data.number"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "else": false
                                                    }
                                                  },
                                                  {
                                                    ">": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectInstallationDate.startTime"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.endTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "<": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "."
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.startTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Заданный период времени уже зарезервирован для проведения демонтажа в выбранном помещении"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$empty": {
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$var": {
                                            "path": "#data.eventDates"
                                          }
                                        },
                                        "filter": {
                                          "$not": {
                                            "data": {
                                              "$or": {
                                                "operands": [
                                                  {
                                                    ">": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectInstallationDate.startTime"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.endTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "<": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "."
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.startTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Заданный период времени уже зарезервирован для проведения мероприятия в выбранном помещении"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$empty": {
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$var": {
                                            "path": "#data.deinstallationDates"
                                          }
                                        },
                                        "filter": {
                                          "$not": {
                                            "data": {
                                              "$or": {
                                                "operands": [
                                                  {
                                                    ">": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectInstallationDate.startTime"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.endTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "<": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "."
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.startTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Заданный период времени уже зарезервирован для проведения демонтажа в выбранном помещении"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "===": {
                                    "operand1": 0,
                                    "operand2": {
                                      "$fetch-object": {
                                        "path": "data.count",
                                        "data": {
                                          "$api-data": {
                                            "query": "stop_list_note/get_for_booking_validate",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "variables": {
                                              "dateTimeFrom": {
                                                "$var": {
                                                  "path": "#modalSelectInstallationDate.startTime"
                                                }
                                              },
                                              "dateTimeTo": {
                                                "$var": {
                                                  "path": "."
                                                }
                                              },
                                              "rooms": {
                                                "$array-pluck": {
                                                  "array": {
                                                    "$var": {
                                                      "path": "#data.rooms"
                                                    }
                                                  },
                                                  "key": "roomId"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Выбранное помещение недоступно для бронирования на заданный период времени"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        }
                      ]
                    }
                  }
                },
                "actions": {
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "class": {
                      "group": "form-actions p-field p-grid mrg-t-lg",
                      "value": "p-jc-xs-end p-autolayout"
                    }
                  },
                  "properties": {
                    "add": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Добавить",
                          "visible": {
                            "$empty": {
                              "data": {
                                "$subs": {
                                  "path": "#modalSelectInstallationDate.positionIndex"
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$validate": {
                                  "path": "#modalSelectInstallationDate"
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$element-option": {
                                        "option": "visible",
                                        "path": "#modalSelectInstallationDate",
                                        "value": false
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#data.installationDates",
                                        "data": {
                                          "$array-push": {
                                            "array": {
                                              "$var": {
                                                "path": "#data.installationDates"
                                              }
                                            },
                                            "data": {
                                              "$assign-object": {
                                                "object": {
                                                  "$var": {
                                                    "path": "#modalSelectInstallationDate"
                                                  }
                                                },
                                                "data": {
                                                  "$sum": {
                                                    "terms": [
                                                      1,
                                                      {
                                                        "$length": {
                                                          "data": {
                                                            "$if": {
                                                              "condition": {
                                                                "$not-empty": {
                                                                  "data": {
                                                                    "$var": {
                                                                      "path": "#data.installationDates"
                                                                    }
                                                                  }
                                                                }
                                                              },
                                                              "then": {
                                                                "$var": {
                                                                  "path": "#data.installationDates"
                                                                }
                                                              },
                                                              "else": ""
                                                            }
                                                          }
                                                        }
                                                      }
                                                    ]
                                                  }
                                                },
                                                "path": "number"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$var": {
                                                "path": "#data.minDate"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$if": {
                                            "condition": {
                                              ">": {
                                                "operand1": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data.minDate"
                                                      }
                                                    }
                                                  }
                                                },
                                                "operand2": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#modalSelectInstallationDate.startTime"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$populate": {
                                                "path": "#data.minDate",
                                                "data": {
                                                  "$var": {
                                                    "path": "#modalSelectInstallationDate.startTime"
                                                  }
                                                }
                                              }
                                            },
                                            "else": {}
                                          }
                                        },
                                        "else": {
                                          "$populate": {
                                            "path": "#data.minDate",
                                            "data": {
                                              "$var": {
                                                "path": "#modalSelectInstallationDate.startTime"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$var": {
                                                "path": "#data.maxDate"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$if": {
                                            "condition": {
                                              "<": {
                                                "operand1": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data.maxDate"
                                                      }
                                                    }
                                                  }
                                                },
                                                "operand2": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#modalSelectInstallationDate.endTime"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$populate": {
                                                "path": "#data.maxDate",
                                                "data": {
                                                  "$var": {
                                                    "path": "#modalSelectInstallationDate.endTime"
                                                  }
                                                }
                                              }
                                            },
                                            "else": {}
                                          }
                                        },
                                        "else": {
                                          "$populate": {
                                            "path": "#data.maxDate",
                                            "data": {
                                              "$var": {
                                                "path": "#modalSelectInstallationDate.endTime"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$event-bus-publish": {
                                        "type": "day-count-change"
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#bookingInfo.table",
                                        "data": {
                                          "$api-table-workflow-data": {
                                            "model": "#bookingInfo.table",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "query": "booking/get_for_info",
                                            "variables": {
                                              "$assign-object": {
                                                "object": {
                                                  "rows": 10,
                                                  "first": 0
                                                },
                                                "data": {
                                                  "except": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  },
                                                  "minDate": {
                                                    "$subs": {
                                                      "path": "#data.minDate"
                                                    }
                                                  },
                                                  "maxDate": {
                                                    "$subs": {
                                                      "path": "#data.maxDate"
                                                    }
                                                  },
                                                  "roomsArr": {
                                                    "$array-pluck": {
                                                      "array": {
                                                        "$from-context": {
                                                          "path": "@preload.booking.rooms"
                                                        }
                                                      },
                                                      "key": "roomId"
                                                    }
                                                  }
                                                },
                                                "path": ""
                                              }
                                            },
                                            "errors": {
                                              "default": {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Ошибка",
                                                  "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$validate": {
                                        "path": "#data.deinstallationDates"
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$form-control-mark": {
                                  "key": "tabs"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "save": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Сохранить",
                          "visible": {
                            "$not-empty": {
                              "data": {
                                "$subs": {
                                  "path": "#modalSelectInstallationDate.positionIndex"
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$validate": {
                                  "path": "#modalSelectInstallationDate"
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$populate": {
                                        "type": "patch",
                                        "path": {
                                          "$replace": {
                                            "template": "#data.installationDates.{{0}}",
                                            "data": [
                                              {
                                                "$var": {
                                                  "path": "#modalSelectInstallationDate.positionIndex"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "data": {
                                          "$var": {
                                            "path": "#modalSelectInstallationDate"
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$element-option": {
                                        "option": "visible",
                                        "path": "#modalSelectInstallationDate",
                                        "value": false
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#data.minDate",
                                        "data": {
                                          "$apply-func": {
                                            "func": "let minStartTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (!minStartTime || new Date(date.startTime) < minStartTime) { minStartTime = new Date(date.startTime); } }); return minStartTime;",
                                            "args": {
                                              "installationDates": {
                                                "$var": {
                                                  "path": "#data.installationDates"
                                                }
                                              },
                                              "eventDates": {
                                                "$var": {
                                                  "path": "#data.eventDates"
                                                }
                                              },
                                              "deinstallationDates": {
                                                "$var": {
                                                  "path": "#data.deinstallationDates"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#data.maxDate",
                                        "data": {
                                          "$apply-func": {
                                            "func": "let maxEndTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (new Date(date.endTime) > maxEndTime) { maxEndTime = new Date(date.endTime); } }); return maxEndTime;",
                                            "args": {
                                              "installationDates": {
                                                "$var": {
                                                  "path": "#data.installationDates"
                                                }
                                              },
                                              "eventDates": {
                                                "$var": {
                                                  "path": "#data.eventDates"
                                                }
                                              },
                                              "deinstallationDates": {
                                                "$var": {
                                                  "path": "#data.deinstallationDates"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#bookingInfo.table",
                                        "data": {
                                          "$api-table-workflow-data": {
                                            "model": "#bookingInfo.table",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "query": "booking/get_for_info",
                                            "variables": {
                                              "$assign-object": {
                                                "object": {
                                                  "rows": 10,
                                                  "first": 0
                                                },
                                                "data": {
                                                  "except": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  },
                                                  "minDate": {
                                                    "$subs": {
                                                      "path": "#data.minDate"
                                                    }
                                                  },
                                                  "maxDate": {
                                                    "$subs": {
                                                      "path": "#data.maxDate"
                                                    }
                                                  },
                                                  "roomsArr": {
                                                    "$array-pluck": {
                                                      "array": {
                                                        "$from-context": {
                                                          "path": "@preload.booking.rooms"
                                                        }
                                                      },
                                                      "key": "roomId"
                                                    }
                                                  }
                                                },
                                                "path": ""
                                              }
                                            },
                                            "errors": {
                                              "default": {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Ошибка",
                                                  "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$validate": {
                                        "path": "#data.deinstallationDates"
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$form-control-mark": {
                                  "key": "tabs"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "cancel": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Отмена"
                        },
                        "events": {
                          "click": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#modalSelectInstallationDate",
                              "value": false
                            }
                          }
                        },
                        "kind": "button-search-form-clear-button-right-style"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "selectEventDate": {
          "type": "object",
          "model": "#modalSelectEventDate",
          "widget": {
            "name": "dialog",
            "options": {
              "visible": false,
              "closable": true
            }
          },
          "properties": {
            "content": {
              "type": "object",
              "model": false,
              "widget": {
                "name": "container"
              },
              "properties": {
                "positionIndex": {
                  "type": "number",
                  "widget": "hidden",
                  "model": "#modalSelectEventDate.positionIndex"
                },
                "header": {
                  "type": "string",
                  "model": false,
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": {
                        "$if": {
                          "condition": {
                            "$empty": {
                              "data": {
                                "$subs": {
                                  "path": "#modalSelectEventDate.positionIndex"
                                }
                              }
                            }
                          },
                          "then": "Добавление даты проведения мероприятия",
                          "else": "Редактирование даты проведения мероприятия"
                        }
                      }
                    },
                    "kind": "container-popup-with-h1-no-form-collapsed-style"
                  }
                },
                "datesEvent": {
                  "model": false,
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Период мероприятия"
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "value": "form-item p-field p-grid p-fluid row p-md-8 p-xs-12"
                    }
                  },
                  "properties": {
                    "startTime": {
                      "type": "datetime",
                      "model": "#modalSelectEventDate.startTime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "dataType": "string"
                        },
                        "class": {
                          "group": "form-item-element calendar-range_start p-xs-12 p-md-6",
                          "label": "form-label form-label_required"
                        },
                        "events": {
                          "change": [
                            {
                              "$validate": {
                                "path": "#modalSelectEventDate"
                              }
                            },
                            {
                              "$if": {
                                "condition": {
                                  "$and": {
                                    "operands": [
                                      {
                                        "$empty": {
                                          "data": {
                                            "$var": {
                                              "path": "#modalSelectEventDate.endTime"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "$not-empty": {
                                          "data": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    ]
                                  }
                                },
                                "then": {
                                  "$populate": {
                                    "path": "#modalSelectEventDate.endTime",
                                    "data": {
                                      "$apply-func": {
                                        "func": "let dateTime = new Date(dateString); return dateTime.setMinutes(dateTime.getMinutes() + 30);",
                                        "args": {
                                          "dateString": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {}
                              }
                            }
                          ]
                        },
                        "kind": "calendar-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Обязательно для заполнения"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "endTime": {
                      "type": "datetime",
                      "model": "#modalSelectEventDate.endTime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "dataType": "string"
                        },
                        "class": {
                          "group": "form-item-element calendar-range_end p-xs-12 p-md-6",
                          "label": "form-label form-label_required"
                        },
                        "events": {
                          "change": [
                            {
                              "$validate": {
                                "path": "#modalSelectEventDate"
                              }
                            },
                            {
                              "$if": {
                                "condition": {
                                  "$and": {
                                    "operands": [
                                      {
                                        "$empty": {
                                          "data": {
                                            "$var": {
                                              "path": "#modalSelectEventDate.startTime"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "$not-empty": {
                                          "data": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    ]
                                  }
                                },
                                "then": {
                                  "$populate": {
                                    "path": "#modalSelectEventDate.startTime",
                                    "data": {
                                      "$apply-func": {
                                        "func": "let dateTime = new Date(dateString); return dateTime.setMinutes(dateTime.getMinutes() - 30);",
                                        "args": {
                                          "dateString": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {}
                              }
                            }
                          ]
                        },
                        "kind": "calendar-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Обязательно для заполнения"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">=": {
                                    "operand1": {
                                      "$apply-func": {
                                        "func": "let dateTime = new Date(dateString); return dateTime.setMinutes(dateTime.getMinutes() - 30);",
                                        "args": {
                                          "dateString": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "operand2": {
                                      "$date-from": {
                                        "data": {
                                          "$var": {
                                            "path": "#modalSelectEventDate.startTime"
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Время проведения мероприятия должно быть более 30 минут"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$apply-func": {
                                    "func": "let dateTimeStart = new Date(dateTimeStartString); let dateTimeEnd = new Date(dateTimeEndString); return ((dateTimeStart.getDate())==(dateTimeEnd.getDate()) && (dateTimeStart.getMonth())==(dateTimeEnd.getMonth()) && (dateTimeStart.getFullYear())==(dateTimeEnd.getFullYear()));",
                                    "args": {
                                      "dateTimeEndString": {
                                        "$var": {
                                          "path": "."
                                        }
                                      },
                                      "dateTimeStartString": {
                                        "$var": {
                                          "path": "#modalSelectEventDate.startTime"
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Мероприятие должно занимать менее 24 часов в рамках одного дня"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$empty": {
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$var": {
                                            "path": "#data.eventDates"
                                          }
                                        },
                                        "filter": {
                                          "$not": {
                                            "data": {
                                              "$or": {
                                                "operands": [
                                                  {
                                                    "$if": {
                                                      "condition": {
                                                        "$not-empty": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectEventDate.positionIndex"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "then": {
                                                        "===": {
                                                          "operand1": {
                                                            "$type-conversion": {
                                                              "data": {
                                                                "$sum": {
                                                                  "terms": [
                                                                    1,
                                                                    {
                                                                      "$var": {
                                                                        "path": "#modalSelectEventDate.positionIndex"
                                                                      }
                                                                    }
                                                                  ]
                                                                }
                                                              }
                                                            }
                                                          },
                                                          "operand2": {
                                                            "$from-context": {
                                                              "path": "$data.number"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "else": false
                                                    }
                                                  },
                                                  {
                                                    ">": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectEventDate.startTime"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.endTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "<": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "."
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.startTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Заданный период времени уже зарезервирован для проведения мероприятия в выбранном помещении"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$empty": {
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$var": {
                                            "path": "#data.installationDates"
                                          }
                                        },
                                        "filter": {
                                          "$not": {
                                            "data": {
                                              "$or": {
                                                "operands": [
                                                  {
                                                    ">": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectEventDate.startTime"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.endTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "<": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "."
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.startTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Заданный период времени уже зарезервирован для проведения монтажа в выбранном помещении"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$empty": {
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$var": {
                                            "path": "#data.deinstallationDates"
                                          }
                                        },
                                        "filter": {
                                          "$not": {
                                            "data": {
                                              "$or": {
                                                "operands": [
                                                  {
                                                    ">": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectEventDate.startTime"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.endTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "<": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "."
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.startTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Заданный период времени уже зарезервирован для проведения демонтажа в выбранном помещении"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "===": {
                                    "operand1": 0,
                                    "operand2": {
                                      "$fetch-object": {
                                        "path": "data.count",
                                        "data": {
                                          "$api-data": {
                                            "query": "stop_list_note/get_for_booking_validate",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "variables": {
                                              "dateTimeFrom": {
                                                "$var": {
                                                  "path": "#modalSelectEventDate.startTime"
                                                }
                                              },
                                              "dateTimeTo": {
                                                "$var": {
                                                  "path": "."
                                                }
                                              },
                                              "rooms": {
                                                "$array-pluck": {
                                                  "array": {
                                                    "$var": {
                                                      "path": "#data.rooms"
                                                    }
                                                  },
                                                  "key": "roomId"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Выбранное помещение недоступно для бронирования на заданный период времени"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        }
                      ]
                    }
                  }
                },
                "actions": {
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "class": {
                      "group": "form-actions p-field p-grid mrg-t-lg",
                      "value": "p-jc-xs-end p-autolayout"
                    }
                  },
                  "properties": {
                    "add": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Добавить",
                          "visible": {
                            "$empty": {
                              "data": {
                                "$subs": {
                                  "path": "#modalSelectEventDate.positionIndex"
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$validate": {
                                  "path": "#modalSelectEventDate"
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$element-option": {
                                        "option": "visible",
                                        "path": "#modalSelectEventDate",
                                        "value": false
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#data.eventDates",
                                        "data": {
                                          "$array-push": {
                                            "array": {
                                              "$var": {
                                                "path": "#data.eventDates"
                                              }
                                            },
                                            "data": {
                                              "$assign-object": {
                                                "object": {
                                                  "$var": {
                                                    "path": "#modalSelectEventDate"
                                                  }
                                                },
                                                "data": {
                                                  "$sum": {
                                                    "terms": [
                                                      1,
                                                      {
                                                        "$length": {
                                                          "data": {
                                                            "$if": {
                                                              "condition": {
                                                                "$not-empty": {
                                                                  "data": {
                                                                    "$var": {
                                                                      "path": "#data.eventDates"
                                                                    }
                                                                  }
                                                                }
                                                              },
                                                              "then": {
                                                                "$var": {
                                                                  "path": "#data.eventDates"
                                                                }
                                                              },
                                                              "else": ""
                                                            }
                                                          }
                                                        }
                                                      }
                                                    ]
                                                  }
                                                },
                                                "path": "number"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$var": {
                                                "path": "#data.minDate"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$if": {
                                            "condition": {
                                              ">": {
                                                "operand1": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data.minDate"
                                                      }
                                                    }
                                                  }
                                                },
                                                "operand2": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#modalSelectEventDate.startTime"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$populate": {
                                                "path": "#data.minDate",
                                                "data": {
                                                  "$var": {
                                                    "path": "#modalSelectEventDate.startTime"
                                                  }
                                                }
                                              }
                                            },
                                            "else": {}
                                          }
                                        },
                                        "else": {
                                          "$populate": {
                                            "path": "#data.minDate",
                                            "data": {
                                              "$var": {
                                                "path": "#modalSelectEventDate.startTime"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$var": {
                                                "path": "#data.maxDate"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$if": {
                                            "condition": {
                                              "<": {
                                                "operand1": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data.maxDate"
                                                      }
                                                    }
                                                  }
                                                },
                                                "operand2": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#modalSelectEventDate.endTime"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$populate": {
                                                "path": "#data.maxDate",
                                                "data": {
                                                  "$var": {
                                                    "path": "#modalSelectEventDate.endTime"
                                                  }
                                                }
                                              }
                                            },
                                            "else": {}
                                          }
                                        },
                                        "else": {
                                          "$populate": {
                                            "path": "#data.maxDate",
                                            "data": {
                                              "$var": {
                                                "path": "#modalSelectEventDate.endTime"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$event-bus-publish": {
                                        "type": "day-count-change"
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#bookingInfo.table",
                                        "data": {
                                          "$api-table-workflow-data": {
                                            "model": "#bookingInfo.table",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "query": "booking/get_for_info",
                                            "variables": {
                                              "$assign-object": {
                                                "object": {
                                                  "rows": 10,
                                                  "first": 0
                                                },
                                                "data": {
                                                  "except": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  },
                                                  "minDate": {
                                                    "$subs": {
                                                      "path": "#data.minDate"
                                                    }
                                                  },
                                                  "maxDate": {
                                                    "$subs": {
                                                      "path": "#data.maxDate"
                                                    }
                                                  },
                                                  "roomsArr": {
                                                    "$array-pluck": {
                                                      "array": {
                                                        "$from-context": {
                                                          "path": "@preload.booking.rooms"
                                                        }
                                                      },
                                                      "key": "roomId"
                                                    }
                                                  }
                                                },
                                                "path": ""
                                              }
                                            },
                                            "errors": {
                                              "default": {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Ошибка",
                                                  "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$validate": {
                                        "path": "#data.deinstallationDates"
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$form-control-mark": {
                                  "key": "tabs"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "save": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Сохранить",
                          "visible": {
                            "$not-empty": {
                              "data": {
                                "$subs": {
                                  "path": "#modalSelectEventDate.positionIndex"
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$validate": {
                                  "path": "#modalSelectEventDate"
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$populate": {
                                        "type": "patch",
                                        "path": {
                                          "$replace": {
                                            "template": "#data.eventDates.{{0}}",
                                            "data": [
                                              {
                                                "$var": {
                                                  "path": "#modalSelectEventDate.positionIndex"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "data": {
                                          "$var": {
                                            "path": "#modalSelectEventDate"
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$element-option": {
                                        "option": "visible",
                                        "path": "#modalSelectEventDate",
                                        "value": false
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#data.minDate",
                                        "data": {
                                          "$apply-func": {
                                            "func": "let minStartTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (!minStartTime || new Date(date.startTime) < minStartTime) { minStartTime = new Date(date.startTime); } }); return minStartTime;",
                                            "args": {
                                              "installationDates": {
                                                "$var": {
                                                  "path": "#data.installationDates"
                                                }
                                              },
                                              "eventDates": {
                                                "$var": {
                                                  "path": "#data.eventDates"
                                                }
                                              },
                                              "deinstallationDates": {
                                                "$var": {
                                                  "path": "#data.deinstallationDates"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#data.maxDate",
                                        "data": {
                                          "$apply-func": {
                                            "func": "let maxEndTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (new Date(date.endTime) > maxEndTime) { maxEndTime = new Date(date.endTime); } }); return maxEndTime;",
                                            "args": {
                                              "installationDates": {
                                                "$var": {
                                                  "path": "#data.installationDates"
                                                }
                                              },
                                              "eventDates": {
                                                "$var": {
                                                  "path": "#data.eventDates"
                                                }
                                              },
                                              "deinstallationDates": {
                                                "$var": {
                                                  "path": "#data.deinstallationDates"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#bookingInfo.table",
                                        "data": {
                                          "$api-table-workflow-data": {
                                            "model": "#bookingInfo.table",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "query": "booking/get_for_info",
                                            "variables": {
                                              "$assign-object": {
                                                "object": {
                                                  "rows": 10,
                                                  "first": 0
                                                },
                                                "data": {
                                                  "except": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  },
                                                  "minDate": {
                                                    "$subs": {
                                                      "path": "#data.minDate"
                                                    }
                                                  },
                                                  "maxDate": {
                                                    "$subs": {
                                                      "path": "#data.maxDate"
                                                    }
                                                  },
                                                  "roomsArr": {
                                                    "$array-pluck": {
                                                      "array": {
                                                        "$from-context": {
                                                          "path": "@preload.booking.rooms"
                                                        }
                                                      },
                                                      "key": "roomId"
                                                    }
                                                  }
                                                },
                                                "path": ""
                                              }
                                            },
                                            "errors": {
                                              "default": {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Ошибка",
                                                  "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$validate": {
                                        "path": "#data.deinstallationDates"
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$form-control-mark": {
                                  "key": "tabs"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "cancel": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Отмена"
                        },
                        "events": {
                          "click": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#modalSelectEventDate",
                              "value": false
                            }
                          }
                        },
                        "kind": "button-search-form-clear-button-right-style"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "selectDeinstallationDate": {
          "type": "object",
          "model": "#modalSelectDeinstallationDate",
          "widget": {
            "name": "dialog",
            "options": {
              "visible": false,
              "closable": true
            }
          },
          "properties": {
            "content": {
              "type": "object",
              "model": false,
              "widget": {
                "name": "container"
              },
              "properties": {
                "positionIndex": {
                  "type": "number",
                  "widget": "hidden",
                  "model": "#modalSelectDeinstallationDate.positionIndex"
                },
                "header": {
                  "type": "string",
                  "model": false,
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": {
                        "$if": {
                          "condition": {
                            "$empty": {
                              "data": {
                                "$subs": {
                                  "path": "#modalSelectDeinstallationDate.positionIndex"
                                }
                              }
                            }
                          },
                          "then": "Добавление даты проведения демонтажа",
                          "else": "Редактирование даты проведения демонтажа"
                        }
                      }
                    },
                    "kind": "container-popup-with-h1-no-form-collapsed-style"
                  }
                },
                "datesDeinstallation": {
                  "model": false,
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Период демонтажа"
                    },
                    "class": {
                      "group": "form-item p-field p-grid p-fluid",
                      "value": "form-item p-field p-grid p-fluid row p-md-8 p-xs-12"
                    }
                  },
                  "properties": {
                    "startTime": {
                      "type": "datetime",
                      "model": "#modalSelectDeinstallationDate.startTime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "dataType": "string"
                        },
                        "class": {
                          "group": "form-item-element calendar-range_start p-xs-12 p-md-6",
                          "label": "form-label form-label_required"
                        },
                        "events": {
                          "change": [
                            {
                              "$validate": {
                                "path": "#modalSelectDeinstallationDate"
                              }
                            },
                            {
                              "$if": {
                                "condition": {
                                  "$and": {
                                    "operands": [
                                      {
                                        "$empty": {
                                          "data": {
                                            "$var": {
                                              "path": "#modalSelectDeinstallationDate.endTime"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "$not-empty": {
                                          "data": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    ]
                                  }
                                },
                                "then": {
                                  "$populate": {
                                    "path": "#modalSelectDeinstallationDate.endTime",
                                    "data": {
                                      "$apply-func": {
                                        "func": "let dateTime = new Date(dateString); return dateTime.setMinutes(dateTime.getMinutes() + 30);",
                                        "args": {
                                          "dateString": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {}
                              }
                            }
                          ]
                        },
                        "kind": "calendar-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Обязательно для заполнения"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "endTime": {
                      "type": "datetime",
                      "model": "#modalSelectDeinstallationDate.endTime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "dataType": "string"
                        },
                        "class": {
                          "group": "form-item-element calendar-range_end p-xs-12 p-md-6",
                          "label": "form-label form-label_required"
                        },
                        "events": {
                          "change": [
                            {
                              "$validate": {
                                "path": "#modalSelectDeinstallationDate"
                              }
                            },
                            {
                              "$if": {
                                "condition": {
                                  "$and": {
                                    "operands": [
                                      {
                                        "$empty": {
                                          "data": {
                                            "$var": {
                                              "path": "#modalSelectDeinstallationDate.startTime"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "$not-empty": {
                                          "data": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    ]
                                  }
                                },
                                "then": {
                                  "$populate": {
                                    "path": "#modalSelectDeinstallationDate.startTime",
                                    "data": {
                                      "$apply-func": {
                                        "func": "let dateTime = new Date(dateString); return dateTime.setMinutes(dateTime.getMinutes() - 30);",
                                        "args": {
                                          "dateString": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {}
                              }
                            }
                          ]
                        },
                        "kind": "calendar-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Обязательно для заполнения"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">=": {
                                    "operand1": {
                                      "$apply-func": {
                                        "func": "let dateTime = new Date(dateString); return dateTime.setMinutes(dateTime.getMinutes() - 30);",
                                        "args": {
                                          "dateString": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "operand2": {
                                      "$date-from": {
                                        "data": {
                                          "$var": {
                                            "path": "#modalSelectDeinstallationDate.startTime"
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Время проведения демонтажных работ должно быть более 30 минут"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$apply-func": {
                                    "func": "let dateTimeStart = new Date(dateTimeStartString); let dateTimeEnd = new Date(dateTimeEndString); return ((dateTimeStart.getDate())==(dateTimeEnd.getDate()) && (dateTimeStart.getMonth())==(dateTimeEnd.getMonth()) && (dateTimeStart.getFullYear())==(dateTimeEnd.getFullYear()));",
                                    "args": {
                                      "dateTimeEndString": {
                                        "$var": {
                                          "path": "."
                                        }
                                      },
                                      "dateTimeStartString": {
                                        "$var": {
                                          "path": "#modalSelectDeinstallationDate.startTime"
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Демонтаж должен занимать менее 24 часов в рамках одного дня"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$empty": {
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$var": {
                                            "path": "#data.deinstallationDates"
                                          }
                                        },
                                        "filter": {
                                          "$not": {
                                            "data": {
                                              "$or": {
                                                "operands": [
                                                  {
                                                    "$if": {
                                                      "condition": {
                                                        "$not-empty": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectDeinstallationDate.positionIndex"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "then": {
                                                        "===": {
                                                          "operand1": {
                                                            "$type-conversion": {
                                                              "data": {
                                                                "$sum": {
                                                                  "terms": [
                                                                    1,
                                                                    {
                                                                      "$var": {
                                                                        "path": "#modalSelectDeinstallationDate.positionIndex"
                                                                      }
                                                                    }
                                                                  ]
                                                                }
                                                              }
                                                            }
                                                          },
                                                          "operand2": {
                                                            "$from-context": {
                                                              "path": "$data.number"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "else": false
                                                    }
                                                  },
                                                  {
                                                    ">": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectDeinstallationDate.startTime"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.endTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "<": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "."
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.startTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Заданный период времени уже зарезервирован для проведения демонтажа в выбранном помещении"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$empty": {
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$var": {
                                            "path": "#data.eventDates"
                                          }
                                        },
                                        "filter": {
                                          "$not": {
                                            "data": {
                                              "$or": {
                                                "operands": [
                                                  {
                                                    ">": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#modalSelectDeinstallationDate.startTime"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.endTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "<": {
                                                      "operand1": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "."
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": {
                                                        "$date-from": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$data.startTime"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Заданный период времени уже зарезервирован для проведения мероприятия в выбранном помещении"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$empty": {
                                "data": {
                                  "$array-filter": {
                                    "array": {
                                      "$var": {
                                        "path": "#data.installationDates"
                                      }
                                    },
                                    "filter": {
                                      "$not": {
                                        "data": {
                                          "$or": {
                                            "operands": [
                                              {
                                                ">": {
                                                  "operand1": {
                                                    "$date-from": {
                                                      "data": {
                                                        "$var": {
                                                          "path": "#modalSelectDeinstallationDate.startTime"
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "operand2": {
                                                    "$date-from": {
                                                      "data": {
                                                        "$from-context": {
                                                          "path": "$data.endTime"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              },
                                              {
                                                "<": {
                                                  "operand1": {
                                                    "$date-from": {
                                                      "data": {
                                                        "$var": {
                                                          "path": "."
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "operand2": {
                                                    "$date-from": {
                                                      "data": {
                                                        "$from-context": {
                                                          "path": "$data.startTime"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "message": "Заданный период времени уже зарезервирован для проведения монтажа в выбранном помещении"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "===": {
                                    "operand1": 0,
                                    "operand2": {
                                      "$fetch-object": {
                                        "path": "data.count",
                                        "data": {
                                          "$api-data": {
                                            "query": "stop_list_note/get_for_booking_validate",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "variables": {
                                              "dateTimeFrom": {
                                                "$var": {
                                                  "path": "#modalSelectDeinstallationDate.startTime"
                                                }
                                              },
                                              "dateTimeTo": {
                                                "$var": {
                                                  "path": "."
                                                }
                                              },
                                              "rooms": {
                                                "$array-pluck": {
                                                  "array": {
                                                    "$var": {
                                                      "path": "#data.rooms"
                                                    }
                                                  },
                                                  "key": "roomId"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Выбранное помещение недоступно для бронирования на заданный период времени"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        }
                      ]
                    }
                  }
                },
                "actions": {
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "class": {
                      "group": "form-actions p-field p-grid mrg-t-lg",
                      "value": "p-jc-xs-end p-autolayout"
                    }
                  },
                  "properties": {
                    "add": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Добавить",
                          "visible": {
                            "$empty": {
                              "data": {
                                "$subs": {
                                  "path": "#modalSelectDeinstallationDate.positionIndex"
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$validate": {
                                  "path": "#modalSelectDeinstallationDate"
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$element-option": {
                                        "option": "visible",
                                        "path": "#modalSelectDeinstallationDate",
                                        "value": false
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#data.deinstallationDates",
                                        "data": {
                                          "$array-push": {
                                            "array": {
                                              "$var": {
                                                "path": "#data.deinstallationDates"
                                              }
                                            },
                                            "data": {
                                              "$assign-object": {
                                                "object": {
                                                  "$var": {
                                                    "path": "#modalSelectDeinstallationDate"
                                                  }
                                                },
                                                "data": {
                                                  "$sum": {
                                                    "terms": [
                                                      1,
                                                      {
                                                        "$length": {
                                                          "data": {
                                                            "$if": {
                                                              "condition": {
                                                                "$not-empty": {
                                                                  "data": {
                                                                    "$var": {
                                                                      "path": "#data.deinstallationDates"
                                                                    }
                                                                  }
                                                                }
                                                              },
                                                              "then": {
                                                                "$var": {
                                                                  "path": "#data.deinstallationDates"
                                                                }
                                                              },
                                                              "else": ""
                                                            }
                                                          }
                                                        }
                                                      }
                                                    ]
                                                  }
                                                },
                                                "path": "number"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$var": {
                                                "path": "#data.minDate"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$if": {
                                            "condition": {
                                              ">": {
                                                "operand1": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data.minDate"
                                                      }
                                                    }
                                                  }
                                                },
                                                "operand2": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#modalSelectDeinstallationDate.startTime"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$populate": {
                                                "path": "#data.minDate",
                                                "data": {
                                                  "$var": {
                                                    "path": "#modalSelectDeinstallationDate.startTime"
                                                  }
                                                }
                                              }
                                            },
                                            "else": {}
                                          }
                                        },
                                        "else": {
                                          "$populate": {
                                            "path": "#data.minDate",
                                            "data": {
                                              "$var": {
                                                "path": "#modalSelectDeinstallationDate.startTime"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$var": {
                                                "path": "#data.maxDate"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$if": {
                                            "condition": {
                                              "<": {
                                                "operand1": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data.maxDate"
                                                      }
                                                    }
                                                  }
                                                },
                                                "operand2": {
                                                  "$date-from": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#modalSelectDeinstallationDate.endTime"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$populate": {
                                                "path": "#data.maxDate",
                                                "data": {
                                                  "$var": {
                                                    "path": "#modalSelectDeinstallationDate.endTime"
                                                  }
                                                }
                                              }
                                            },
                                            "else": {}
                                          }
                                        },
                                        "else": {
                                          "$populate": {
                                            "path": "#data.maxDate",
                                            "data": {
                                              "$var": {
                                                "path": "#modalSelectDeinstallationDate.endTime"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$event-bus-publish": {
                                        "type": "day-count-change"
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#bookingInfo.table",
                                        "data": {
                                          "$api-table-workflow-data": {
                                            "model": "#bookingInfo.table",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "query": "booking/get_for_info",
                                            "variables": {
                                              "$assign-object": {
                                                "object": {
                                                  "rows": 10,
                                                  "first": 0
                                                },
                                                "data": {
                                                  "except": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  },
                                                  "minDate": {
                                                    "$subs": {
                                                      "path": "#data.minDate"
                                                    }
                                                  },
                                                  "maxDate": {
                                                    "$subs": {
                                                      "path": "#data.maxDate"
                                                    }
                                                  },
                                                  "roomsArr": {
                                                    "$array-pluck": {
                                                      "array": {
                                                        "$from-context": {
                                                          "path": "@preload.booking.rooms"
                                                        }
                                                      },
                                                      "key": "roomId"
                                                    }
                                                  }
                                                },
                                                "path": ""
                                              }
                                            },
                                            "errors": {
                                              "default": {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Ошибка",
                                                  "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$validate": {
                                        "path": "#data.deinstallationDates"
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$form-control-mark": {
                                  "key": "tabs"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "save": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Сохранить",
                          "visible": {
                            "$not-empty": {
                              "data": {
                                "$subs": {
                                  "path": "#modalSelectDeinstallationDate.positionIndex"
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$validate": {
                                  "path": "#modalSelectDeinstallationDate"
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$populate": {
                                        "type": "patch",
                                        "path": {
                                          "$replace": {
                                            "template": "#data.deinstallationDates.{{0}}",
                                            "data": [
                                              {
                                                "$var": {
                                                  "path": "#modalSelectDeinstallationDate.positionIndex"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "data": {
                                          "$var": {
                                            "path": "#modalSelectDeinstallationDate"
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$element-option": {
                                        "option": "visible",
                                        "path": "#modalSelectDeinstallationDate",
                                        "value": false
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#data.minDate",
                                        "data": {
                                          "$apply-func": {
                                            "func": "let minStartTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (!minStartTime || new Date(date.startTime) < minStartTime) { minStartTime = new Date(date.startTime); } }); return minStartTime;",
                                            "args": {
                                              "installationDates": {
                                                "$var": {
                                                  "path": "#data.installationDates"
                                                }
                                              },
                                              "eventDates": {
                                                "$var": {
                                                  "path": "#data.eventDates"
                                                }
                                              },
                                              "deinstallationDates": {
                                                "$var": {
                                                  "path": "#data.deinstallationDates"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#data.maxDate",
                                        "data": {
                                          "$apply-func": {
                                            "func": "let maxEndTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (new Date(date.endTime) > maxEndTime) { maxEndTime = new Date(date.endTime); } }); return maxEndTime;",
                                            "args": {
                                              "installationDates": {
                                                "$var": {
                                                  "path": "#data.installationDates"
                                                }
                                              },
                                              "eventDates": {
                                                "$var": {
                                                  "path": "#data.eventDates"
                                                }
                                              },
                                              "deinstallationDates": {
                                                "$var": {
                                                  "path": "#data.deinstallationDates"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#bookingInfo.table",
                                        "data": {
                                          "$api-table-workflow-data": {
                                            "model": "#bookingInfo.table",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "query": "booking/get_for_info",
                                            "variables": {
                                              "$assign-object": {
                                                "object": {
                                                  "rows": 10,
                                                  "first": 0
                                                },
                                                "data": {
                                                  "except": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  },
                                                  "minDate": {
                                                    "$subs": {
                                                      "path": "#data.minDate"
                                                    }
                                                  },
                                                  "maxDate": {
                                                    "$subs": {
                                                      "path": "#data.maxDate"
                                                    }
                                                  },
                                                  "roomsArr": {
                                                    "$array-pluck": {
                                                      "array": {
                                                        "$from-context": {
                                                          "path": "@preload.booking.rooms"
                                                        }
                                                      },
                                                      "key": "roomId"
                                                    }
                                                  }
                                                },
                                                "path": ""
                                              }
                                            },
                                            "errors": {
                                              "default": {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Ошибка",
                                                  "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$validate": {
                                        "path": "#data.deinstallationDates"
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$form-control-mark": {
                                  "key": "tabs"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "cancel": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Отмена"
                        },
                        "events": {
                          "click": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#modalSelectDeinstallationDate",
                              "value": false
                            }
                          }
                        },
                        "kind": "button-search-form-clear-button-right-style"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "selectRoomServices": {
          "type": "object",
          "model": "#modalSelectRoomServices",
          "widget": {
            "name": "dialog",
            "options": {
              "visible": false,
              "closable": true
            }
          },
          "properties": {
            "content": {
              "type": "object",
              "widget": {
                "name": "container"
              },
              "properties": {
                "header": {
                  "type": "string",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Выбор дополнительных услуг"
                    },
                    "kind": "container-popup-with-h1-no-form-collapsed-style"
                  }
                },
                "search": {
                  "type": "object",
                  "model": "#searchRoomServices",
                  "widget": {
                    "name": "container",
                    "options": {
                      "displayNone": false,
                      "routerOptions": [
                        "displayNone"
                      ],
                      "visible": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueServiceIds = new Set(); rooms.forEach(room => { room.room.additional_services.forEach(service => { uniqueServiceIds.add(service.serviceId); }); }); return Array.from(uniqueServiceIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.additional_services"
                                    }
                                  },
                                  "key": "serviceId"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "kind": "container-search-form-collapsed-container-style"
                  },
                  "properties": {
                    "typeOrName": {
                      "type": "string",
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/length-255"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ],
                      "widget": {
                        "name": "input-group-button",
                        "options": {
                          "placeholder": "Наименование, тип услуги",
                          "actionButtonLabel": "Найти",
                          "actionButtonIconMobile": "icon-search",
                          "enableClearButton": true,
                          "visible": {
                            "$not-empty": {
                              "data": {
                                "$if": {
                                  "condition": {
                                    "$from-context": {
                                      "path": "@preload.booking.configuration"
                                    }
                                  },
                                  "then": {
                                    "$apply-func": {
                                      "func": " const uniqueServiceIds = new Set(); rooms.forEach(room => { room.room.additional_services.forEach(service => { uniqueServiceIds.add(service.serviceId); }); }); return Array.from(uniqueServiceIds);",
                                      "args": {
                                        "rooms": {
                                          "$from-context": {
                                            "path": "@preload.booking.rooms"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "else": {
                                    "$array-pluck": {
                                      "array": {
                                        "$from-context": {
                                          "path": "@preload.booking.rooms.0.room.additional_services"
                                        }
                                      },
                                      "key": "serviceId"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "actionButtonClick": {
                            "$grid": {
                              "action": "lazyLoad",
                              "path": "#selectorRoomServices",
                              "filters": {
                                "$var": {
                                  "path": "#searchRoomServices"
                                }
                              }
                            }
                          },
                          "keypress-13": {
                            "$grid": {
                              "action": "lazyLoad",
                              "path": "#selectorRoomServices",
                              "filters": {
                                "$var": {
                                  "path": "#searchRoomServices"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "selected-count": {
                  "type": "string",
                  "model": false,
                  "widget": {
                    "name": "html",
                    "class": {
                      "value": "mrg-b-xs"
                    }
                  },
                  "value": {
                    "$if": {
                      "condition": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueServiceIds = new Set(); rooms.forEach(room => { room.room.additional_services.forEach(service => { uniqueServiceIds.add(service.serviceId); }); }); return Array.from(uniqueServiceIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.additional_services"
                                    }
                                  },
                                  "key": "serviceId"
                                }
                              }
                            }
                          }
                        }
                      },
                      "then": {
                        "$replace": {
                          "template": "<p>Выбрано услуг: {{0}}</p>",
                          "data": [
                            {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$element-option": {
                                        "option": "selection$",
                                        "path": "#selectorRoomServices"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$length": {
                                    "data": {
                                      "$element-option": {
                                        "option": "selection$",
                                        "path": "#selectorRoomServices"
                                      }
                                    }
                                  }
                                },
                                "else": 0
                              }
                            }
                          ]
                        }
                      },
                      "else": "Для данного помещения нет доступных для выбора дополнительных услуг. Пожалуйста, прикрепите услуги к карточке помещения."
                    }
                  }
                },
                "selected-chips-room-service": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "widget": "info"
                  },
                  "model": "#selected-chips-room-service",
                  "widget": {
                    "name": "chips",
                    "class": {
                      "value": "chips-invite-suppliers mrg-b-sm"
                    },
                    "options": {
                      "onlyRemove": true,
                      "allowDuplicate": false,
                      "disabled": true,
                      "visible": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueServiceIds = new Set(); rooms.forEach(room => { room.room.additional_services.forEach(service => { uniqueServiceIds.add(service.serviceId); }); }); return Array.from(uniqueServiceIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.additional_services"
                                    }
                                  },
                                  "key": "serviceId"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "events": {
                      "onRemove": {
                        "$element-option": {
                          "path": "#selectorRoomServices",
                          "option": "selection",
                          "value": {
                            "$array-pluck": {
                              "array": {
                                "$array-filter": {
                                  "array": {
                                    "$element-option": {
                                      "path": "#selectorRoomServices",
                                      "option": "selectedRows"
                                    }
                                  },
                                  "filter": {
                                    "!==": {
                                      "operand1": {
                                        "$from-context": {
                                          "path": "$data.value.name"
                                        }
                                      },
                                      "operand2": {
                                        "$from-context": {
                                          "path": "$event.event"
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "key": "value.serviceId"
                            }
                          }
                        }
                      }
                    }
                  },
                  "value": {
                    "$if": {
                      "condition": {
                        "$and": {
                          "operands": [
                            {
                              "$not-empty": {
                                "data": {
                                  "$subs": {
                                    "path": "#selectorRoomServices"
                                  }
                                }
                              }
                            },
                            {
                              "$not-empty": {
                                "data": {
                                  "$element-option": {
                                    "path": "#selectorRoomServices",
                                    "option": "selection$"
                                  }
                                }
                              }
                            }
                          ]
                        }
                      },
                      "then": {
                        "$array-pluck": {
                          "array": {
                            "$fetch-object": {
                              "path": "data.items",
                              "data": {
                                "$api-data": {
                                  "query": "additional_service/get_name_for_select",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  },
                                  "variables": {
                                    "ids": {
                                      "$element-option": {
                                        "path": "#selectorRoomServices",
                                        "option": "selection$"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "key": "name"
                        }
                      },
                      "else": []
                    }
                  }
                },
                "table": {
                  "value": {
                    "$api-table-workflow-data": {
                      "model": "#selectorRoomServices",
                      "query": "additional_service/get_for_select",
                      "id": {
                        "$query-params": {
                          "name": "id"
                        }
                      },
                      "variables": {
                        "$assign-object": {
                          "object": {
                            "$graphql-event-variables": {
                              "data": {
                                "$element-event": {
                                  "event": "lazyLoad"
                                }
                              }
                            }
                          },
                          "data": {
                            "ids": {
                              "$if": {
                                "condition": {
                                  "$from-context": {
                                    "path": "@preload.booking.configuration"
                                  }
                                },
                                "then": {
                                  "$apply-func": {
                                    "func": " const uniqueServiceIds = new Set(); rooms.forEach(room => { room.room.additional_services.forEach(service => { uniqueServiceIds.add(service.serviceId); }); }); return Array.from(uniqueServiceIds);",
                                    "args": {
                                      "rooms": {
                                        "$from-context": {
                                          "path": "@preload.booking.rooms"
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {
                                  "$array-pluck": {
                                    "array": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms.0.room.additional_services"
                                      }
                                    },
                                    "key": "serviceId"
                                  }
                                }
                              }
                            }
                          },
                          "path": ""
                        }
                      },
                      "errors": {
                        "default": {
                          "$message": {
                            "severity": "error",
                            "summary": "Ошибка",
                            "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                          }
                        }
                      }
                    }
                  },
                  "type": "array",
                  "model": "#selectorRoomServices",
                  "widget": {
                    "name": "table-lazy",
                    "options": {
                      "selectionMode": "multiple",
                      "selectionField": "selected",
                      "selectionKey": "serviceId",
                      "first": 0,
                      "rows": 10,
                      "lazy": true,
                      "paginator": true,
                      "visible": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueServiceIds = new Set(); rooms.forEach(room => { room.room.additional_services.forEach(service => { uniqueServiceIds.add(service.serviceId); }); }); return Array.from(uniqueServiceIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.additional_services"
                                    }
                                  },
                                  "key": "serviceId"
                                }
                              }
                            }
                          }
                        }
                      },
                      "rowsPerPageOptions": [
                        10,
                        20,
                        50
                      ],
                      "routerOptions": [
                        "first",
                        "rows"
                      ],
                      "sortField": "name",
                      "sortOrder": 1
                    },
                    "class": {
                      "value": "data-table d-block mrg-b-lg"
                    },
                    "events": {
                      "lazyLoad": {
                        "$element-option": {
                          "path": "#selectorRoomServices",
                          "option": "loading",
                          "value": true
                        }
                      },
                      "onRowSelect": {
                        "$populate": {
                          "path": "#selected-chips-room-service",
                          "data": {
                            "$array-push": {
                              "array": {
                                "$var": {
                                  "path": "#selected-chips-room-service"
                                }
                              },
                              "data": {
                                "$from-context": {
                                  "path": "$event.event.value.name"
                                }
                              }
                            }
                          }
                        }
                      },
                      "onRowUnselect": {
                        "$populate": {
                          "path": "#selected-chips-room-service",
                          "data": {
                            "$array-filter": {
                              "array": {
                                "$var": {
                                  "path": "#selected-chips-room-service"
                                }
                              },
                              "filter": {
                                "!==": {
                                  "operand1": {
                                    "$from-context": {
                                      "path": "$data"
                                    }
                                  },
                                  "operand2": {
                                    "$from-context": {
                                      "path": "$event.event.value.name"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "onHeaderCheckboxToggle": {
                        "$if": {
                          "condition": {
                            "===": {
                              "operand1": {
                                "$from-context": {
                                  "path": "$event.event"
                                }
                              },
                              "operand2": true
                            }
                          },
                          "then": {
                            "$populate": {
                              "path": "#selected-chips-room-service",
                              "data": {
                                "$apply-func": {
                                  "func": "return [...new Set([...chipsArr, ...currPageServices])]",
                                  "args": {
                                    "chipsArr": {
                                      "$var": {
                                        "path": "#selected-chips-room-service"
                                      }
                                    },
                                    "currPageServices": {
                                      "$array-pluck": {
                                        "array": {
                                          "$var": {
                                            "path": "#selectorRoomServices"
                                          }
                                        },
                                        "key": "name"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "else": {
                            "$populate": {
                              "path": "#selected-chips-room-service",
                              "data": {
                                "$apply-func": {
                                  "func": "return chipsArr.filter( function( el ) { return currPageServices.indexOf( el ) < 0; } )",
                                  "args": {
                                    "chipsArr": {
                                      "$var": {
                                        "path": "#selected-chips-room-service"
                                      }
                                    },
                                    "currPageServices": {
                                      "$array-pluck": {
                                        "array": {
                                          "$var": {
                                            "path": "#selectorRoomServices"
                                          }
                                        },
                                        "key": "name"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "subscriptions": {
                      "reload-table": {
                        "$element-event": {
                          "event": "reload",
                          "value": true
                        }
                      }
                    }
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "selected": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "serviceId": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "name": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Наименование услуги"
                          }
                        }
                      },
                      "servicesType": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "widget": {
                              "name": "info"
                            }
                          }
                        },
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Тип услуги"
                          }
                        }
                      },
                      "unitPrice": {
                        "type": "number",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "unitPriceView": {
                        "type": "object",
                        "model": false,
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Цена (руб.)"
                          }
                        },
                        "properties": {
                          "price": {
                            "type": "string",
                            "model": false,
                            "widget": {
                              "name": "info",
                              "options": {
                                "formatter": "number:'0.2-2':'ru'",
                                "viewedValue": {
                                  "$from-context": {
                                    "path": "$rowData.unitPrice"
                                  }
                                }
                              },
                              "class": {
                                "group": "p-text-right",
                                "value": "p-jc-end"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "actions": {
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "class": {
                      "group": "form-actions p-field p-grid mrg-t-lg",
                      "value": "p-jc-xs-end p-autolayout"
                    }
                  },
                  "properties": {
                    "save": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Добавить выбранные",
                          "visible": {
                            "$not-empty": {
                              "data": {
                                "$if": {
                                  "condition": {
                                    "$from-context": {
                                      "path": "@preload.booking.configuration"
                                    }
                                  },
                                  "then": {
                                    "$apply-func": {
                                      "func": " const uniqueServiceIds = new Set(); rooms.forEach(room => { room.room.additional_services.forEach(service => { uniqueServiceIds.add(service.serviceId); }); }); return Array.from(uniqueServiceIds);",
                                      "args": {
                                        "rooms": {
                                          "$from-context": {
                                            "path": "@preload.booking.rooms"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "else": {
                                    "$array-pluck": {
                                      "array": {
                                        "$from-context": {
                                          "path": "@preload.booking.rooms.0.room.additional_services"
                                        }
                                      },
                                      "key": "serviceId"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$not-empty": {
                                  "data": {
                                    "$element-option": {
                                      "path": "#selectorRoomServices",
                                      "option": "selection"
                                    }
                                  }
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$assign-context": {
                                        "path": "$addedService",
                                        "data": {
                                          "$array-filter": {
                                            "array": {
                                              "$element-option": {
                                                "path": "#selectorRoomServices",
                                                "option": "selection"
                                              }
                                            },
                                            "filter": {
                                              "$not": {
                                                "data": {
                                                  "$in": {
                                                    "value": {
                                                      "$from-context": {
                                                        "path": "$data"
                                                      }
                                                    },
                                                    "array": {
                                                      "$array-pluck": {
                                                        "array": {
                                                          "$fetch-object": {
                                                            "path": "data.items",
                                                            "data": {
                                                              "$api-data": {
                                                                "query": "additional_facilities/get_for_select_in_booking",
                                                                "id": {
                                                                  "$query-params": {
                                                                    "name": "id"
                                                                  }
                                                                },
                                                                "variables": {
                                                                  "eventId": {
                                                                    "$from-context": {
                                                                      "path": "@preload.booking.eventId"
                                                                    }
                                                                  },
                                                                  "bookingId": {
                                                                    "$query-params": {
                                                                      "name": "id"
                                                                    }
                                                                  },
                                                                  "facilityType": "additional_service"
                                                                }
                                                              }
                                                            }
                                                          }
                                                        },
                                                        "key": "serviceId"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$from-context": {
                                                "path": "$addedService"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$http-code": {
                                            "200": [
                                              {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Добавление брони дополнительной услуги",
                                                  "detail": "Бронь дополнительной услуги к помещению успешно добавлена"
                                                }
                                              },
                                              {
                                                "$element-option": {
                                                  "option": "visible",
                                                  "path": "#modalSelectRoomServices",
                                                  "value": false
                                                }
                                              },
                                              {
                                                "$event-bus-publish": {
                                                  "type": "reload-service-table"
                                                }
                                              }
                                            ],
                                            "422": [
                                              {
                                                "$validate": {
                                                  "errors": {
                                                    "$from-context": {
                                                      "path": "$response.error.errors"
                                                    }
                                                  }
                                                }
                                              }
                                            ],
                                            "client": {
                                              "$api-workflow": {
                                                "type": "post",
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "workflow": "additional_facilities",
                                                "action": "mass_add_for_booking",
                                                "data": {
                                                  "facilities": {
                                                    "$from-context": {
                                                      "path": "$addedService"
                                                    }
                                                  },
                                                  "type": "additional_service",
                                                  "bookingId": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  },
                                                  "eventId": {
                                                    "$from-context": {
                                                      "path": "@preload.booking.eventId"
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "default": [
                                              {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Добавление брони дополнительной услуги",
                                                  "detail": "Непредвиденная ошибка"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "else": {
                                          "$element-option": {
                                            "option": "visible",
                                            "path": "#modalSelectRoomServices",
                                            "value": false
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$element-option": {
                                  "option": "visible",
                                  "path": "#modalSelectRoomServices",
                                  "value": false
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "viewRoom": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "К просмотру помещения",
                          "visible": {
                            "$and": {
                              "operands": [
                                {
                                  "$empty": {
                                    "data": {
                                      "$if": {
                                        "condition": {
                                          "$from-context": {
                                            "path": "@preload.booking.configuration"
                                          }
                                        },
                                        "then": {
                                          "$apply-func": {
                                            "func": "const uniqueServiceIds = new Set(); rooms.forEach(room => { room.room.additional_services.forEach(service => { uniqueServiceIds.add(service.serviceId); }); }); return Array.from(uniqueServiceIds);",
                                            "args": {
                                              "rooms": {
                                                "$from-context": {
                                                  "path": "@preload.booking.rooms"
                                                }
                                              }
                                            }
                                          }
                                        },
                                        "else": {
                                          "$array-pluck": {
                                            "array": {
                                              "$from-context": {
                                                "path": "@preload.booking.rooms.0.room.additional_services"
                                              }
                                            },
                                            "key": "serviceId"
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                {
                                  "$active-user-has-permission": {
                                    "permission": "room.view"
                                  }
                                },
                                {
                                  "$not": {
                                    "data": {
                                      "$from-context": {
                                        "path": "@preload.booking.configuration"
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$window-open": {
                              "url": {
                                "$replace": {
                                  "template": "/cabinet/room/view?id={{id}}",
                                  "data": {
                                    "id": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms.0.roomId"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "cancel": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Отмена"
                        },
                        "events": {
                          "click": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#modalSelectRoomServices",
                              "value": false
                            }
                          }
                        },
                        "kind": "button-search-form-clear-button-right-style"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "selectEquipments": {
          "type": "object",
          "model": "#modalSelectEquipments",
          "widget": {
            "name": "dialog",
            "options": {
              "visible": false,
              "closable": true
            }
          },
          "properties": {
            "content": {
              "type": "object",
              "widget": {
                "name": "container"
              },
              "properties": {
                "header": {
                  "type": "string",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Выбор оборудования"
                    },
                    "kind": "container-popup-with-h1-no-form-collapsed-style"
                  }
                },
                "search": {
                  "type": "object",
                  "model": "#searchEquipment",
                  "widget": {
                    "name": "container",
                    "options": {
                      "displayNone": false,
                      "routerOptions": [
                        "displayNone"
                      ],
                      "visible": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueEquipmentsIds = new Set(); rooms.forEach(room => { room.room.equipments.forEach(equipment => { uniqueEquipmentsIds.add(equipment.equipmentId); }); }); return Array.from(uniqueEquipmentsIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.equipments"
                                    }
                                  },
                                  "key": "equipmentId"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "kind": "container-search-form-collapsed-container-style"
                  },
                  "properties": {
                    "typeOrNumber": {
                      "type": "string",
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/length-255"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ],
                      "widget": {
                        "name": "input-group-button",
                        "options": {
                          "placeholder": "Наименование, номенклатурный номер оборудования",
                          "actionButtonLabel": "Найти",
                          "actionButtonIconMobile": "icon-search",
                          "enableClearButton": true
                        },
                        "events": {
                          "actionButtonClick": {
                            "$grid": {
                              "action": "lazyLoad",
                              "path": "#selectorEquipments",
                              "filters": {
                                "$var": {
                                  "path": "#searchEquipment"
                                }
                              }
                            }
                          },
                          "keypress-13": {
                            "$grid": {
                              "action": "lazyLoad",
                              "path": "#selectorEquipments",
                              "filters": {
                                "$var": {
                                  "path": "#searchEquipment"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "selected-count": {
                  "type": "string",
                  "model": false,
                  "widget": {
                    "name": "html",
                    "class": {
                      "value": "mrg-b-xs"
                    }
                  },
                  "value": {
                    "$if": {
                      "condition": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueEquipmentsIds = new Set(); rooms.forEach(room => { room.room.equipments.forEach(equipment => { uniqueEquipmentsIds.add(equipment.equipmentId); }); }); return Array.from(uniqueEquipmentsIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.equipments"
                                    }
                                  },
                                  "key": "equipmentId"
                                }
                              }
                            }
                          }
                        }
                      },
                      "then": {
                        "$replace": {
                          "template": "<p>Выбрано оборудования: {{0}}</p>",
                          "data": [
                            {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$element-option": {
                                        "option": "selection$",
                                        "path": "#selectorEquipments"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$length": {
                                    "data": {
                                      "$element-option": {
                                        "option": "selection$",
                                        "path": "#selectorEquipments"
                                      }
                                    }
                                  }
                                },
                                "else": 0
                              }
                            }
                          ]
                        }
                      },
                      "else": "Для данного помещения нет доступного для выбора оборудования. Пожалуйста, прикрепите оборудование к карточке помещения."
                    }
                  }
                },
                "selected-chips-equipment": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "widget": "info"
                  },
                  "model": "#selected-chips-equipment",
                  "widget": {
                    "name": "chips",
                    "class": {
                      "value": "chips-invite-suppliers mrg-b-sm"
                    },
                    "options": {
                      "onlyRemove": true,
                      "allowDuplicate": false,
                      "disabled": true,
                      "visible": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueEquipmentsIds = new Set(); rooms.forEach(room => { room.room.equipments.forEach(equipment => { uniqueEquipmentsIds.add(equipment.equipmentId); }); }); return Array.from(uniqueEquipmentsIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.equipments"
                                    }
                                  },
                                  "key": "equipmentId"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "events": {
                      "onRemove": {
                        "$element-option": {
                          "path": "#selectorEquipments",
                          "option": "selection",
                          "value": {
                            "$array-pluck": {
                              "array": {
                                "$array-filter": {
                                  "array": {
                                    "$element-option": {
                                      "path": "#selectorEquipments",
                                      "option": "selectedRows"
                                    }
                                  },
                                  "filter": {
                                    "!==": {
                                      "operand1": {
                                        "$from-context": {
                                          "path": "$data.value.name"
                                        }
                                      },
                                      "operand2": {
                                        "$from-context": {
                                          "path": "$event.event"
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "key": "value.equipmentId"
                            }
                          }
                        }
                      }
                    }
                  },
                  "value": {
                    "$if": {
                      "condition": {
                        "$and": {
                          "operands": [
                            {
                              "$not-empty": {
                                "data": {
                                  "$subs": {
                                    "path": "#selectorEquipments"
                                  }
                                }
                              }
                            },
                            {
                              "$not-empty": {
                                "data": {
                                  "$element-option": {
                                    "path": "#selectorEquipments",
                                    "option": "selection$"
                                  }
                                }
                              }
                            }
                          ]
                        }
                      },
                      "then": {
                        "$array-pluck": {
                          "array": {
                            "$fetch-object": {
                              "path": "data.items",
                              "data": {
                                "$api-data": {
                                  "query": "equipment/get_name_for_select",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  },
                                  "variables": {
                                    "ids": {
                                      "$element-option": {
                                        "path": "#selectorEquipments",
                                        "option": "selection$"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "key": "name"
                        }
                      },
                      "else": []
                    }
                  }
                },
                "table": {
                  "value": {
                    "$api-table-workflow-data": {
                      "model": "#selectorEquipments",
                      "query": "equipment/get_for_select",
                      "id": {
                        "$query-params": {
                          "name": "id"
                        }
                      },
                      "variables": {
                        "$assign-object": {
                          "object": {
                            "$graphql-event-variables": {
                              "data": {
                                "$element-event": {
                                  "event": "lazyLoad"
                                }
                              }
                            }
                          },
                          "data": {
                            "ids": {
                              "$if": {
                                "condition": {
                                  "$from-context": {
                                    "path": "@preload.booking.configuration"
                                  }
                                },
                                "then": {
                                  "$apply-func": {
                                    "func": " const uniqueEquipmentsIds = new Set(); rooms.forEach(room => { room.room.equipments.forEach(equipment => { uniqueEquipmentsIds.add(equipment.equipmentId); }); }); return Array.from(uniqueEquipmentsIds);",
                                    "args": {
                                      "rooms": {
                                        "$from-context": {
                                          "path": "@preload.booking.rooms"
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {
                                  "$array-pluck": {
                                    "array": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms.0.room.equipments"
                                      }
                                    },
                                    "key": "equipmentId"
                                  }
                                }
                              }
                            }
                          },
                          "path": ""
                        }
                      },
                      "errors": {
                        "default": {
                          "$message": {
                            "severity": "error",
                            "summary": "Ошибка",
                            "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                          }
                        }
                      }
                    }
                  },
                  "type": "array",
                  "model": "#selectorEquipments",
                  "widget": {
                    "name": "table-lazy",
                    "options": {
                      "selectionMode": "multiple",
                      "selectionField": "selected",
                      "selectionKey": "equipmentId",
                      "first": 0,
                      "rows": 10,
                      "lazy": true,
                      "paginator": true,
                      "visible": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueEquipmentsIds = new Set(); rooms.forEach(room => { room.room.equipments.forEach(equipment => { uniqueEquipmentsIds.add(equipment.equipmentId); }); }); return Array.from(uniqueEquipmentsIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.equipments"
                                    }
                                  },
                                  "key": "equipmentId"
                                }
                              }
                            }
                          }
                        }
                      },
                      "rowsPerPageOptions": [
                        10,
                        20,
                        50
                      ],
                      "routerOptions": [
                        "first",
                        "rows"
                      ],
                      "sortField": "name",
                      "sortOrder": 1
                    },
                    "class": {
                      "value": "data-table d-block mrg-b-lg"
                    },
                    "events": {
                      "lazyLoad": {
                        "$element-option": {
                          "path": "#selectorEquipments",
                          "option": "loading",
                          "value": true
                        }
                      },
                      "onRowSelect": {
                        "$populate": {
                          "path": "#selected-chips-equipment",
                          "data": {
                            "$array-push": {
                              "array": {
                                "$var": {
                                  "path": "#selected-chips-equipment"
                                }
                              },
                              "data": {
                                "$from-context": {
                                  "path": "$event.event.value.name"
                                }
                              }
                            }
                          }
                        }
                      },
                      "onRowUnselect": {
                        "$populate": {
                          "path": "#selected-chips-equipment",
                          "data": {
                            "$array-filter": {
                              "array": {
                                "$var": {
                                  "path": "#selected-chips-equipment"
                                }
                              },
                              "filter": {
                                "!==": {
                                  "operand1": {
                                    "$from-context": {
                                      "path": "$data"
                                    }
                                  },
                                  "operand2": {
                                    "$from-context": {
                                      "path": "$event.event.value.name"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "onHeaderCheckboxToggle": {
                        "$if": {
                          "condition": {
                            "===": {
                              "operand1": {
                                "$from-context": {
                                  "path": "$event.event"
                                }
                              },
                              "operand2": true
                            }
                          },
                          "then": {
                            "$populate": {
                              "path": "#selected-chips-equipment",
                              "data": {
                                "$apply-func": {
                                  "func": "return [...new Set([...chipsArr, ...currPageEquipments])]",
                                  "args": {
                                    "chipsArr": {
                                      "$var": {
                                        "path": "#selected-chips-equipment"
                                      }
                                    },
                                    "currPageEquipments": {
                                      "$array-pluck": {
                                        "array": {
                                          "$var": {
                                            "path": "#selectorEquipments"
                                          }
                                        },
                                        "key": "name"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "else": {
                            "$populate": {
                              "path": "#selected-chips-equipment",
                              "data": {
                                "$apply-func": {
                                  "func": "return chipsArr.filter( function( el ) { return currPageEquipments.indexOf( el ) < 0; } )",
                                  "args": {
                                    "chipsArr": {
                                      "$var": {
                                        "path": "#selected-chips-equipment"
                                      }
                                    },
                                    "currPageEquipments": {
                                      "$array-pluck": {
                                        "array": {
                                          "$var": {
                                            "path": "#selectorEquipments"
                                          }
                                        },
                                        "key": "name"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "subscriptions": {
                      "reload-table": {
                        "$element-event": {
                          "event": "reload",
                          "value": true
                        }
                      }
                    }
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "selected": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "equipmentId": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "name": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Наименование оборудования"
                          }
                        }
                      },
                      "nomenclatureNumber": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Номенклатурный номер"
                          }
                        }
                      },
                      "unitPrice": {
                        "type": "number",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "unitPriceView": {
                        "type": "object",
                        "model": false,
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Цена (руб.)"
                          }
                        },
                        "properties": {
                          "price": {
                            "type": "string",
                            "model": false,
                            "widget": {
                              "name": "info",
                              "options": {
                                "formatter": "number:'0.2-2':'ru'",
                                "viewedValue": {
                                  "$from-context": {
                                    "path": "$rowData.unitPrice"
                                  }
                                }
                              },
                              "class": {
                                "group": "p-text-right",
                                "value": "p-jc-end"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "actions": {
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "class": {
                      "group": "form-actions p-field p-grid mrg-t-lg",
                      "value": "p-jc-xs-end p-autolayout"
                    }
                  },
                  "properties": {
                    "save": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Добавить выбранные",
                          "visible": {
                            "$not-empty": {
                              "data": {
                                "$if": {
                                  "condition": {
                                    "$from-context": {
                                      "path": "@preload.booking.configuration"
                                    }
                                  },
                                  "then": {
                                    "$apply-func": {
                                      "func": " const uniqueEquipmentsIds = new Set(); rooms.forEach(room => { room.room.equipments.forEach(equipment => { uniqueEquipmentsIds.add(equipment.equipmentId); }); }); return Array.from(uniqueEquipmentsIds);",
                                      "args": {
                                        "rooms": {
                                          "$from-context": {
                                            "path": "@preload.booking.rooms"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "else": {
                                    "$array-pluck": {
                                      "array": {
                                        "$from-context": {
                                          "path": "@preload.booking.rooms.0.room.equipments"
                                        }
                                      },
                                      "key": "equipmentId"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$not-empty": {
                                  "data": {
                                    "$element-option": {
                                      "path": "#selectorEquipments",
                                      "option": "selection"
                                    }
                                  }
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$assign-context": {
                                        "path": "$addedEquipment",
                                        "data": {
                                          "$array-filter": {
                                            "array": {
                                              "$element-option": {
                                                "path": "#selectorEquipments",
                                                "option": "selection"
                                              }
                                            },
                                            "filter": {
                                              "$not": {
                                                "data": {
                                                  "$in": {
                                                    "value": {
                                                      "$from-context": {
                                                        "path": "$data"
                                                      }
                                                    },
                                                    "array": {
                                                      "$array-pluck": {
                                                        "array": {
                                                          "$fetch-object": {
                                                            "path": "data.items",
                                                            "data": {
                                                              "$api-data": {
                                                                "query": "additional_facilities/get_for_select_in_booking",
                                                                "id": {
                                                                  "$query-params": {
                                                                    "name": "id"
                                                                  }
                                                                },
                                                                "variables": {
                                                                  "eventId": {
                                                                    "$from-context": {
                                                                      "path": "@preload.booking.eventId"
                                                                    }
                                                                  },
                                                                  "bookingId": {
                                                                    "$query-params": {
                                                                      "name": "id"
                                                                    }
                                                                  },
                                                                  "facilityType": "equipment"
                                                                }
                                                              }
                                                            }
                                                          }
                                                        },
                                                        "key": "equipmentId"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$from-context": {
                                                "path": "$addedEquipment"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$http-code": {
                                            "200": [
                                              {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Добавление брони оборудования",
                                                  "detail": "Бронь оборудования к помещению успешно добавлена"
                                                }
                                              },
                                              {
                                                "$element-option": {
                                                  "option": "visible",
                                                  "path": "#modalSelectEquipments",
                                                  "value": false
                                                }
                                              },
                                              {
                                                "$event-bus-publish": {
                                                  "type": "reload-equipment-table"
                                                }
                                              }
                                            ],
                                            "422": [
                                              {
                                                "$validate": {
                                                  "errors": {
                                                    "$from-context": {
                                                      "path": "$response.error.errors"
                                                    }
                                                  }
                                                }
                                              }
                                            ],
                                            "client": {
                                              "$api-workflow": {
                                                "type": "post",
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "workflow": "additional_facilities",
                                                "action": "mass_add_for_booking",
                                                "data": {
                                                  "facilities": {
                                                    "$from-context": {
                                                      "path": "$addedEquipment"
                                                    }
                                                  },
                                                  "type": "equipment",
                                                  "bookingId": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  },
                                                  "eventId": {
                                                    "$from-context": {
                                                      "path": "@preload.booking.eventId"
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "default": [
                                              {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Добавление брони дополнительной оборудования",
                                                  "detail": "Непредвиденная ошибка"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "else": {
                                          "$element-option": {
                                            "option": "visible",
                                            "path": "#modalSelectEquipments",
                                            "value": false
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$element-option": {
                                  "option": "visible",
                                  "path": "#modalSelectEquipments",
                                  "value": false
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "viewRoom": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "К просмотру помещения",
                          "visible": {
                            "$and": {
                              "operands": [
                                {
                                  "$empty": {
                                    "data": {
                                      "$if": {
                                        "condition": {
                                          "$from-context": {
                                            "path": "@preload.booking.configuration"
                                          }
                                        },
                                        "then": {
                                          "$apply-func": {
                                            "func": " const uniqueEquipmentsIds = new Set(); rooms.forEach(room => { room.room.equipments.forEach(equipment => { uniqueEquipmentsIds.add(equipment.equipmentId); }); }); return Array.from(uniqueEquipmentsIds);",
                                            "args": {
                                              "rooms": {
                                                "$from-context": {
                                                  "path": "@preload.booking.rooms"
                                                }
                                              }
                                            }
                                          }
                                        },
                                        "else": {
                                          "$array-pluck": {
                                            "array": {
                                              "$from-context": {
                                                "path": "@preload.booking.rooms.0.room.equipments"
                                              }
                                            },
                                            "key": "equipmentId"
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                {
                                  "$active-user-has-permission": {
                                    "permission": "room.view"
                                  }
                                },
                                {
                                  "$not": {
                                    "data": {
                                      "$from-context": {
                                        "path": "@preload.booking.configuration"
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$window-open": {
                              "url": {
                                "$replace": {
                                  "template": "/cabinet/room/view?id={{id}}",
                                  "data": {
                                    "id": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms.0.roomId"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "cancel": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Отмена"
                        },
                        "events": {
                          "click": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#modalSelectEquipments",
                              "value": false
                            }
                          }
                        },
                        "kind": "button-search-form-clear-button-right-style"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "selectFurniture": {
          "type": "object",
          "model": "#modalSelectFurniture",
          "widget": {
            "name": "dialog",
            "options": {
              "visible": false,
              "closable": true
            }
          },
          "properties": {
            "content": {
              "type": "object",
              "widget": {
                "name": "container"
              },
              "properties": {
                "header": {
                  "type": "string",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Выбор мебели"
                    },
                    "kind": "container-popup-with-h1-no-form-collapsed-style"
                  }
                },
                "search": {
                  "type": "object",
                  "model": "#searchFurniture",
                  "widget": {
                    "name": "container",
                    "options": {
                      "displayNone": false,
                      "routerOptions": [
                        "displayNone"
                      ],
                      "visible": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueFurnitureIds = new Set(); rooms.forEach(room => { room.room.furniture.forEach(furnitureOne => { uniqueFurnitureIds.add(furnitureOne.furnitureId); }); }); return Array.from(uniqueFurnitureIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.furniture"
                                    }
                                  },
                                  "key": "furnitureId"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "kind": "container-search-form-collapsed-container-style"
                  },
                  "properties": {
                    "typeOrNumber": {
                      "type": "string",
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/length-255"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ],
                      "widget": {
                        "name": "input-group-button",
                        "options": {
                          "placeholder": "Наименование, номенклатурный номер мебели",
                          "actionButtonLabel": "Найти",
                          "actionButtonIconMobile": "icon-search",
                          "enableClearButton": true
                        },
                        "events": {
                          "actionButtonClick": {
                            "$grid": {
                              "action": "lazyLoad",
                              "path": "#selectorFurniture",
                              "filters": {
                                "$var": {
                                  "path": "#searchFurniture"
                                }
                              }
                            }
                          },
                          "keypress-13": {
                            "$grid": {
                              "action": "lazyLoad",
                              "path": "#selectorFurniture",
                              "filters": {
                                "$var": {
                                  "path": "#searchFurniture"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "selected-count": {
                  "type": "string",
                  "model": false,
                  "widget": {
                    "name": "html",
                    "class": {
                      "value": "mrg-b-xs"
                    }
                  },
                  "value": {
                    "$if": {
                      "condition": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueFurnitureIds = new Set(); rooms.forEach(room => { room.room.furniture.forEach(furnitureOne => { uniqueFurnitureIds.add(furnitureOne.furnitureId); }); }); return Array.from(uniqueFurnitureIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.furniture"
                                    }
                                  },
                                  "key": "furnitureId"
                                }
                              }
                            }
                          }
                        }
                      },
                      "then": {
                        "$replace": {
                          "template": "<p>Выбрано мебели: {{0}}</p>",
                          "data": [
                            {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$element-option": {
                                        "option": "selection$",
                                        "path": "#selectorFurniture"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$length": {
                                    "data": {
                                      "$element-option": {
                                        "option": "selection$",
                                        "path": "#selectorFurniture"
                                      }
                                    }
                                  }
                                },
                                "else": 0
                              }
                            }
                          ]
                        }
                      },
                      "else": "Для данного помещения нет доступной для выбора мебели. Пожалуйста, прикрепите мебель к карточке помещения."
                    }
                  }
                },
                "selected-chips-furniture": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "widget": "info"
                  },
                  "model": "#selected-chips-furniture",
                  "widget": {
                    "name": "chips",
                    "class": {
                      "value": "chips-invite-suppliers mrg-b-sm"
                    },
                    "options": {
                      "visible": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueFurnitureIds = new Set(); rooms.forEach(room => { room.room.furniture.forEach(furnitureOne => { uniqueFurnitureIds.add(furnitureOne.furnitureId); }); }); return Array.from(uniqueFurnitureIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.furniture"
                                    }
                                  },
                                  "key": "furnitureId"
                                }
                              }
                            }
                          }
                        }
                      },
                      "onlyRemove": true,
                      "allowDuplicate": false,
                      "disabled": true
                    },
                    "events": {
                      "onRemove": {
                        "$element-option": {
                          "path": "#selectorFurniture",
                          "option": "selection",
                          "value": {
                            "$array-pluck": {
                              "array": {
                                "$array-filter": {
                                  "array": {
                                    "$element-option": {
                                      "path": "#selectorFurniture",
                                      "option": "selectedRows"
                                    }
                                  },
                                  "filter": {
                                    "!==": {
                                      "operand1": {
                                        "$from-context": {
                                          "path": "$data.value.name"
                                        }
                                      },
                                      "operand2": {
                                        "$from-context": {
                                          "path": "$event.event"
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "key": "value.furnitureId"
                            }
                          }
                        }
                      }
                    }
                  },
                  "value": {
                    "$if": {
                      "condition": {
                        "$and": {
                          "operands": [
                            {
                              "$not-empty": {
                                "data": {
                                  "$subs": {
                                    "path": "#selectorFurniture"
                                  }
                                }
                              }
                            },
                            {
                              "$not-empty": {
                                "data": {
                                  "$element-option": {
                                    "path": "#selectorFurniture",
                                    "option": "selection$"
                                  }
                                }
                              }
                            }
                          ]
                        }
                      },
                      "then": {
                        "$array-pluck": {
                          "array": {
                            "$fetch-object": {
                              "path": "data.items",
                              "data": {
                                "$api-data": {
                                  "query": "furniture/get_name_for_select",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  },
                                  "variables": {
                                    "ids": {
                                      "$element-option": {
                                        "path": "#selectorFurniture",
                                        "option": "selection$"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "key": "name"
                        }
                      },
                      "else": []
                    }
                  }
                },
                "table": {
                  "value": {
                    "$api-table-workflow-data": {
                      "model": "#selectorFurniture",
                      "query": "furniture/get_for_select",
                      "id": {
                        "$query-params": {
                          "name": "id"
                        }
                      },
                      "variables": {
                        "$assign-object": {
                          "object": {
                            "$graphql-event-variables": {
                              "data": {
                                "$element-event": {
                                  "event": "lazyLoad"
                                }
                              }
                            }
                          },
                          "data": {
                            "ids": {
                              "$if": {
                                "condition": {
                                  "$from-context": {
                                    "path": "@preload.booking.configuration"
                                  }
                                },
                                "then": {
                                  "$apply-func": {
                                    "func": " const uniqueFurnitureIds = new Set(); rooms.forEach(room => { room.room.furniture.forEach(furnitureOne => { uniqueFurnitureIds.add(furnitureOne.furnitureId); }); }); return Array.from(uniqueFurnitureIds);",
                                    "args": {
                                      "rooms": {
                                        "$from-context": {
                                          "path": "@preload.booking.rooms"
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {
                                  "$array-pluck": {
                                    "array": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms.0.room.furniture"
                                      }
                                    },
                                    "key": "furnitureId"
                                  }
                                }
                              }
                            }
                          },
                          "path": ""
                        }
                      },
                      "errors": {
                        "default": {
                          "$message": {
                            "severity": "error",
                            "summary": "Ошибка",
                            "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                          }
                        }
                      }
                    }
                  },
                  "type": "array",
                  "model": "#selectorFurniture",
                  "widget": {
                    "name": "table-lazy",
                    "options": {
                      "selectionMode": "multiple",
                      "selectionField": "selected",
                      "selectionKey": "furnitureId",
                      "visible": {
                        "$not-empty": {
                          "data": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "$apply-func": {
                                  "func": " const uniqueFurnitureIds = new Set(); rooms.forEach(room => { room.room.furniture.forEach(furnitureOne => { uniqueFurnitureIds.add(furnitureOne.furnitureId); }); }); return Array.from(uniqueFurnitureIds);",
                                  "args": {
                                    "rooms": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms"
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$array-pluck": {
                                  "array": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.furniture"
                                    }
                                  },
                                  "key": "furnitureId"
                                }
                              }
                            }
                          }
                        }
                      },
                      "first": 0,
                      "rows": 10,
                      "lazy": true,
                      "paginator": true,
                      "rowsPerPageOptions": [
                        10,
                        20,
                        50
                      ],
                      "routerOptions": [
                        "first",
                        "rows"
                      ],
                      "sortField": "name",
                      "sortOrder": 1
                    },
                    "class": {
                      "value": "data-table d-block mrg-b-lg"
                    },
                    "events": {
                      "lazyLoad": {
                        "$element-option": {
                          "path": "#selectorFurniture",
                          "option": "loading",
                          "value": true
                        }
                      },
                      "onRowSelect": {
                        "$populate": {
                          "path": "#selected-chips-furniture",
                          "data": {
                            "$array-push": {
                              "array": {
                                "$var": {
                                  "path": "#selected-chips-furniture"
                                }
                              },
                              "data": {
                                "$from-context": {
                                  "path": "$event.event.value.name"
                                }
                              }
                            }
                          }
                        }
                      },
                      "onRowUnselect": {
                        "$populate": {
                          "path": "#selected-chips-furniture",
                          "data": {
                            "$array-filter": {
                              "array": {
                                "$var": {
                                  "path": "#selected-chips-furniture"
                                }
                              },
                              "filter": {
                                "!==": {
                                  "operand1": {
                                    "$from-context": {
                                      "path": "$data"
                                    }
                                  },
                                  "operand2": {
                                    "$from-context": {
                                      "path": "$event.event.value.name"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "onHeaderCheckboxToggle": {
                        "$if": {
                          "condition": {
                            "===": {
                              "operand1": {
                                "$from-context": {
                                  "path": "$event.event"
                                }
                              },
                              "operand2": true
                            }
                          },
                          "then": {
                            "$populate": {
                              "path": "#selected-chips-furniture",
                              "data": {
                                "$apply-func": {
                                  "func": "return [...new Set([...chipsArr, ...currPageFurniture])]",
                                  "args": {
                                    "chipsArr": {
                                      "$var": {
                                        "path": "#selected-chips-furniture"
                                      }
                                    },
                                    "currPageFurniture": {
                                      "$array-pluck": {
                                        "array": {
                                          "$var": {
                                            "path": "#selectorFurniture"
                                          }
                                        },
                                        "key": "name"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "else": {
                            "$populate": {
                              "path": "#selected-chips-furniture",
                              "data": {
                                "$apply-func": {
                                  "func": "return chipsArr.filter( function( el ) { return currPageFurniture.indexOf( el ) < 0; } )",
                                  "args": {
                                    "chipsArr": {
                                      "$var": {
                                        "path": "#selected-chips-furniture"
                                      }
                                    },
                                    "currPageFurniture": {
                                      "$array-pluck": {
                                        "array": {
                                          "$var": {
                                            "path": "#selectorFurniture"
                                          }
                                        },
                                        "key": "name"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "subscriptions": {
                      "reload-table": {
                        "$element-event": {
                          "event": "reload",
                          "value": true
                        }
                      }
                    }
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "selected": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "furnitureId": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "name": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Наименование мебели"
                          }
                        }
                      },
                      "nomenclatureNumber": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Номенклатурный номер"
                          }
                        }
                      },
                      "unitPrice": {
                        "type": "number",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "unitPriceView": {
                        "type": "object",
                        "model": false,
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Цена (руб.)"
                          }
                        },
                        "properties": {
                          "price": {
                            "type": "string",
                            "model": false,
                            "widget": {
                              "name": "info",
                              "options": {
                                "formatter": "number:'0.2-2':'ru'",
                                "viewedValue": {
                                  "$from-context": {
                                    "path": "$rowData.unitPrice"
                                  }
                                }
                              },
                              "class": {
                                "group": "p-text-right",
                                "value": "p-jc-end"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "actions": {
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "class": {
                      "group": "form-actions p-field p-grid mrg-t-lg",
                      "value": "p-jc-xs-end p-autolayout"
                    }
                  },
                  "properties": {
                    "save": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Добавить выбранные",
                          "visible": {
                            "$not-empty": {
                              "data": {
                                "$if": {
                                  "condition": {
                                    "$from-context": {
                                      "path": "@preload.booking.configuration"
                                    }
                                  },
                                  "then": {
                                    "$apply-func": {
                                      "func": " const uniqueFurnitureIds = new Set(); rooms.forEach(room => { room.room.furniture.forEach(furnitureOne => { uniqueFurnitureIds.add(furnitureOne.furnitureId); }); }); return Array.from(uniqueFurnitureIds);",
                                      "args": {
                                        "rooms": {
                                          "$from-context": {
                                            "path": "@preload.booking.rooms"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "else": {
                                    "$array-pluck": {
                                      "array": {
                                        "$from-context": {
                                          "path": "@preload.booking.rooms.0.room.furniture"
                                        }
                                      },
                                      "key": "furnitureId"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$not-empty": {
                                  "data": {
                                    "$element-option": {
                                      "path": "#selectorFurniture",
                                      "option": "selection"
                                    }
                                  }
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$assign-context": {
                                        "path": "$addedFurniture",
                                        "data": {
                                          "$array-filter": {
                                            "array": {
                                              "$element-option": {
                                                "path": "#selectorFurniture",
                                                "option": "selection"
                                              }
                                            },
                                            "filter": {
                                              "$not": {
                                                "data": {
                                                  "$in": {
                                                    "value": {
                                                      "$from-context": {
                                                        "path": "$data"
                                                      }
                                                    },
                                                    "array": {
                                                      "$array-pluck": {
                                                        "array": {
                                                          "$fetch-object": {
                                                            "path": "data.items",
                                                            "data": {
                                                              "$api-data": {
                                                                "query": "additional_facilities/get_for_select_in_booking",
                                                                "id": {
                                                                  "$query-params": {
                                                                    "name": "id"
                                                                  }
                                                                },
                                                                "variables": {
                                                                  "eventId": {
                                                                    "$from-context": {
                                                                      "path": "@preload.booking.eventId"
                                                                    }
                                                                  },
                                                                  "bookingId": {
                                                                    "$query-params": {
                                                                      "name": "id"
                                                                    }
                                                                  },
                                                                  "facilityType": "furniture"
                                                                }
                                                              }
                                                            }
                                                          }
                                                        },
                                                        "key": "furnitureId"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$from-context": {
                                                "path": "$addedFurniture"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$http-code": {
                                            "200": [
                                              {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Добавление брони мебели",
                                                  "detail": "Бронь мебели к помещению успешно добавлена"
                                                }
                                              },
                                              {
                                                "$element-option": {
                                                  "option": "visible",
                                                  "path": "#modalSelectFurniture",
                                                  "value": false
                                                }
                                              },
                                              {
                                                "$event-bus-publish": {
                                                  "type": "reload-furniture-table"
                                                }
                                              }
                                            ],
                                            "422": [
                                              {
                                                "$validate": {
                                                  "errors": {
                                                    "$from-context": {
                                                      "path": "$response.error.errors"
                                                    }
                                                  }
                                                }
                                              }
                                            ],
                                            "client": {
                                              "$api-workflow": {
                                                "type": "post",
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "workflow": "additional_facilities",
                                                "action": "mass_add_for_booking",
                                                "data": {
                                                  "facilities": {
                                                    "$from-context": {
                                                      "path": "$addedFurniture"
                                                    }
                                                  },
                                                  "type": "furniture",
                                                  "bookingId": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  },
                                                  "eventId": {
                                                    "$from-context": {
                                                      "path": "@preload.booking.eventId"
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "default": [
                                              {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Добавление брони мебели",
                                                  "detail": "Непредвиденная ошибка"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "else": {
                                          "$element-option": {
                                            "option": "visible",
                                            "path": "#modalSelectFurniture",
                                            "value": false
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$element-option": {
                                  "option": "visible",
                                  "path": "#modalSelectFurniture",
                                  "value": false
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "viewRoom": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "К просмотру помещения",
                          "visible": {
                            "$and": {
                              "operands": [
                                {
                                  "$empty": {
                                    "data": {
                                      "$if": {
                                        "condition": {
                                          "$from-context": {
                                            "path": "@preload.booking.configuration"
                                          }
                                        },
                                        "then": {
                                          "$apply-func": {
                                            "func": " const uniqueFurnitureIds = new Set(); rooms.forEach(room => { room.room.furniture.forEach(furnitureOne => { uniqueFurnitureIds.add(furnitureOne.furnitureId); }); }); return Array.from(uniqueFurnitureIds);",
                                            "args": {
                                              "rooms": {
                                                "$from-context": {
                                                  "path": "@preload.booking.rooms"
                                                }
                                              }
                                            }
                                          }
                                        },
                                        "else": {
                                          "$array-pluck": {
                                            "array": {
                                              "$from-context": {
                                                "path": "@preload.booking.rooms.0.room.furniture"
                                              }
                                            },
                                            "key": "furnitureId"
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                {
                                  "$active-user-has-permission": {
                                    "permission": "room.view"
                                  }
                                },
                                {
                                  "$not": {
                                    "data": {
                                      "$from-context": {
                                        "path": "@preload.booking.configuration"
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        },
                        "events": {
                          "click": {
                            "$window-open": {
                              "url": {
                                "$replace": {
                                  "template": "/cabinet/room/view?id={{id}}",
                                  "data": {
                                    "id": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms.0.roomId"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "cancel": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Отмена"
                        },
                        "events": {
                          "click": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#modalSelectFurniture",
                              "value": false
                            }
                          }
                        },
                        "kind": "button-search-form-clear-button-right-style"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "bookingInfo": {
          "type": "object",
          "model": "#bookingInfo",
          "widget": {
            "name": "dialog",
            "options": {
              "visible": false,
              "closable": true
            }
          },
          "properties": {
            "content": {
              "type": "object",
              "widget": {
                "name": "container"
              },
              "properties": {
                "header": {
                  "type": "string",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Информация о бронировании помещения"
                    },
                    "kind": "container-popup-with-h1-no-form-collapsed-style"
                  }
                },
                "message": {
                  "type": "string",
                  "widget": {
                    "name": "html",
                    "class": {
                      "group": "form-item p-field p-grid",
                      "label": "form-label form-label_view",
                      "value": "form-item-element form-item-element_view"
                    }
                  },
                  "value": {
                    "$if": {
                      "condition": {
                        ">": {
                          "operand1": {
                            "$length": {
                              "data": {
                                "$subs": {
                                  "path": "#bookingInfo.table"
                                }
                              }
                            }
                          },
                          "operand2": 0
                        }
                      },
                      "then": {
                        "$if": {
                          "condition": {
                            "!==": {
                              "operand1": {
                                "$subs": {
                                  "path": "#data.minDate"
                                }
                              },
                              "operand2": null
                            }
                          },
                          "then": "Выбранное помещение частично забронировано для следующих мероприятий в рамках указанного срока:",
                          "else": "Выбранное помещение частично забронировано для следующих мероприятий:"
                        }
                      },
                      "else": "Выбранное помещение не забронировано для других мероприятий в рамках указанного срока."
                    }
                  }
                },
                "table": {
                  "type": "array",
                  "model": "#bookingInfo.table",
                  "value": {
                    "$api-table-workflow-data": {
                      "model": "#bookingInfo.table",
                      "id": {
                        "$query-params": {
                          "name": "id"
                        }
                      },
                      "query": "booking/get_for_info",
                      "variables": {
                        "$assign-object": {
                          "object": {
                            "$graphql-event-variables": {
                              "data": {
                                "$element-event": {
                                  "event": "lazyLoad"
                                }
                              }
                            }
                          },
                          "data": {
                            "except": {
                              "$query-params": {
                                "name": "id"
                              }
                            },
                            "minDate": {
                              "$subs": {
                                "path": "#data.minDate"
                              }
                            },
                            "maxDate": {
                              "$subs": {
                                "path": "#data.maxDate"
                              }
                            },
                            "roomsArr": {
                              "$array-pluck": {
                                "array": {
                                  "$from-context": {
                                    "path": "@preload.booking.rooms"
                                  }
                                },
                                "key": "roomId"
                              }
                            }
                          },
                          "path": ""
                        }
                      },
                      "errors": {
                        "default": {
                          "$message": {
                            "severity": "error",
                            "summary": "Ошибка",
                            "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                          }
                        }
                      }
                    }
                  },
                  "widget": {
                    "name": "table-lazy",
                    "options": {
                      "emptyMessage": "Выбранное помещение не забронировано для других мероприятий в рамках указанного срока.",
                      "first": 0,
                      "rows": 10,
                      "paginator": true,
                      "visible": {
                        ">": {
                          "operand1": {
                            "$length": {
                              "data": {
                                "$from-context": {
                                  "path": "$response.body.data.pagination.items",
                                  "data": {
                                    "$api-data": {
                                      "options": {
                                        "observe": "response"
                                      },
                                      "query": "booking/get_for_info",
                                      "id": {
                                        "$query-params": {
                                          "name": "id"
                                        }
                                      },
                                      "variables": {
                                        "$assign-object": {
                                          "object": {
                                            "first": 0,
                                            "rows": 10
                                          },
                                          "data": {
                                            "except": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "minDate": {
                                              "$subs": {
                                                "path": "#data.minDate"
                                              }
                                            },
                                            "maxDate": {
                                              "$subs": {
                                                "path": "#data.maxDate"
                                              }
                                            },
                                            "roomsArr": {
                                              "$array-pluck": {
                                                "array": {
                                                  "$from-context": {
                                                    "path": "@preload.booking.rooms"
                                                  }
                                                },
                                                "key": "roomId"
                                              }
                                            }
                                          },
                                          "path": ""
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "operand2": 0
                        }
                      },
                      "rowsPerPageOptions": [
                        10,
                        20,
                        50
                      ],
                      "routerOptions": [
                        "first",
                        "rows"
                      ]
                    },
                    "class": {
                      "value": "data-table d-block mrg-b-lg"
                    },
                    "events": {
                      "lazyLoad": {
                        "$element-option": {
                          "path": "#bookingInfo.table",
                          "option": "loading",
                          "value": true
                        }
                      }
                    },
                    "subscriptions": {
                      "reload-table": {
                        "$element-event": {
                          "event": "reload",
                          "value": true
                        }
                      }
                    }
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "number": {
                        "type": "number",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "№",
                            "viewedValue": {
                              "$sum": {
                                "terms": [
                                  {
                                    "$collection": {
                                      "action": "row-number"
                                    }
                                  },
                                  {
                                    "$element-option": {
                                      "path": "#bookingInfo.table",
                                      "option": "first"
                                    }
                                  }
                                ]
                              }
                            }
                          },
                          "class": {
                            "header": "column_actions",
                            "cell": "column_actions"
                          }
                        }
                      },
                      "eventId": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "event": {
                        "type": "object",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        },
                        "properties": {
                          "name": {
                            "type": "string",
                            "widget": {
                              "name": "hidden"
                            }
                          },
                          "state": {
                            "type": "string",
                            "widget": {
                              "name": "hidden"
                            }
                          }
                        }
                      },
                      "rooms": {
                        "type": "array",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        },
                        "items": {
                          "type": "object",
                          "properties": {
                            "room": {
                              "type": "object",
                              "widget": {
                                "name": "hidden"
                              },
                              "properties": {
                                "square": {
                                  "type": "number",
                                  "widget": {
                                    "name": "hidden"
                                  }
                                }
                              }
                            },
                            "roomId": {
                              "type": "string",
                              "widget": {
                                "name": "hidden"
                              }
                            }
                          },
                          "widget": {
                            "name": "fieldset"
                          }
                        }
                      },
                      "eventView": {
                        "type": "object",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Наименование мероприятия"
                          }
                        },
                        "properties": {
                          "name": {
                            "type": "string",
                            "widget": {
                              "name": "info",
                              "options": {
                                "visible": {
                                  "$not": {
                                    "data": {
                                      "$active-user-has-permission": {
                                        "permission": "event.view"
                                      }
                                    }
                                  }
                                },
                                "viewedValue": {
                                  "$from-context": {
                                    "path": "$rowData.event.name"
                                  }
                                }
                              }
                            }
                          },
                          "link": {
                            "type": "string",
                            "widget": {
                              "name": "link",
                              "options": {
                                "visible": {
                                  "$active-user-has-permission": {
                                    "permission": "event.view"
                                  }
                                },
                                "routerLink": "/cabinet/event/view",
                                "queryParams": {
                                  "id": {
                                    "$from-context": {
                                      "path": "$rowData.eventId"
                                    }
                                  }
                                },
                                "viewedValue": {
                                  "$from-context": {
                                    "path": "$rowData.event.name"
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "minDate": {
                        "type": "datetime",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "maxDate": {
                        "type": "datetime",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "bookingPeriod": {
                        "type": "object",
                        "model": false,
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Даты брони"
                          }
                        },
                        "properties": {
                          "bookingPeriodView": {
                            "type": "string",
                            "model": false,
                            "widget": {
                              "name": "info",
                              "options": {
                                "viewedValue": {
                                  "$replace": {
                                    "template": "{{start}} - {{end}}",
                                    "data": {
                                      "start": {
                                        "$formatter": {
                                          "format": "datetime:\"DD.MM.YYYY HH:mm\"",
                                          "data": {
                                            "$from-context": {
                                              "path": "$rowData.minDate"
                                            }
                                          }
                                        }
                                      },
                                      "end": {
                                        "$formatter": {
                                          "format": "datetime:\"DD.MM.YYYY HH:mm\"",
                                          "data": {
                                            "$from-context": {
                                              "path": "$rowData.maxDate"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "class": {
                                "group": "p-text-right",
                                "value": "p-jc-end"
                              }
                            }
                          }
                        }
                      },
                      "configuration": {
                        "type": "boolean",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "allSquare": {
                        "type": "number",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "allSquareView": {
                        "type": "object",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Бронируемая площадь (м²)"
                          }
                        },
                        "properties": {
                          "squareView": {
                            "type": "string",
                            "value": {
                              "$replace": {
                                "template": "{{bookingSquare}} из {{square}} м²",
                                "data": {
                                  "bookingSquare": {
                                    "$from-context": {
                                      "path": "$rowData.allSquare"
                                    }
                                  },
                                  "square": {
                                    "$if": {
                                      "condition": {
                                        "$from-context": {
                                          "path": "$rowData.configuration"
                                        }
                                      },
                                      "then": {
                                        "$from-context": {
                                          "path": "$rowData.allSquare"
                                        }
                                      },
                                      "else": {
                                        "$from-context": {
                                          "path": "$rowData.rooms.0.room.square"
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "widget": "info"
                          }
                        }
                      },
                      "status": {
                        "type": "object",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Статус"
                          }
                        },
                        "properties": {
                          "stateView": {
                            "type": "string",
                            "value": {
                              "$from-context": {
                                "path": "$rowData.event.state"
                              }
                            },
                            "widget": {
                              "name": "badge",
                              "options": {
                                "defaultLabel": "",
                                "displayMapping": [
                                  {
                                    "color": "badge_default",
                                    "label": "Предварительная бронь",
                                    "value": "pre_booking"
                                  },
                                  {
                                    "color": "badge_warning",
                                    "label": "Получен запрос",
                                    "value": "requested"
                                  },
                                  {
                                    "color": "badge_custom_orange",
                                    "label": "Получено ТЗ",
                                    "value": "task_received"
                                  },
                                  {
                                    "color": "badge_active",
                                    "label": "Согласована смета",
                                    "value": "agreed"
                                  },
                                  {
                                    "color": "badge_accent",
                                    "label": "Пройден check-in",
                                    "value": "check_in"
                                  }
                                ]
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "roomDelete": {
          "type": "object",
          "model": "#roomDelete",
          "widget": {
            "name": "dialog",
            "options": {
              "visible": false,
              "closable": true
            }
          },
          "properties": {
            "content": {
              "type": "object",
              "widget": {
                "name": "container"
              },
              "properties": {
                "header": {
                  "type": "string",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Предупреждение"
                    },
                    "kind": "container-popup-with-h1-no-form-collapsed-style"
                  }
                },
                "message": {
                  "type": "string",
                  "widget": {
                    "name": "html",
                    "class": {
                      "group": "form-item p-field p-grid",
                      "label": "form-label form-label_view",
                      "value": "form-item-element form-item-element_view"
                    }
                  },
                  "value": {
                    "$if": {
                      "condition": {
                        "$from-context": {
                          "path": "@preload.booking.configuration"
                        }
                      },
                      "then": {
                        "$if": {
                          "condition": {
                            "<": {
                              "operand1": 1,
                              "operand2": {
                                "$length": {
                                  "data": {
                                    "$array-filter": {
                                      "array": {
                                        "$from-context": {
                                          "path": "@preload.booking.rooms"
                                        }
                                      },
                                      "filter": {
                                        "===": {
                                          "operand1": "deleted",
                                          "operand2": {
                                            "$from-context": {
                                              "path": "$data.room.state"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "then": {
                            "$replace": {
                              "template": "Помещения \"{{0}}\" были удалены из реестра помещений. Желаете сохранить изменения в рамках брони и продолжить работу?",
                              "data": [
                                {
                                  "$array-join": {
                                    "array": {
                                      "$array-map": {
                                        "array": {
                                          "$array-filter": {
                                            "array": {
                                              "$from-context": {
                                                "path": "@preload.booking.rooms"
                                              }
                                            },
                                            "filter": {
                                              "===": {
                                                "operand1": "deleted",
                                                "operand2": {
                                                  "$from-context": {
                                                    "path": "$data.room.state"
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        "map": {
                                          "$from-context": {
                                            "path": "$data.room.name"
                                          }
                                        }
                                      }
                                    },
                                    "separator": "\", \""
                                  }
                                }
                              ]
                            }
                          },
                          "else": {
                            "$replace": {
                              "template": "Помещение \"{{0}}\" было удалено из реестра помещений. Желаете сохранить изменения в рамках брони и продолжить работу?",
                              "data": [
                                {
                                  "$fetch-object": {
                                    "path": "0.room.name",
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$from-context": {
                                            "path": "@preload.booking.rooms"
                                          }
                                        },
                                        "filter": {
                                          "===": {
                                            "operand1": "deleted",
                                            "operand2": {
                                              "$from-context": {
                                                "path": "$data.room.state"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        }
                      },
                      "else": {
                        "$replace": {
                          "template": "Помещение \"{{0}}\" было удалено из реестра помещений. Желаете сохранить изменения в рамках брони и продолжить работу?",
                          "data": [
                            {
                              "$from-context": {
                                "path": "@preload.booking.rooms.0.room.name"
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "actions": {
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "class": {
                      "group": "form-actions p-field p-grid mrg-t-lg",
                      "value": "p-jc-xl-end p-autolayout"
                    }
                  },
                  "properties": {
                    "add": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Подтвердить"
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$or": {
                                  "operands": [
                                    {
                                      "$in": {
                                        "value": {
                                          "$from-context": {
                                            "path": "@preload.booking.event.state"
                                          }
                                        },
                                        "array": [
                                          "new",
                                          "draft",
                                          "pre_booking"
                                        ]
                                      }
                                    },
                                    {
                                      "$active-user-has-permission": {
                                        "permission": "request.accept.new"
                                      }
                                    },
                                    {
                                      "$and": {
                                        "operands": [
                                          {
                                            "===": {
                                              "operand1": {
                                                "$from-context": {
                                                  "path": "@preload.booking.state"
                                                }
                                              },
                                              "operand2": "not_filled"
                                            }
                                          },
                                          {
                                            "===": {
                                              "operand1": {
                                                "$var": {
                                                  "path": "#data.discountOrMarkupFlag"
                                                }
                                              },
                                              "operand2": "no"
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "$and": {
                                        "operands": [
                                          {
                                            "$active-user-has-permission": {
                                              "permission": "booking.edit_part"
                                            }
                                          },
                                          {
                                            "===": {
                                              "operand1": {
                                                "$var": {
                                                  "path": "#data.discountOrMarkupFlag"
                                                }
                                              },
                                              "operand2": "no"
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    "$ref:operation-frontend:snippets/element/_loading/onclick-loading-enable",
                                    {
                                      "$http-code": {
                                        "200": [
                                          {
                                            "$message": {
                                              "severity": "success",
                                              "summary": "Редактирование брони помещения",
                                              "detail": "Бронь помещения успешно изменена"
                                            }
                                          },
                                          {
                                            "$navigate": {
                                              "commands": [
                                                "/cabinet/event/edit"
                                              ],
                                              "extras": {
                                                "queryParams": {
                                                  "id": {
                                                    "$from-context": {
                                                      "path": "@preload.booking.eventId"
                                                    }
                                                  },
                                                  "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"rent\"}}"
                                                }
                                              }
                                            }
                                          }
                                        ],
                                        "422": [
                                          "$ref:operation-frontend:snippets/element/_http_message/http-errors-from-response"
                                        ],
                                        "client": {
                                          "$api-workflow": {
                                            "type": "post",
                                            "options": {
                                              "observe": "response"
                                            },
                                            "workflow": "booking",
                                            "action": "edit",
                                            "data": {
                                              "$assign-object": {
                                                "path": "hasPermission",
                                                "data": {
                                                  "$if": {
                                                    "condition": {
                                                      "$active-user-has-permission": {
                                                        "permission": "request.accept.new"
                                                      }
                                                    },
                                                    "then": "accept_request",
                                                    "else": {
                                                      "$if": {
                                                        "condition": {
                                                          "$active-user-has-permission": {
                                                            "permission": "booking.edit_part"
                                                          }
                                                        },
                                                        "then": "edit_part",
                                                        "else": "no"
                                                      }
                                                    }
                                                  }
                                                },
                                                "object": {
                                                  "$exclude": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data"
                                                      }
                                                    },
                                                    "exclude": [
                                                      "rooms",
                                                      "configuration",
                                                      "roomsView",
                                                      "roomType",
                                                      "additional_services",
                                                      "equipments",
                                                      "furniture"
                                                    ]
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        "finalize": "$ref:operation-frontend:snippets/element/_loading/onclick-loading-disable",
                                        "default": [
                                          {
                                            "$message": {
                                              "severity": "success",
                                              "summary": "Редактирование брони помещения",
                                              "detail": "Непредвиденная ошибка"
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": [
                                {
                                  "$element-option": {
                                    "option": "visible",
                                    "path": "#roomDelete",
                                    "value": false
                                  }
                                },
                                {
                                  "$confirmation": {
                                    "header": "Подтверждение изменений",
                                    "message": {
                                      "$replace": {
                                        "template": "Заявка с изменениями будет направлена на согласование. Все изменения применятся к брони после подтверждения данной заявки. Желаете продолжить?"
                                      }
                                    },
                                    "accept": {
                                      "$waterfall": {
                                        "arrayFunctions": [
                                          "$ref:operation-frontend:snippets/element/_loading/onclick-loading-enable",
                                          {
                                            "$http-code": {
                                              "200": [
                                                {
                                                  "$message": {
                                                    "severity": "success",
                                                    "summary": "Редактирование брони помещения",
                                                    "detail": "Заявка на изменение брони помещения успешно отправлена"
                                                  }
                                                },
                                                {
                                                  "$navigate": {
                                                    "commands": [
                                                      "/cabinet/event/edit"
                                                    ],
                                                    "extras": {
                                                      "queryParams": {
                                                        "id": {
                                                          "$from-context": {
                                                            "path": "@preload.booking.eventId"
                                                          }
                                                        },
                                                        "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"rent\"}}"
                                                      }
                                                    }
                                                  }
                                                }
                                              ],
                                              "422": [
                                                "$ref:operation-frontend:snippets/element/_http_message/http-errors-from-response"
                                              ],
                                              "client": {
                                                "$api-workflow": {
                                                  "type": "post",
                                                  "options": {
                                                    "observe": "response"
                                                  },
                                                  "workflow": "booking",
                                                  "action": "edit",
                                                  "data": {
                                                    "$assign-object": {
                                                      "path": "hasPermission",
                                                      "data": {
                                                        "$if": {
                                                          "condition": {
                                                            "$active-user-has-permission": {
                                                              "permission": "request.accept.new"
                                                            }
                                                          },
                                                          "then": "accept_request",
                                                          "else": {
                                                            "$if": {
                                                              "condition": {
                                                                "$active-user-has-permission": {
                                                                  "permission": "booking.edit_part"
                                                                }
                                                              },
                                                              "then": "edit_part",
                                                              "else": "no"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "object": {
                                                        "$exclude": {
                                                          "data": {
                                                            "$var": {
                                                              "path": "#data"
                                                            }
                                                          },
                                                          "exclude": [
                                                            "rooms",
                                                            "configuration",
                                                            "roomsView",
                                                            "roomType",
                                                            "additional_services",
                                                            "equipments",
                                                            "furniture"
                                                          ]
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              },
                                              "finalize": "$ref:operation-frontend:snippets/element/_loading/onclick-loading-disable",
                                              "default": [
                                                {
                                                  "$message": {
                                                    "severity": "success",
                                                    "summary": "Редактирование брони помещения",
                                                    "detail": "Непредвиденная ошибка"
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "acceptLabel": "Подтвердить",
                                    "rejectLabel": "Отмена",
                                    "rejectButtonStyleClass": "button_outline",
                                    "reject": false
                                  }
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "cancel": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Отмена"
                        },
                        "events": {
                          "click": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#roomDelete",
                              "value": false
                            }
                          }
                        },
                        "class": {
                          "value": "button_outline mrg-r-0 mrg-b-0"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "breadcrumbs": {
      "type": "object",
      "model": false,
      "widget": {
        "name": "breadcrumb",
        "mobileItems": [
          {
            "label": "Главная",
            "routerLink": "/cabinet/event/list"
          }
        ],
        "items": [
          {
            "label": "Главная",
            "routerLink": "/cabinet/event/list"
          },
          {
            "label": {
              "$from-context": {
                "path": "@preload.booking.event.name"
              }
            },
            "routerLink": "/cabinet/event/view",
            "queryParams": {
              "id": {
                "$from-context": {
                  "path": "@preload.booking.eventId"
                }
              }
            }
          },
          {
            "label": "Редактирование мероприятия",
            "routerLink": "/cabinet/event/edit",
            "queryParams": {
              "id": {
                "$from-context": {
                  "path": "@preload.booking.eventId"
                }
              },
              "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"rent\"}}"
            }
          },
          {
            "label": {
              "$replace": {
                "template": "Редактирование брони помещения \"{{0}}\"",
                "data": [
                  {
                    "$from-context": {
                      "path": "@preload.booking.name"
                    }
                  }
                ]
              }
            }
          }
        ],
        "class": {
          "group": "p-xs-auto mrg-b-md"
        }
      }
    },
    "form": {
      "type": "object",
      "model": "#data",
      "value": {
        "$json-model": {
          "data": {
            "$from-context": {
              "path": "@preload.booking"
            }
          },
          "alias": "#data"
        }
      },
      "widget": {
        "name": "form",
        "options": {
          "label": {
            "$replace": {
              "template": "Редактирование брони помещения \"{{0}}\"",
              "data": [
                {
                  "$from-context": {
                    "path": "@preload.booking.name"
                  }
                }
              ]
            }
          }
        },
        "class": {
          "label": "h1 mrg-b-xl"
        }
      },
      "properties": {
        "tabs": {
          "type": "object",
          "model": false,
          "widget": {
            "key": "tabs",
            "name": "tab-view"
          },
          "properties": {
            "commonInfo": {
              "type": "object",
              "model": false,
              "widget": {
                "key": "commonInfo",
                "name": "tab-panel",
                "options": {
                  "label": "Общие данные"
                }
              },
              "properties": {
                "common": {
                  "type": "object",
                  "model": false,
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Основные сведения о брони"
                    },
                    "kind": "container-form-group-with-h2-style"
                  },
                  "properties": {
                    "eventState": {
                      "type": "string",
                      "widget": "hidden",
                      "model": "#data.eventState",
                      "value": {
                        "$from-context": {
                          "path": "@preload.booking.event.state"
                        }
                      }
                    },
                    "rooms": {
                      "type": "array",
                      "widget": "hidden",
                      "items": {
                        "type": "object",
                        "properties": {
                          "roomId": {
                            "type": "string",
                            "widget": "hidden"
                          },
                          "room": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string",
                                "widget": "hidden"
                              }
                            }
                          }
                        }
                      }
                    },
                    "configuration": {
                      "type": "boolean",
                      "widget": "hidden"
                    },
                    "minDate": {
                      "type": "datetime",
                      "widget": "hidden"
                    },
                    "maxDate": {
                      "type": "datetime",
                      "widget": "hidden"
                    },
                    "name": {
                      "type": "string",
                      "widget": {
                        "name": "input",
                        "options": {
                          "label": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": "Наименование конфигурации",
                              "else": "Наименование помещения"
                            }
                          },
                          "disabled": {
                            "$not": {
                              "data": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              }
                            }
                          }
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": "form-label form-label_required p-xs-12 p-md-4 p-xl-3",
                              "else": "form-label p-xs-12 p-md-4 p-xl-3"
                            }
                          },
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Обязательно для заполнения"
                          },
                          "events": [
                            "onUpdate",
                            "onBackend"
                          ]
                        }
                      ]
                    },
                    "roomsView": {
                      "type": "array",
                      "widget": {
                        "name": "info",
                        "options": {
                          "label": "Помещения",
                          "visible": {
                            "$from-context": {
                              "path": "@preload.booking.configuration"
                            }
                          },
                          "separator": "<br>",
                          "asList": "true",
                          "viewedValue": {
                            "$array-map": {
                              "array": {
                                "$from-context": {
                                  "path": "@preload.booking.rooms"
                                }
                              },
                              "map": {
                                "$from-context": {
                                  "path": "$data.room.name"
                                }
                              }
                            }
                          }
                        },
                        "kind": "info-form-item-text-view-style"
                      },
                      "items": {
                        "type": "string",
                        "widget": {
                          "name": "info"
                        }
                      }
                    },
                    "roomType": {
                      "type": "string",
                      "value": {
                        "$from-context": {
                          "path": "@preload.booking.rooms.0.room.type"
                        }
                      },
                      "widget": {
                        "name": "dropdown",
                        "options": {
                          "label": "Тип помещения",
                          "visible": {
                            "$not": {
                              "data": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              }
                            }
                          },
                          "disabled": true,
                          "optionLabel": "name",
                          "valueKey": "id",
                          "dataKey": "id",
                          "placeholder": "Выбрать",
                          "filter": true,
                          "valueOptions": {
                            "$fetch-object": {
                              "path": "data.items",
                              "data": {
                                "$api-data": {
                                  "query": "room_type/get_for_dropdown",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "kind": "dropdown-dropdown-input-style"
                      }
                    },
                    "seatingTypeId": {
                      "type": "string",
                      "widget": {
                        "name": "dropdown",
                        "options": {
                          "label": "Тип рассадки",
                          "showClear": true,
                          "optionLabel": "name",
                          "valueKey": "id",
                          "dataKey": "id",
                          "placeholder": "Выбрать",
                          "filter": true,
                          "valueOptions": {
                            "$fetch-object": {
                              "path": "data.items",
                              "data": {
                                "$api-data": {
                                  "query": "seating_type/get_for_dropdown",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "kind": "dropdown-dropdown-input-style"
                      }
                    },
                    "numberOfPeople": {
                      "type": "number",
                      "widget": {
                        "name": "input",
                        "options": {
                          "label": "Количество человек",
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "autoGroup": true,
                            "rightAlign": false,
                            "allowMinus": false,
                            "integerDigits": 10,
                            "digits": 0
                          }
                        },
                        "kind": "input-text-input-style"
                      }
                    },
                    "comment": {
                      "type": "string",
                      "widget": {
                        "name": "textarea",
                        "options": {
                          "label": "Комментарий",
                          "rows": 6,
                          "maxlength": 4000
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      }
                    }
                  }
                },
                "dates_container": {
                  "type": "object",
                  "model": false,
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Даты бронирования"
                    },
                    "kind": "container-form-group-with-h2-style"
                  },
                  "properties": {
                    "installation": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "kind": "container-form-group-with-h3-style"
                      },
                      "properties": {
                        "header-with-button": {
                          "type": "object",
                          "widget": {
                            "name": "container",
                            "options": {
                              "label": "Монтаж"
                            },
                            "class": {
                              "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                              "label": "h4 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 mrg-md-b-md",
                              "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0"
                            }
                          },
                          "properties": {
                            "button": {
                              "widget": {
                                "name": "button",
                                "options": {
                                  "icon": "icon-plus",
                                  "label": "Добавить дату монтажа"
                                },
                                "events": {
                                  "click": {
                                    "$waterfall": {
                                      "arrayFunctions": [
                                        {
                                          "$populate": {
                                            "path": "#modalSelectInstallationDate",
                                            "data": {}
                                          }
                                        },
                                        {
                                          "$element-option": {
                                            "option": "visible",
                                            "path": "#modalSelectInstallationDate",
                                            "value": true
                                          }
                                        }
                                      ]
                                    }
                                  }
                                },
                                "class": {
                                  "value": "button_link"
                                }
                              }
                            }
                          }
                        },
                        "installation_dates": {
                          "type": "array",
                          "model": "#data.installationDates",
                          "widget": {
                            "name": "table-old",
                            "class": {
                              "group": "p-xxl-12 p-xs-12 mrg-t-md"
                            },
                            "options": {
                              "emptyMessage": "Данные не найдены"
                            },
                            "columns": {
                              "number": {
                                "label": "№"
                              },
                              "day": {
                                "label": "День"
                              },
                              "startTime": {
                                "label": "Время начала"
                              },
                              "endTime": {
                                "label": "Время завершения"
                              },
                              "actions": {
                                "label": "Действия",
                                "class": {
                                  "label": "column_actions",
                                  "value": "column_actions"
                                }
                              }
                            }
                          },
                          "items": {
                            "type": "object",
                            "properties": {
                              "number": {
                                "type": "number",
                                "widget": {
                                  "name": "info"
                                },
                                "value": {
                                  "$collection": {
                                    "action": "row-number"
                                  }
                                }
                              },
                              "day": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "datetime:\"DD.MM.YYYY\""
                                  }
                                },
                                "value": {
                                  "$subs": {
                                    "path": "#data.installationDates[].startTime"
                                  }
                                }
                              },
                              "startTime": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "datetime:\"HH:mm\""
                                  }
                                }
                              },
                              "endTime": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "datetime:\"HH:mm\""
                                  }
                                }
                              },
                              "actions": {
                                "type": "array",
                                "model": false,
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "title": {
                                      "type": "string",
                                      "widget": "hidden"
                                    }
                                  },
                                  "widget": {
                                    "name": "fieldset"
                                  }
                                },
                                "widget": {
                                  "name": "menu-button",
                                  "options": {
                                    "labelKey": "title"
                                  },
                                  "class": {
                                    "toggle": "actions-button"
                                  },
                                  "items": [
                                    {
                                      "title": "Редактировать",
                                      "command": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$populate": {
                                                "path": "#modalSelectInstallationDate.startTime",
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.installationDates[].startTime"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#modalSelectInstallationDate.endTime",
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.installationDates[].endTime"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#modalSelectInstallationDate.positionIndex",
                                                "data": {
                                                  "$subtract": {
                                                    "operand1": {
                                                      "$collection": {
                                                        "action": "row-number"
                                                      }
                                                    },
                                                    "operand2": 1
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "option": "visible",
                                                "path": "#modalSelectInstallationDate",
                                                "value": true
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    {
                                      "title": "Удалить",
                                      "command": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$collection": {
                                                "action": "row-remove"
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#data.minDate",
                                                "data": {
                                                  "$apply-func": {
                                                    "func": "let minStartTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (!minStartTime || new Date(date.startTime) < minStartTime) { minStartTime = new Date(date.startTime); } }); return minStartTime;",
                                                    "args": {
                                                      "installationDates": {
                                                        "$var": {
                                                          "path": "#data.installationDates"
                                                        }
                                                      },
                                                      "eventDates": {
                                                        "$var": {
                                                          "path": "#data.eventDates"
                                                        }
                                                      },
                                                      "deinstallationDates": {
                                                        "$var": {
                                                          "path": "#data.deinstallationDates"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#data.maxDate",
                                                "data": {
                                                  "$apply-func": {
                                                    "func": "let maxEndTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (new Date(date.endTime) > maxEndTime) { maxEndTime = new Date(date.endTime); } }); return maxEndTime;",
                                                    "args": {
                                                      "installationDates": {
                                                        "$var": {
                                                          "path": "#data.installationDates"
                                                        }
                                                      },
                                                      "eventDates": {
                                                        "$var": {
                                                          "path": "#data.eventDates"
                                                        }
                                                      },
                                                      "deinstallationDates": {
                                                        "$var": {
                                                          "path": "#data.deinstallationDates"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$event-bus-publish": {
                                                "type": "day-count-change"
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#bookingInfo.table",
                                                "data": {
                                                  "$api-table-workflow-data": {
                                                    "model": "#bookingInfo.table",
                                                    "id": {
                                                      "$query-params": {
                                                        "name": "id"
                                                      }
                                                    },
                                                    "query": "booking/get_for_info",
                                                    "variables": {
                                                      "$assign-object": {
                                                        "object": {
                                                          "rows": 10,
                                                          "first": 0
                                                        },
                                                        "data": {
                                                          "except": {
                                                            "$query-params": {
                                                              "name": "id"
                                                            }
                                                          },
                                                          "minDate": {
                                                            "$subs": {
                                                              "path": "#data.minDate"
                                                            }
                                                          },
                                                          "maxDate": {
                                                            "$subs": {
                                                              "path": "#data.maxDate"
                                                            }
                                                          },
                                                          "roomsArr": {
                                                            "$array-pluck": {
                                                              "array": {
                                                                "$from-context": {
                                                                  "path": "@preload.booking.rooms"
                                                                }
                                                              },
                                                              "key": "roomId"
                                                            }
                                                          }
                                                        },
                                                        "path": ""
                                                      }
                                                    },
                                                    "errors": {
                                                      "default": {
                                                        "$message": {
                                                          "severity": "error",
                                                          "summary": "Ошибка",
                                                          "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.deinstallationDates"
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "event": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "kind": "container-form-group-with-h3-style"
                      },
                      "properties": {
                        "header-with-button": {
                          "type": "object",
                          "widget": {
                            "name": "container",
                            "options": {
                              "label": "Мероприятие"
                            },
                            "class": {
                              "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                              "label": "h4 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 mrg-md-b-md",
                              "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0"
                            }
                          },
                          "properties": {
                            "button": {
                              "widget": {
                                "name": "button",
                                "options": {
                                  "icon": "icon-plus",
                                  "label": "Добавить дату мероприятия"
                                },
                                "events": {
                                  "click": {
                                    "$waterfall": {
                                      "arrayFunctions": [
                                        {
                                          "$populate": {
                                            "path": "#modalSelectEventDate",
                                            "data": {}
                                          }
                                        },
                                        {
                                          "$element-option": {
                                            "option": "visible",
                                            "path": "#modalSelectEventDate",
                                            "value": true
                                          }
                                        }
                                      ]
                                    }
                                  }
                                },
                                "class": {
                                  "value": "button_link"
                                }
                              }
                            }
                          }
                        },
                        "event_dates": {
                          "type": "array",
                          "model": "#data.eventDates",
                          "widget": {
                            "name": "table-old",
                            "class": {
                              "group": "p-xxl-12 p-xs-12 mrg-t-md"
                            },
                            "options": {
                              "emptyMessage": "Данные не найдены"
                            },
                            "columns": {
                              "number": {
                                "label": "№"
                              },
                              "day": {
                                "label": "День"
                              },
                              "startTime": {
                                "label": "Время начала"
                              },
                              "endTime": {
                                "label": "Время завершения"
                              },
                              "actions": {
                                "label": "Действия",
                                "class": {
                                  "label": "column_actions",
                                  "value": "column_actions"
                                }
                              }
                            }
                          },
                          "items": {
                            "type": "object",
                            "properties": {
                              "number": {
                                "type": "number",
                                "widget": {
                                  "name": "info"
                                },
                                "value": {
                                  "$collection": {
                                    "action": "row-number"
                                  }
                                }
                              },
                              "day": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "datetime:\"DD.MM.YYYY\""
                                  }
                                },
                                "value": {
                                  "$subs": {
                                    "path": "#data.eventDates[].startTime"
                                  }
                                }
                              },
                              "startTime": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "datetime:\"HH:mm\""
                                  }
                                }
                              },
                              "endTime": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "datetime:\"HH:mm\""
                                  }
                                }
                              },
                              "actions": {
                                "type": "array",
                                "model": false,
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "title": {
                                      "type": "string",
                                      "widget": "hidden"
                                    }
                                  },
                                  "widget": {
                                    "name": "fieldset"
                                  }
                                },
                                "widget": {
                                  "name": "menu-button",
                                  "options": {
                                    "labelKey": "title"
                                  },
                                  "class": {
                                    "toggle": "actions-button"
                                  },
                                  "items": [
                                    {
                                      "title": "Редактировать",
                                      "command": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$populate": {
                                                "path": "#modalSelectEventDate.startTime",
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.eventDates[].startTime"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#modalSelectEventDate.endTime",
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.eventDates[].endTime"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#modalSelectEventDate.positionIndex",
                                                "data": {
                                                  "$subtract": {
                                                    "operand1": {
                                                      "$collection": {
                                                        "action": "row-number"
                                                      }
                                                    },
                                                    "operand2": 1
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "option": "visible",
                                                "path": "#modalSelectEventDate",
                                                "value": true
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    {
                                      "title": "Удалить",
                                      "command": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$collection": {
                                                "action": "row-remove"
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#data.minDate",
                                                "data": {
                                                  "$apply-func": {
                                                    "func": "let minStartTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (!minStartTime || new Date(date.startTime) < minStartTime) { minStartTime = new Date(date.startTime); } }); return minStartTime;",
                                                    "args": {
                                                      "installationDates": {
                                                        "$var": {
                                                          "path": "#data.installationDates"
                                                        }
                                                      },
                                                      "eventDates": {
                                                        "$var": {
                                                          "path": "#data.eventDates"
                                                        }
                                                      },
                                                      "deinstallationDates": {
                                                        "$var": {
                                                          "path": "#data.deinstallationDates"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#data.maxDate",
                                                "data": {
                                                  "$apply-func": {
                                                    "func": "let maxEndTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (new Date(date.endTime) > maxEndTime) { maxEndTime = new Date(date.endTime); } }); return maxEndTime;",
                                                    "args": {
                                                      "installationDates": {
                                                        "$var": {
                                                          "path": "#data.installationDates"
                                                        }
                                                      },
                                                      "eventDates": {
                                                        "$var": {
                                                          "path": "#data.eventDates"
                                                        }
                                                      },
                                                      "deinstallationDates": {
                                                        "$var": {
                                                          "path": "#data.deinstallationDates"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$event-bus-publish": {
                                                "type": "day-count-change"
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#bookingInfo.table",
                                                "data": {
                                                  "$api-table-workflow-data": {
                                                    "model": "#bookingInfo.table",
                                                    "id": {
                                                      "$query-params": {
                                                        "name": "id"
                                                      }
                                                    },
                                                    "query": "booking/get_for_info",
                                                    "variables": {
                                                      "$assign-object": {
                                                        "object": {
                                                          "rows": 10,
                                                          "first": 0
                                                        },
                                                        "data": {
                                                          "except": {
                                                            "$query-params": {
                                                              "name": "id"
                                                            }
                                                          },
                                                          "minDate": {
                                                            "$subs": {
                                                              "path": "#data.minDate"
                                                            }
                                                          },
                                                          "maxDate": {
                                                            "$subs": {
                                                              "path": "#data.maxDate"
                                                            }
                                                          },
                                                          "roomsArr": {
                                                            "$array-pluck": {
                                                              "array": {
                                                                "$from-context": {
                                                                  "path": "@preload.booking.rooms"
                                                                }
                                                              },
                                                              "key": "roomId"
                                                            }
                                                          }
                                                        },
                                                        "path": ""
                                                      }
                                                    },
                                                    "errors": {
                                                      "default": {
                                                        "$message": {
                                                          "severity": "error",
                                                          "summary": "Ошибка",
                                                          "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.deinstallationDates"
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "message": "Обязательно для заполнения"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            }
                          ]
                        }
                      }
                    },
                    "deinstallation": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "kind": "container-form-group-with-h3-style"
                      },
                      "properties": {
                        "header-with-button": {
                          "type": "object",
                          "widget": {
                            "name": "container",
                            "options": {
                              "label": "Демонтаж"
                            },
                            "class": {
                              "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                              "label": "h4 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 mrg-md-b-md",
                              "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0"
                            }
                          },
                          "properties": {
                            "button": {
                              "widget": {
                                "name": "button",
                                "options": {
                                  "icon": "icon-plus",
                                  "label": "Добавить дату демонтажа"
                                },
                                "events": {
                                  "click": {
                                    "$waterfall": {
                                      "arrayFunctions": [
                                        {
                                          "$populate": {
                                            "path": "#modalSelectDeinstallationDate",
                                            "data": {}
                                          }
                                        },
                                        {
                                          "$element-option": {
                                            "option": "visible",
                                            "path": "#modalSelectDeinstallationDate",
                                            "value": true
                                          }
                                        }
                                      ]
                                    }
                                  }
                                },
                                "class": {
                                  "value": "button_link"
                                }
                              }
                            }
                          }
                        },
                        "deinstallation_dates": {
                          "type": "array",
                          "model": "#data.deinstallationDates",
                          "widget": {
                            "name": "table-old",
                            "class": {
                              "group": "p-xxl-12 p-xs-12 mrg-t-md"
                            },
                            "options": {
                              "emptyMessage": "Данные не найдены"
                            },
                            "columns": {
                              "number": {
                                "label": "№"
                              },
                              "day": {
                                "label": "День"
                              },
                              "startTime": {
                                "label": "Время начала"
                              },
                              "endTime": {
                                "label": "Время завершения"
                              },
                              "actions": {
                                "label": "Действия",
                                "class": {
                                  "label": "column_actions",
                                  "value": "column_actions"
                                }
                              }
                            }
                          },
                          "items": {
                            "type": "object",
                            "properties": {
                              "number": {
                                "type": "number",
                                "widget": {
                                  "name": "info"
                                },
                                "value": {
                                  "$collection": {
                                    "action": "row-number"
                                  }
                                }
                              },
                              "day": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "datetime:\"DD.MM.YYYY\""
                                  }
                                },
                                "value": {
                                  "$subs": {
                                    "path": "#data.deinstallationDates[].startTime"
                                  }
                                }
                              },
                              "startTime": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "datetime:\"HH:mm\""
                                  }
                                }
                              },
                              "endTime": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "datetime:\"HH:mm\""
                                  }
                                }
                              },
                              "actions": {
                                "type": "array",
                                "model": false,
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "title": {
                                      "type": "string",
                                      "widget": "hidden"
                                    }
                                  },
                                  "widget": {
                                    "name": "fieldset"
                                  }
                                },
                                "widget": {
                                  "name": "menu-button",
                                  "options": {
                                    "labelKey": "title"
                                  },
                                  "class": {
                                    "toggle": "actions-button"
                                  },
                                  "items": [
                                    {
                                      "title": "Редактировать",
                                      "command": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$populate": {
                                                "path": "#modalSelectDeinstallationDate.startTime",
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.deinstallationDates[].startTime"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#modalSelectDeinstallationDate.endTime",
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.deinstallationDates[].endTime"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#modalSelectDeinstallationDate.positionIndex",
                                                "data": {
                                                  "$subtract": {
                                                    "operand1": {
                                                      "$collection": {
                                                        "action": "row-number"
                                                      }
                                                    },
                                                    "operand2": 1
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "option": "visible",
                                                "path": "#modalSelectDeinstallationDate",
                                                "value": true
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    },
                                    {
                                      "title": "Удалить",
                                      "command": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$collection": {
                                                "action": "row-remove"
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#data.minDate",
                                                "data": {
                                                  "$apply-func": {
                                                    "func": "let minStartTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (!minStartTime || new Date(date.startTime) < minStartTime) { minStartTime = new Date(date.startTime); } }); return minStartTime;",
                                                    "args": {
                                                      "installationDates": {
                                                        "$var": {
                                                          "path": "#data.installationDates"
                                                        }
                                                      },
                                                      "eventDates": {
                                                        "$var": {
                                                          "path": "#data.eventDates"
                                                        }
                                                      },
                                                      "deinstallationDates": {
                                                        "$var": {
                                                          "path": "#data.deinstallationDates"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#data.maxDate",
                                                "data": {
                                                  "$apply-func": {
                                                    "func": "let maxEndTime = null; const allDates = [...installationDates, ...eventDates, ...deinstallationDates]; allDates.forEach(date => { if (new Date(date.endTime) > maxEndTime) { maxEndTime = new Date(date.endTime); } }); return maxEndTime;",
                                                    "args": {
                                                      "installationDates": {
                                                        "$var": {
                                                          "path": "#data.installationDates"
                                                        }
                                                      },
                                                      "eventDates": {
                                                        "$var": {
                                                          "path": "#data.eventDates"
                                                        }
                                                      },
                                                      "deinstallationDates": {
                                                        "$var": {
                                                          "path": "#data.deinstallationDates"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$event-bus-publish": {
                                                "type": "day-count-change"
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#bookingInfo.table",
                                                "data": {
                                                  "$api-table-workflow-data": {
                                                    "model": "#bookingInfo.table",
                                                    "id": {
                                                      "$query-params": {
                                                        "name": "id"
                                                      }
                                                    },
                                                    "query": "booking/get_for_info",
                                                    "variables": {
                                                      "$assign-object": {
                                                        "object": {
                                                          "rows": 10,
                                                          "first": 0
                                                        },
                                                        "data": {
                                                          "except": {
                                                            "$query-params": {
                                                              "name": "id"
                                                            }
                                                          },
                                                          "minDate": {
                                                            "$subs": {
                                                              "path": "#data.minDate"
                                                            }
                                                          },
                                                          "maxDate": {
                                                            "$subs": {
                                                              "path": "#data.maxDate"
                                                            }
                                                          },
                                                          "roomsArr": {
                                                            "$array-pluck": {
                                                              "array": {
                                                                "$from-context": {
                                                                  "path": "@preload.booking.rooms"
                                                                }
                                                              },
                                                              "key": "roomId"
                                                            }
                                                          }
                                                        },
                                                        "path": ""
                                                      }
                                                    },
                                                    "errors": {
                                                      "default": {
                                                        "$message": {
                                                          "severity": "error",
                                                          "summary": "Ошибка",
                                                          "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.deinstallationDates"
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$if": {
                                    "condition": {
                                      "$and": {
                                        "operands": [
                                          {
                                            "$not": {
                                              "data": {
                                                "$var": {
                                                  "path": "#data.partial"
                                                }
                                              }
                                            }
                                          },
                                          {
                                            "$not": {
                                              "data": {
                                                "$from-context": {
                                                  "path": "@preload.booking.configuration"
                                                }
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "then": {
                                      "$or": {
                                        "operands": [
                                          {
                                            "$empty": {
                                              "data": {
                                                "$var": {
                                                  "path": "#bookingInfo.table"
                                                }
                                              }
                                            }
                                          },
                                          {
                                            "===": {
                                              "operand1": {
                                                "$var": {
                                                  "path": "#data.minDate"
                                                }
                                              },
                                              "operand2": null
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "else": true
                                  }
                                },
                                "message": "Помещение уже забронированно в выбранный период в рамках другого мероприятия"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                "cost_of_rent_container": {
                  "type": "object",
                  "model": false,
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Расчет стоимости аренды"
                    },
                    "class": {
                      "label": "h2 mrg-b-md",
                      "value": "mrg-b-xl"
                    }
                  },
                  "properties": {
                    "container_checkbox": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Забронировать часть помещения",
                          "visible": {
                            "$and": {
                              "operands": [
                                {
                                  "$from-context": {
                                    "path": "@preload.booking.rooms.0.room.transformation"
                                  }
                                },
                                {
                                  "$not": {
                                    "data": {
                                      "$from-context": {
                                        "path": "@preload.booking.configuration"
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "properties": {
                        "partial": {
                          "type": "boolean",
                          "model": "#data.partial",
                          "widget": {
                            "name": "checkbox",
                            "options": {
                              "optionLabel": "",
                              "optionLabelHTML": ""
                            },
                            "events": {
                              "change": {
                                "$if": {
                                  "condition": {
                                    "$var": {
                                      "path": "#data.partial"
                                    }
                                  },
                                  "then": {},
                                  "else": {
                                    "$populate": {
                                      "data": {
                                        "$from-context": {
                                          "path": "@preload.booking.rooms.0.room.square"
                                        }
                                      },
                                      "path": "#data.allSquare"
                                    }
                                  }
                                }
                              }
                            },
                            "class": {
                              "value": "form-item-element form-item-element_checkbox form-item-element_label-html"
                            }
                          }
                        }
                      }
                    },
                    "file": {
                      "type": "file",
                      "widget": {
                        "name": "file",
                        "model": "#data.file",
                        "options": {
                          "visible": {
                            "$subs": {
                              "path": "#data.partial"
                            }
                          },
                          "label": "Часть помещения на карте",
                          "enableFilesUpload": true,
                          "displayUploadedFiles": true,
                          "uploadParams": {
                            "workflow": "event",
                            "action": "add-document-upload",
                            "invalidFileSizeMessageDetail": "Превышен максимально допустимый размер файла: 60Мб",
                            "invalidFileTypeMessageDetail": "Недопустимый формат файла",
                            "accept": ".jpg, .png, .pdf, .jpeg",
                            "multiple": false,
                            "maxFileSize": 62914560,
                            "chooseLabel": "Выбрать"
                          },
                          "displayParams": {
                            "showSize": true,
                            "enableFilesRemove": true,
                            "enableFilesDownload": true
                          },
                          "objectId": {
                            "$query-params": {
                              "name": "id"
                            }
                          }
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid mrg-b-sm",
                          "label": "form-label form-label_required p-col-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-col-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$var": {
                                    "path": "#data.partial"
                                  }
                                },
                                "then": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "#data.file._id"
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Обязательно для заполнения"
                          },
                          "events": [
                            "onUpdate",
                            "onBackend"
                          ]
                        }
                      ]
                    },
                    "appendSquare": {
                      "type": "string",
                      "model": "#appendSquare",
                      "value": {
                        "$replace": {
                          "template": "из {{square}} м²",
                          "data": {
                            "square": {
                              "$if": {
                                "condition": {
                                  "$from-context": {
                                    "path": "@preload.booking.configuration"
                                  }
                                },
                                "then": {
                                  "$from-context": {
                                    "path": "@preload.booking.allSquare"
                                  }
                                },
                                "else": {
                                  "$from-context": {
                                    "path": "@preload.booking.rooms.0.room.square"
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "widget": "hidden"
                    },
                    "allSquare": {
                      "type": "number",
                      "model": "#data.allSquare",
                      "value": {
                        "$if": {
                          "condition": {
                            "$empty": {
                              "data": {
                                "$from-context": {
                                  "path": "@preload.booking.allSquare"
                                }
                              }
                            }
                          },
                          "then": {
                            "$from-context": {
                              "path": "@preload.booking.rooms.0.room.square"
                            }
                          },
                          "else": {
                            "$from-context": {
                              "path": "@preload.booking.allSquare"
                            }
                          }
                        }
                      },
                      "widget": {
                        "name": "input",
                        "options": {
                          "label": "Бронируемая площадь",
                          "disabled": {
                            "$not": {
                              "data": {
                                "$subs": {
                                  "path": "#data.partial"
                                }
                              }
                            }
                          },
                          "inputmask": {
                            "alias": "decimal",
                            "groupSeparator": " ",
                            "autoGroup": true,
                            "radixPoint": ",",
                            "rightAlign": false,
                            "allowMinus": false,
                            "digits": 2,
                            "integerDigits": 10
                          }
                        },
                        "append": {
                          "type": "string",
                          "value": {
                            "$var": {
                              "path": "#appendSquare"
                            }
                          },
                          "widget": {
                            "name": "link",
                            "class": {
                              "group": "text-addon text-addon_right"
                            },
                            "events": {
                              "click": [
                                {
                                  "$element-option": {
                                    "option": "visible",
                                    "path": "#bookingInfo",
                                    "value": true
                                  }
                                },
                                {
                                  "$element-event": {
                                    "path": "#bookingInfo.table",
                                    "event": "reload",
                                    "value": true
                                  }
                                }
                              ]
                            }
                          }
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label_required p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        },
                        "events": {
                          "change": {
                            "$event-bus-publish": {
                              "type": "all-square-change",
                              "publisher": "allSquare",
                              "next": {
                                "$var": {
                                  "path": "#data.allSquare"
                                }
                              }
                            }
                          }
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Поле обязательно для заполнения"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "!==": {
                                "operand1": {
                                  "$var": {
                                    "path": "."
                                  }
                                },
                                "operand2": 0
                              }
                            },
                            "message": "Бронируемая площадь должна быть больше 0"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$from-context": {
                                    "path": "@preload.booking.configuration"
                                  }
                                },
                                "then": {
                                  "<=": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": {
                                      "$from-context": {
                                        "path": "@preload.booking.allSquare"
                                      }
                                    }
                                  }
                                },
                                "else": {
                                  "<=": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": {
                                      "$from-context": {
                                        "path": "@preload.booking.rooms.0.room.square"
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "message": "Бронируемая площадь не должна превышать площадь помещения"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "discountOrMarkupFlag": {
                      "type": "string",
                      "model": "#data.discountOrMarkupFlag",
                      "widget": {
                        "name": "radio-button",
                        "options": {
                          "label": "Применить скидку/наценку",
                          "valueKey": "code",
                          "optionLabel": "name",
                          "valueOptions": [
                            {
                              "code": "no",
                              "name": "Не применять"
                            },
                            {
                              "code": "discount",
                              "name": "Применить скидку"
                            },
                            {
                              "code": "markup",
                              "name": "Применить наценку"
                            }
                          ]
                        },
                        "class": {
                          "group": "form-item form-item_radio p-field p-grid p-fluid",
                          "label": "form-label form-label mrg-t-0 p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4 p-flex-column",
                          "item": "form-item_radio__item width-100"
                        },
                        "events": {
                          "change": {
                            "$waterfall": {
                              "arrayFunctions": [
                                {
                                  "$event-bus-publish": {
                                    "type": "flag-change",
                                    "publisher": "discountOrMarkupFlag",
                                    "next": {
                                      "$var": {
                                        "path": "#data.discountOrMarkupFlag"
                                      }
                                    }
                                  }
                                },
                                {
                                  "$populate": {
                                    "path": "#data.discountOrMarkup",
                                    "data": ""
                                  }
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "discountOrMarkup": {
                      "type": "number",
                      "model": "#data.discountOrMarkup",
                      "widget": {
                        "name": "input",
                        "options": {
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "rightAlign": false,
                            "autoGroup": true,
                            "allowMinus": false,
                            "integerDigits": 3,
                            "digits": 2,
                            "radixPoint": ","
                          },
                          "label": {
                            "$switch": {
                              "condition": {
                                "$subs": {
                                  "path": "#data.discountOrMarkupFlag"
                                }
                              },
                              "default": "",
                              "cases": [
                                {
                                  "value": "discount",
                                  "action": "Скидка"
                                },
                                {
                                  "value": "markup",
                                  "action": "Наценка"
                                }
                              ]
                            }
                          },
                          "visible": {
                            "!==": {
                              "operand1": {
                                "$subs": {
                                  "path": "#data.discountOrMarkupFlag"
                                }
                              },
                              "operand2": "no"
                            }
                          }
                        },
                        "append": {
                          "type": "string",
                          "value": "%",
                          "widget": {
                            "name": "info",
                            "class": {
                              "group": "text-addon text-addon_right"
                            }
                          }
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label_required p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        },
                        "events": {
                          "change": [
                            {
                              "$populate": {
                                "path": "#data.allPriceMeterWithDiscountOrMarkup",
                                "emitEvent": false,
                                "data": {
                                  "$math-round": {
                                    "value": {
                                      "$add": {
                                        "multipliers": [
                                          {
                                            "$var": {
                                              "path": "#data.allPriceMeter"
                                            }
                                          },
                                          {
                                            "$switch": {
                                              "condition": {
                                                "$var": {
                                                  "path": "#data.discountOrMarkupFlag"
                                                }
                                              },
                                              "cases": [
                                                {
                                                  "value": "discount",
                                                  "action": {
                                                    "$subtract": {
                                                      "operand1": 1,
                                                      "operand2": {
                                                        "$division": {
                                                          "operand1": {
                                                            "$var": {
                                                              "path": "#data.discountOrMarkup"
                                                            }
                                                          },
                                                          "operand2": 100
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                {
                                                  "value": "markup",
                                                  "action": {
                                                    "$sum": {
                                                      "terms": [
                                                        1,
                                                        {
                                                          "$division": {
                                                            "operand1": {
                                                              "$var": {
                                                                "path": "#data.discountOrMarkup"
                                                              }
                                                            },
                                                            "operand2": 100
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  }
                                                },
                                                {
                                                  "value": "no",
                                                  "action": 1
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "exp": -2
                                  }
                                }
                              }
                            },
                            {
                              "$populate": {
                                "path": "#data.allPriceWithDiscountOrMarkup",
                                "emitEvent": false,
                                "data": {
                                  "$math-round": {
                                    "value": {
                                      "$add": {
                                        "multipliers": [
                                          {
                                            "$var": {
                                              "path": "#data.allPrice"
                                            }
                                          },
                                          {
                                            "$switch": {
                                              "condition": {
                                                "$var": {
                                                  "path": "#data.discountOrMarkupFlag"
                                                }
                                              },
                                              "cases": [
                                                {
                                                  "value": "discount",
                                                  "action": {
                                                    "$subtract": {
                                                      "operand1": 1,
                                                      "operand2": {
                                                        "$division": {
                                                          "operand1": {
                                                            "$var": {
                                                              "path": "#data.discountOrMarkup"
                                                            }
                                                          },
                                                          "operand2": 100
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                {
                                                  "value": "markup",
                                                  "action": {
                                                    "$sum": {
                                                      "terms": [
                                                        1,
                                                        {
                                                          "$division": {
                                                            "operand1": {
                                                              "$var": {
                                                                "path": "#data.discountOrMarkup"
                                                              }
                                                            },
                                                            "operand2": 100
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  }
                                                },
                                                {
                                                  "value": "no",
                                                  "action": 1
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "exp": -2
                                  }
                                }
                              }
                            }
                          ]
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "!==": {
                                    "operand1": "no",
                                    "operand2": {
                                      "$var": {
                                        "path": "#data.discountOrMarkupFlag"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Поле обязательно для заполнения"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$and": {
                                    "operands": [
                                      {
                                        "!==": {
                                          "operand1": "no",
                                          "operand2": {
                                            "$var": {
                                              "path": "#data.discountOrMarkupFlag"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "$not-empty": {
                                          "data": {
                                            "$var": {
                                              "path": "."
                                            }
                                          }
                                        }
                                      }
                                    ]
                                  }
                                },
                                "then": {
                                  ">": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 0
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Значение должно быть больше 0"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "===": {
                                    "operand1": "discount",
                                    "operand2": {
                                      "$var": {
                                        "path": "#data.discountOrMarkupFlag"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "<": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 100
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Значение должно быть меньше 100"
                          },
                          "events": [
                            "onUpdate",
                            "onBackend"
                          ]
                        }
                      ]
                    },
                    "allPriceMeter-container": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Стоимость брони помещения за м²"
                        },
                        "class": {
                          "group": "form-item p-field p-grid",
                          "label": "form-label form-label_nds-label form-label_required p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element form-item-element_view input-height-fit-content p-xs-12 p-md-6 p-xl-4 d-flex p-flex-wrap p-flex-md-nowrap pdd-l-0 pdd-r-0"
                        }
                      },
                      "properties": {
                        "allPriceMeter": {
                          "type": "number",
                          "model": "#data.allPriceMeter",
                          "value": {
                            "$if": {
                              "condition": {
                                "$empty": {
                                  "data": {
                                    "$from-context": {
                                      "path": "@preload.booking.allPriceMeter"
                                    }
                                  }
                                }
                              },
                              "then": 0,
                              "else": {
                                "$from-context": {
                                  "path": "@preload.booking.allPriceMeter"
                                }
                              }
                            }
                          },
                          "widget": {
                            "name": "input",
                            "options": {
                              "label": {
                                "$switch": {
                                  "condition": {
                                    "$subs": {
                                      "path": "#data.discountOrMarkupFlag"
                                    }
                                  },
                                  "default": " ",
                                  "cases": [
                                    {
                                      "value": "discount",
                                      "action": "без скидки"
                                    },
                                    {
                                      "value": "markup",
                                      "action": "без наценки"
                                    }
                                  ]
                                }
                              },
                              "inputmask": {
                                "alias": "integer",
                                "groupSeparator": " ",
                                "autoGroup": true,
                                "radixPoint": ",",
                                "integerDigits": 12,
                                "allowMinus": false,
                                "digits": 2
                              }
                            },
                            "append": {
                              "type": "string",
                              "value": "руб.",
                              "widget": {
                                "name": "info",
                                "class": {
                                  "group": "text-addon text-addon_right"
                                }
                              }
                            },
                            "class": {
                              "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                              "label": "text-secondary fw-500 mrg-b-0"
                            },
                            "events": {
                              "change": [
                                {
                                  "$event-bus-publish": {
                                    "type": "all-price-meter-change",
                                    "publisher": "allPriceMeter",
                                    "next": {
                                      "$var": {
                                        "path": "#data.allPriceMeter"
                                      }
                                    }
                                  }
                                }
                              ]
                            },
                            "subscriptions": {
                              "all-price-change": {
                                "subscriber": "allPriceMeter",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceMeter",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$division": {
                                            "operand1": {
                                              "$var": {
                                                "path": "#data.allPrice"
                                              }
                                            },
                                            "operand2": {
                                              "$add": {
                                                "multipliers": [
                                                  {
                                                    "$sum": {
                                                      "terms": [
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.installationDates"
                                                              }
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.eventDates"
                                                              }
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.deinstallationDates"
                                                              }
                                                            }
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "$var": {
                                                      "path": "#data.allSquare"
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-meter-with-change": {
                                "subscriber": "allPriceMeter",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceMeter",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$division": {
                                            "operand1": {
                                              "$var": {
                                                "path": "#data.allPriceMeterWithDiscountOrMarkup"
                                              }
                                            },
                                            "operand2": {
                                              "$switch": {
                                                "condition": {
                                                  "$var": {
                                                    "path": "#data.discountOrMarkupFlag"
                                                  }
                                                },
                                                "cases": [
                                                  {
                                                    "value": "discount",
                                                    "action": {
                                                      "$subtract": {
                                                        "operand1": 1,
                                                        "operand2": {
                                                          "$division": {
                                                            "operand1": {
                                                              "$var": {
                                                                "path": "#data.discountOrMarkup"
                                                              }
                                                            },
                                                            "operand2": 100
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "value": "markup",
                                                    "action": {
                                                      "$sum": {
                                                        "terms": [
                                                          1,
                                                          {
                                                            "$division": {
                                                              "operand1": {
                                                                "$var": {
                                                                  "path": "#data.discountOrMarkup"
                                                                }
                                                              },
                                                              "operand2": 100
                                                            }
                                                          }
                                                        ]
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "value": "no",
                                                    "action": 1
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-with-change": {
                                "subscriber": "allPriceMeter",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceMeter",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$division": {
                                            "operand1": {
                                              "$var": {
                                                "path": "#data.allPriceWithDiscountOrMarkup"
                                              }
                                            },
                                            "operand2": {
                                              "$add": {
                                                "multipliers": [
                                                  {
                                                    "$var": {
                                                      "path": "#data.allSquare"
                                                    }
                                                  },
                                                  {
                                                    "$switch": {
                                                      "condition": {
                                                        "$var": {
                                                          "path": "#data.discountOrMarkupFlag"
                                                        }
                                                      },
                                                      "cases": [
                                                        {
                                                          "value": "discount",
                                                          "action": {
                                                            "$subtract": {
                                                              "operand1": 1,
                                                              "operand2": {
                                                                "$division": {
                                                                  "operand1": {
                                                                    "$var": {
                                                                      "path": "#data.discountOrMarkup"
                                                                    }
                                                                  },
                                                                  "operand2": 100
                                                                }
                                                              }
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "value": "markup",
                                                          "action": {
                                                            "$sum": {
                                                              "terms": [
                                                                1,
                                                                {
                                                                  "$division": {
                                                                    "operand1": {
                                                                      "$var": {
                                                                        "path": "#data.discountOrMarkup"
                                                                      }
                                                                    },
                                                                    "operand2": 100
                                                                  }
                                                                }
                                                              ]
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "value": "no",
                                                          "action": 1
                                                        }
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "$sum": {
                                                      "terms": [
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.installationDates"
                                                              }
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.eventDates"
                                                              }
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.deinstallationDates"
                                                              }
                                                            }
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  ">": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 0
                                  }
                                },
                                "message": "Стоимость брони помещения за м² должна быть больше 0"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            }
                          ]
                        },
                        "allPriceMeterWithDiscountOrMarkup": {
                          "type": "number",
                          "model": "#data.allPriceMeterWithDiscountOrMarkup",
                          "value": {
                            "$if": {
                              "condition": {
                                "$empty": {
                                  "data": {
                                    "$from-context": {
                                      "path": "@preload.booking.allPriceMeterWithDiscountOrMarkup"
                                    }
                                  }
                                }
                              },
                              "then": 0,
                              "else": {
                                "$from-context": {
                                  "path": "@preload.booking.allPriceMeterWithDiscountOrMarkup"
                                }
                              }
                            }
                          },
                          "widget": {
                            "name": "input",
                            "options": {
                              "label": {
                                "$switch": {
                                  "condition": {
                                    "$subs": {
                                      "path": "#data.discountOrMarkupFlag"
                                    }
                                  },
                                  "default": "",
                                  "cases": [
                                    {
                                      "value": "discount",
                                      "action": "со скидкой"
                                    },
                                    {
                                      "value": "markup",
                                      "action": "с наценкой"
                                    }
                                  ]
                                }
                              },
                              "inputmask": {
                                "alias": "integer",
                                "groupSeparator": " ",
                                "autoGroup": true,
                                "radixPoint": ",",
                                "integerDigits": 12,
                                "allowMinus": false,
                                "digits": 2
                              },
                              "visible": {
                                "!==": {
                                  "operand1": "no",
                                  "operand2": {
                                    "$subs": {
                                      "path": "#data.discountOrMarkupFlag"
                                    }
                                  }
                                }
                              }
                            },
                            "append": {
                              "type": "string",
                              "value": "руб.",
                              "widget": {
                                "name": "info",
                                "class": {
                                  "group": "text-addon text-addon_right"
                                }
                              }
                            },
                            "class": {
                              "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                              "label": "text-secondary fw-500 mrg-b-0"
                            },
                            "events": {
                              "change": [
                                {
                                  "$event-bus-publish": {
                                    "type": "all-price-meter-with-change",
                                    "publisher": "allPriceMeterWithDiscountOrMarkup",
                                    "next": {
                                      "$var": {
                                        "path": "#data.allPriceMeterWithDiscountOrMarkup"
                                      }
                                    }
                                  }
                                }
                              ]
                            },
                            "subscriptions": {
                              "flag-change": {
                                "subscriber": "allPriceMeterWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceMeterWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$var": {
                                        "path": "#data.allPriceMeter"
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-change": {
                                "subscriber": "allPriceMeterWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceMeterWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$add": {
                                            "multipliers": [
                                              {
                                                "$division": {
                                                  "operand1": {
                                                    "$var": {
                                                      "path": "#data.allPrice"
                                                    }
                                                  },
                                                  "operand2": {
                                                    "$add": {
                                                      "multipliers": [
                                                        {
                                                          "$sum": {
                                                            "terms": [
                                                              {
                                                                "$length": {
                                                                  "data": {
                                                                    "$var": {
                                                                      "path": "#data.installationDates"
                                                                    }
                                                                  }
                                                                }
                                                              },
                                                              {
                                                                "$length": {
                                                                  "data": {
                                                                    "$var": {
                                                                      "path": "#data.eventDates"
                                                                    }
                                                                  }
                                                                }
                                                              },
                                                              {
                                                                "$length": {
                                                                  "data": {
                                                                    "$var": {
                                                                      "path": "#data.deinstallationDates"
                                                                    }
                                                                  }
                                                                }
                                                              }
                                                            ]
                                                          }
                                                        },
                                                        {
                                                          "$var": {
                                                            "path": "#data.allSquare"
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  }
                                                }
                                              },
                                              {
                                                "$switch": {
                                                  "condition": {
                                                    "$var": {
                                                      "path": "#data.discountOrMarkupFlag"
                                                    }
                                                  },
                                                  "cases": [
                                                    {
                                                      "value": "discount",
                                                      "action": {
                                                        "$subtract": {
                                                          "operand1": 1,
                                                          "operand2": {
                                                            "$division": {
                                                              "operand1": {
                                                                "$var": {
                                                                  "path": "#data.discountOrMarkup"
                                                                }
                                                              },
                                                              "operand2": 100
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "value": "markup",
                                                      "action": {
                                                        "$sum": {
                                                          "terms": [
                                                            1,
                                                            {
                                                              "$division": {
                                                                "operand1": {
                                                                  "$var": {
                                                                    "path": "#data.discountOrMarkup"
                                                                  }
                                                                },
                                                                "operand2": 100
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "value": "no",
                                                      "action": 1
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-with-change": {
                                "subscriber": "allPriceMeterWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceMeterWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$division": {
                                            "operand1": {
                                              "$var": {
                                                "path": "#data.allPriceWithDiscountOrMarkup"
                                              }
                                            },
                                            "operand2": {
                                              "$add": {
                                                "multipliers": [
                                                  {
                                                    "$sum": {
                                                      "terms": [
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.installationDates"
                                                              }
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.eventDates"
                                                              }
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.deinstallationDates"
                                                              }
                                                            }
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "$var": {
                                                      "path": "#data.allSquare"
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-meter-change": {
                                "subscriber": "allPriceMeterWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceMeterWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$add": {
                                            "multipliers": [
                                              {
                                                "$var": {
                                                  "path": "#data.allPriceMeter"
                                                }
                                              },
                                              {
                                                "$switch": {
                                                  "condition": {
                                                    "$var": {
                                                      "path": "#data.discountOrMarkupFlag"
                                                    }
                                                  },
                                                  "cases": [
                                                    {
                                                      "value": "discount",
                                                      "action": {
                                                        "$subtract": {
                                                          "operand1": 1,
                                                          "operand2": {
                                                            "$division": {
                                                              "operand1": {
                                                                "$var": {
                                                                  "path": "#data.discountOrMarkup"
                                                                }
                                                              },
                                                              "operand2": 100
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "value": "markup",
                                                      "action": {
                                                        "$sum": {
                                                          "terms": [
                                                            1,
                                                            {
                                                              "$division": {
                                                                "operand1": {
                                                                  "$var": {
                                                                    "path": "#data.discountOrMarkup"
                                                                  }
                                                                },
                                                                "operand2": 100
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "value": "no",
                                                      "action": 1
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$if": {
                                    "condition": {
                                      "===": {
                                        "operand1": {
                                          "$var": {
                                            "path": "#data.discountOrMarkupFlag"
                                          }
                                        },
                                        "operand2": "discount"
                                      }
                                    },
                                    "then": {
                                      "<": {
                                        "operand1": {
                                          "$var": {
                                            "path": "."
                                          }
                                        },
                                        "operand2": {
                                          "$var": {
                                            "path": "#data.allPriceMeter"
                                          }
                                        }
                                      }
                                    },
                                    "else": true
                                  }
                                },
                                "message": "Стоимость брони помещения за м² со скидкой не может превышать стоимость без скидки"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            },
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$if": {
                                    "condition": {
                                      "===": {
                                        "operand1": {
                                          "$var": {
                                            "path": "#data.discountOrMarkupFlag"
                                          }
                                        },
                                        "operand2": "markup"
                                      }
                                    },
                                    "then": {
                                      ">": {
                                        "operand1": {
                                          "$var": {
                                            "path": "."
                                          }
                                        },
                                        "operand2": {
                                          "$var": {
                                            "path": "#data.allPriceMeter"
                                          }
                                        }
                                      }
                                    },
                                    "else": true
                                  }
                                },
                                "message": "Стоимость брони помещения за м² с наценкой должна превышать стоимость без наценки"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            }
                          ]
                        }
                      }
                    },
                    "allPrice-container": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Общая стоимость брони помещения"
                        },
                        "class": {
                          "group": "form-item p-field p-grid",
                          "label": "form-label form-label_nds-label form-label_required p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element form-item-element_view input-height-fit-content p-xs-12 p-md-6 p-xl-4 d-flex p-flex-wrap p-flex-md-nowrap pdd-l-0 pdd-r-0"
                        }
                      },
                      "properties": {
                        "allPrice": {
                          "type": "number",
                          "model": "#data.allPrice",
                          "value": {
                            "$if": {
                              "condition": {
                                "$empty": {
                                  "data": {
                                    "$from-context": {
                                      "path": "@preload.booking.allPrice"
                                    }
                                  }
                                }
                              },
                              "then": 0,
                              "else": {
                                "$from-context": {
                                  "path": "@preload.booking.allPrice"
                                }
                              }
                            }
                          },
                          "widget": {
                            "name": "input",
                            "options": {
                              "label": {
                                "$switch": {
                                  "condition": {
                                    "$subs": {
                                      "path": "#data.discountOrMarkupFlag"
                                    }
                                  },
                                  "default": " ",
                                  "cases": [
                                    {
                                      "value": "discount",
                                      "action": "без скидки"
                                    },
                                    {
                                      "value": "markup",
                                      "action": "без наценки"
                                    }
                                  ]
                                }
                              },
                              "inputmask": {
                                "alias": "integer",
                                "groupSeparator": " ",
                                "autoGroup": true,
                                "radixPoint": ",",
                                "integerDigits": 12,
                                "allowMinus": false,
                                "digits": 2
                              }
                            },
                            "append": {
                              "type": "string",
                              "value": "руб.",
                              "widget": {
                                "name": "info",
                                "class": {
                                  "group": "text-addon text-addon_right"
                                }
                              }
                            },
                            "class": {
                              "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                              "label": "text-secondary fw-500 mrg-b-0"
                            },
                            "events": {
                              "change": [
                                {
                                  "$event-bus-publish": {
                                    "type": "all-price-change",
                                    "publisher": "allPrice",
                                    "next": {
                                      "$var": {
                                        "path": "#data.allPrice"
                                      }
                                    }
                                  }
                                }
                              ]
                            },
                            "subscriptions": {
                              "all-square-change": {
                                "subscriber": "allPrice",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPrice",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$add": {
                                            "multipliers": [
                                              {
                                                "$var": {
                                                  "path": "#data.allSquare"
                                                }
                                              },
                                              {
                                                "$var": {
                                                  "path": "#data.allPriceMeter"
                                                }
                                              },
                                              {
                                                "$sum": {
                                                  "terms": [
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.installationDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.eventDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.deinstallationDates"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "day-count-change": {
                                "$populate": {
                                  "path": "#data.allPrice",
                                  "emitEvent": true,
                                  "data": {
                                    "$math-round": {
                                      "value": {
                                        "$add": {
                                          "multipliers": [
                                            {
                                              "$var": {
                                                "path": "#data.allSquare"
                                              }
                                            },
                                            {
                                              "$var": {
                                                "path": "#data.allPriceMeter"
                                              }
                                            },
                                            {
                                              "$sum": {
                                                "terms": [
                                                  {
                                                    "$length": {
                                                      "data": {
                                                        "$var": {
                                                          "path": "#data.installationDates"
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "$length": {
                                                      "data": {
                                                        "$var": {
                                                          "path": "#data.eventDates"
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "$length": {
                                                      "data": {
                                                        "$var": {
                                                          "path": "#data.deinstallationDates"
                                                        }
                                                      }
                                                    }
                                                  }
                                                ]
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "exp": -2
                                    }
                                  }
                                }
                              },
                              "all-price-meter-change": {
                                "subscriber": "allPrice",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPrice",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$add": {
                                            "multipliers": [
                                              {
                                                "$var": {
                                                  "path": "#data.allSquare"
                                                }
                                              },
                                              {
                                                "$var": {
                                                  "path": "#data.allPriceMeter"
                                                }
                                              },
                                              {
                                                "$sum": {
                                                  "terms": [
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.installationDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.eventDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.deinstallationDates"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-meter-with-change": {
                                "subscriber": "allPrice",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPrice",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$division": {
                                            "operand1": {
                                              "$add": {
                                                "multipliers": [
                                                  {
                                                    "$var": {
                                                      "path": "#data.allSquare"
                                                    }
                                                  },
                                                  {
                                                    "$var": {
                                                      "path": "#data.allPriceMeterWithDiscountOrMarkup"
                                                    }
                                                  },
                                                  {
                                                    "$sum": {
                                                      "terms": [
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.installationDates"
                                                              }
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.eventDates"
                                                              }
                                                            }
                                                          }
                                                        },
                                                        {
                                                          "$length": {
                                                            "data": {
                                                              "$var": {
                                                                "path": "#data.deinstallationDates"
                                                              }
                                                            }
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  }
                                                ]
                                              }
                                            },
                                            "operand2": {
                                              "$switch": {
                                                "condition": {
                                                  "$var": {
                                                    "path": "#data.discountOrMarkupFlag"
                                                  }
                                                },
                                                "cases": [
                                                  {
                                                    "value": "discount",
                                                    "action": {
                                                      "$subtract": {
                                                        "operand1": 1,
                                                        "operand2": {
                                                          "$division": {
                                                            "operand1": {
                                                              "$var": {
                                                                "path": "#data.discountOrMarkup"
                                                              }
                                                            },
                                                            "operand2": 100
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "value": "markup",
                                                    "action": {
                                                      "$sum": {
                                                        "terms": [
                                                          1,
                                                          {
                                                            "$division": {
                                                              "operand1": {
                                                                "$var": {
                                                                  "path": "#data.discountOrMarkup"
                                                                }
                                                              },
                                                              "operand2": 100
                                                            }
                                                          }
                                                        ]
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "value": "no",
                                                    "action": 1
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-with-change": {
                                "subscriber": "allPrice",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPrice",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$division": {
                                            "operand1": {
                                              "$var": {
                                                "path": "#data.allPriceWithDiscountOrMarkup"
                                              }
                                            },
                                            "operand2": {
                                              "$switch": {
                                                "condition": {
                                                  "$var": {
                                                    "path": "#data.discountOrMarkupFlag"
                                                  }
                                                },
                                                "cases": [
                                                  {
                                                    "value": "discount",
                                                    "action": {
                                                      "$subtract": {
                                                        "operand1": 1,
                                                        "operand2": {
                                                          "$division": {
                                                            "operand1": {
                                                              "$var": {
                                                                "path": "#data.discountOrMarkup"
                                                              }
                                                            },
                                                            "operand2": 100
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "value": "markup",
                                                    "action": {
                                                      "$sum": {
                                                        "terms": [
                                                          1,
                                                          {
                                                            "$division": {
                                                              "operand1": {
                                                                "$var": {
                                                                  "path": "#data.discountOrMarkup"
                                                                }
                                                              },
                                                              "operand2": 100
                                                            }
                                                          }
                                                        ]
                                                      }
                                                    }
                                                  },
                                                  {
                                                    "value": "no",
                                                    "action": 1
                                                  }
                                                ]
                                              }
                                            }
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  ">": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 0
                                  }
                                },
                                "message": "Общая стоимость брони помещения должна быть больше 0"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            }
                          ]
                        },
                        "allPriceWithDiscountOrMarkup": {
                          "type": "number",
                          "model": "#data.allPriceWithDiscountOrMarkup",
                          "value": {
                            "$if": {
                              "condition": {
                                "$empty": {
                                  "data": {
                                    "$from-context": {
                                      "path": "@preload.booking.allPriceWithDiscountOrMarkup"
                                    }
                                  }
                                }
                              },
                              "then": 0,
                              "else": {
                                "$from-context": {
                                  "path": "@preload.booking.allPriceWithDiscountOrMarkup"
                                }
                              }
                            }
                          },
                          "widget": {
                            "name": "input",
                            "options": {
                              "label": {
                                "$switch": {
                                  "condition": {
                                    "$subs": {
                                      "path": "#data.discountOrMarkupFlag"
                                    }
                                  },
                                  "default": "",
                                  "cases": [
                                    {
                                      "value": "discount",
                                      "action": "со скидкой"
                                    },
                                    {
                                      "value": "markup",
                                      "action": "с наценкой"
                                    }
                                  ]
                                }
                              },
                              "inputmask": {
                                "alias": "integer",
                                "groupSeparator": " ",
                                "autoGroup": true,
                                "radixPoint": ",",
                                "integerDigits": 12,
                                "allowMinus": false,
                                "digits": 2
                              },
                              "visible": {
                                "!==": {
                                  "operand1": "no",
                                  "operand2": {
                                    "$subs": {
                                      "path": "#data.discountOrMarkupFlag"
                                    }
                                  }
                                }
                              }
                            },
                            "append": {
                              "type": "string",
                              "value": "руб.",
                              "widget": {
                                "name": "info",
                                "class": {
                                  "group": "text-addon text-addon_right"
                                }
                              }
                            },
                            "class": {
                              "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                              "label": "text-secondary fw-500 mrg-b-0"
                            },
                            "events": {
                              "change": {
                                "$event-bus-publish": {
                                  "type": "all-price-with-change",
                                  "publisher": "allPriceWithDiscountOrMarkup",
                                  "next": {
                                    "$var": {
                                      "path": "#data.allPriceWithDiscountOrMarkup"
                                    }
                                  }
                                }
                              }
                            },
                            "subscriptions": {
                              "flag-change": {
                                "subscriber": "allPriceWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$var": {
                                        "path": "#data.allPrice"
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-meter-with-change": {
                                "subscriber": "allPriceWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$add": {
                                            "multipliers": [
                                              {
                                                "$var": {
                                                  "path": "#data.allSquare"
                                                }
                                              },
                                              {
                                                "$var": {
                                                  "path": "#data.allPriceMeterWithDiscountOrMarkup"
                                                }
                                              },
                                              {
                                                "$sum": {
                                                  "terms": [
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.installationDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.eventDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.deinstallationDates"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "all-square-change": {
                                "subscriber": "allPriceWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$add": {
                                            "multipliers": [
                                              {
                                                "$var": {
                                                  "path": "#data.allSquare"
                                                }
                                              },
                                              {
                                                "$var": {
                                                  "path": "#data.allPriceMeterWithDiscountOrMarkup"
                                                }
                                              },
                                              {
                                                "$sum": {
                                                  "terms": [
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.installationDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.eventDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.deinstallationDates"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-meter-change": {
                                "subscriber": "allPriceWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$add": {
                                            "multipliers": [
                                              {
                                                "$var": {
                                                  "path": "#data.allSquare"
                                                }
                                              },
                                              {
                                                "$var": {
                                                  "path": "#data.allPriceMeter"
                                                }
                                              },
                                              {
                                                "$switch": {
                                                  "condition": {
                                                    "$var": {
                                                      "path": "#data.discountOrMarkupFlag"
                                                    }
                                                  },
                                                  "cases": [
                                                    {
                                                      "value": "discount",
                                                      "action": {
                                                        "$subtract": {
                                                          "operand1": 1,
                                                          "operand2": {
                                                            "$division": {
                                                              "operand1": {
                                                                "$var": {
                                                                  "path": "#data.discountOrMarkup"
                                                                }
                                                              },
                                                              "operand2": 100
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "value": "markup",
                                                      "action": {
                                                        "$sum": {
                                                          "terms": [
                                                            1,
                                                            {
                                                              "$division": {
                                                                "operand1": {
                                                                  "$var": {
                                                                    "path": "#data.discountOrMarkup"
                                                                  }
                                                                },
                                                                "operand2": 100
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "value": "no",
                                                      "action": 1
                                                    }
                                                  ]
                                                }
                                              },
                                              {
                                                "$sum": {
                                                  "terms": [
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.installationDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.eventDates"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$length": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data.deinstallationDates"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              },
                              "all-price-change": {
                                "subscriber": "allPriceWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.allPriceWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$math-round": {
                                        "value": {
                                          "$add": {
                                            "multipliers": [
                                              {
                                                "$var": {
                                                  "path": "#data.allPrice"
                                                }
                                              },
                                              {
                                                "$switch": {
                                                  "condition": {
                                                    "$var": {
                                                      "path": "#data.discountOrMarkupFlag"
                                                    }
                                                  },
                                                  "cases": [
                                                    {
                                                      "value": "discount",
                                                      "action": {
                                                        "$subtract": {
                                                          "operand1": 1,
                                                          "operand2": {
                                                            "$division": {
                                                              "operand1": {
                                                                "$var": {
                                                                  "path": "#data.discountOrMarkup"
                                                                }
                                                              },
                                                              "operand2": 100
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "value": "markup",
                                                      "action": {
                                                        "$sum": {
                                                          "terms": [
                                                            1,
                                                            {
                                                              "$division": {
                                                                "operand1": {
                                                                  "$var": {
                                                                    "path": "#data.discountOrMarkup"
                                                                  }
                                                                },
                                                                "operand2": 100
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "value": "no",
                                                      "action": 1
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        "exp": -2
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$if": {
                                    "condition": {
                                      "===": {
                                        "operand1": {
                                          "$var": {
                                            "path": "#data.discountOrMarkupFlag"
                                          }
                                        },
                                        "operand2": "discount"
                                      }
                                    },
                                    "then": {
                                      "<": {
                                        "operand1": {
                                          "$var": {
                                            "path": "."
                                          }
                                        },
                                        "operand2": {
                                          "$var": {
                                            "path": "#data.allPrice"
                                          }
                                        }
                                      }
                                    },
                                    "else": true
                                  }
                                },
                                "message": "Общая стоимость брони помещения со скидкой не может превышать стоимость без скидки"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            },
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$if": {
                                    "condition": {
                                      "===": {
                                        "operand1": {
                                          "$var": {
                                            "path": "#data.discountOrMarkupFlag"
                                          }
                                        },
                                        "operand2": "markup"
                                      }
                                    },
                                    "then": {
                                      ">": {
                                        "operand1": {
                                          "$var": {
                                            "path": "."
                                          }
                                        },
                                        "operand2": {
                                          "$var": {
                                            "path": "#data.allPrice"
                                          }
                                        }
                                      }
                                    },
                                    "else": true
                                  }
                                },
                                "message": "Общая стоимость брони помещения с наценкой должна превышать стоимость без наценки"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              }
            },
            "allEquipment": {
              "type": "object",
              "model": false,
              "widget": {
                "key": "allEquipment",
                "name": "tab-panel",
                "options": {
                  "label": "Оснащение"
                }
              },
              "properties": {
                "facilities_container": {
                  "type": "object",
                  "model": false,
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Сведения о бронируемом оснащении"
                    },
                    "kind": "container-form-group-with-h2-style"
                  },
                  "properties": {
                    "additional_services": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "kind": "container-form-group-with-h3-style"
                      },
                      "properties": {
                        "header-with-button": {
                          "type": "object",
                          "widget": {
                            "name": "container",
                            "options": {
                              "label": "Дополнительные услуги"
                            },
                            "class": {
                              "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                              "label": "h4 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 mrg-md-b-md",
                              "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0"
                            }
                          },
                          "properties": {
                            "button": {
                              "widget": {
                                "name": "button",
                                "options": {
                                  "icon": "icon-plus",
                                  "label": "Добавить услуги"
                                },
                                "events": {
                                  "click": {
                                    "$if": {
                                      "condition": {
                                        "$and": {
                                          "operands": [
                                            {
                                              "$validate": {
                                                "path": "#data.eventDates"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.deinstallationDates"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.file"
                                              }
                                            },
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$var": {
                                                    "path": "#data.partial"
                                                  }
                                                },
                                                "then": {
                                                  "$validate": {
                                                    "path": "#data.allSquare"
                                                  }
                                                },
                                                "else": true
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.discountOrMarkup"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.allPriceMeterWithDiscountOrMarkup"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.allPriceWithDiscountOrMarkup"
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "then": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$not": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data.partial"
                                                      }
                                                    }
                                                  }
                                                },
                                                "then": {
                                                  "$populate": {
                                                    "data": {},
                                                    "path": "#data.file"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$api-workflow": {
                                                "type": "post",
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "workflow": "booking",
                                                "action": "edit_for_add_facilities",
                                                "data": {
                                                  "$exclude": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data"
                                                      }
                                                    },
                                                    "exclude": [
                                                      "rooms",
                                                      "configuration",
                                                      "name",
                                                      "roomsView",
                                                      "roomType",
                                                      "additional_services",
                                                      "equipments",
                                                      "furniture",
                                                      "eventState"
                                                    ]
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#searchRoomServices",
                                                "data": {}
                                              }
                                            },
                                            {
                                              "$element-event": {
                                                "event": "keypress-13",
                                                "path": "#searchRoomServices.typeOrName",
                                                "value": true
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "option": "visible",
                                                "path": "#modalSelectRoomServices",
                                                "value": true
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "path": "#selectorRoomServices",
                                                "option": "selection",
                                                "value": {
                                                  "$array-pluck": {
                                                    "array": {
                                                      "$fetch-object": {
                                                        "path": "data.items",
                                                        "data": {
                                                          "$api-data": {
                                                            "query": "additional_facilities/get_for_select_in_booking",
                                                            "id": {
                                                              "$query-params": {
                                                                "name": "id"
                                                              }
                                                            },
                                                            "variables": {
                                                              "eventId": {
                                                                "$from-context": {
                                                                  "path": "@preload.booking.eventId"
                                                                }
                                                              },
                                                              "bookingId": {
                                                                "$query-params": {
                                                                  "name": "id"
                                                                }
                                                              },
                                                              "facilityType": "additional_service"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    "key": "serviceId"
                                                  }
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "else": {
                                        "$message": {
                                          "severity": "error",
                                          "summary": "Выбор дополнительных услуг",
                                          "detail": "Необходимо заполнить основную информацию о брони помещения"
                                        }
                                      }
                                    }
                                  }
                                },
                                "class": {
                                  "value": "button_link"
                                }
                              }
                            }
                          }
                        },
                        "additional_services": {
                          "type": "array",
                          "model": "#data.additional_services",
                          "value": {
                            "$api-table-workflow-data": {
                              "model": "#data.additional_services",
                              "query": "additional_facilities/list_for_booking",
                              "id": {
                                "$query-params": {
                                  "name": "id"
                                }
                              },
                              "variables": {
                                "$assign-object": {
                                  "object": {
                                    "$graphql-event-variables": {
                                      "data": {
                                        "$element-event": {
                                          "event": "lazyLoad"
                                        }
                                      }
                                    }
                                  },
                                  "data": {
                                    "eventId": {
                                      "$from-context": {
                                        "path": "@preload.booking.eventId"
                                      }
                                    },
                                    "bookingId": {
                                      "$query-params": {
                                        "name": "id"
                                      }
                                    },
                                    "facilityType": "additional_service"
                                  },
                                  "path": ""
                                }
                              },
                              "errors": {
                                "default": {
                                  "$message": {
                                    "severity": "error",
                                    "summary": "Ошибка",
                                    "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                  }
                                }
                              }
                            }
                          },
                          "widget": {
                            "name": "table-lazy",
                            "options": {
                              "emptyMessage": "Не добавлено информации для отображения",
                              "responsive": false,
                              "first": 0,
                              "lazy": true,
                              "paginator": true,
                              "rows": 10,
                              "rowsPerPageOptions": [
                                10,
                                20,
                                50
                              ],
                              "routerOptions": [
                                "first",
                                "rows"
                              ],
                              "sortField": "createdAt",
                              "sortOrder": 1
                            },
                            "class": {
                              "value": "data-table d-block mrg-b-lg"
                            },
                            "events": {
                              "lazyLoad": {
                                "$element-option": {
                                  "path": "#data.additional_services",
                                  "option": "loading",
                                  "value": true
                                }
                              }
                            },
                            "subscriptions": {
                              "reload-table": {
                                "$element-event": {
                                  "event": "reload",
                                  "value": true
                                }
                              },
                              "reload-service-table": {
                                "subscriber": "serviceTable",
                                "action": {
                                  "$element-event": {
                                    "path": "#data.additional_services",
                                    "event": "reload",
                                    "value": true
                                  }
                                }
                              }
                            }
                          },
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "number": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "№",
                                    "viewedValue": {
                                      "$sum": {
                                        "terms": [
                                          {
                                            "$collection": {
                                              "action": "row-number"
                                            }
                                          },
                                          {
                                            "$element-option": {
                                              "path": "#data.additional_services",
                                              "option": "first"
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "class": {
                                    "header": "column_actions",
                                    "cell": "column_actions"
                                  }
                                }
                              },
                              "serviceId": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "additionalService": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Наименование услуги"
                                  }
                                },
                                "properties": {
                                  "name": {
                                    "type": "string",
                                    "widget": {
                                      "name": "info"
                                    }
                                  },
                                  "servicesType": {
                                    "type": "object",
                                    "widget": {
                                      "name": "hidden"
                                    },
                                    "properties": {
                                      "name": {
                                        "type": "string",
                                        "widget": {
                                          "name": "info"
                                        }
                                      }
                                    }
                                  },
                                  "unit": {
                                    "type": "string",
                                    "widget": {
                                      "name": "hidden"
                                    }
                                  },
                                  "unitPrice": {
                                    "type": "string",
                                    "widget": {
                                      "name": "hidden"
                                    }
                                  }
                                }
                              },
                              "servicesType": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Тип услуги",
                                    "viewedValue": {
                                      "$from-context": {
                                        "path": "$rowData.additionalService.servicesType.name"
                                      }
                                    }
                                  }
                                }
                              },
                              "discountOrMarkupFlag": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "unitPrice": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "unitPriceWithDiscountOrMarkup": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "unitPriceView": {
                                "type": "object",
                                "model": false,
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Цена за единицу (руб.)"
                                  }
                                },
                                "properties": {
                                  "price": {
                                    "type": "string",
                                    "model": false,
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "formatter": "number:'0.2-2':'ru'",
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "===": {
                                                "operand1": "no",
                                                "operand2": {
                                                  "$from-context": {
                                                    "path": "$rowData.discountOrMarkupFlag"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$from-context": {
                                                "path": "$rowData.additionalService.unitPrice"
                                              }
                                            },
                                            "else": {
                                              "$from-context": {
                                                "path": "$rowData.unitPriceWithDiscountOrMarkup"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "class": {
                                        "group": "p-text-right",
                                        "value": "p-jc-end"
                                      }
                                    }
                                  }
                                }
                              },
                              "quantity": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "quantityView": {
                                "type": "object",
                                "model": false,
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Количество"
                                  }
                                },
                                "properties": {
                                  "amount": {
                                    "type": "string",
                                    "model": false,
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "$empty": {
                                                "data": {
                                                  "$subs": {
                                                    "path": "#data.additional_services[].quantity"
                                                  }
                                                }
                                              }
                                            },
                                            "then": "",
                                            "else": {
                                              "$replace": {
                                                "template": "{{quantity}} {{unit}}",
                                                "data": {
                                                  "quantity": {
                                                    "$subs": {
                                                      "path": "#data.additional_services[].quantity"
                                                    }
                                                  },
                                                  "unit": {
                                                    "$if": {
                                                      "condition": {
                                                        "$empty": {
                                                          "data": {
                                                            "$from-context": {
                                                              "path": "$rowData.additionalService.unit"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "then": "",
                                                      "else": {
                                                        "$from-context": {
                                                          "path": "$rowData.additionalService.unit"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "class": {
                                        "group": "p-text-right",
                                        "value": "p-jc-end"
                                      }
                                    }
                                  }
                                }
                              },
                              "totalPrice": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "totalPriceWithDiscountOrMarkup": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "totalPriceView": {
                                "type": "object",
                                "model": false,
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Общая стоимость (руб.)"
                                  }
                                },
                                "properties": {
                                  "price": {
                                    "type": "string",
                                    "model": false,
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "formatter": "number:'0.2-2':'ru'",
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "===": {
                                                "operand1": "no",
                                                "operand2": {
                                                  "$from-context": {
                                                    "path": "$rowData.discountOrMarkupFlag"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$from-context": {
                                                "path": "$rowData.totalPrice"
                                              }
                                            },
                                            "else": {
                                              "$from-context": {
                                                "path": "$rowData.totalPriceWithDiscountOrMarkup"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "class": {
                                        "group": "p-text-right",
                                        "value": "p-jc-end"
                                      }
                                    }
                                  }
                                }
                              },
                              "bookingPeriod": {
                                "type": "array",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                },
                                "items": {
                                  "type": "string",
                                  "widget": "info"
                                }
                              },
                              "bookingPeriodView": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Период бронирования"
                                  }
                                },
                                "properties": {
                                  "period": {
                                    "type": "array",
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "separator": "<br>",
                                        "asList": "true",
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "$not-empty": {
                                                "data": {
                                                  "$from-context": {
                                                    "path": "$rowData.bookingPeriod"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$array-map": {
                                                "array": {
                                                  "$from-context": {
                                                    "path": "$rowData.bookingPeriod"
                                                  }
                                                },
                                                "map": {
                                                  "$switch": {
                                                    "condition": {
                                                      "$from-context": {
                                                        "path": "$data"
                                                      }
                                                    },
                                                    "cases": [
                                                      {
                                                        "value": "installation",
                                                        "action": "Монтаж"
                                                      },
                                                      {
                                                        "value": "event",
                                                        "action": "Мероприятие"
                                                      },
                                                      {
                                                        "value": "deinstallation",
                                                        "action": "Демонтаж"
                                                      }
                                                    ]
                                                  }
                                                }
                                              }
                                            },
                                            "else": []
                                          }
                                        }
                                      }
                                    },
                                    "items": {
                                      "type": "string",
                                      "widget": {
                                        "name": "info"
                                      }
                                    }
                                  }
                                }
                              },
                              "bookingComment": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Комментарий"
                                  }
                                }
                              },
                              "state": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "status": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Статус"
                                  }
                                },
                                "properties": {
                                  "stateView": {
                                    "type": "string",
                                    "value": {
                                      "$from-context": {
                                        "path": "$rowData.state"
                                      }
                                    },
                                    "widget": {
                                      "name": "badge",
                                      "options": {
                                        "defaultLabel": "Не заполнено",
                                        "displayMapping": [
                                          {
                                            "color": "badge_active",
                                            "label": "Заполнено",
                                            "value": "filled"
                                          },
                                          {
                                            "color": "badge_error",
                                            "label": "Не заполнено",
                                            "value": "not_filled"
                                          }
                                        ]
                                      }
                                    }
                                  }
                                }
                              },
                              "actions_column": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Действия"
                                  },
                                  "class": {
                                    "cell": "column_actions"
                                  }
                                },
                                "properties": {
                                  "actions": {
                                    "type": "array",
                                    "model": false,
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "title": {
                                          "type": "string",
                                          "widget": "hidden"
                                        }
                                      },
                                      "widget": {
                                        "name": "fieldset"
                                      }
                                    },
                                    "widget": {
                                      "name": "menu-button",
                                      "options": {
                                        "labelKey": "title"
                                      },
                                      "class": {
                                        "toggle": "actions-button"
                                      },
                                      "items": [
                                        {
                                          "title": "Редактировать",
                                          "command": {
                                            "$navigate": {
                                              "commands": [
                                                "/cabinet/additional_facilities/edit_for_booking"
                                              ],
                                              "extras": {
                                                "queryParams": {
                                                  "id": {
                                                    "$var": {
                                                      "path": "#data.additional_services[].id"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "title": "Удалить",
                                          "command": {
                                            "$open-popup": {
                                              "workflow": "additional_facilities",
                                              "action": "delete_for_booking",
                                              "id": {
                                                "$var": {
                                                  "path": "#data.additional_services[].id"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$empty": {
                                    "data": {
                                      "$fetch-object": {
                                        "path": "data.items",
                                        "data": {
                                          "$api-data": {
                                            "query": "additional_facilities/list_not_filled",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "variables": {
                                              "eventId": {
                                                "$from-context": {
                                                  "path": "@preload.booking.eventId"
                                                }
                                              },
                                              "bookingId": {
                                                "$query-params": {
                                                  "name": "id"
                                                }
                                              },
                                              "facilityType": "additional_service"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "message": "Присутствуют незаполненные брони"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            }
                          ]
                        }
                      }
                    },
                    "equipments": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "kind": "container-form-group-with-h3-style"
                      },
                      "properties": {
                        "header-with-button": {
                          "type": "object",
                          "widget": {
                            "name": "container",
                            "options": {
                              "label": "Оборудование"
                            },
                            "class": {
                              "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                              "label": "h4 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 mrg-md-b-md",
                              "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0"
                            }
                          },
                          "properties": {
                            "button": {
                              "widget": {
                                "name": "button",
                                "options": {
                                  "icon": "icon-plus",
                                  "label": "Добавить оборудование"
                                },
                                "events": {
                                  "click": {
                                    "$if": {
                                      "condition": {
                                        "$and": {
                                          "operands": [
                                            {
                                              "$validate": {
                                                "path": "#data.eventDates"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.deinstallationDates"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.file"
                                              }
                                            },
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$var": {
                                                    "path": "#data.partial"
                                                  }
                                                },
                                                "then": {
                                                  "$validate": {
                                                    "path": "#data.allSquare"
                                                  }
                                                },
                                                "else": true
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.discountOrMarkup"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.allPriceMeterWithDiscountOrMarkup"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.allPriceWithDiscountOrMarkup"
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "then": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$not": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data.partial"
                                                      }
                                                    }
                                                  }
                                                },
                                                "then": {
                                                  "$populate": {
                                                    "data": {},
                                                    "path": "#data.file"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$api-workflow": {
                                                "type": "post",
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "workflow": "booking",
                                                "action": "edit_for_add_facilities",
                                                "data": {
                                                  "$exclude": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data"
                                                      }
                                                    },
                                                    "exclude": [
                                                      "rooms",
                                                      "configuration",
                                                      "name",
                                                      "roomsView",
                                                      "roomType",
                                                      "additional_services",
                                                      "equipments",
                                                      "furniture",
                                                      "eventState"
                                                    ]
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#searchEquipment",
                                                "data": {}
                                              }
                                            },
                                            {
                                              "$element-event": {
                                                "event": "keypress-13",
                                                "path": "#searchEquipment.typeOrNumber",
                                                "value": true
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "option": "visible",
                                                "path": "#modalSelectEquipments",
                                                "value": true
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "path": "#selectorEquipments",
                                                "option": "selection",
                                                "value": {
                                                  "$array-pluck": {
                                                    "array": {
                                                      "$fetch-object": {
                                                        "path": "data.items",
                                                        "data": {
                                                          "$api-data": {
                                                            "query": "additional_facilities/get_for_select_in_booking",
                                                            "id": {
                                                              "$query-params": {
                                                                "name": "id"
                                                              }
                                                            },
                                                            "variables": {
                                                              "eventId": {
                                                                "$from-context": {
                                                                  "path": "@preload.booking.eventId"
                                                                }
                                                              },
                                                              "bookingId": {
                                                                "$query-params": {
                                                                  "name": "id"
                                                                }
                                                              },
                                                              "facilityType": "equipment"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    "key": "equipmentId"
                                                  }
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "else": {
                                        "$message": {
                                          "severity": "error",
                                          "summary": "Сохранение брони помещения",
                                          "detail": "Форма содержит ошибки"
                                        }
                                      }
                                    }
                                  }
                                },
                                "class": {
                                  "value": "button_link"
                                }
                              }
                            }
                          }
                        },
                        "equipments": {
                          "type": "array",
                          "model": "#data.equipments",
                          "value": {
                            "$api-table-workflow-data": {
                              "model": "#data.equipments",
                              "query": "additional_facilities/list_for_booking",
                              "id": {
                                "$query-params": {
                                  "name": "id"
                                }
                              },
                              "variables": {
                                "$assign-object": {
                                  "object": {
                                    "$graphql-event-variables": {
                                      "data": {
                                        "$element-event": {
                                          "event": "lazyLoad"
                                        }
                                      }
                                    }
                                  },
                                  "data": {
                                    "eventId": {
                                      "$from-context": {
                                        "path": "@preload.booking.eventId"
                                      }
                                    },
                                    "bookingId": {
                                      "$query-params": {
                                        "name": "id"
                                      }
                                    },
                                    "facilityType": "equipment"
                                  },
                                  "path": ""
                                }
                              },
                              "errors": {
                                "default": {
                                  "$message": {
                                    "severity": "error",
                                    "summary": "Ошибка",
                                    "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                  }
                                }
                              }
                            }
                          },
                          "widget": {
                            "name": "table-lazy",
                            "options": {
                              "selectionKey": "id",
                              "emptyMessage": "Не добавлено информации для отображения",
                              "responsive": false,
                              "first": 0,
                              "lazy": true,
                              "paginator": true,
                              "rows": 10,
                              "rowsPerPageOptions": [
                                10,
                                20,
                                50
                              ],
                              "routerOptions": [
                                "first",
                                "rows"
                              ],
                              "initialFilters": {
                                "$var": {
                                  "path": "#data.equipments"
                                }
                              },
                              "sortField": "createdAt",
                              "sortOrder": 1
                            },
                            "class": {
                              "value": "data-table d-block mrg-b-lg"
                            },
                            "events": {
                              "lazyLoad": {
                                "$element-option": {
                                  "path": "#data.equipments",
                                  "option": "loading",
                                  "value": true
                                }
                              }
                            },
                            "subscriptions": {
                              "reload-table": {
                                "$element-event": {
                                  "event": "reload",
                                  "value": true
                                }
                              },
                              "reload-equipment-table": {
                                "subscriber": "equipmentTable",
                                "action": {
                                  "$element-event": {
                                    "path": "#data.equipments",
                                    "event": "reload",
                                    "value": true
                                  }
                                }
                              }
                            }
                          },
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "equipmentId": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "number": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "№",
                                    "viewedValue": {
                                      "$sum": {
                                        "terms": [
                                          {
                                            "$collection": {
                                              "action": "row-number"
                                            }
                                          },
                                          {
                                            "$element-option": {
                                              "path": "#data.equipments",
                                              "option": "first"
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "class": {
                                    "header": "column_actions",
                                    "cell": "column_actions"
                                  }
                                }
                              },
                              "equipment": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Наименование"
                                  }
                                },
                                "properties": {
                                  "name": {
                                    "type": "string",
                                    "widget": {
                                      "name": "info"
                                    }
                                  },
                                  "nomenclatureNumber": {
                                    "type": "string",
                                    "widget": {
                                      "name": "hidden"
                                    }
                                  },
                                  "unitPrice": {
                                    "type": "string",
                                    "widget": {
                                      "name": "hidden"
                                    }
                                  }
                                }
                              },
                              "nomenclatureNumber": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Номенклатурный номер",
                                    "viewedValue": {
                                      "$from-context": {
                                        "path": "$rowData.equipment.nomenclatureNumber"
                                      }
                                    }
                                  }
                                }
                              },
                              "discountOrMarkupFlag": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "unitPrice": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "unitPriceWithDiscountOrMarkup": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "unitPriceView": {
                                "type": "object",
                                "model": false,
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Цена за единицу (руб.)"
                                  }
                                },
                                "properties": {
                                  "price": {
                                    "type": "string",
                                    "model": false,
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "formatter": "number:'0.2-2':'ru'",
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "===": {
                                                "operand1": "no",
                                                "operand2": {
                                                  "$from-context": {
                                                    "path": "$rowData.discountOrMarkupFlag"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$from-context": {
                                                "path": "$rowData.equipment.unitPrice"
                                              }
                                            },
                                            "else": {
                                              "$from-context": {
                                                "path": "$rowData.unitPriceWithDiscountOrMarkup"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "class": {
                                        "group": "p-text-right",
                                        "value": "p-jc-end"
                                      }
                                    }
                                  }
                                }
                              },
                              "quantity": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "quantityView": {
                                "type": "object",
                                "model": false,
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Количество (шт.)"
                                  }
                                },
                                "properties": {
                                  "amount": {
                                    "type": "string",
                                    "model": false,
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "viewedValue": {
                                          "$subs": {
                                            "path": "#data.equipments[].quantity"
                                          }
                                        }
                                      },
                                      "class": {
                                        "group": "p-text-right",
                                        "value": "p-jc-end"
                                      }
                                    }
                                  }
                                }
                              },
                              "totalPrice": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "totalPriceWithDiscountOrMarkup": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "totalPriceView": {
                                "type": "object",
                                "model": false,
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Общая стоимость (руб.)"
                                  }
                                },
                                "properties": {
                                  "price": {
                                    "type": "string",
                                    "model": false,
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "formatter": "number:'0.2-2':'ru'",
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "===": {
                                                "operand1": "no",
                                                "operand2": {
                                                  "$from-context": {
                                                    "path": "$rowData.discountOrMarkupFlag"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$from-context": {
                                                "path": "$rowData.totalPrice"
                                              }
                                            },
                                            "else": {
                                              "$from-context": {
                                                "path": "$rowData.totalPriceWithDiscountOrMarkup"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "class": {
                                        "group": "p-text-right",
                                        "value": "p-jc-end"
                                      }
                                    }
                                  }
                                }
                              },
                              "bookingPeriod": {
                                "type": "array",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                },
                                "items": {
                                  "type": "string",
                                  "widget": "info"
                                }
                              },
                              "bookingPeriodView": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Период бронирования"
                                  }
                                },
                                "properties": {
                                  "period": {
                                    "type": "array",
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "separator": "<br>",
                                        "asList": "true",
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "$not-empty": {
                                                "data": {
                                                  "$from-context": {
                                                    "path": "$rowData.bookingPeriod"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$array-map": {
                                                "array": {
                                                  "$from-context": {
                                                    "path": "$rowData.bookingPeriod"
                                                  }
                                                },
                                                "map": {
                                                  "$switch": {
                                                    "condition": {
                                                      "$from-context": {
                                                        "path": "$data"
                                                      }
                                                    },
                                                    "cases": [
                                                      {
                                                        "value": "installation",
                                                        "action": "Монтаж"
                                                      },
                                                      {
                                                        "value": "event",
                                                        "action": "Мероприятие"
                                                      },
                                                      {
                                                        "value": "deinstallation",
                                                        "action": "Демонтаж"
                                                      }
                                                    ]
                                                  }
                                                }
                                              }
                                            },
                                            "else": []
                                          }
                                        }
                                      }
                                    },
                                    "items": {
                                      "type": "string",
                                      "widget": {
                                        "name": "info"
                                      }
                                    }
                                  }
                                }
                              },
                              "bookingComment": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Комментарий"
                                  }
                                }
                              },
                              "state": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "status": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Статус"
                                  }
                                },
                                "properties": {
                                  "stateView": {
                                    "type": "string",
                                    "value": {
                                      "$from-context": {
                                        "path": "$rowData.state"
                                      }
                                    },
                                    "widget": {
                                      "name": "badge",
                                      "options": {
                                        "defaultLabel": "Не заполнено",
                                        "displayMapping": [
                                          {
                                            "color": "badge_active",
                                            "label": "Заполнено",
                                            "value": "filled"
                                          },
                                          {
                                            "color": "badge_error",
                                            "label": "Не заполнено",
                                            "value": "not_filled"
                                          }
                                        ]
                                      }
                                    }
                                  }
                                }
                              },
                              "actions_column": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Действия"
                                  },
                                  "class": {
                                    "cell": "column_actions"
                                  }
                                },
                                "properties": {
                                  "actions": {
                                    "type": "array",
                                    "model": false,
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "title": {
                                          "type": "string",
                                          "widget": "hidden"
                                        }
                                      },
                                      "widget": {
                                        "name": "fieldset"
                                      }
                                    },
                                    "widget": {
                                      "name": "menu-button",
                                      "options": {
                                        "labelKey": "title"
                                      },
                                      "class": {
                                        "toggle": "actions-button"
                                      },
                                      "items": [
                                        {
                                          "title": "Редактировать",
                                          "command": {
                                            "$navigate": {
                                              "commands": [
                                                "/cabinet/additional_facilities/edit_for_booking"
                                              ],
                                              "extras": {
                                                "queryParams": {
                                                  "id": {
                                                    "$var": {
                                                      "path": "#data.equipments[].id"
                                                    }
                                                  },
                                                  "minDate": {
                                                    "$var": {
                                                      "path": "#data.minDate"
                                                    }
                                                  },
                                                  "maxDate": {
                                                    "$var": {
                                                      "path": "#data.maxDate"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "title": "Удалить",
                                          "command": {
                                            "$open-popup": {
                                              "workflow": "additional_facilities",
                                              "action": "delete_for_booking",
                                              "id": {
                                                "$var": {
                                                  "path": "#data.equipments[].id"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$empty": {
                                    "data": {
                                      "$fetch-object": {
                                        "path": "data.items",
                                        "data": {
                                          "$api-data": {
                                            "query": "additional_facilities/list_not_filled",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "variables": {
                                              "eventId": {
                                                "$from-context": {
                                                  "path": "@preload.booking.eventId"
                                                }
                                              },
                                              "bookingId": {
                                                "$query-params": {
                                                  "name": "id"
                                                }
                                              },
                                              "facilityType": "equipment"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "message": "Присутствуют незаполненные брони"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            }
                          ]
                        }
                      }
                    },
                    "furniture": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "kind": "container-form-group-with-h3-style"
                      },
                      "properties": {
                        "header-with-button": {
                          "type": "object",
                          "widget": {
                            "name": "container",
                            "options": {
                              "label": "Мебель"
                            },
                            "class": {
                              "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                              "label": "h4 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 mrg-md-b-md",
                              "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0"
                            }
                          },
                          "properties": {
                            "button": {
                              "widget": {
                                "name": "button",
                                "options": {
                                  "icon": "icon-plus",
                                  "label": "Добавить мебель"
                                },
                                "events": {
                                  "click": {
                                    "$if": {
                                      "condition": {
                                        "$and": {
                                          "operands": [
                                            {
                                              "$validate": {
                                                "path": "#data.eventDates"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.deinstallationDates"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.file"
                                              }
                                            },
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$var": {
                                                    "path": "#data.partial"
                                                  }
                                                },
                                                "then": {
                                                  "$validate": {
                                                    "path": "#data.allSquare"
                                                  }
                                                },
                                                "else": true
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.discountOrMarkup"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.allPriceMeterWithDiscountOrMarkup"
                                              }
                                            },
                                            {
                                              "$validate": {
                                                "path": "#data.allPriceWithDiscountOrMarkup"
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "then": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$not": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data.partial"
                                                      }
                                                    }
                                                  }
                                                },
                                                "then": {
                                                  "$populate": {
                                                    "data": {},
                                                    "path": "#data.file"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$api-workflow": {
                                                "type": "post",
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "workflow": "booking",
                                                "action": "edit_for_add_facilities",
                                                "data": {
                                                  "$exclude": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data"
                                                      }
                                                    },
                                                    "exclude": [
                                                      "rooms",
                                                      "configuration",
                                                      "name",
                                                      "roomsView",
                                                      "roomType",
                                                      "additional_services",
                                                      "equipments",
                                                      "furniture",
                                                      "eventState"
                                                    ]
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#searchFurniture",
                                                "data": {}
                                              }
                                            },
                                            {
                                              "$element-event": {
                                                "event": "keypress-13",
                                                "path": "#searchFurniture.typeOrNumber",
                                                "value": true
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "option": "visible",
                                                "path": "#modalSelectFurniture",
                                                "value": true
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "path": "#selectorFurniture",
                                                "option": "selection",
                                                "value": {
                                                  "$array-pluck": {
                                                    "array": {
                                                      "$fetch-object": {
                                                        "path": "data.items",
                                                        "data": {
                                                          "$api-data": {
                                                            "query": "additional_facilities/get_for_select_in_booking",
                                                            "id": {
                                                              "$query-params": {
                                                                "name": "id"
                                                              }
                                                            },
                                                            "variables": {
                                                              "eventId": {
                                                                "$from-context": {
                                                                  "path": "@preload.booking.eventId"
                                                                }
                                                              },
                                                              "bookingId": {
                                                                "$query-params": {
                                                                  "name": "id"
                                                                }
                                                              },
                                                              "facilityType": "furniture"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },
                                                    "key": "furnitureId"
                                                  }
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "else": {
                                        "$message": {
                                          "severity": "error",
                                          "summary": "Сохранение брони помещения",
                                          "detail": "Форма содержит ошибки"
                                        }
                                      }
                                    }
                                  }
                                },
                                "class": {
                                  "value": "button_link"
                                }
                              }
                            }
                          }
                        },
                        "furniture": {
                          "type": "array",
                          "model": "#data.furniture",
                          "value": {
                            "$api-table-workflow-data": {
                              "model": "#data.furniture",
                              "query": "additional_facilities/list_for_booking",
                              "id": {
                                "$query-params": {
                                  "name": "id"
                                }
                              },
                              "variables": {
                                "$assign-object": {
                                  "object": {
                                    "$graphql-event-variables": {
                                      "data": {
                                        "$element-event": {
                                          "event": "lazyLoad"
                                        }
                                      }
                                    }
                                  },
                                  "data": {
                                    "eventId": {
                                      "$from-context": {
                                        "path": "@preload.booking.eventId"
                                      }
                                    },
                                    "bookingId": {
                                      "$query-params": {
                                        "name": "id"
                                      }
                                    },
                                    "facilityType": "furniture"
                                  },
                                  "path": ""
                                }
                              },
                              "errors": {
                                "default": {
                                  "$message": {
                                    "severity": "error",
                                    "summary": "Ошибка",
                                    "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                  }
                                }
                              }
                            }
                          },
                          "widget": {
                            "name": "table-lazy",
                            "options": {
                              "selectionKey": "furnitureId",
                              "emptyMessage": "Не добавлено информации для отображения",
                              "responsive": false,
                              "first": 0,
                              "lazy": true,
                              "paginator": true,
                              "rows": 10,
                              "rowsPerPageOptions": [
                                10,
                                20,
                                50
                              ],
                              "routerOptions": [
                                "first",
                                "rows"
                              ],
                              "initialFilters": {
                                "$var": {
                                  "path": "#data.furniture"
                                }
                              },
                              "sortField": "createdAt",
                              "sortOrder": 1
                            },
                            "class": {
                              "value": "data-table d-block mrg-b-lg"
                            },
                            "events": {
                              "lazyLoad": {
                                "$element-option": {
                                  "path": "#data.furniture",
                                  "option": "loading",
                                  "value": true
                                }
                              }
                            },
                            "subscriptions": {
                              "reload-table": {
                                "$element-event": {
                                  "event": "reload",
                                  "value": true
                                }
                              },
                              "reload-furniture-table": {
                                "subscriber": "furnitureTable",
                                "action": {
                                  "$element-event": {
                                    "path": "#data.furniture",
                                    "event": "reload",
                                    "value": true
                                  }
                                }
                              }
                            }
                          },
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "furnitureId": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "number": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "№",
                                    "viewedValue": {
                                      "$sum": {
                                        "terms": [
                                          {
                                            "$collection": {
                                              "action": "row-number"
                                            }
                                          },
                                          {
                                            "$element-option": {
                                              "path": "#data.furniture",
                                              "option": "first"
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "class": {
                                    "header": "column_actions",
                                    "cell": "column_actions"
                                  }
                                }
                              },
                              "furniture": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Наименование"
                                  }
                                },
                                "properties": {
                                  "name": {
                                    "type": "string",
                                    "widget": {
                                      "name": "info"
                                    }
                                  },
                                  "nomenclatureNumber": {
                                    "type": "string",
                                    "widget": {
                                      "name": "hidden"
                                    }
                                  },
                                  "unitPrice": {
                                    "type": "string",
                                    "widget": {
                                      "name": "hidden"
                                    }
                                  }
                                }
                              },
                              "nomenclatureNumber": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Номенклатурный номер",
                                    "viewedValue": {
                                      "$from-context": {
                                        "path": "$rowData.furniture.nomenclatureNumber"
                                      }
                                    }
                                  }
                                }
                              },
                              "discountOrMarkupFlag": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "unitPrice": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "unitPriceWithDiscountOrMarkup": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "unitPriceView": {
                                "type": "object",
                                "model": false,
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Цена за единицу (руб.)"
                                  }
                                },
                                "properties": {
                                  "price": {
                                    "type": "string",
                                    "model": false,
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "formatter": "number:'0.2-2':'ru'",
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "===": {
                                                "operand1": "no",
                                                "operand2": {
                                                  "$from-context": {
                                                    "path": "$rowData.discountOrMarkupFlag"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$from-context": {
                                                "path": "$rowData.furniture.unitPrice"
                                              }
                                            },
                                            "else": {
                                              "$from-context": {
                                                "path": "$rowData.unitPriceWithDiscountOrMarkup"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "class": {
                                        "group": "p-text-right",
                                        "value": "p-jc-end"
                                      }
                                    }
                                  }
                                }
                              },
                              "quantity": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "quantityView": {
                                "type": "object",
                                "model": false,
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Количество (шт.)"
                                  }
                                },
                                "properties": {
                                  "amount": {
                                    "type": "string",
                                    "model": false,
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "viewedValue": {
                                          "$subs": {
                                            "path": "#data.furniture[].quantity"
                                          }
                                        }
                                      },
                                      "class": {
                                        "group": "p-text-right",
                                        "value": "p-jc-end"
                                      }
                                    }
                                  }
                                }
                              },
                              "totalPrice": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "totalPriceWithDiscountOrMarkup": {
                                "type": "number",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "totalPriceView": {
                                "type": "object",
                                "model": false,
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Общая стоимость (руб.)"
                                  }
                                },
                                "properties": {
                                  "price": {
                                    "type": "string",
                                    "model": false,
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "formatter": "number:'0.2-2':'ru'",
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "===": {
                                                "operand1": "no",
                                                "operand2": {
                                                  "$from-context": {
                                                    "path": "$rowData.discountOrMarkupFlag"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$from-context": {
                                                "path": "$rowData.totalPrice"
                                              }
                                            },
                                            "else": {
                                              "$from-context": {
                                                "path": "$rowData.totalPriceWithDiscountOrMarkup"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "class": {
                                        "group": "p-text-right",
                                        "value": "p-jc-end"
                                      }
                                    }
                                  }
                                }
                              },
                              "bookingPeriod": {
                                "type": "array",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                },
                                "items": {
                                  "type": "string",
                                  "widget": "info"
                                }
                              },
                              "bookingPeriodView": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Период бронирования"
                                  }
                                },
                                "properties": {
                                  "period": {
                                    "type": "array",
                                    "widget": {
                                      "name": "info",
                                      "options": {
                                        "separator": "<br>",
                                        "asList": "true",
                                        "viewedValue": {
                                          "$if": {
                                            "condition": {
                                              "$not-empty": {
                                                "data": {
                                                  "$from-context": {
                                                    "path": "$rowData.bookingPeriod"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$array-map": {
                                                "array": {
                                                  "$from-context": {
                                                    "path": "$rowData.bookingPeriod"
                                                  }
                                                },
                                                "map": {
                                                  "$switch": {
                                                    "condition": {
                                                      "$from-context": {
                                                        "path": "$data"
                                                      }
                                                    },
                                                    "cases": [
                                                      {
                                                        "value": "installation",
                                                        "action": "Монтаж"
                                                      },
                                                      {
                                                        "value": "event",
                                                        "action": "Мероприятие"
                                                      },
                                                      {
                                                        "value": "deinstallation",
                                                        "action": "Демонтаж"
                                                      }
                                                    ]
                                                  }
                                                }
                                              }
                                            },
                                            "else": []
                                          }
                                        }
                                      }
                                    },
                                    "items": {
                                      "type": "string",
                                      "widget": {
                                        "name": "info"
                                      }
                                    }
                                  }
                                }
                              },
                              "bookingComment": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Комментарий"
                                  }
                                }
                              },
                              "state": {
                                "type": "string",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "visible": false
                                  }
                                }
                              },
                              "status": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Статус"
                                  }
                                },
                                "properties": {
                                  "stateView": {
                                    "type": "string",
                                    "value": {
                                      "$from-context": {
                                        "path": "$rowData.state"
                                      }
                                    },
                                    "widget": {
                                      "name": "badge",
                                      "options": {
                                        "defaultLabel": "Не заполнено",
                                        "displayMapping": [
                                          {
                                            "color": "badge_active",
                                            "label": "Заполнено",
                                            "value": "filled"
                                          },
                                          {
                                            "color": "badge_error",
                                            "label": "Не заполнено",
                                            "value": "not_filled"
                                          }
                                        ]
                                      }
                                    }
                                  }
                                }
                              },
                              "actions_column": {
                                "type": "object",
                                "widget": {
                                  "name": "table-column",
                                  "options": {
                                    "label": "Действия"
                                  },
                                  "class": {
                                    "cell": "column_actions"
                                  }
                                },
                                "properties": {
                                  "actions": {
                                    "type": "array",
                                    "model": false,
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "title": {
                                          "type": "string",
                                          "widget": "hidden"
                                        }
                                      },
                                      "widget": {
                                        "name": "fieldset"
                                      }
                                    },
                                    "widget": {
                                      "name": "menu-button",
                                      "options": {
                                        "labelKey": "title"
                                      },
                                      "class": {
                                        "toggle": "actions-button"
                                      },
                                      "items": [
                                        {
                                          "title": "Редактировать",
                                          "command": {
                                            "$navigate": {
                                              "commands": [
                                                "/cabinet/additional_facilities/edit_for_booking"
                                              ],
                                              "extras": {
                                                "queryParams": {
                                                  "id": {
                                                    "$var": {
                                                      "path": "#data.furniture[].id"
                                                    }
                                                  },
                                                  "minDate": {
                                                    "$var": {
                                                      "path": "#data.minDate"
                                                    }
                                                  },
                                                  "maxDate": {
                                                    "$var": {
                                                      "path": "#data.maxDate"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "title": "Удалить",
                                          "command": {
                                            "$open-popup": {
                                              "workflow": "additional_facilities",
                                              "action": "delete_for_booking",
                                              "id": {
                                                "$var": {
                                                  "path": "#data.furniture[].id"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$empty": {
                                    "data": {
                                      "$fetch-object": {
                                        "path": "data.items",
                                        "data": {
                                          "$api-data": {
                                            "query": "additional_facilities/list_not_filled",
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "variables": {
                                              "eventId": {
                                                "$from-context": {
                                                  "path": "@preload.booking.eventId"
                                                }
                                              },
                                              "bookingId": {
                                                "$query-params": {
                                                  "name": "id"
                                                }
                                              },
                                              "facilityType": "furniture"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "message": "Присутствуют незаполненные брони"
                              },
                              "events": [
                                "onUpdate",
                                "onBackend"
                              ]
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "actions": {
          "type": "object",
          "widget": {
            "name": "container",
            "class": {
              "group": "form-actions p-field p-grid mrg-t-lg",
              "value": "p-jc-xl-end p-autolayout"
            }
          },
          "properties": {
            "add": {
              "widget": {
                "name": "button",
                "options": {
                  "label": "Сохранить"
                },
                "events": {
                  "click": {
                    "$if": {
                      "condition": {
                        "$validate": {
                          "path": "#data"
                        }
                      },
                      "then": {
                        "$if": {
                          "condition": {
                            "$if": {
                              "condition": {
                                "$from-context": {
                                  "path": "@preload.booking.configuration"
                                }
                              },
                              "then": {
                                "!==": {
                                  "operand1": 0,
                                  "operand2": {
                                    "$length": {
                                      "data": {
                                        "$array-filter": {
                                          "array": {
                                            "$from-context": {
                                              "path": "@preload.booking.rooms"
                                            }
                                          },
                                          "filter": {
                                            "===": {
                                              "operand1": "deleted",
                                              "operand2": {
                                                "$from-context": {
                                                  "path": "$data.room.state"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "else": {
                                "===": {
                                  "operand1": "deleted",
                                  "operand2": {
                                    "$from-context": {
                                      "path": "@preload.booking.rooms.0.room.state"
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "then": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#roomDelete",
                              "value": true
                            }
                          },
                          "else": {
                            "$if": {
                              "condition": {
                                "$or": {
                                  "operands": [
                                    {
                                      "$and": {
                                        "operands": [
                                          {
                                            "===": {
                                              "operand1": {
                                                "$var": {
                                                  "path": "#data.discountOrMarkupFlag"
                                                }
                                              },
                                              "operand2": "no"
                                            }
                                          },
                                          {
                                            "$in": {
                                              "value": {
                                                "$from-context": {
                                                  "path": "@preload.booking.event.state"
                                                }
                                              },
                                              "array": [
                                                "new",
                                                "draft",
                                                "pre_booking"
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "$active-user-has-permission": {
                                        "permission": "request.accept.new"
                                      }
                                    },
                                    {
                                      "$and": {
                                        "operands": [
                                          {
                                            "===": {
                                              "operand1": {
                                                "$from-context": {
                                                  "path": "@preload.booking.state"
                                                }
                                              },
                                              "operand2": "not_filled"
                                            }
                                          },
                                          {
                                            "===": {
                                              "operand1": {
                                                "$var": {
                                                  "path": "#data.discountOrMarkupFlag"
                                                }
                                              },
                                              "operand2": "no"
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "$and": {
                                        "operands": [
                                          {
                                            "$active-user-has-permission": {
                                              "permission": "booking.edit_part"
                                            }
                                          },
                                          {
                                            "===": {
                                              "operand1": {
                                                "$var": {
                                                  "path": "#data.discountOrMarkupFlag"
                                                }
                                              },
                                              "operand2": "no"
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              "then": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not": {
                                            "data": {
                                              "$var": {
                                                "path": "#data.partial"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$populate": {
                                            "data": {},
                                            "path": "#data.file"
                                          }
                                        }
                                      }
                                    },
                                    "$ref:operation-frontend:snippets/element/_loading/onclick-loading-enable",
                                    {
                                      "$http-code": {
                                        "200": [
                                          {
                                            "$message": {
                                              "severity": "success",
                                              "summary": "Редактирование брони помещения",
                                              "detail": "Бронь помещения успешно изменена"
                                            }
                                          },
                                          {
                                            "$navigate": {
                                              "commands": [
                                                "/cabinet/event/edit"
                                              ],
                                              "extras": {
                                                "queryParams": {
                                                  "id": {
                                                    "$from-context": {
                                                      "path": "@preload.booking.eventId"
                                                    }
                                                  },
                                                  "selectedTabs": "rent"
                                                }
                                              }
                                            }
                                          }
                                        ],
                                        "422": [
                                          "$ref:operation-frontend:snippets/element/_http_message/http-errors-from-response"
                                        ],
                                        "client": {
                                          "$api-workflow": {
                                            "type": "post",
                                            "options": {
                                              "observe": "response"
                                            },
                                            "workflow": "booking",
                                            "action": "edit",
                                            "data": {
                                              "$assign-object": {
                                                "path": "hasPermission",
                                                "data": {
                                                  "$if": {
                                                    "condition": {
                                                      "$active-user-has-permission": {
                                                        "permission": "request.accept.new"
                                                      }
                                                    },
                                                    "then": "accept_request",
                                                    "else": {
                                                      "$if": {
                                                        "condition": {
                                                          "$active-user-has-permission": {
                                                            "permission": "booking.edit_part"
                                                          }
                                                        },
                                                        "then": "edit_part",
                                                        "else": "no"
                                                      }
                                                    }
                                                  }
                                                },
                                                "object": {
                                                  "$exclude": {
                                                    "data": {
                                                      "$var": {
                                                        "path": "#data"
                                                      }
                                                    },
                                                    "exclude": [
                                                      "rooms",
                                                      "configuration",
                                                      "roomsView",
                                                      "roomType",
                                                      "additional_services",
                                                      "equipments",
                                                      "furniture"
                                                    ]
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        "finalize": "$ref:operation-frontend:snippets/element/_loading/onclick-loading-disable",
                                        "default": [
                                          {
                                            "$message": {
                                              "severity": "success",
                                              "summary": "Редактирование брони помещения",
                                              "detail": "Непредвиденная ошибка"
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$confirmation": {
                                  "header": "Подтверждение изменений",
                                  "message": {
                                    "$replace": {
                                      "template": "Заявка с изменениями будет направлена на согласование. Все изменения применятся к брони после подтверждения данной заявки. Желаете продолжить?"
                                    }
                                  },
                                  "accept": {
                                    "$waterfall": {
                                      "arrayFunctions": [
                                        {
                                          "$if": {
                                            "condition": {
                                              "$not": {
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.partial"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$populate": {
                                                "data": {},
                                                "path": "#data.file"
                                              }
                                            }
                                          }
                                        },
                                        "$ref:operation-frontend:snippets/element/_loading/onclick-loading-enable",
                                        {
                                          "$http-code": {
                                            "200": [
                                              {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Редактирование брони помещения",
                                                  "detail": "Заявка на изменение брони помещения успешно отправлена"
                                                }
                                              },
                                              {
                                                "$navigate": {
                                                  "commands": [
                                                    "/cabinet/event/edit"
                                                  ],
                                                  "extras": {
                                                    "queryParams": {
                                                      "id": {
                                                        "$from-context": {
                                                          "path": "@preload.booking.eventId"
                                                        }
                                                      },
                                                      "selectedTabs": "rent"
                                                    }
                                                  }
                                                }
                                              }
                                            ],
                                            "422": [
                                              "$ref:operation-frontend:snippets/element/_http_message/http-errors-from-response"
                                            ],
                                            "client": {
                                              "$api-workflow": {
                                                "type": "post",
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "workflow": "booking",
                                                "action": "edit",
                                                "data": {
                                                  "$assign-object": {
                                                    "path": "hasPermission",
                                                    "data": {
                                                      "$if": {
                                                        "condition": {
                                                          "$active-user-has-permission": {
                                                            "permission": "request.accept.new"
                                                          }
                                                        },
                                                        "then": "accept_request",
                                                        "else": {
                                                          "$if": {
                                                            "condition": {
                                                              "$active-user-has-permission": {
                                                                "permission": "booking.edit_part"
                                                              }
                                                            },
                                                            "then": "edit_part",
                                                            "else": "no"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    "object": {
                                                      "$exclude": {
                                                        "data": {
                                                          "$var": {
                                                            "path": "#data"
                                                          }
                                                        },
                                                        "exclude": [
                                                          "rooms",
                                                          "configuration",
                                                          "roomsView",
                                                          "roomType",
                                                          "additional_services",
                                                          "equipments",
                                                          "furniture"
                                                        ]
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "finalize": "$ref:operation-frontend:snippets/element/_loading/onclick-loading-disable",
                                            "default": [
                                              {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Редактирование брони помещения",
                                                  "detail": "Непредвиденная ошибка"
                                                }
                                              }
                                            ]
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  "acceptLabel": "Подтвердить",
                                  "rejectLabel": "Отмена",
                                  "rejectButtonStyleClass": "button_outline",
                                  "reject": false
                                }
                              }
                            }
                          }
                        }
                      },
                      "else": {
                        "$waterfall": {
                          "arrayFunctions": [
                            {
                              "$message": {
                                "severity": "error",
                                "summary": "Сохранение брони помещения",
                                "detail": {
                                  "$if": {
                                    "condition": {
                                      "$or": {
                                        "operands": [
                                          {
                                            "$not": {
                                              "data": {
                                                "$validate": {
                                                  "path": "#data.additional_services"
                                                }
                                              }
                                            }
                                          },
                                          {
                                            "$not": {
                                              "data": {
                                                "$validate": {
                                                  "path": "#data.equipments"
                                                }
                                              }
                                            }
                                          },
                                          {
                                            "$not": {
                                              "data": {
                                                "$validate": {
                                                  "path": "#data.furniture"
                                                }
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "then": "Форма содержит ошибки. Необходимо заполнить все брони оснащения",
                                    "else": "Форма содержит ошибки"
                                  }
                                }
                              }
                            },
                            {
                              "$form-control-mark": {
                                "key": "tabs"
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              }
            },
            "cancel": {
              "widget": {
                "name": "button",
                "options": {
                  "label": "Отмена"
                },
                "events": {
                  "click": {
                    "$navigate": {
                      "commands": [
                        "/cabinet/event/edit"
                      ],
                      "extras": {
                        "queryParams": {
                          "id": {
                            "$from-context": {
                              "path": "@preload.booking.eventId"
                            }
                          },
                          "selectedTabs": "rent"
                        }
                      }
                    }
                  }
                },
                "class": {
                  "value": "button_outline mrg-r-0 mrg-b-0"
                }
              }
            }
          }
        }
      }
    }
  }
}
