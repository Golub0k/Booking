{
  "@title": "Добавление мероприятия",
  "@preload": {
    "roles": {
      "$array-pluck": {
        "array": {
          "$from-context": {
            "path": "$response.body.data.roles",
            "data": {
              "$api-data": {
                "options": {
                  "observe": "response"
                },
                "workflow": "event",
                "action": "add",
                "id": {
                  "$query-params": {
                    "name": "id"
                  }
                },
                "query": "role/get_by_permission",
                "variables": {
                  "permission": [
                    "event.edit",
                    "event.edit.draft",
                    "event.edit.pre_booking",
                    "event.edit.requested",
                    "event.edit.task_received",
                    "event.edit.agreed",
                    "event.edit.check_in",
                    "event.edit_part"
                  ]
                }
              }
            }
          }
        },
        "key": "_id"
      }
    },
    "event": {
      "$from-context": {
        "path": "$response.body.data.items.0",
        "data": {
          "$api-data": {
            "options": {
              "observe": "response"
            },
            "workflow": "event",
            "action": "add",
            "id": {
              "$query-params": {
                "name": "id"
              }
            },
            "query": "event/get",
            "variables": {
              "id": {
                "$query-params": {
                  "name": "id"
                }
              }
            }
          }
        }
      }
    }
  },
  "type": "object",
  "model": "#data",
  "widget": {
    "name": "container",
    "events": {
      "init": [
        {
          "$populate": {
            "path": "#data.organizers",
            "data": {
              "$if": {
                "condition": {
                  "$not-empty": {
                    "data": {
                      "$from-context": {
                        "path": "@preload.event.organizers"
                      }
                    }
                  }
                },
                "then": {
                  "$array-pluck": {
                    "array": {
                      "$from-context": {
                        "path": "@preload.event.organizers"
                      }
                    },
                    "key": "partner"
                  }
                },
                "else": []
              }
            }
          }
        },
        {
          "$populate": {
            "path": "#data.curators",
            "data": {
              "$if": {
                "condition": {
                  "$not-empty": {
                    "data": {
                      "$from-context": {
                        "path": "@preload.event.curators"
                      }
                    }
                  }
                },
                "then": {
                  "$array-pluck": {
                    "array": {
                      "$from-context": {
                        "path": "@preload.event.curators"
                      }
                    },
                    "key": "user"
                  }
                },
                "else": []
              }
            }
          }
        },
        {
          "$if": {
            "condition": {
              "$or": {
                "operands": [
                  {
                    "===": {
                      "operand1": 0,
                      "operand2": {
                        "$from-context": {
                          "path": "@preload.event.totalEventCost"
                        }
                      }
                    }
                  },
                  {
                    "$empty": {
                      "data": {
                        "$from-context": {
                          "path": "@preload.event.totalEventCost"
                        }
                      }
                    }
                  }
                ]
              }
            },
            "then": {
              "$waterfall": {
                "arrayFunctions": [
                  {
                    "$assign-context": {
                      "path": "$costElements",
                      "data": {
                        "$fetch-object": {
                          "path": "data",
                          "data": {
                            "$api-data": {
                              "query": "event/get_total_cost",
                              "variables": {
                                "eventId": {
                                  "$query-params": {
                                    "name": "id"
                                  }
                                }
                              },
                              "id": {
                                "$query-params": {
                                  "name": "id"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  {
                    "$populate": {
                      "path": "#data.commonInfo.totalEventCost",
                      "data": {
                        "$sum": {
                          "terms": [
                            {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$costElements.bookingsNoDiscountOrMarkup"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$array-sum": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$costElements.bookingsNoDiscountOrMarkup"
                                      }
                                    },
                                    "coercion": true,
                                    "keyPath": "allPrice"
                                  }
                                },
                                "else": 0
                              }
                            },
                            {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$costElements.bookingsWithDiscountOrMarkup"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$array-sum": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$costElements.bookingsWithDiscountOrMarkup"
                                      }
                                    },
                                    "coercion": true,
                                    "keyPath": "allPriceWithDiscountOrMarkup"
                                  }
                                },
                                "else": 0
                              }
                            },
                            {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$costElements.facilitiesNoDiscountOrMarkup"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$array-sum": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$costElements.facilitiesNoDiscountOrMarkup"
                                      }
                                    },
                                    "coercion": true,
                                    "keyPath": "totalPrice"
                                  }
                                },
                                "else": 0
                              }
                            },
                            {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$costElements.facilitiesWithDiscountOrMarkup"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$array-sum": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$costElements.facilitiesWithDiscountOrMarkup"
                                      }
                                    },
                                    "coercion": true,
                                    "keyPath": "totalPriceWithDiscountOrMarkup"
                                  }
                                },
                                "else": 0
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        }
      ]
    }
  },
  "properties": {
    "selectRoomsVisible": {
      "model": "#selectRoomsVisible",
      "type": "boolean",
      "widget": "hidden",
      "value": false
    },
    "modals": {
      "model": false,
      "type": "object",
      "widget": "container",
      "properties": {
        "selectServices": {
          "type": "object",
          "model": "#modalSelectServices",
          "widget": {
            "name": "dialog",
            "options": {
              "visible": false,
              "closable": true
            }
          },
          "properties": {
            "content": {
              "type": "object",
              "widget": {
                "name": "container"
              },
              "properties": {
                "header": {
                  "type": "string",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Выбор дополнительных услуг"
                    },
                    "kind": "container-popup-with-h1-no-form-collapsed-style"
                  }
                },
                "search": {
                  "type": "object",
                  "model": "#searchServices",
                  "widget": {
                    "name": "container",
                    "options": {
                      "displayNone": false,
                      "routerOptions": [
                        "displayNone"
                      ]
                    },
                    "kind": "container-search-form-collapsed-container-style"
                  },
                  "properties": {
                    "typeOrName": {
                      "type": "string",
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/length-255"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ],
                      "widget": {
                        "name": "input-group-button",
                        "options": {
                          "placeholder": "Наименование, тип услуги",
                          "actionButtonLabel": "Найти",
                          "actionButtonIconMobile": "icon-search",
                          "enableClearButton": true
                        },
                        "events": {
                          "actionButtonClick": {
                            "$grid": {
                              "action": "lazyLoad",
                              "path": "#selectorServices",
                              "filters": {
                                "$var": {
                                  "path": "#searchServices"
                                }
                              }
                            }
                          },
                          "keypress-13": {
                            "$grid": {
                              "action": "lazyLoad",
                              "path": "#selectorServices",
                              "filters": {
                                "$var": {
                                  "path": "#searchServices"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "selected-count": {
                  "type": "string",
                  "model": false,
                  "widget": {
                    "name": "html",
                    "class": {
                      "value": "mrg-b-xs"
                    }
                  },
                  "value": {
                    "$replace": {
                      "template": "<p>Выбрано услуг: {{0}}</p>",
                      "data": [
                        {
                          "$if": {
                            "condition": {
                              "$not-empty": {
                                "data": {
                                  "$element-option": {
                                    "option": "selection$",
                                    "path": "#selectorServices"
                                  }
                                }
                              }
                            },
                            "then": {
                              "$length": {
                                "data": {
                                  "$element-option": {
                                    "option": "selection$",
                                    "path": "#selectorServices"
                                  }
                                }
                              }
                            },
                            "else": 0
                          }
                        }
                      ]
                    }
                  }
                },
                "selected-chips-service": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "widget": "info"
                  },
                  "model": "#selected-chips-service",
                  "widget": {
                    "name": "chips",
                    "class": {
                      "value": "chips-invite-suppliers mrg-b-sm"
                    },
                    "options": {
                      "onlyRemove": true,
                      "allowDuplicate": false,
                      "disabled": true
                    },
                    "events": {
                      "onRemove": {
                        "$element-option": {
                          "path": "#selectorServices",
                          "option": "selection",
                          "value": {
                            "$array-pluck": {
                              "array": {
                                "$array-filter": {
                                  "array": {
                                    "$element-option": {
                                      "path": "#selectorServices",
                                      "option": "selectedRows"
                                    }
                                  },
                                  "filter": {
                                    "!==": {
                                      "operand1": {
                                        "$from-context": {
                                          "path": "$data.value.name"
                                        }
                                      },
                                      "operand2": {
                                        "$from-context": {
                                          "path": "$event.event"
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "key": "value.serviceId"
                            }
                          }
                        }
                      }
                    }
                  },
                  "value": {
                    "$if": {
                      "condition": {
                        "$not-empty": {
                          "data": {
                            "$subs": {
                              "path": "#data.services"
                            }
                          }
                        }
                      },
                      "then": {
                        "$array-pluck": {
                          "array": {
                            "$var": {
                              "path": "#data.services"
                            }
                          },
                          "key": "additionalService.name"
                        }
                      },
                      "else": []
                    }
                  }
                },
                "table": {
                  "value": {
                    "$api-table-workflow-data": {
                      "model": "#selectorServices",
                      "query": "additional_service/get_for_select",
                      "id": {
                        "$query-params": {
                          "name": "id"
                        }
                      },
                      "variables": {
                        "$graphql-event-variables": {
                          "data": {
                            "$element-event": {
                              "event": "lazyLoad"
                            }
                          }
                        }
                      },
                      "errors": {
                        "default": {
                          "$message": {
                            "severity": "error",
                            "summary": "Ошибка",
                            "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                          }
                        }
                      }
                    }
                  },
                  "type": "array",
                  "model": "#selectorServices",
                  "widget": {
                    "name": "table-lazy",
                    "options": {
                      "selectionMode": "multiple",
                      "selectionField": "selected",
                      "selectionKey": "serviceId",
                      "first": 0,
                      "rows": 10,
                      "lazy": true,
                      "paginator": true,
                      "rowsPerPageOptions": [
                        10,
                        20,
                        50
                      ],
                      "routerOptions": [
                        "first",
                        "rows"
                      ],
                      "sortField": "name",
                      "sortOrder": 1
                    },
                    "class": {
                      "value": "data-table d-block mrg-b-lg"
                    },
                    "events": {
                      "lazyLoad": {
                        "$element-option": {
                          "path": "#selectorServices",
                          "option": "loading",
                          "value": true
                        }
                      },
                      "onRowSelect": {
                        "$populate": {
                          "path": "#selected-chips-service",
                          "data": {
                            "$array-push": {
                              "array": {
                                "$var": {
                                  "path": "#selected-chips-service"
                                }
                              },
                              "data": {
                                "$from-context": {
                                  "path": "$event.event.value.name"
                                }
                              }
                            }
                          }
                        }
                      },
                      "onRowUnselect": {
                        "$populate": {
                          "path": "#selected-chips-service",
                          "data": {
                            "$array-filter": {
                              "array": {
                                "$var": {
                                  "path": "#selected-chips-service"
                                }
                              },
                              "filter": {
                                "!==": {
                                  "operand1": {
                                    "$from-context": {
                                      "path": "$data"
                                    }
                                  },
                                  "operand2": {
                                    "$from-context": {
                                      "path": "$event.event.value.name"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "onHeaderCheckboxToggle": {
                        "$if": {
                          "condition": {
                            "===": {
                              "operand1": {
                                "$from-context": {
                                  "path": "$event.event"
                                }
                              },
                              "operand2": true
                            }
                          },
                          "then": {
                            "$populate": {
                              "path": "#selected-chips-service",
                              "data": {
                                "$apply-func": {
                                  "func": "return [...new Set([...chipsArr, ...currPageServices])]",
                                  "args": {
                                    "chipsArr": {
                                      "$var": {
                                        "path": "#selected-chips-service"
                                      }
                                    },
                                    "currPageServices": {
                                      "$array-pluck": {
                                        "array": {
                                          "$var": {
                                            "path": "#selectorServices"
                                          }
                                        },
                                        "key": "name"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "else": {
                            "$populate": {
                              "path": "#selected-chips-service",
                              "data": {
                                "$apply-func": {
                                  "func": "return chipsArr.filter( function( el ) { return currPageServices.indexOf( el ) < 0; } )",
                                  "args": {
                                    "chipsArr": {
                                      "$var": {
                                        "path": "#selected-chips-service"
                                      }
                                    },
                                    "currPageServices": {
                                      "$array-pluck": {
                                        "array": {
                                          "$var": {
                                            "path": "#selectorServices"
                                          }
                                        },
                                        "key": "name"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "subscriptions": {
                      "reload-table": {
                        "$element-event": {
                          "event": "reload",
                          "value": true
                        }
                      }
                    }
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "selected": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "serviceId": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "name": {
                        "type": "string",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Наименование услуги"
                          }
                        }
                      },
                      "servicesType": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "widget": {
                              "name": "info"
                            }
                          }
                        },
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Тип услуги"
                          }
                        }
                      },
                      "unitPrice": {
                        "type": "number",
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "visible": false
                          }
                        }
                      },
                      "unitPriceView": {
                        "type": "object",
                        "model": false,
                        "widget": {
                          "name": "table-column",
                          "options": {
                            "label": "Цена (руб.)"
                          }
                        },
                        "properties": {
                          "price": {
                            "type": "string",
                            "model": false,
                            "widget": {
                              "name": "info",
                              "options": {
                                "formatter": "number:'0.2-2':'ru'",
                                "viewedValue": {
                                  "$from-context": {
                                    "path": "$rowData.unitPrice"
                                  }
                                }
                              },
                              "class": {
                                "group": "p-text-right",
                                "value": "p-jc-end"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "actions": {
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "class": {
                      "group": "form-actions p-field p-grid mrg-t-lg",
                      "value": "p-jc-xs-end p-autolayout"
                    }
                  },
                  "properties": {
                    "save": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Добавить выбранные"
                        },
                        "events": {
                          "click": {
                            "$if": {
                              "condition": {
                                "$not-empty": {
                                  "data": {
                                    "$element-option": {
                                      "path": "#selectorServices",
                                      "option": "selection"
                                    }
                                  }
                                }
                              },
                              "then": {
                                "$if": {
                                  "condition": {
                                    "$and": {
                                      "operands": [
                                        {
                                          "!==": {
                                            "operand1": {
                                              "$from-context": {
                                                "path": "@preload.event.state"
                                              }
                                            },
                                            "operand2": {
                                              "$fetch-object": {
                                                "path": "code",
                                                "data": {
                                                  "$workflow-object-state": {
                                                    "workflow": "additional_facilities",
                                                    "objectId": {
                                                      "$query-params": {
                                                        "name": "id"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "===": {
                                            "operand1": false,
                                            "operand2": {
                                              "$var": {
                                                "path": "#data.addServiceFlag"
                                              }
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  "then": {
                                    "$http-code": {
                                      "200": [
                                        {
                                          "$navigate": {
                                            "commands": [
                                              "/cabinet/event/edit"
                                            ],
                                            "extras": {
                                              "queryParams": {
                                                "id": {
                                                  "$from-context": {
                                                    "path": "$response.body.data.id.0"
                                                  }
                                                },
                                                "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"rent\"}}"
                                              }
                                            }
                                          }
                                        }
                                      ],
                                      "422": [
                                        {
                                          "$validate": {
                                            "errors": {
                                              "$from-context": {
                                                "path": "$response.error.errors"
                                              }
                                            }
                                          }
                                        }
                                      ],
                                      "client": {
                                        "$api-workflow": {
                                          "type": "post",
                                          "options": {
                                            "observe": "response"
                                          },
                                          "workflow": "event",
                                          "action": "add_draft",
                                          "data": {
                                            "eventData": {
                                              "$exclude": {
                                                "data": {
                                                  "$var": {
                                                    "path": "#data"
                                                  }
                                                },
                                                "exclude": [
                                                  "addServiceFlag",
                                                  "services"
                                                ]
                                              }
                                            },
                                            "services": {
                                              "$element-option": {
                                                "path": "#selectorServices",
                                                "option": "selection"
                                              }
                                            },
                                            "type": "additional_service"
                                          }
                                        }
                                      },
                                      "default": [
                                        {
                                          "$message": {
                                            "severity": "error",
                                            "summary": "Добавление мероприятия",
                                            "detail": "Непредвиденная ошибка"
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  "else": {
                                    "$waterfall": {
                                      "arrayFunctions": [
                                        {
                                          "$assign-context": {
                                            "path": "$addedServices",
                                            "data": {
                                              "$array-filter": {
                                                "array": {
                                                  "$element-option": {
                                                    "path": "#selectorServices",
                                                    "option": "selection"
                                                  }
                                                },
                                                "filter": {
                                                  "$not": {
                                                    "data": {
                                                      "$in": {
                                                        "value": {
                                                          "$from-context": {
                                                            "path": "$data"
                                                          }
                                                        },
                                                        "array": {
                                                          "$array-pluck": {
                                                            "array": {
                                                              "$var": {
                                                                "path": "#data.services"
                                                              }
                                                            },
                                                            "key": "serviceId"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        },
                                        {
                                          "$if": {
                                            "condition": {
                                              "$not-empty": {
                                                "data": {
                                                  "$from-context": {
                                                    "path": "$addedServices"
                                                  }
                                                }
                                              }
                                            },
                                            "then": {
                                              "$http-code": {
                                                "200": [
                                                  {
                                                    "$navigate": {
                                                      "commands": [
                                                        "/cabinet/event/edit"
                                                      ],
                                                      "extras": {
                                                        "queryParams": {
                                                          "id": {
                                                            "$query-params": {
                                                              "name": "id"
                                                            }
                                                          },
                                                          "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"rent\"}}"
                                                        }
                                                      }
                                                    }
                                                  }
                                                ],
                                                "422": [
                                                  {
                                                    "$validate": {
                                                      "errors": {
                                                        "$from-context": {
                                                          "path": "$response.error.errors"
                                                        }
                                                      }
                                                    }
                                                  }
                                                ],
                                                "client": {
                                                  "$api-workflow": {
                                                    "type": "post",
                                                    "options": {
                                                      "observe": "response"
                                                    },
                                                    "workflow": "additional_facilities",
                                                    "action": "mass_add",
                                                    "data": {
                                                      "services": {
                                                        "$from-context": {
                                                          "path": "$addedServices"
                                                        }
                                                      },
                                                      "type": "additional_service",
                                                      "eventId": {
                                                        "$query-params": {
                                                          "name": "id"
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                "default": [
                                                  {
                                                    "$message": {
                                                      "severity": "error",
                                                      "summary": "Добавление дополнительной услуги",
                                                      "detail": "Непредвиденная ошибка"
                                                    }
                                                  }
                                                ]
                                              }
                                            },
                                            "else": {
                                              "$element-option": {
                                                "option": "visible",
                                                "path": "#modalSelectServices",
                                                "value": false
                                              }
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  }
                                }
                              },
                              "else": {
                                "$element-option": {
                                  "option": "visible",
                                  "path": "#modalSelectServices",
                                  "value": false
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "cancel": {
                      "widget": {
                        "name": "button",
                        "options": {
                          "label": "Отмена"
                        },
                        "events": {
                          "click": {
                            "$element-option": {
                              "option": "visible",
                              "path": "#modalSelectServices",
                              "value": false
                            }
                          }
                        },
                        "kind": "button-search-form-clear-button-right-style"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "breadcrumbs": {
      "type": "object",
      "model": false,
      "widget": {
        "name": "breadcrumb",
        "mobileItems": [
          {
            "label": "Главная",
            "routerLink": "/cabinet/event/list"
          }
        ],
        "items": [
          {
            "label": "Главная",
            "routerLink": "/cabinet/event/list"
          },
          {
            "label": "Добавление мероприятия"
          },
          {
            "label": "Выбор помещений",
            "visible": {
              "$subs": {
                "path": "#selectRoomsVisible"
              }
            }
          }
        ],
        "class": {
          "group": "p-xs-auto mrg-lg-b-xl mrg-b-md"
        }
      }
    },
    "form": {
      "type": "object",
      "model": false,
      "widget": {
        "name": "form",
        "options": {
          "label": "Добавление мероприятия",
          "visible": {
            "$not": {
              "data": {
                "$subs": {
                  "path": "#selectRoomsVisible"
                }
              }
            }
          }
        },
        "class": {
          "label": "h1 mrg-b-lg d-block",
          "value": "mrg-b-xl d-block"
        }
      },
      "properties": {
        "tabs": {
          "type": "object",
          "model": false,
          "widget": {
            "key": "tabs",
            "name": "tab-view"
          },
          "properties": {
            "commonInfo": {
              "type": "object",
              "model": false,
              "widget": {
                "key": "commonInfo",
                "name": "tab-panel",
                "options": {
                  "label": "Общие данные"
                }
              },
              "properties": {
                "modals": {
                  "model": false,
                  "type": "object",
                  "widget": "container",
                  "properties": {
                    "selectOrganizers": {
                      "type": "object",
                      "model": "#modalSelectOrganizers",
                      "widget": {
                        "name": "dialog",
                        "options": {
                          "visible": false,
                          "closable": true
                        }
                      },
                      "properties": {
                        "content": {
                          "type": "object",
                          "widget": {
                            "name": "container"
                          },
                          "properties": {
                            "header": {
                              "type": "string",
                              "widget": {
                                "name": "container",
                                "options": {
                                  "label": "Выбор организаторов"
                                },
                                "kind": "container-popup-with-h1-no-form-collapsed-style"
                              }
                            },
                            "search": {
                              "type": "object",
                              "model": "#searchOrganizers",
                              "widget": {
                                "name": "container",
                                "options": {
                                  "displayNone": false,
                                  "routerOptions": [
                                    "displayNone"
                                  ]
                                },
                                "kind": "container-search-form-collapsed-container-style"
                              },
                              "properties": {
                                "search": {
                                  "type": "string",
                                  "validation": [
                                    {
                                      "type": "schema",
                                      "params": {
                                        "rule": "$ref:rule-validation:snippets/validation/checks/length-255"
                                      },
                                      "events": [
                                        "onBackend",
                                        "onUpdate"
                                      ]
                                    }
                                  ],
                                  "widget": {
                                    "name": "input-group-button",
                                    "options": {
                                      "placeholder": "Наименование контрагента, контактное лицо",
                                      "actionButtonLabel": "Найти",
                                      "actionButtonIconMobile": "icon-search",
                                      "enableClearButton": true
                                    },
                                    "events": {
                                      "actionButtonClick": {
                                        "$grid": {
                                          "action": "lazyLoad",
                                          "path": "#selectorOrganizers",
                                          "filters": {
                                            "$var": {
                                              "path": "#searchOrganizers"
                                            }
                                          }
                                        }
                                      },
                                      "keypress-13": {
                                        "$grid": {
                                          "action": "lazyLoad",
                                          "path": "#selectorOrganizers",
                                          "filters": {
                                            "$var": {
                                              "path": "#searchOrganizers"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "selected-count": {
                              "type": "string",
                              "model": false,
                              "widget": {
                                "name": "html",
                                "class": {
                                  "value": "mrg-b-xs"
                                }
                              },
                              "value": {
                                "$replace": {
                                  "template": "<p>Выбрано контрагентов: {{0}}</p>",
                                  "data": [
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$element-option": {
                                                "option": "selection$",
                                                "path": "#selectorOrganizers"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$length": {
                                            "data": {
                                              "$element-option": {
                                                "option": "selection$",
                                                "path": "#selectorOrganizers"
                                              }
                                            }
                                          }
                                        },
                                        "else": 0
                                      }
                                    }
                                  ]
                                }
                              }
                            },
                            "selected-chips-organizer": {
                              "type": "array",
                              "items": {
                                "type": "string",
                                "widget": "info"
                              },
                              "model": "#selected-chips-organizer",
                              "widget": {
                                "name": "chips",
                                "class": {
                                  "value": "chips-invite-suppliers mrg-b-sm"
                                },
                                "options": {
                                  "onlyRemove": true,
                                  "allowDuplicate": false,
                                  "disabled": true
                                },
                                "events": {
                                  "onRemove": {
                                    "$element-option": {
                                      "path": "#selectorOrganizers",
                                      "option": "selection",
                                      "value": {
                                        "$array-pluck": {
                                          "array": {
                                            "$array-filter": {
                                              "array": {
                                                "$element-option": {
                                                  "path": "#selectorOrganizers",
                                                  "option": "selectedRows"
                                                }
                                              },
                                              "filter": {
                                                "!==": {
                                                  "operand1": {
                                                    "$from-context": {
                                                      "path": "$data.value.name"
                                                    }
                                                  },
                                                  "operand2": {
                                                    "$from-context": {
                                                      "path": "$event.event"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "key": "value.organizerId"
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "value": {
                                "$if": {
                                  "condition": {
                                    "$not-empty": {
                                      "data": {
                                        "$subs": {
                                          "path": "#data.organizers"
                                        }
                                      }
                                    }
                                  },
                                  "then": {
                                    "$array-pluck": {
                                      "array": {
                                        "$var": {
                                          "path": "#data.organizers"
                                        }
                                      },
                                      "key": "name"
                                    }
                                  },
                                  "else": []
                                }
                              }
                            },
                            "table": {
                              "value": {
                                "$api-table-workflow-data": {
                                  "model": "#selectorOrganizers",
                                  "query": "partner/get_for_select",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  },
                                  "variables": {
                                    "$graphql-event-variables": {
                                      "data": {
                                        "$element-event": {
                                          "event": "lazyLoad"
                                        }
                                      }
                                    }
                                  },
                                  "errors": {
                                    "default": {
                                      "$message": {
                                        "severity": "error",
                                        "summary": "Ошибка",
                                        "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                      }
                                    }
                                  }
                                }
                              },
                              "type": "array",
                              "model": "#selectorOrganizers",
                              "widget": {
                                "name": "table-lazy",
                                "options": {
                                  "emptyMessage": "Данные не найдены",
                                  "selectionMode": "multiple",
                                  "selectionField": "selected",
                                  "selectionKey": "organizerId",
                                  "first": 0,
                                  "rows": 10,
                                  "lazy": true,
                                  "paginator": true,
                                  "rowsPerPageOptions": [
                                    10,
                                    20,
                                    50
                                  ],
                                  "routerOptions": [
                                    "first",
                                    "rows"
                                  ],
                                  "sortField": "name",
                                  "sortOrder": 1
                                },
                                "class": {
                                  "value": "data-table d-block mrg-b-lg"
                                },
                                "events": {
                                  "lazyLoad": {
                                    "$element-option": {
                                      "path": "#selectorOrganizers",
                                      "option": "loading",
                                      "value": true
                                    }
                                  },
                                  "onRowSelect": {
                                    "$populate": {
                                      "path": "#selected-chips-organizer",
                                      "data": {
                                        "$array-push": {
                                          "array": {
                                            "$var": {
                                              "path": "#selected-chips-organizer"
                                            }
                                          },
                                          "data": {
                                            "$from-context": {
                                              "path": "$event.event.value.name"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "onRowUnselect": {
                                    "$populate": {
                                      "path": "#selected-chips-organizer",
                                      "data": {
                                        "$array-filter": {
                                          "array": {
                                            "$var": {
                                              "path": "#selected-chips-organizer"
                                            }
                                          },
                                          "filter": {
                                            "!==": {
                                              "operand1": {
                                                "$from-context": {
                                                  "path": "$data"
                                                }
                                              },
                                              "operand2": {
                                                "$from-context": {
                                                  "path": "$event.event.value.name"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "onHeaderCheckboxToggle": {
                                    "$if": {
                                      "condition": {
                                        "===": {
                                          "operand1": {
                                            "$from-context": {
                                              "path": "$event.event"
                                            }
                                          },
                                          "operand2": true
                                        }
                                      },
                                      "then": {
                                        "$populate": {
                                          "path": "#selected-chips-organizer",
                                          "data": {
                                            "$apply-func": {
                                              "func": "return [...new Set([...chipsArr, ...currPageOrganizers])]",
                                              "args": {
                                                "chipsArr": {
                                                  "$var": {
                                                    "path": "#selected-chips-organizer"
                                                  }
                                                },
                                                "currPageOrganizers": {
                                                  "$array-pluck": {
                                                    "array": {
                                                      "$var": {
                                                        "path": "#selectorOrganizers"
                                                      }
                                                    },
                                                    "key": "name"
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "else": {
                                        "$populate": {
                                          "path": "#selected-chips-organizer",
                                          "data": {
                                            "$apply-func": {
                                              "func": "return chipsArr.filter( function( el ) { return currPageOrganizers.indexOf( el ) < 0; } )",
                                              "args": {
                                                "chipsArr": {
                                                  "$var": {
                                                    "path": "#selected-chips-organizer"
                                                  }
                                                },
                                                "currPageOrganizers": {
                                                  "$array-pluck": {
                                                    "array": {
                                                      "$var": {
                                                        "path": "#selectorOrganizers"
                                                      }
                                                    },
                                                    "key": "name"
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "subscriptions": {
                                  "reload-table": {
                                    "$element-event": {
                                      "event": "reload",
                                      "value": true
                                    }
                                  }
                                }
                              },
                              "items": {
                                "type": "object",
                                "properties": {
                                  "selected": {
                                    "type": "string",
                                    "widget": {
                                      "name": "table-column",
                                      "options": {
                                        "visible": false
                                      }
                                    }
                                  },
                                  "organizerId": {
                                    "type": "string",
                                    "widget": {
                                      "name": "table-column",
                                      "options": {
                                        "visible": false
                                      }
                                    }
                                  },
                                  "name": {
                                    "type": "string",
                                    "widget": {
                                      "name": "table-column",
                                      "options": {
                                        "label": "Наименование контрагента"
                                      }
                                    }
                                  },
                                  "mainContactPerson": {
                                    "type": "object",
                                    "widget": {
                                      "name": "table-column",
                                      "options": {
                                        "label": "Контактное лицо"
                                      }
                                    },
                                    "properties": {
                                      "fullName": {
                                        "type": "string",
                                        "widget": {
                                          "name": "info"
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "actions": {
                              "type": "object",
                              "widget": {
                                "name": "container",
                                "class": {
                                  "group": "form-actions p-field p-grid mrg-t-lg",
                                  "value": "p-jc-xs-end p-autolayout"
                                }
                              },
                              "properties": {
                                "save": {
                                  "widget": {
                                    "name": "button",
                                    "options": {
                                      "label": "Добавить выбранные"
                                    },
                                    "events": {
                                      "click": {
                                        "$if": {
                                          "condition": {
                                            "$not-empty": {
                                              "data": {
                                                "$element-option": {
                                                  "path": "#selectorOrganizers",
                                                  "option": "selection"
                                                }
                                              }
                                            }
                                          },
                                          "then": {
                                            "$waterfall": {
                                              "arrayFunctions": [
                                                {
                                                  "$populate": {
                                                    "path": "#data.organizers",
                                                    "data": {
                                                      "$fetch-object": {
                                                        "path": "data.pagination.items",
                                                        "data": {
                                                          "$api-data": {
                                                            "query": "partner/get_for_select",
                                                            "id": {
                                                              "$query-params": {
                                                                "name": "id"
                                                              }
                                                            },
                                                            "variables": {
                                                              "id": {
                                                                "$element-option": {
                                                                  "path": "#selectorOrganizers",
                                                                  "option": "selection"
                                                                }
                                                              }
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                {
                                                  "$element-option": {
                                                    "option": "visible",
                                                    "path": "#modalSelectOrganizers",
                                                    "value": false
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          "else": {
                                            "$waterfall": {
                                              "arrayFunctions": [
                                                {
                                                  "$populate": {
                                                    "path": "#data.organizers",
                                                    "data": {}
                                                  }
                                                },
                                                {
                                                  "$element-option": {
                                                    "option": "visible",
                                                    "path": "#modalSelectOrganizers",
                                                    "value": false
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "cancel": {
                                  "widget": {
                                    "name": "button",
                                    "options": {
                                      "label": "Отмена"
                                    },
                                    "events": {
                                      "click": {
                                        "$element-option": {
                                          "option": "visible",
                                          "path": "#modalSelectOrganizers",
                                          "value": false
                                        }
                                      }
                                    },
                                    "kind": "button-search-form-clear-button-right-style"
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "selectCurators": {
                      "type": "object",
                      "model": "#modalSelectCurators",
                      "widget": {
                        "name": "dialog",
                        "options": {
                          "visible": false,
                          "closable": true
                        }
                      },
                      "properties": {
                        "content": {
                          "type": "object",
                          "widget": {
                            "name": "container"
                          },
                          "properties": {
                            "header": {
                              "type": "string",
                              "widget": {
                                "name": "container",
                                "options": {
                                  "label": "Выбор кураторов"
                                },
                                "kind": "container-popup-with-h1-no-form-collapsed-style"
                              }
                            },
                            "search": {
                              "type": "object",
                              "model": "#searchCurators",
                              "widget": {
                                "name": "container",
                                "options": {
                                  "displayNone": false,
                                  "routerOptions": [
                                    "displayNone"
                                  ]
                                },
                                "kind": "container-search-form-collapsed-container-style"
                              },
                              "properties": {
                                "search": {
                                  "type": "string",
                                  "validation": [
                                    {
                                      "type": "schema",
                                      "params": {
                                        "rule": "$ref:rule-validation:snippets/validation/checks/length-255"
                                      },
                                      "events": [
                                        "onBackend",
                                        "onUpdate"
                                      ]
                                    }
                                  ],
                                  "widget": {
                                    "name": "input-group-button",
                                    "options": {
                                      "placeholder": "ФИО пользователя",
                                      "actionButtonLabel": "Найти",
                                      "actionButtonIconMobile": "icon-search",
                                      "enableClearButton": true
                                    },
                                    "events": {
                                      "actionButtonClick": {
                                        "$grid": {
                                          "action": "lazyLoad",
                                          "path": "#selectorCurators",
                                          "filters": {
                                            "$var": {
                                              "path": "#searchCurators"
                                            }
                                          }
                                        }
                                      },
                                      "keypress-13": {
                                        "$grid": {
                                          "action": "lazyLoad",
                                          "path": "#selectorCurators",
                                          "filters": {
                                            "$var": {
                                              "path": "#searchCurators"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "selected-count": {
                              "type": "string",
                              "model": false,
                              "widget": {
                                "name": "html",
                                "class": {
                                  "value": "mrg-b-xs"
                                }
                              },
                              "value": {
                                "$replace": {
                                  "template": "<p>Выбрано пользователей: {{0}}</p>",
                                  "data": [
                                    {
                                      "$if": {
                                        "condition": {
                                          "$not-empty": {
                                            "data": {
                                              "$element-option": {
                                                "option": "selection$",
                                                "path": "#selectorCurators"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$length": {
                                            "data": {
                                              "$element-option": {
                                                "option": "selection$",
                                                "path": "#selectorCurators"
                                              }
                                            }
                                          }
                                        },
                                        "else": 0
                                      }
                                    }
                                  ]
                                }
                              }
                            },
                            "selected-chips-curator": {
                              "type": "array",
                              "items": {
                                "type": "string",
                                "widget": "info"
                              },
                              "model": "#selected-chips-curator",
                              "widget": {
                                "name": "chips",
                                "class": {
                                  "value": "chips-invite-suppliers mrg-b-sm"
                                },
                                "options": {
                                  "onlyRemove": true,
                                  "allowDuplicate": false,
                                  "disabled": true
                                },
                                "events": {
                                  "onRemove": {
                                    "$element-option": {
                                      "path": "#selectorCurators",
                                      "option": "selection",
                                      "value": {
                                        "$array-pluck": {
                                          "array": {
                                            "$array-filter": {
                                              "array": {
                                                "$element-option": {
                                                  "path": "#selectorCurators",
                                                  "option": "selectedRows"
                                                }
                                              },
                                              "filter": {
                                                "!==": {
                                                  "operand1": {
                                                    "$from-context": {
                                                      "path": "$data.value.fullName"
                                                    }
                                                  },
                                                  "operand2": {
                                                    "$from-context": {
                                                      "path": "$event.event"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "key": "value.userId"
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "value": {
                                "$if": {
                                  "condition": {
                                    "$not-empty": {
                                      "data": {
                                        "$subs": {
                                          "path": "#data.curators"
                                        }
                                      }
                                    }
                                  },
                                  "then": {
                                    "$array-pluck": {
                                      "array": {
                                        "$var": {
                                          "path": "#data.curators"
                                        }
                                      },
                                      "key": "fullName"
                                    }
                                  },
                                  "else": []
                                }
                              }
                            },
                            "table": {
                              "value": {
                                "$api-table-workflow-data": {
                                  "model": "#selectorCurators",
                                  "query": "user/get_for_select",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  },
                                  "variables": {
                                    "$assign-object": {
                                      "path": "roles",
                                      "data": {
                                        "$from-context": {
                                          "path": "@preload.roles"
                                        }
                                      },
                                      "object": {
                                        "$graphql-event-variables": {
                                          "data": {
                                            "$element-event": {
                                              "event": "lazyLoad"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "errors": {
                                    "default": {
                                      "$message": {
                                        "severity": "error",
                                        "summary": "Ошибка",
                                        "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                                      }
                                    }
                                  }
                                }
                              },
                              "type": "array",
                              "model": "#selectorCurators",
                              "widget": {
                                "name": "table-lazy",
                                "options": {
                                  "emptyMessage": "Данные не найдены",
                                  "selectionMode": "multiple",
                                  "selectionField": "selected",
                                  "selectionKey": "userId",
                                  "first": 0,
                                  "rows": 10,
                                  "lazy": true,
                                  "paginator": true,
                                  "rowsPerPageOptions": [
                                    10,
                                    20,
                                    50
                                  ],
                                  "routerOptions": [
                                    "first",
                                    "rows"
                                  ],
                                  "sortField": "lastName",
                                  "sortOrder": 1
                                },
                                "class": {
                                  "value": "data-table d-block mrg-b-lg"
                                },
                                "events": {
                                  "lazyLoad": {
                                    "$element-option": {
                                      "path": "#selectorCurators",
                                      "option": "loading",
                                      "value": true
                                    }
                                  },
                                  "onRowSelect": {
                                    "$populate": {
                                      "path": "#selected-chips-curator",
                                      "data": {
                                        "$array-push": {
                                          "array": {
                                            "$var": {
                                              "path": "#selected-chips-curator"
                                            }
                                          },
                                          "data": {
                                            "$from-context": {
                                              "path": "$event.event.value.fullName"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "onRowUnselect": {
                                    "$populate": {
                                      "path": "#selected-chips-curator",
                                      "data": {
                                        "$array-filter": {
                                          "array": {
                                            "$var": {
                                              "path": "#selected-chips-curator"
                                            }
                                          },
                                          "filter": {
                                            "!==": {
                                              "operand1": {
                                                "$from-context": {
                                                  "path": "$data"
                                                }
                                              },
                                              "operand2": {
                                                "$from-context": {
                                                  "path": "$event.event.value.fullName"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "onHeaderCheckboxToggle": {
                                    "$if": {
                                      "condition": {
                                        "===": {
                                          "operand1": {
                                            "$from-context": {
                                              "path": "$event.event"
                                            }
                                          },
                                          "operand2": true
                                        }
                                      },
                                      "then": {
                                        "$populate": {
                                          "path": "#selected-chips-curator",
                                          "data": {
                                            "$apply-func": {
                                              "func": "return [...new Set([...chipsArr, ...currPageCurators])]",
                                              "args": {
                                                "chipsArr": {
                                                  "$var": {
                                                    "path": "#selected-chips-curator"
                                                  }
                                                },
                                                "currPageCurators": {
                                                  "$array-pluck": {
                                                    "array": {
                                                      "$var": {
                                                        "path": "#selectorCurators"
                                                      }
                                                    },
                                                    "key": "fullName"
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "else": {
                                        "$populate": {
                                          "path": "#selected-chips-curator",
                                          "data": {
                                            "$apply-func": {
                                              "func": "return chipsArr.filter( function( el ) { return currPageCurators.indexOf( el ) < 0; } )",
                                              "args": {
                                                "chipsArr": {
                                                  "$var": {
                                                    "path": "#selected-chips-curator"
                                                  }
                                                },
                                                "currPageCurators": {
                                                  "$array-pluck": {
                                                    "array": {
                                                      "$var": {
                                                        "path": "#selectorCurators"
                                                      }
                                                    },
                                                    "key": "fullName"
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "subscriptions": {
                                  "reload-table": {
                                    "$element-event": {
                                      "event": "reload",
                                      "value": true
                                    }
                                  }
                                }
                              },
                              "items": {
                                "type": "object",
                                "properties": {
                                  "selected": {
                                    "type": "string",
                                    "widget": {
                                      "name": "table-column",
                                      "options": {
                                        "visible": false
                                      }
                                    }
                                  },
                                  "userId": {
                                    "type": "string",
                                    "widget": {
                                      "name": "table-column",
                                      "options": {
                                        "visible": false
                                      }
                                    }
                                  },
                                  "fullName": {
                                    "type": "string",
                                    "widget": {
                                      "name": "table-column",
                                      "options": {
                                        "label": "ФИО пользователя"
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "actions": {
                              "type": "object",
                              "widget": {
                                "name": "container",
                                "class": {
                                  "group": "form-actions p-field p-grid mrg-t-lg",
                                  "value": "p-jc-xs-end p-autolayout"
                                }
                              },
                              "properties": {
                                "save": {
                                  "widget": {
                                    "name": "button",
                                    "options": {
                                      "label": "Добавить выбранные"
                                    },
                                    "events": {
                                      "click": {
                                        "$if": {
                                          "condition": {
                                            "$not-empty": {
                                              "data": {
                                                "$element-option": {
                                                  "path": "#selectorCurators",
                                                  "option": "selection"
                                                }
                                              }
                                            }
                                          },
                                          "then": {
                                            "$waterfall": {
                                              "arrayFunctions": [
                                                {
                                                  "$populate": {
                                                    "path": "#data.curators",
                                                    "data": {
                                                      "$fetch-object": {
                                                        "path": "data.pagination.items",
                                                        "data": {
                                                          "$api-data": {
                                                            "query": "user/get_for_select",
                                                            "id": {
                                                              "$query-params": {
                                                                "name": "id"
                                                              }
                                                            },
                                                            "variables": {
                                                              "id": {
                                                                "$element-option": {
                                                                  "path": "#selectorCurators",
                                                                  "option": "selection"
                                                                }
                                                              }
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                {
                                                  "$element-option": {
                                                    "option": "visible",
                                                    "path": "#modalSelectCurators",
                                                    "value": false
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          "else": {
                                            "$waterfall": {
                                              "arrayFunctions": [
                                                {
                                                  "$populate": {
                                                    "path": "#data.curators",
                                                    "data": {}
                                                  }
                                                },
                                                {
                                                  "$element-option": {
                                                    "option": "visible",
                                                    "path": "#modalSelectCurators",
                                                    "value": false
                                                  }
                                                }
                                              ]
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "cancel": {
                                  "widget": {
                                    "name": "button",
                                    "options": {
                                      "label": "Отмена"
                                    },
                                    "events": {
                                      "click": {
                                        "$element-option": {
                                          "option": "visible",
                                          "path": "#modalSelectCurators",
                                          "value": false
                                        }
                                      }
                                    },
                                    "kind": "button-search-form-clear-button-right-style"
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "eventCommonInfo": {
                  "type": "object",
                  "model": "#data.commonInfo",
                  "value": {
                    "$json-model": {
                      "data": {
                        "$from-context": {
                          "path": "@preload.event"
                        }
                      },
                      "alias": "#data.commonInfo"
                    }
                  },
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Общие сведения о мероприятии"
                    },
                    "class": {
                      "label": "h2 mrg-b-md",
                      "value": "mrg-b-xl"
                    }
                  },
                  "properties": {
                    "container_preliminary_checkbox": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Предварительное бронирование"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "properties": {
                        "preliminary": {
                          "type": "boolean",
                          "model": "#data.commonInfo.preliminary",
                          "value": {
                            "$if": {
                              "condition": {
                                "$not-empty": {
                                  "data": {
                                    "$from-context": {
                                      "path": "@preload.event.preliminary"
                                    }
                                  }
                                }
                              },
                              "then": {
                                "$from-context": {
                                  "path": "@preload.event.preliminary"
                                }
                              },
                              "else": false
                            }
                          },
                          "widget": {
                            "name": "checkbox",
                            "options": {
                              "optionLabel": "",
                              "optionLabelHTML": "",
                              "disabled": {
                                "$not": {
                                  "data": {
                                    "$in": {
                                      "value": {
                                        "$fetch-object": {
                                          "path": "code",
                                          "data": {
                                            "$workflow-object-state": {
                                              "workflow": "event",
                                              "objectId": {
                                                "$query-params": {
                                                  "name": "id"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "array": [
                                        "draft",
                                        "new",
                                        "pre_booking"
                                      ]
                                    }
                                  }
                                }
                              }
                            },
                            "class": {
                              "value": "form-item-element form-item-element_checkbox form-item-element_label-html"
                            }
                          }
                        }
                      }
                    },
                    "container_contract_is_signed_checkbox": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Договор подписан"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "properties": {
                        "contractSigned": {
                          "type": "boolean",
                          "model": "#data.commonInfo.contractSigned",
                          "value": {
                            "$if": {
                              "condition": {
                                "$not-empty": {
                                  "data": {
                                    "$from-context": {
                                      "path": "@preload.event.contractSigned"
                                    }
                                  }
                                }
                              },
                              "then": {
                                "$from-context": {
                                  "path": "@preload.event.contractSigned"
                                }
                              },
                              "else": false
                            }
                          },
                          "widget": {
                            "name": "checkbox",
                            "options": {
                              "optionLabel": "",
                              "optionLabelHTML": ""
                            },
                            "class": {
                              "value": "form-item-element form-item-element_checkbox form-item-element_label-html"
                            }
                          }
                        }
                      }
                    },
                    "container_act_is_signed_checkbox": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Акт подписан"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "properties": {
                        "actSigned": {
                          "type": "boolean",
                          "model": "#data.commonInfo.actSigned",
                          "value": {
                            "$if": {
                              "condition": {
                                "$not-empty": {
                                  "data": {
                                    "$from-context": {
                                      "path": "@preload.event.actSigned"
                                    }
                                  }
                                }
                              },
                              "then": {
                                "$from-context": {
                                  "path": "@preload.event.actSigned"
                                }
                              },
                              "else": false
                            }
                          },
                          "widget": {
                            "name": "checkbox",
                            "options": {
                              "optionLabel": "",
                              "optionLabelHTML": ""
                            },
                            "class": {
                              "value": "form-item-element form-item-element_checkbox form-item-element_label-html"
                            }
                          }
                        }
                      }
                    },
                    "name": {
                      "type": "string",
                      "widget": {
                        "name": "input",
                        "options": {
                          "label": "Наименование мероприятия"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label_required p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Поле обязательно для заполнения"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "type": {
                      "type": "string",
                      "widget": {
                        "name": "dropdown",
                        "options": {
                          "label": "Вид мероприятия",
                          "showClear": true,
                          "optionLabel": "name",
                          "dataKey": "id",
                          "valueKey": "id",
                          "placeholder": "Выбрать",
                          "filter": true,
                          "valueOptions": {
                            "$fetch-object": {
                              "path": "data.items",
                              "data": {
                                "$api-data": {
                                  "query": "event_type/get_for_dropdown",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": {
                            "$if": {
                              "condition": {
                                "===": {
                                  "operand1": {
                                    "$subs": {
                                      "path": "#data.commonInfo.preliminary"
                                    }
                                  },
                                  "operand2": false
                                }
                              },
                              "then": "form-label form-label_required p-xs-12 p-md-4 p-xl-3",
                              "else": "form-label form-label p-xs-12 p-md-4 p-xl-3"
                            }
                          },
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "===": {
                                    "operand1": {
                                      "$var": {
                                        "path": "#data.commonInfo.preliminary"
                                      }
                                    },
                                    "operand2": false
                                  }
                                },
                                "then": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Поле обязательно для заполнения"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "country": {
                      "type": "string",
                      "widget": {
                        "name": "dropdown",
                        "options": {
                          "label": "Страна/регион",
                          "showClear": true,
                          "optionLabel": "name",
                          "dataKey": "code",
                          "valueKey": "code",
                          "placeholder": "Выбрать",
                          "filter": true,
                          "valueOptions": [
                            {
                              "code": "other",
                              "name": "Зарубежные страны"
                            },
                            {
                              "code": "rt",
                              "name": "Республика Татарстан"
                            },
                            {
                              "code": "ru",
                              "name": "Российская Федерация"
                            }
                          ]
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      }
                    },
                    "industry": {
                      "type": "string",
                      "widget": {
                        "name": "dropdown",
                        "options": {
                          "label": "Отрасль",
                          "showClear": true,
                          "optionLabel": "name",
                          "dataKey": "id",
                          "valueKey": "id",
                          "placeholder": "Выбрать",
                          "filter": true,
                          "valueOptions": {
                            "$fetch-object": {
                              "path": "data.items",
                              "data": {
                                "$api-data": {
                                  "query": "industry/get_for_dropdown",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      }
                    },
                    "description": {
                      "type": "string",
                      "widget": {
                        "name": "textarea",
                        "options": {
                          "label": "Описание",
                          "rows": 6,
                          "maxlength": 4000
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": {
                            "$if": {
                              "condition": {
                                "===": {
                                  "operand1": {
                                    "$subs": {
                                      "path": "#data.commonInfo.preliminary"
                                    }
                                  },
                                  "operand2": false
                                }
                              },
                              "then": "form-label_required p-xs-12 p-md-4 p-xl-3",
                              "else": "form-label p-xs-12 p-md-4 p-xl-3"
                            }
                          },
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "===": {
                                    "operand1": {
                                      "$var": {
                                        "path": "#data.commonInfo.preliminary"
                                      }
                                    },
                                    "operand2": false
                                  }
                                },
                                "then": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Поле обязательно для заполнения"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "numberOfPeople": {
                      "type": "number",
                      "widget": {
                        "name": "input",
                        "options": {
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "rightAlign": false,
                            "autoGroup": true,
                            "allowMinus": false,
                            "integerDigits": 10
                          },
                          "label": "Количество человек"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 0
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Должно быть указано целое положительное число"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "numberOfExhibitors": {
                      "type": "number",
                      "widget": {
                        "name": "input",
                        "options": {
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "rightAlign": false,
                            "autoGroup": true,
                            "allowMinus": false,
                            "integerDigits": 10
                          },
                          "label": "Количество экспонентов"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 0
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Должно быть указано целое положительное число"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "numberOfCountries": {
                      "type": "number",
                      "widget": {
                        "name": "input",
                        "options": {
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "rightAlign": false,
                            "autoGroup": true,
                            "allowMinus": false,
                            "integerDigits": 10
                          },
                          "label": "Количество стран-участниц"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 0
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Должно быть указано целое положительное число"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "standardBuilding": {
                      "type": "number",
                      "widget": {
                        "name": "input",
                        "options": {
                          "inputmask": {
                            "alias": "decimal",
                            "groupSeparator": " ",
                            "rightAlign": false,
                            "autoGroup": true,
                            "allowMinus": false,
                            "integerDigits": 10,
                            "digits": 2,
                            "radixPoint": ","
                          },
                          "label": "Стандартная застройка (м²)"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 0
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Должно быть указано положительное число"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "buildingAreaNet": {
                      "type": "number",
                      "widget": {
                        "name": "input",
                        "options": {
                          "inputmask": {
                            "alias": "decimal",
                            "groupSeparator": " ",
                            "rightAlign": false,
                            "autoGroup": true,
                            "allowMinus": false,
                            "integerDigits": 10,
                            "digits": 2,
                            "radixPoint": ","
                          },
                          "label": "Площадь застройки нетто (м²)"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 0
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Должно быть указано положительное число"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "sitePlacement": {
                      "type": "string",
                      "value": "no_request",
                      "widget": {
                        "name": "dropdown",
                        "options": {
                          "showClear": true,
                          "label": "Размещение на сайте",
                          "optionLabel": "name",
                          "dataKey": "code",
                          "valueKey": "code",
                          "placeholder": "Выбрать",
                          "filter": true,
                          "valueOptions": [
                            {
                              "code": "yes",
                              "name": "Да"
                            },
                            {
                              "code": "no",
                              "name": "Нет"
                            },
                            {
                              "code": "no_request",
                              "name": "Официальный запрос не поступил"
                            }
                          ]
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "#data.commonInfo.sitePlacement"
                                  }
                                }
                              }
                            },
                            "message": "Поле обязательно для заполнения"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "container_protocol_checkbox": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Протокольное мероприятие"
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      },
                      "properties": {
                        "protocolEvent": {
                          "type": "boolean",
                          "model": "#data.commonInfo.protocolEvent",
                          "value": {
                            "$if": {
                              "condition": {
                                "===": {
                                  "operand1": "edit",
                                  "operand2": {
                                    "$route-params": {
                                      "name": "action"
                                    }
                                  }
                                }
                              },
                              "then": {
                                "$from-context": {
                                  "path": "@preload.event.protocolEvent"
                                }
                              },
                              "else": false
                            }
                          },
                          "widget": {
                            "name": "checkbox",
                            "options": {
                              "optionLabel": "",
                              "optionLabelHTML": ""
                            },
                            "class": {
                              "value": "form-item-element form-item-element_checkbox form-item-element_label-html"
                            }
                          }
                        }
                      }
                    },
                    "comment": {
                      "type": "string",
                      "widget": {
                        "name": "textarea",
                        "options": {
                          "label": "Комментарий",
                          "rows": 6,
                          "maxlength": 4000
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        }
                      }
                    }
                  }
                },
                "organizerList": {
                  "type": "object",
                  "model": false,
                  "widget": {
                    "name": "container"
                  },
                  "properties": {
                    "header-with-button": {
                      "type": "object",
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Сведения об организаторах"
                        },
                        "class": {
                          "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                          "label": "h2 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 mrg-md-b-md",
                          "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0"
                        }
                      },
                      "properties": {
                        "button": {
                          "widget": {
                            "name": "button",
                            "options": {
                              "icon": "icon-plus",
                              "label": "Добавить организаторов"
                            },
                            "class": {
                              "value": "button_link"
                            },
                            "events": {
                              "click": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$populate": {
                                        "path": "#searchOrganizers",
                                        "data": {}
                                      }
                                    },
                                    {
                                      "$element-event": {
                                        "event": "keypress-13",
                                        "path": "#searchOrganizers.search",
                                        "value": true
                                      }
                                    },
                                    {
                                      "$element-option": {
                                        "option": "visible",
                                        "path": "#modalSelectOrganizers",
                                        "value": true
                                      }
                                    },
                                    {
                                      "$element-option": {
                                        "path": "#selectorOrganizers",
                                        "option": "selection",
                                        "value": {
                                          "$array-pluck": {
                                            "array": {
                                              "$var": {
                                                "path": "#data.organizers"
                                              }
                                            },
                                            "key": "organizerId"
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#selected-chips-organizer",
                                        "data": {
                                          "$array-pluck": {
                                            "array": {
                                              "$var": {
                                                "path": "#data.organizers"
                                              }
                                            },
                                            "key": "name"
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "organizers": {
                      "type": "array",
                      "model": "#data.organizers",
                      "bindRouter": false,
                      "widget": {
                        "name": "table",
                        "options": {
                          "selectionKey": "organizerId",
                          "emptyMessage": "Не добавлено информации для отображения",
                          "responsive": false,
                          "sortField": "organizerNumber",
                          "sortOrder": 1
                        },
                        "class": {
                          "value": "data-table d-block mrg-b-lg"
                        }
                      },
                      "items": {
                        "type": "object",
                        "properties": {
                          "organizerNumber": {
                            "type": "number",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "№",
                                "viewedValue": {
                                  "$collection": {
                                    "action": "row-number"
                                  }
                                }
                              }
                            }
                          },
                          "organizerId": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "name": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "organizerInfo": {
                            "type": "object",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Наименование контрагента"
                              }
                            },
                            "properties": {
                              "link": {
                                "type": "string",
                                "model": false,
                                "widget": {
                                  "name": "link",
                                  "options": {
                                    "target": "_blank",
                                    "viewedValue": {
                                      "$from-context": {
                                        "path": "$rowData.name"
                                      }
                                    },
                                    "routerLink": "/cabinet/partner/view",
                                    "queryParams": {
                                      "id": {
                                        "$from-context": {
                                          "path": "$rowData.organizerId"
                                        }
                                      }
                                    },
                                    "visible": {
                                      "$active-user-has-permission": {
                                        "permission": "partner.view"
                                      }
                                    }
                                  }
                                }
                              },
                              "name": {
                                "type": "string",
                                "model": false,
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "viewedValue": {
                                      "$from-context": {
                                        "path": "$rowData.name"
                                      }
                                    },
                                    "visible": {
                                      "$not": {
                                        "data": {
                                          "$active-user-has-permission": {
                                            "permission": "partner.view"
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "mainContactPerson": {
                            "type": "object",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Контактное лицо"
                              }
                            },
                            "properties": {
                              "fullName": {
                                "type": "string",
                                "widget": {
                                  "name": "info"
                                }
                              },
                              "phone": {
                                "type": "string",
                                "widget": {
                                  "name": "info"
                                }
                              }
                            }
                          },
                          "actions_column": {
                            "type": "object",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Действия"
                              },
                              "class": {
                                "cell": "column_actions"
                              }
                            },
                            "properties": {
                              "actions": {
                                "widget": {
                                  "name": "button",
                                  "options": {
                                    "icon": "icon-trashbin"
                                  },
                                  "events": {
                                    "click": {
                                      "$collection": {
                                        "action": "row-remove"
                                      }
                                    }
                                  },
                                  "class": {
                                    "group": "p-autolayout p-jc-center",
                                    "value": "button_icon button_icon-shaded"
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "value": {
                        "$if": {
                          "condition": {
                            "$not-empty": {
                              "data": {
                                "$from-context": {
                                  "path": "@preload.event.organizers"
                                }
                              }
                            }
                          },
                          "then": {
                            "$array-pluck": {
                              "array": {
                                "$from-context": {
                                  "path": "@preload.event.organizers"
                                }
                              },
                              "key": "partner"
                            }
                          },
                          "else": []
                        }
                      }
                    }
                  }
                },
                "curatorList": {
                  "type": "object",
                  "model": false,
                  "widget": {
                    "name": "container"
                  },
                  "properties": {
                    "header-with-button": {
                      "type": "object",
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Сведения о кураторах"
                        },
                        "class": {
                          "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                          "label": "h2 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 mrg-md-b-md",
                          "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0"
                        }
                      },
                      "properties": {
                        "button": {
                          "widget": {
                            "name": "button",
                            "options": {
                              "icon": "icon-plus",
                              "label": "Добавить кураторов"
                            },
                            "class": {
                              "value": "button_link"
                            },
                            "events": {
                              "click": {
                                "$waterfall": {
                                  "arrayFunctions": [
                                    {
                                      "$populate": {
                                        "path": "#searchCurators",
                                        "data": {}
                                      }
                                    },
                                    {
                                      "$element-event": {
                                        "event": "keypress-13",
                                        "path": "#searchCurators.search",
                                        "value": true
                                      }
                                    },
                                    {
                                      "$element-option": {
                                        "option": "visible",
                                        "path": "#modalSelectCurators",
                                        "value": true
                                      }
                                    },
                                    {
                                      "$element-option": {
                                        "path": "#selectorCurators",
                                        "option": "selection",
                                        "value": {
                                          "$array-pluck": {
                                            "array": {
                                              "$var": {
                                                "path": "#data.curators"
                                              }
                                            },
                                            "key": "userId"
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "$populate": {
                                        "path": "#selected-chips-curator",
                                        "data": {
                                          "$array-pluck": {
                                            "array": {
                                              "$var": {
                                                "path": "#data.curators"
                                              }
                                            },
                                            "key": "fullName"
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "curators": {
                      "type": "array",
                      "model": "#data.curators",
                      "bindRouter": false,
                      "widget": {
                        "name": "table",
                        "options": {
                          "selectionKey": "userId",
                          "emptyMessage": "Не добавлено информации для отображения",
                          "sortField": "userNumber",
                          "sortOrder": 1
                        },
                        "class": {
                          "value": "data-table d-block mrg-b-lg"
                        }
                      },
                      "items": {
                        "type": "object",
                        "properties": {
                          "userNumber": {
                            "type": "number",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "№",
                                "viewedValue": {
                                  "$collection": {
                                    "action": "row-number"
                                  }
                                }
                              }
                            }
                          },
                          "userId": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "fullName": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "phoneView": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "userInfo": {
                            "type": "object",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Куратор от АНО \"Казань Экспо\""
                              }
                            },
                            "properties": {
                              "link": {
                                "type": "string",
                                "model": false,
                                "widget": {
                                  "name": "link",
                                  "options": {
                                    "target": "_blank",
                                    "viewedValue": {
                                      "$from-context": {
                                        "path": "$rowData.fullName"
                                      }
                                    },
                                    "routerLink": "/cabinet/user/view",
                                    "queryParams": {
                                      "id": {
                                        "$from-context": {
                                          "path": "$rowData.userId"
                                        }
                                      }
                                    },
                                    "visible": {
                                      "$active-user-has-permission": {
                                        "permission": "user.view.active"
                                      }
                                    }
                                  }
                                }
                              },
                              "name": {
                                "type": "string",
                                "model": false,
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "viewedValue": {
                                      "$from-context": {
                                        "path": "$rowData.fullName"
                                      }
                                    },
                                    "visible": {
                                      "$not": {
                                        "data": {
                                          "$active-user-has-permission": {
                                            "permission": "user.view.active"
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "phone": {
                                "type": "string",
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "viewedValue": {
                                      "$from-context": {
                                        "path": "$rowData.phoneView"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "actions_column": {
                            "type": "object",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Действия"
                              },
                              "class": {
                                "cell": "column_actions"
                              }
                            },
                            "properties": {
                              "actions": {
                                "widget": {
                                  "name": "button",
                                  "options": {
                                    "icon": "icon-trashbin"
                                  },
                                  "events": {
                                    "click": {
                                      "$collection": {
                                        "action": "row-remove"
                                      }
                                    }
                                  },
                                  "class": {
                                    "group": "p-autolayout p-jc-center",
                                    "value": "button_icon button_icon-shaded"
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "value": {
                        "$if": {
                          "condition": {
                            "$not-empty": {
                              "data": {
                                "$from-context": {
                                  "path": "@preload.event.curators"
                                }
                              }
                            }
                          },
                          "then": {
                            "$array-pluck": {
                              "array": {
                                "$from-context": {
                                  "path": "@preload.event.curators"
                                }
                              },
                              "key": "user"
                            }
                          },
                          "else": []
                        }
                      }
                    }
                  }
                }
              }
            },
            "workingHours": {
              "type": "object",
              "model": false,
              "widget": {
                "key": "workingHours",
                "name": "tab-panel",
                "options": {
                  "label": "График работы"
                }
              },
              "properties": {
                "eventWorkingHours": {
                  "type": "object",
                  "model": "#data.workingHours",
                  "value": {
                    "$json-model": {
                      "data": {
                        "$from-context": {
                          "path": "@preload.event"
                        }
                      },
                      "alias": "#data.workingHours"
                    }
                  },
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "График работы мероприятия"
                    },
                    "class": {
                      "label": "h2 mrg-b-md"
                    }
                  },
                  "properties": {
                    "installationStart": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Начало монтажных работ"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "#data.workingHours.installationEnd"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Поле обязательно для заполнения, так как указана дата завершения монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "installationEnd": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Завершение монтажных работ"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "#data.workingHours.installationStart"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Поле обязательно для заполнения, так как указана дата начала монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.installationStart",
                            "message": "Указанная дата должна быть больше даты начала монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">": {
                                    "operand1": {
                                      "$apply-func": {
                                        "func": "var d = new Date(dt);d.setMinutes(d.getMinutes() - 30);return d;",
                                        "args": {
                                          "dt": {
                                            "$date-format": {
                                              "template": "YYYY-MM-DD HH:mm",
                                              "nameZone": "ETC/GMT+0",
                                              "value": {
                                                "$date-from": {
                                                  "data": {
                                                    "$var": {
                                                      "path": "."
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "operand2": {
                                      "$date-from": {
                                        "data": {
                                          "$date-format": {
                                            "template": "YYYY-MM-DD HH:mm",
                                            "nameZone": "ETC/GMT+0",
                                            "value": {
                                              "$date-from": {
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.workingHours.installationStart"
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Время монтажных работ должно быть более 30 минут"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "eventStart": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Начало мероприятия"
                        },
                        "kind": "calendar-dropdown-input-required-style-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Поле обязательно для заполнения"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.installationEnd",
                            "message": "Указанная дата должна быть больше даты завершения монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.installationStart",
                            "message": "Указанная дата должна быть больше даты начала монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "eventEnd": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Завершение мероприятия"
                        },
                        "kind": "calendar-dropdown-input-required-style-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$not-empty": {
                                "data": {
                                  "$var": {
                                    "path": "."
                                  }
                                }
                              }
                            },
                            "message": "Поле обязательно для заполнения"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.eventStart",
                            "message": "Указанная дата должна быть больше даты начала мероприятия"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.installationEnd",
                            "message": "Указанная дата должна быть больше даты завершения монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.installationStart",
                            "message": "Указанная дата должна быть больше даты начала монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">": {
                                    "operand1": {
                                      "$apply-func": {
                                        "func": "var d = new Date(dt);d.setMinutes(d.getMinutes() - 30);return d;",
                                        "args": {
                                          "dt": {
                                            "$date-format": {
                                              "template": "YYYY-MM-DD HH:mm",
                                              "nameZone": "ETC/GMT+0",
                                              "value": {
                                                "$date-from": {
                                                  "data": {
                                                    "$var": {
                                                      "path": "."
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "operand2": {
                                      "$date-from": {
                                        "data": {
                                          "$date-format": {
                                            "template": "YYYY-MM-DD HH:mm",
                                            "nameZone": "ETC/GMT+0",
                                            "value": {
                                              "$date-from": {
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.workingHours.eventStart"
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Время проведения мероприятия должно быть более 30 минут"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "deinstallationStart": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Начало демонтажных работ"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "#data.workingHours.deinstallationEnd"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Поле обязательно для заполнения, так как указана дата завершения демонтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.eventEnd",
                            "message": "Указанная дата должна быть больше даты завершения мероприятия"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.eventStart",
                            "message": "Указанная дата должна быть больше даты начала мероприятия"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.installationEnd",
                            "message": "Указанная дата должна быть больше даты завершения монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.installationStart",
                            "message": "Указанная дата должна быть больше даты начала монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "deinstallationEnd": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Завершение демонтажных работ"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "#data.workingHours.deinstallationStart"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Поле обязательно для заполнения, так как указана дата начала демонтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.deinstallationStart",
                            "message": "Указанная дата должна быть больше даты начала демонтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.eventEnd",
                            "message": "Указанная дата должна быть больше даты завершения мероприятия"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.eventStart",
                            "message": "Указанная дата должна быть больше даты начала мероприятия"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.installationEnd",
                            "message": "Указанная дата должна быть больше даты завершения монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": "$ref:rule-validation:snippets/validation/checks/datetime_greater_datetime@@#data.workingHours.installationStart",
                            "message": "Указанная дата должна быть больше даты начала монтажных работ"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        },
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$var": {
                                        "path": "."
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  ">": {
                                    "operand1": {
                                      "$apply-func": {
                                        "func": "var d = new Date(dt);d.setMinutes(d.getMinutes() - 30);return d;",
                                        "args": {
                                          "dt": {
                                            "$date-format": {
                                              "template": "YYYY-MM-DD HH:mm",
                                              "nameZone": "ETC/GMT+0",
                                              "value": {
                                                "$date-from": {
                                                  "data": {
                                                    "$var": {
                                                      "path": "."
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "operand2": {
                                      "$date-from": {
                                        "data": {
                                          "$date-format": {
                                            "template": "YYYY-MM-DD HH:mm",
                                            "nameZone": "ETC/GMT+0",
                                            "value": {
                                              "$date-from": {
                                                "data": {
                                                  "$var": {
                                                    "path": "#data.workingHours.deinstallationStart"
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Время демонтажных работ должно быть более 30 минут"
                          },
                          "events": [
                            "onBackend",
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "arrival": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Заезд участников"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      }
                    },
                    "secondImport": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Дозавоз"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      }
                    },
                    "openingOfExhibition": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Открытие выставки для посетителей"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      }
                    },
                    "closingOfExhibition": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Закрытие выставки для посетителей"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      }
                    },
                    "departure": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Выход участников из павильона"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      }
                    },
                    "departureOnLastDay": {
                      "type": "datetime",
                      "widget": {
                        "name": "calendar",
                        "options": {
                          "label": "Выход из павильона в последний день"
                        },
                        "kind": "calendar-dropdown-input-style-active-user-timezone-offset"
                      }
                    }
                  }
                }
              }
            },
            "rent": {
              "type": "object",
              "model": false,
              "widget": {
                "key": "rent",
                "name": "tab-panel",
                "options": {
                  "label": "Аренда"
                }
              },
              "properties": {
                "selectedCount": {
                  "type": "number",
                  "widget": "hidden",
                  "model": "#selectedCount",
                  "value": 0
                },
                "bookingsData": {
                  "type": "array",
                  "widget": "hidden",
                  "model": "#bookingsData",
                  "value": {
                    "$array-map": {
                      "array": {
                        "$json-model": {
                          "alias": "#bookingsData",
                          "data": {
                            "$from-context": {
                              "path": "$response.body.data.pagination.items",
                              "data": {
                                "$api-data": {
                                  "options": {
                                    "observe": "response"
                                  },
                                  "query": "booking/list",
                                  "id": {
                                    "$query-params": {
                                      "name": "id"
                                    }
                                  },
                                  "variables": {
                                    "eventId": {
                                      "$query-params": {
                                        "name": "id"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "map": {
                        "$if": {
                          "condition": {
                            ">": {
                              "operand1": {
                                "$length": {
                                  "data": {
                                    "$from-context": {
                                      "path": "$data.rooms"
                                    }
                                  }
                                }
                              },
                              "operand2": 1
                            }
                          },
                          "then": {
                            "$from-context": {
                              "path": "$data"
                            }
                          },
                          "else": {
                            "$exclude": {
                              "data": {
                                "$assign-object": {
                                  "path": "bookingRoom",
                                  "data": {
                                    "$from-context": {
                                      "path": "$data.rooms.0.room"
                                    }
                                  },
                                  "object": {
                                    "$from-context": {
                                      "path": "$data"
                                    }
                                  }
                                }
                              },
                              "exclude": [
                                "rooms"
                              ]
                            }
                          }
                        }
                      }
                    }
                  },
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "widget": "hidden"
                      },
                      "rowNumber": {
                        "type": "string"
                      },
                      "selected": {
                        "type": "boolean"
                      },
                      "name": {
                        "type": "string"
                      },
                      "maxDate": {
                        "type": "datetime"
                      },
                      "minDate": {
                        "type": "datetime"
                      },
                      "configuration": {
                        "type": "boolean"
                      },
                      "allSquare": {
                        "type": "number"
                      },
                      "numberOfPeople": {
                        "type": "number"
                      },
                      "allPrice": {
                        "type": "number"
                      },
                      "allPriceWithDiscountOrMarkup": {
                        "type": "number"
                      },
                      "comment": {
                        "type": "string"
                      },
                      "state": {
                        "type": "string"
                      },
                      "installationDates": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "day": {
                              "type": "datetime"
                            },
                            "startTime": {
                              "type": "datetime"
                            },
                            "endTime": {
                              "type": "datetime"
                            }
                          }
                        }
                      },
                      "eventsDates": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "day": {
                              "type": "datetime"
                            },
                            "startTime": {
                              "type": "datetime"
                            },
                            "endTime": {
                              "type": "datetime"
                            }
                          }
                        }
                      },
                      "deinstallationDates": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "day": {
                              "type": "datetime"
                            },
                            "startTime": {
                              "type": "datetime"
                            },
                            "endTime": {
                              "type": "datetime"
                            }
                          }
                        }
                      },
                      "rooms": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "rowNumber": {
                              "type": "string"
                            },
                            "roomId": {
                              "type": "string"
                            },
                            "room": {
                              "type": "object",
                              "properties": {
                                "_id": {
                                  "type": "string"
                                },
                                "name": {
                                  "type": "string"
                                },
                                "type": {
                                  "type": "string"
                                },
                                "configuration": {
                                  "type": "boolean"
                                }
                              }
                            }
                          }
                        }
                      },
                      "bookingRoom": {
                        "type": "object",
                        "properties": {
                          "_id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string"
                          },
                          "configuration": {
                            "type": "boolean"
                          }
                        }
                      },
                      "actions": {
                        "type": "any",
                        "items": {
                          "type": "object",
                          "properties": {
                            "title": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "bookings": {
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "model": false,
                    "class": {
                      "label": "h2 mrg-b-md"
                    }
                  },
                  "properties": {
                    "header-with-button": {
                      "type": "object",
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Помещения"
                        },
                        "class": {
                          "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                          "label": "h2 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 pdd-r-lg mrg-md-b-md",
                          "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0 p-ai-center p-flex-row"
                        }
                      },
                      "properties": {
                        "button": {
                          "widget": {
                            "name": "button",
                            "options": {
                              "icon": "icon-plus",
                              "label": "Добавить помещения",
                              "visible": {
                                "$active-user-has-permission": {
                                  "permission": "event.edit"
                                }
                              }
                            },
                            "events": {
                              "click": {
                                "$if": {
                                  "condition": {
                                    "$and": {
                                      "operands": [
                                        {
                                          "$validate": {
                                            "path": "#data.commonInfo"
                                          }
                                        },
                                        {
                                          "$validate": {
                                            "path": "#data.workingHours"
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  "then": {
                                    "$if": {
                                      "condition": {
                                        "===": {
                                          "operand1": {
                                            "$fetch-object": {
                                              "path": "code",
                                              "data": {
                                                "$workflow-object-state": {
                                                  "workflow": "event",
                                                  "objectId": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "operand2": "new"
                                        }
                                      },
                                      "then": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$api-workflow": {
                                                "type": "post",
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "workflow": "event",
                                                "action": "to_draft",
                                                "data": {
                                                  "$var": {
                                                    "path": "#data"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#selectRoomsVisible",
                                                "data": true
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "else": {
                                        "$if": {
                                          "condition": {
                                            "===": {
                                              "operand1": {
                                                "$fetch-object": {
                                                  "path": "code",
                                                  "data": {
                                                    "$workflow-object-state": {
                                                      "workflow": "event",
                                                      "objectId": {
                                                        "$query-params": {
                                                          "name": "id"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              },
                                              "operand2": {
                                                "$from-context": {
                                                  "path": "@preload.event.state"
                                                }
                                              }
                                            }
                                          },
                                          "then": {
                                            "$waterfall": {
                                              "arrayFunctions": [
                                                {
                                                  "$populate": {
                                                    "path": "#selectRoomsVisible",
                                                    "data": true
                                                  }
                                                },
                                                {
                                                  "$element-option": {
                                                    "path": "#selectorRooms",
                                                    "option": "selection",
                                                    "value": {
                                                      "$array-pluck": {
                                                        "array": {
                                                          "$apply-func": {
                                                            "func": "let mergedRooms = []; arr.forEach(item => { item.rooms.forEach(room => { if (room.room.state === \"active\" ) { mergedRooms.push({roomId: room.roomId}); } }); }); return mergedRooms;",
                                                            "args": {
                                                              "arr": {
                                                                "$from-context": {
                                                                  "path": "$response.body.data.pagination.items",
                                                                  "data": {
                                                                    "$api-data": {
                                                                      "options": {
                                                                        "observe": "response"
                                                                      },
                                                                      "query": "booking/list",
                                                                      "id": {
                                                                        "$query-params": {
                                                                          "name": "id"
                                                                        }
                                                                      },
                                                                      "variables": {
                                                                        "eventId": {
                                                                          "$query-params": {
                                                                            "name": "id"
                                                                          }
                                                                        }
                                                                      }
                                                                    }
                                                                  }
                                                                }
                                                              }
                                                            }
                                                          }
                                                        },
                                                        "key": "roomId"
                                                      }
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          "else": {
                                            "$if": {
                                              "condition": {
                                                "$var": {
                                                  "path": "#data.addServiceFlag"
                                                }
                                              },
                                              "then": {
                                                "$waterfall": {
                                                  "arrayFunctions": [
                                                    {
                                                      "$populate": {
                                                        "path": "#selectRoomsVisible",
                                                        "data": true
                                                      }
                                                    }
                                                  ]
                                                }
                                              },
                                              "else": {
                                                "$waterfall": {
                                                  "arrayFunctions": [
                                                    {
                                                      "$populate": {
                                                        "path": "#selectRoomsVisible",
                                                        "data": true
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "else": {
                                    "$message": {
                                      "severity": "error",
                                      "summary": "Сохранение мероприятия",
                                      "detail": "Перед добавлением помещений заполните обязательные поля"
                                    }
                                  }
                                }
                              }
                            },
                            "class": {
                              "group": "p-jc-start p-xs-3 p-xl-3",
                              "value": "button_link p-autolayout"
                            }
                          }
                        },
                        "group": {
                          "widget": {
                            "name": "button",
                            "options": {
                              "label": "Объединить в группу",
                              "disabled": {
                                "<": {
                                  "operand1": {
                                    "$subs": {
                                      "path": "#selectedCount"
                                    }
                                  },
                                  "operand2": 2
                                }
                              }
                            },
                            "events": {
                              "click": {
                                "$confirmation": {
                                  "header": "Подтверждение объединения в группу",
                                  "message": "Вы действительно хотите объединить в группу выбранные брони помещений? После объединения будет удалено прикрепленное к помещениям оснащение",
                                  "accept": [
                                    {
                                      "$waterfall": {
                                        "arrayFunctions": [
                                          {
                                            "$element-option": {
                                              "option": "disabled",
                                              "value": true
                                            }
                                          },
                                          {
                                            "$element-option": {
                                              "option": "loading",
                                              "value": true
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "$http-code": {
                                        "200": [
                                          {
                                            "$message": {
                                              "severity": "success",
                                              "summary": "Объединение броней помещений",
                                              "detail": "Брони помещений успешно объединены"
                                            }
                                          },
                                          {
                                            "$event-bus-publish": {
                                              "type": "reload-table"
                                            }
                                          }
                                        ],
                                        "422": [
                                          {
                                            "$waterfall": {
                                              "arrayFunctions": [
                                                {
                                                  "$element-option": {
                                                    "option": "disabled",
                                                    "value": false
                                                  }
                                                },
                                                {
                                                  "$element-option": {
                                                    "option": "loading",
                                                    "value": false
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "$validate": {
                                              "errors": {
                                                "$from-context": {
                                                  "path": "$response.error.errors"
                                                }
                                              }
                                            }
                                          }
                                        ],
                                        "client": {
                                          "$api-workflow": {
                                            "data": {
                                              "bookingIds": {
                                                "$array-map": {
                                                  "array": {
                                                    "$array-filter": {
                                                      "array": {
                                                        "$var": {
                                                          "path": "#bookingsData"
                                                        }
                                                      },
                                                      "filter": {
                                                        "===": {
                                                          "operand1": {
                                                            "$from-context": {
                                                              "path": "$data.selected"
                                                            }
                                                          },
                                                          "operand2": true
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "map": {
                                                    "$from-context": {
                                                      "path": "$data.id"
                                                    }
                                                  }
                                                }
                                              },
                                              "eventId": {
                                                "$query-params": {
                                                  "name": "id"
                                                }
                                              }
                                            },
                                            "type": "post",
                                            "workflow": "booking",
                                            "action": "group",
                                            "options": {
                                              "observe": "response"
                                            }
                                          }
                                        },
                                        "default": [
                                          {
                                            "$waterfall": {
                                              "arrayFunctions": [
                                                {
                                                  "$element-option": {
                                                    "option": "disabled",
                                                    "value": false
                                                  }
                                                },
                                                {
                                                  "$element-option": {
                                                    "option": "loading",
                                                    "value": false
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          {
                                            "$message": {
                                              "severity": "error",
                                              "summary": "Запрос на открытие доступа",
                                              "detail": "Непредвиденная ошибка"
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "$waterfall": {
                                        "arrayFunctions": [
                                          {
                                            "$element-option": {
                                              "option": "disabled",
                                              "value": false
                                            }
                                          },
                                          {
                                            "$element-option": {
                                              "option": "loading",
                                              "value": false
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "$event-bus-publish": {
                                        "type": "reload-table"
                                      }
                                    }
                                  ],
                                  "acceptLabel": "Объединить",
                                  "rejectLabel": "Отмена",
                                  "rejectButtonStyleClass": "button_outline",
                                  "reject": false,
                                  "reloadTable": true
                                }
                              }
                            },
                            "class": {
                              "group": {
                                "$if": {
                                  "condition": {
                                    "$active-user-has-permission": {
                                      "permission": "event.edit"
                                    }
                                  },
                                  "then": "p-autolayout p-jc-end p-xs-9 p-xl-9",
                                  "else": "p-autolayout p-jc-end p-xs-12 p-xl-12"
                                }
                              },
                              "value": "p-jc-xl-end"
                            }
                          }
                        }
                      }
                    },
                    "bookings": {
                      "type": "any",
                      "model": "#data.bookings",
                      "value": {
                        "$subs": {
                          "path": "#bookingsData"
                        }
                      },
                      "widget": {
                        "name": "tree-table",
                        "options": {
                          "childrenKey": "rooms",
                          "nodeAsData": true
                        },
                        "subscriptions": {
                          "reload-table": [
                            {
                              "$populate": {
                                "path": "#bookingsData",
                                "data": {
                                  "$array-map": {
                                    "array": {
                                      "$json-model": {
                                        "alias": "#bookingsData",
                                        "data": {
                                          "$from-context": {
                                            "path": "$response.body.data.pagination.items",
                                            "data": {
                                              "$api-data": {
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "query": "booking/list",
                                                "id": {
                                                  "$query-params": {
                                                    "name": "id"
                                                  }
                                                },
                                                "variables": {
                                                  "eventId": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "map": {
                                      "$if": {
                                        "condition": {
                                          ">": {
                                            "operand1": {
                                              "$length": {
                                                "data": {
                                                  "$from-context": {
                                                    "path": "$data.rooms"
                                                  }
                                                }
                                              }
                                            },
                                            "operand2": 1
                                          }
                                        },
                                        "then": {
                                          "$from-context": {
                                            "path": "$data"
                                          }
                                        },
                                        "else": {
                                          "$exclude": {
                                            "data": {
                                              "$assign-object": {
                                                "path": "bookingRoom",
                                                "data": {
                                                  "$from-context": {
                                                    "path": "$data.rooms.0.room"
                                                  }
                                                },
                                                "object": {
                                                  "$from-context": {
                                                    "path": "$data"
                                                  }
                                                }
                                              }
                                            },
                                            "exclude": [
                                              "rooms"
                                            ]
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "$populate": {
                                "path": "#selectedCount",
                                "data": 0
                              }
                            }
                          ]
                        },
                        "class": {
                          "togglerWrapper": "p-grid p-nogutter p-autolayout p-jc-center pdd-tb-0 pdd-lr-0 mrg-tb-0 mrg-lr-0",
                          "group": "form-item p-field p-grid",
                          "rootItemsRow": "treetable__node_root_background"
                        },
                        "columns": {
                          "selected": {
                            "type": "string",
                            "widget": {
                              "name": "info",
                              "class": {
                                "value": "p-jc-center"
                              }
                            },
                            "value": "Выбрать"
                          },
                          "rowNumber": {
                            "type": "string",
                            "widget": "info",
                            "value": "№"
                          },
                          "name": {
                            "type": "string",
                            "widget": "info",
                            "value": "Помещение"
                          },
                          "bookingPeriod": "Период бронирования",
                          "allSquare": "Бронируемая площадь (м²)",
                          "numberOfPeople": "Количество человек",
                          "priceView": "Общая стоимость (руб.)",
                          "comment": "Комментарий",
                          "status": "Статус",
                          "actions": {
                            "type": "string",
                            "widget": {
                              "name": "info",
                              "class": {
                                "value": "p-jc-center"
                              }
                            },
                            "value": "Действия"
                          }
                        },
                        "items": {
                          "id": {
                            "type": "string",
                            "widget": "hidden"
                          },
                          "selected": {
                            "type": "boolean",
                            "widget": {
                              "name": "checkbox",
                              "options": {
                                "optionLabel": "",
                                "visible": {
                                  "===": {
                                    "operand1": {
                                      "$from-context": {
                                        "path": "$tree.node.bookingRoom.configuration"
                                      }
                                    },
                                    "operand2": true
                                  }
                                }
                              },
                              "events": {
                                "change": {
                                  "$if": {
                                    "condition": {
                                      "===": {
                                        "operand1": {
                                          "$var": {
                                            "path": "."
                                          }
                                        },
                                        "operand2": true
                                      }
                                    },
                                    "then": {
                                      "$waterfall": {
                                        "arrayFunctions": [
                                          {
                                            "$populate": {
                                              "path": {
                                                "$replace": {
                                                  "template": "#bookingsData.{{index}}.selected",
                                                  "data": {
                                                    "index": {
                                                      "$from-context": {
                                                        "path": "$tree.index"
                                                      }
                                                    }
                                                  }
                                                }
                                              },
                                              "data": true
                                            }
                                          },
                                          {
                                            "$populate": {
                                              "path": "#selectedCount",
                                              "data": {
                                                "$sum": {
                                                  "terms": [
                                                    {
                                                      "$var": {
                                                        "path": "#selectedCount"
                                                      }
                                                    },
                                                    1
                                                  ]
                                                }
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "else": {
                                      "$waterfall": {
                                        "arrayFunctions": [
                                          {
                                            "$populate": {
                                              "path": {
                                                "$replace": {
                                                  "template": "#bookingsData.{{index}}.selected",
                                                  "data": {
                                                    "index": {
                                                      "$from-context": {
                                                        "path": "$tree.index"
                                                      }
                                                    }
                                                  }
                                                }
                                              },
                                              "data": false
                                            }
                                          },
                                          {
                                            "$populate": {
                                              "path": "#selectedCount",
                                              "data": {
                                                "$subtract": {
                                                  "operand1": {
                                                    "$var": {
                                                      "path": "#selectedCount"
                                                    }
                                                  },
                                                  "operand2": 1
                                                }
                                              }
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  }
                                }
                              },
                              "class": {
                                "group": "p-autolayout p-jc-center p-ai-center mrg-l-xs"
                              }
                            }
                          },
                          "rowNumber": {
                            "type": "string",
                            "widget": {
                              "name": "info"
                            },
                            "value": {
                              "$if": {
                                "condition": {
                                  "$empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$tree.node.id"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$apply-func": {
                                    "func": "const cleanedInput = input.replace(/[/[]/g, ''); const numbers = cleanedInput.split(']'); const transformedNumbers = numbers.map(num => parseInt(num, 10) + 1); const result = `${transformedNumbers[0]}.${transformedNumbers[1]}`; return result;",
                                    "args": {
                                      "input": {
                                        "$from-context": {
                                          "path": "$tree.node.path"
                                        }
                                      }
                                    }
                                  }
                                },
                                "else": {
                                  "$sum": {
                                    "terms": [
                                      {
                                        "$from-context": {
                                          "path": "$tree.index"
                                        }
                                      },
                                      1
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          "roomId": {
                            "type": "string",
                            "widget": "hidden"
                          },
                          "name": {
                            "type": "string",
                            "widget": {
                              "name": "info"
                            },
                            "value": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$tree.node.id"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$from-context": {
                                    "path": "$tree.node.name"
                                  }
                                },
                                "else": {
                                  "$from-context": {
                                    "path": "$tree.node.room.name"
                                  }
                                }
                              }
                            }
                          },
                          "minDate": {
                            "type": "datetime",
                            "widget": "hidden"
                          },
                          "maxDate": {
                            "type": "datetime",
                            "widget": "hidden"
                          },
                          "bookingPeriod": {
                            "type": "string",
                            "widget": "info",
                            "value": {
                              "$replace": {
                                "template": "{{minDate}} - {{maxDate}}",
                                "data": {
                                  "minDate": {
                                    "$if": {
                                      "condition": {
                                        "$not-empty": {
                                          "data": {
                                            "$from-context": {
                                              "path": "$tree.node.minDate"
                                            }
                                          }
                                        }
                                      },
                                      "then": {
                                        "$formatter": {
                                          "format": "datetime:\"DD.MM.YYYY HH:mm\"",
                                          "data": {
                                            "$from-context": {
                                              "path": "$tree.node.minDate"
                                            }
                                          }
                                        }
                                      },
                                      "else": ""
                                    }
                                  },
                                  "maxDate": {
                                    "$if": {
                                      "condition": {
                                        "$not-empty": {
                                          "data": {
                                            "$from-context": {
                                              "path": "$tree.node.maxDate"
                                            }
                                          }
                                        }
                                      },
                                      "then": {
                                        "$formatter": {
                                          "format": "datetime:\"DD.MM.YYYY HH:mm\"",
                                          "data": {
                                            "$from-context": {
                                              "path": "$tree.node.maxDate"
                                            }
                                          }
                                        }
                                      },
                                      "else": ""
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "allSquare": {
                            "type": "number",
                            "widget": {
                              "name": "info",
                              "options": {
                                "formatter": "number:'0.2-2':'ru'"
                              },
                              "class": {
                                "value": "p-jc-end"
                              }
                            }
                          },
                          "numberOfPeople": {
                            "type": "string",
                            "widget": {
                              "name": "info",
                              "class": {
                                "value": "p-jc-end"
                              }
                            }
                          },
                          "allPrice": {
                            "type": "number",
                            "widget": {
                              "name": "info"
                            }
                          },
                          "allPriceWithDiscountOrMarkup": {
                            "type": "number",
                            "widget": {
                              "name": "info"
                            }
                          },
                          "priceView": {
                            "type": "string",
                            "widget": {
                              "name": "info",
                              "options": {
                                "formatter": "number:'0.2-2':'ru'"
                              },
                              "class": {
                                "value": "p-jc-end"
                              }
                            },
                            "value": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "$tree.node.allPriceWithDiscountOrMarkup"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "$from-context": {
                                    "path": "$tree.node.allPriceWithDiscountOrMarkup"
                                  }
                                },
                                "else": {
                                  "$from-context": {
                                    "path": "$tree.node.allPrice"
                                  }
                                }
                              }
                            }
                          },
                          "comment": {
                            "type": "string",
                            "widget": "info"
                          },
                          "state": {
                            "type": "string",
                            "widget": "info"
                          },
                          "status": {
                            "type": "string",
                            "value": {
                              "$from-context": {
                                "path": "$tree.node.state"
                              }
                            },
                            "widget": {
                              "name": "badge",
                              "options": {
                                "defaultLabel": "",
                                "displayMapping": [
                                  {
                                    "color": "badge_active",
                                    "label": "Заполнено",
                                    "value": "filled"
                                  },
                                  {
                                    "color": "badge_error",
                                    "label": "Не заполнено",
                                    "value": "not_filled"
                                  }
                                ]
                              }
                            }
                          },
                          "seatingType": {
                            "type": "string",
                            "widget": "hidden"
                          },
                          "actions": {
                            "type": "any",
                            "widget": {
                              "name": "menu-button",
                              "options": {
                                "tableMode": false,
                                "labelKey": "title"
                              },
                              "class": {
                                "toggle": "actions-button actions-button_darker",
                                "value": "p-jc-center"
                              },
                              "items": [
                                {
                                  "title": "Редактировать",
                                  "visible": {
                                    "$not-empty": {
                                      "data": {
                                        "$from-context": {
                                          "path": "$tree.node.id"
                                        }
                                      }
                                    }
                                  },
                                  "command": {
                                    "$go": {
                                      "workflow": "booking",
                                      "action": "edit",
                                      "id": {
                                        "$from-context": {
                                          "path": "$tree.node.id"
                                        }
                                      }
                                    }
                                  }
                                },
                                {
                                  "title": "Расформировать",
                                  "visible": {
                                    "===": {
                                      "operand1": {
                                        "$from-context": {
                                          "path": "$tree.node.configuration"
                                        }
                                      },
                                      "operand2": true
                                    }
                                  },
                                  "command": {
                                    "$confirmation": {
                                      "header": "Подтверждение расформирования",
                                      "message": "Вы действительно хотите расформировать конфигурацию помещений?",
                                      "accept": [
                                        {
                                          "$waterfall": {
                                            "arrayFunctions": [
                                              {
                                                "$element-option": {
                                                  "option": "disabled",
                                                  "value": true
                                                }
                                              },
                                              {
                                                "$element-option": {
                                                  "option": "loading",
                                                  "value": true
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "$http-code": {
                                            "200": [
                                              {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Расформирование конфигурации помещений",
                                                  "detail": "Конфигурация помещений успешно расформирована"
                                                }
                                              },
                                              {
                                                "$event-bus-publish": {
                                                  "type": "reload-table"
                                                }
                                              }
                                            ],
                                            "422": [
                                              {
                                                "$waterfall": {
                                                  "arrayFunctions": [
                                                    {
                                                      "$element-option": {
                                                        "option": "disabled",
                                                        "value": false
                                                      }
                                                    },
                                                    {
                                                      "$element-option": {
                                                        "option": "loading",
                                                        "value": false
                                                      }
                                                    }
                                                  ]
                                                }
                                              },
                                              {
                                                "$validate": {
                                                  "errors": {
                                                    "$from-context": {
                                                      "path": "$response.error.errors"
                                                    }
                                                  }
                                                }
                                              }
                                            ],
                                            "client": {
                                              "$api-workflow": {
                                                "data": {
                                                  "bookingId": {
                                                    "$from-context": {
                                                      "path": "$tree.node.id"
                                                    }
                                                  },
                                                  "eventId": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  }
                                                },
                                                "type": "post",
                                                "workflow": "booking",
                                                "action": "disband",
                                                "id": {
                                                  "$from-context": {
                                                    "path": "$tree.node.id"
                                                  }
                                                },
                                                "options": {
                                                  "observe": "response"
                                                }
                                              }
                                            },
                                            "default": [
                                              {
                                                "$waterfall": {
                                                  "arrayFunctions": [
                                                    {
                                                      "$element-option": {
                                                        "option": "disabled",
                                                        "value": false
                                                      }
                                                    },
                                                    {
                                                      "$element-option": {
                                                        "option": "loading",
                                                        "value": false
                                                      }
                                                    }
                                                  ]
                                                }
                                              },
                                              {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Запрос на открытие доступа",
                                                  "detail": "Непредвиденная ошибка"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "$waterfall": {
                                            "arrayFunctions": [
                                              {
                                                "$element-option": {
                                                  "option": "disabled",
                                                  "value": false
                                                }
                                              },
                                              {
                                                "$element-option": {
                                                  "option": "loading",
                                                  "value": false
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "$event-bus-publish": {
                                            "type": "reload-table"
                                          }
                                        }
                                      ],
                                      "acceptLabel": "Расформировать",
                                      "rejectLabel": "Отмена",
                                      "rejectButtonStyleClass": "button_outline",
                                      "reject": false,
                                      "reloadTable": true
                                    }
                                  }
                                },
                                {
                                  "title": "Удалить из группы",
                                  "visible": {
                                    "$empty": {
                                      "data": {
                                        "$from-context": {
                                          "path": "$tree.node.id"
                                        }
                                      }
                                    }
                                  },
                                  "command": {
                                    "$confirmation": {
                                      "header": "Подтверждение удаления из группы",
                                      "message": "Вы действительно хотите удалить помещение из группы?",
                                      "accept": [
                                        {
                                          "$waterfall": {
                                            "arrayFunctions": [
                                              {
                                                "$element-option": {
                                                  "option": "disabled",
                                                  "value": true
                                                }
                                              },
                                              {
                                                "$element-option": {
                                                  "option": "loading",
                                                  "value": true
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "$http-code": {
                                            "200": [
                                              {
                                                "$message": {
                                                  "severity": "success",
                                                  "summary": "Удаление помещения из группы",
                                                  "detail": "Помещение успешно удалено из группы"
                                                }
                                              },
                                              {
                                                "$event-bus-publish": {
                                                  "type": "reload-table"
                                                }
                                              }
                                            ],
                                            "422": [
                                              {
                                                "$waterfall": {
                                                  "arrayFunctions": [
                                                    {
                                                      "$element-option": {
                                                        "option": "disabled",
                                                        "value": false
                                                      }
                                                    },
                                                    {
                                                      "$element-option": {
                                                        "option": "loading",
                                                        "value": false
                                                      }
                                                    }
                                                  ]
                                                }
                                              },
                                              {
                                                "$validate": {
                                                  "errors": {
                                                    "$from-context": {
                                                      "path": "$response.error.errors"
                                                    }
                                                  }
                                                }
                                              }
                                            ],
                                            "client": {
                                              "$api-workflow": {
                                                "data": {
                                                  "bookingId": {
                                                    "$from-context": {
                                                      "path": "$tree.node.parent.id"
                                                    }
                                                  },
                                                  "roomId": {
                                                    "$from-context": {
                                                      "path": "$tree.node.room._id"
                                                    }
                                                  },
                                                  "eventId": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  }
                                                },
                                                "type": "post",
                                                "workflow": "booking",
                                                "action": "delete-from-group-with-transfer",
                                                "id": {
                                                  "$from-context": {
                                                    "path": "$tree.node.parent.id"
                                                  }
                                                },
                                                "options": {
                                                  "observe": "response"
                                                }
                                              }
                                            },
                                            "default": [
                                              {
                                                "$waterfall": {
                                                  "arrayFunctions": [
                                                    {
                                                      "$element-option": {
                                                        "option": "disabled",
                                                        "value": false
                                                      }
                                                    },
                                                    {
                                                      "$element-option": {
                                                        "option": "loading",
                                                        "value": false
                                                      }
                                                    }
                                                  ]
                                                }
                                              },
                                              {
                                                "$message": {
                                                  "severity": "error",
                                                  "summary": "Запрос на открытие доступа",
                                                  "detail": "Непредвиденная ошибка"
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "$waterfall": {
                                            "arrayFunctions": [
                                              {
                                                "$element-option": {
                                                  "option": "disabled",
                                                  "value": false
                                                }
                                              },
                                              {
                                                "$element-option": {
                                                  "option": "loading",
                                                  "value": false
                                                }
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "$event-bus-publish": {
                                            "type": "reload-table"
                                          }
                                        }
                                      ],
                                      "acceptLabel": "Удалить",
                                      "rejectLabel": "Отмена",
                                      "rejectButtonStyleClass": "button_outline",
                                      "reject": false,
                                      "reloadTable": true
                                    }
                                  }
                                },
                                {
                                  "title": "Удалить",
                                  "command": {
                                    "$if": {
                                      "condition": {
                                        "$empty": {
                                          "data": {
                                            "$from-context": {
                                              "path": "$tree.node.id"
                                            }
                                          }
                                        }
                                      },
                                      "then": {
                                        "$confirmation": {
                                          "header": "Подтверждение удаления",
                                          "message": "Вы действительно хотите удалить помещение?",
                                          "accept": [
                                            {
                                              "$waterfall": {
                                                "arrayFunctions": [
                                                  {
                                                    "$element-option": {
                                                      "option": "disabled",
                                                      "value": true
                                                    }
                                                  },
                                                  {
                                                    "$element-option": {
                                                      "option": "loading",
                                                      "value": true
                                                    }
                                                  }
                                                ]
                                              }
                                            },
                                            {
                                              "$http-code": {
                                                "200": [
                                                  {
                                                    "$message": {
                                                      "severity": "success",
                                                      "summary": "Удаление помещения",
                                                      "detail": "Помещение успешно удалено"
                                                    }
                                                  },
                                                  {
                                                    "$event-bus-publish": {
                                                      "type": "reload-table"
                                                    }
                                                  }
                                                ],
                                                "422": [
                                                  {
                                                    "$waterfall": {
                                                      "arrayFunctions": [
                                                        {
                                                          "$element-option": {
                                                            "option": "disabled",
                                                            "value": false
                                                          }
                                                        },
                                                        {
                                                          "$element-option": {
                                                            "option": "loading",
                                                            "value": false
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "$validate": {
                                                      "errors": {
                                                        "$from-context": {
                                                          "path": "$response.error.errors"
                                                        }
                                                      }
                                                    }
                                                  }
                                                ],
                                                "client": {
                                                  "$api-workflow": {
                                                    "data": {
                                                      "bookingId": {
                                                        "$from-context": {
                                                          "path": "$tree.node.parent.id"
                                                        }
                                                      },
                                                      "roomId": {
                                                        "$from-context": {
                                                          "path": "$tree.node.room._id"
                                                        }
                                                      },
                                                      "eventId": {
                                                        "$query-params": {
                                                          "name": "id"
                                                        }
                                                      }
                                                    },
                                                    "type": "post",
                                                    "workflow": "booking",
                                                    "action": "delete-from-group",
                                                    "id": {
                                                      "$from-context": {
                                                        "path": "$tree.node.parent.id"
                                                      }
                                                    },
                                                    "options": {
                                                      "observe": "response"
                                                    }
                                                  }
                                                },
                                                "default": [
                                                  {
                                                    "$waterfall": {
                                                      "arrayFunctions": [
                                                        {
                                                          "$element-option": {
                                                            "option": "disabled",
                                                            "value": false
                                                          }
                                                        },
                                                        {
                                                          "$element-option": {
                                                            "option": "loading",
                                                            "value": false
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "$message": {
                                                      "severity": "error",
                                                      "summary": "Запрос на открытие доступа",
                                                      "detail": "Непредвиденная ошибка"
                                                    }
                                                  }
                                                ]
                                              }
                                            },
                                            {
                                              "$waterfall": {
                                                "arrayFunctions": [
                                                  {
                                                    "$element-option": {
                                                      "option": "disabled",
                                                      "value": false
                                                    }
                                                  },
                                                  {
                                                    "$element-option": {
                                                      "option": "loading",
                                                      "value": false
                                                    }
                                                  }
                                                ]
                                              }
                                            },
                                            {
                                              "$event-bus-publish": {
                                                "type": "reload-table"
                                              }
                                            }
                                          ],
                                          "acceptLabel": "Удалить",
                                          "rejectLabel": "Отмена",
                                          "rejectButtonStyleClass": "button_outline",
                                          "reject": false,
                                          "reloadTable": true
                                        }
                                      },
                                      "else": {
                                        "$if": {
                                          "condition": {
                                            "===": {
                                              "operand1": {
                                                "$from-context": {
                                                  "path": "$tree.node.configuration"
                                                }
                                              },
                                              "operand2": true
                                            }
                                          },
                                          "then": {
                                            "$confirmation": {
                                              "header": "Подтверждение удаления",
                                              "message": {
                                                "$replace": {
                                                  "template": "Вы действительно хотите удалить бронь конфигурации \"{{0}}\"? Все помещения, принадлежащие конфигурации, также будут удалены.",
                                                  "data": [
                                                    {
                                                      "$from-context": {
                                                        "path": "$tree.node.name"
                                                      }
                                                    }
                                                  ]
                                                }
                                              },
                                              "accept": [
                                                {
                                                  "$waterfall": {
                                                    "arrayFunctions": [
                                                      {
                                                        "$element-option": {
                                                          "option": "disabled",
                                                          "value": true
                                                        }
                                                      },
                                                      {
                                                        "$element-option": {
                                                          "option": "loading",
                                                          "value": true
                                                        }
                                                      }
                                                    ]
                                                  }
                                                },
                                                {
                                                  "$http-code": {
                                                    "200": [
                                                      {
                                                        "$message": {
                                                          "severity": "success",
                                                          "summary": "Удаление конфигурации помещений",
                                                          "detail": "Конфигурация помещений успешно удалена"
                                                        }
                                                      },
                                                      {
                                                        "$event-bus-publish": {
                                                          "type": "reload-table"
                                                        }
                                                      }
                                                    ],
                                                    "422": [
                                                      {
                                                        "$waterfall": {
                                                          "arrayFunctions": [
                                                            {
                                                              "$element-option": {
                                                                "option": "disabled",
                                                                "value": false
                                                              }
                                                            },
                                                            {
                                                              "$element-option": {
                                                                "option": "loading",
                                                                "value": false
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      },
                                                      {
                                                        "$validate": {
                                                          "errors": {
                                                            "$from-context": {
                                                              "path": "$response.error.errors"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    ],
                                                    "client": {
                                                      "$api-workflow": {
                                                        "data": {
                                                          "bookingId": {
                                                            "$from-context": {
                                                              "path": "$tree.node.id"
                                                            }
                                                          },
                                                          "eventId": {
                                                            "$query-params": {
                                                              "name": "id"
                                                            }
                                                          }
                                                        },
                                                        "type": "post",
                                                        "workflow": "booking",
                                                        "action": "delete-configuration",
                                                        "id": {
                                                          "$from-context": {
                                                            "path": "$tree.node.id"
                                                          }
                                                        },
                                                        "options": {
                                                          "observe": "response"
                                                        }
                                                      }
                                                    },
                                                    "default": [
                                                      {
                                                        "$waterfall": {
                                                          "arrayFunctions": [
                                                            {
                                                              "$element-option": {
                                                                "option": "disabled",
                                                                "value": false
                                                              }
                                                            },
                                                            {
                                                              "$element-option": {
                                                                "option": "loading",
                                                                "value": false
                                                              }
                                                            }
                                                          ]
                                                        }
                                                      },
                                                      {
                                                        "$message": {
                                                          "severity": "error",
                                                          "summary": "Запрос на открытие доступа",
                                                          "detail": "Непредвиденная ошибка"
                                                        }
                                                      }
                                                    ]
                                                  }
                                                },
                                                {
                                                  "$waterfall": {
                                                    "arrayFunctions": [
                                                      {
                                                        "$element-option": {
                                                          "option": "disabled",
                                                          "value": false
                                                        }
                                                      },
                                                      {
                                                        "$element-option": {
                                                          "option": "loading",
                                                          "value": false
                                                        }
                                                      }
                                                    ]
                                                  }
                                                },
                                                {
                                                  "$event-bus-publish": {
                                                    "type": "reload-table"
                                                  }
                                                }
                                              ],
                                              "acceptLabel": "Удалить",
                                              "rejectLabel": "Отмена",
                                              "rejectButtonStyleClass": "button_outline",
                                              "reject": false,
                                              "reloadTable": true
                                            }
                                          },
                                          "else": {
                                            "$open-popup": {
                                              "workflow": "booking",
                                              "action": "delete",
                                              "id": {
                                                "$from-context": {
                                                  "path": "$tree.node.id"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              ]
                            }
                          }
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$empty": {
                                "data": {
                                  "$array-filter": {
                                    "array": {
                                      "$var": {
                                        "path": "#bookingsData"
                                      }
                                    },
                                    "filter": {
                                      "!==": {
                                        "operand1": {
                                          "$from-context": {
                                            "path": "$data.state"
                                          }
                                        },
                                        "operand2": "filled"
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "message": "Необходимо заполнить все брони помещений"
                          },
                          "events": [
                            "onUpdate",
                            "onBackend"
                          ]
                        }
                      ]
                    }
                  }
                },
                "serviceList": {
                  "type": "object",
                  "model": false,
                  "widget": {
                    "name": "container"
                  },
                  "properties": {
                    "header-with-button": {
                      "type": "object",
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Дополнительные услуги к мероприятию"
                        },
                        "class": {
                          "group": "flex-row p-grid mrg-b-lg mrg-t-0",
                          "label": "h2 p-xs-12 p-md-4 p-xl-3 pdd-tb-0 pdd-r-lg mrg-md-b-md",
                          "value": "p-xs-12 p-md-8 p-xl-9 pdd-tb-0"
                        }
                      },
                      "properties": {
                        "button": {
                          "widget": {
                            "name": "button",
                            "model": "#serviceButton",
                            "options": {
                              "icon": "icon-plus",
                              "label": "Добавить услуги",
                              "visible": {
                                "$active-user-has-permission": {
                                  "permission": "event.edit"
                                }
                              }
                            },
                            "class": {
                              "value": "button_link"
                            },
                            "events": {
                              "click": {
                                "$if": {
                                  "condition": {
                                    "$and": {
                                      "operands": [
                                        {
                                          "$validate": {
                                            "path": "#data.commonInfo"
                                          }
                                        },
                                        {
                                          "$validate": {
                                            "path": "#data.workingHours"
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  "then": {
                                    "$if": {
                                      "condition": {
                                        "===": {
                                          "operand1": {
                                            "$fetch-object": {
                                              "path": "code",
                                              "data": {
                                                "$workflow-object-state": {
                                                  "workflow": "event",
                                                  "objectId": {
                                                    "$query-params": {
                                                      "name": "id"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "operand2": "new"
                                        }
                                      },
                                      "then": {
                                        "$waterfall": {
                                          "arrayFunctions": [
                                            {
                                              "$api-workflow": {
                                                "type": "post",
                                                "options": {
                                                  "observe": "response"
                                                },
                                                "workflow": "event",
                                                "action": "to_draft",
                                                "data": {
                                                  "$var": {
                                                    "path": "#data"
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#data.addServiceFlag",
                                                "data": true
                                              }
                                            },
                                            {
                                              "$populate": {
                                                "path": "#searchServices",
                                                "data": {}
                                              }
                                            },
                                            {
                                              "$element-event": {
                                                "event": "keypress-13",
                                                "path": "#searchServices.typeOrName",
                                                "value": true
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "option": "visible",
                                                "path": "#modalSelectServices",
                                                "value": true
                                              }
                                            },
                                            {
                                              "$element-option": {
                                                "path": "#selectorServices",
                                                "option": "selection",
                                                "value": {
                                                  "$array-pluck": {
                                                    "array": {
                                                      "$var": {
                                                        "path": "#data.services"
                                                      }
                                                    },
                                                    "key": "serviceId"
                                                  }
                                                }
                                              }
                                            }
                                          ]
                                        }
                                      },
                                      "else": {
                                        "$if": {
                                          "condition": {
                                            "===": {
                                              "operand1": {
                                                "$fetch-object": {
                                                  "path": "code",
                                                  "data": {
                                                    "$workflow-object-state": {
                                                      "workflow": "event",
                                                      "objectId": {
                                                        "$query-params": {
                                                          "name": "id"
                                                        }
                                                      }
                                                    }
                                                  }
                                                }
                                              },
                                              "operand2": {
                                                "$from-context": {
                                                  "path": "@preload.event.state"
                                                }
                                              }
                                            }
                                          },
                                          "then": {
                                            "$waterfall": {
                                              "arrayFunctions": [
                                                {
                                                  "$populate": {
                                                    "path": "#searchServices",
                                                    "data": {}
                                                  }
                                                },
                                                {
                                                  "$element-event": {
                                                    "event": "keypress-13",
                                                    "path": "#searchServices.typeOrName",
                                                    "value": true
                                                  }
                                                },
                                                {
                                                  "$element-option": {
                                                    "option": "visible",
                                                    "path": "#modalSelectServices",
                                                    "value": true
                                                  }
                                                },
                                                {
                                                  "$element-option": {
                                                    "path": "#selectorServices",
                                                    "option": "selection",
                                                    "value": {
                                                      "$array-pluck": {
                                                        "array": {
                                                          "$var": {
                                                            "path": "#data.services"
                                                          }
                                                        },
                                                        "key": "serviceId"
                                                      }
                                                    }
                                                  }
                                                }
                                              ]
                                            }
                                          },
                                          "else": {
                                            "$if": {
                                              "condition": {
                                                "$var": {
                                                  "path": "#data.addServiceFlag"
                                                }
                                              },
                                              "then": {
                                                "$waterfall": {
                                                  "arrayFunctions": [
                                                    {
                                                      "$populate": {
                                                        "path": "#searchServices",
                                                        "data": {}
                                                      }
                                                    },
                                                    {
                                                      "$element-event": {
                                                        "event": "keypress-13",
                                                        "path": "#searchServices.typeOrName",
                                                        "value": true
                                                      }
                                                    },
                                                    {
                                                      "$element-option": {
                                                        "option": "visible",
                                                        "path": "#modalSelectServices",
                                                        "value": true
                                                      }
                                                    },
                                                    {
                                                      "$element-option": {
                                                        "path": "#selectorServices",
                                                        "option": "selection",
                                                        "value": {
                                                          "$array-pluck": {
                                                            "array": {
                                                              "$var": {
                                                                "path": "#data.services"
                                                              }
                                                            },
                                                            "key": "serviceId"
                                                          }
                                                        }
                                                      }
                                                    },
                                                    {
                                                      "$populate": {
                                                        "path": "#selected-chips-service",
                                                        "data": {
                                                          "$array-pluck": {
                                                            "array": {
                                                              "$var": {
                                                                "path": "#data.services"
                                                              }
                                                            },
                                                            "key": "name"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              },
                                              "else": {
                                                "$waterfall": {
                                                  "arrayFunctions": [
                                                    {
                                                      "$populate": {
                                                        "path": "#searchServices",
                                                        "data": {}
                                                      }
                                                    },
                                                    {
                                                      "$element-event": {
                                                        "event": "keypress-13",
                                                        "path": "#searchServices.typeOrName",
                                                        "value": true
                                                      }
                                                    },
                                                    {
                                                      "$populate": {
                                                        "path": "#selected-chips-service",
                                                        "data": []
                                                      }
                                                    },
                                                    {
                                                      "$element-option": {
                                                        "option": "visible",
                                                        "path": "#modalSelectServices",
                                                        "value": true
                                                      }
                                                    },
                                                    {
                                                      "$populate": {
                                                        "path": "#selected-chips-service",
                                                        "data": {
                                                          "$array-pluck": {
                                                            "array": {
                                                              "$var": {
                                                                "path": "#data.services"
                                                              }
                                                            },
                                                            "key": "name"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  ]
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "else": {
                                    "$message": {
                                      "severity": "error",
                                      "summary": "Сохранение мероприятия",
                                      "detail": "Перед добавлением дополнительных услуг заполните обязательные поля"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "addServiceFlag": {
                      "type": "boolean",
                      "value": false,
                      "model": "#data.addServiceFlag",
                      "widget": {
                        "name": "hidden"
                      }
                    },
                    "services": {
                      "type": "array",
                      "model": "#data.services",
                      "value": {
                        "$api-table-workflow-data": {
                          "model": "#data.services",
                          "query": "additional_facilities/list",
                          "id": {
                            "$query-params": {
                              "name": "id"
                            }
                          },
                          "variables": {
                            "$assign-object": {
                              "object": {
                                "$graphql-event-variables": {
                                  "data": {
                                    "$element-event": {
                                      "event": "lazyLoad"
                                    }
                                  }
                                }
                              },
                              "data": {
                                "eventId": {
                                  "$query-params": {
                                    "name": "id"
                                  }
                                },
                                "facilityType": "additional_service"
                              },
                              "path": ""
                            }
                          },
                          "errors": {
                            "default": {
                              "$message": {
                                "severity": "error",
                                "summary": "Ошибка",
                                "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                              }
                            }
                          }
                        }
                      },
                      "widget": {
                        "name": "table-lazy",
                        "options": {
                          "emptyMessage": "Не добавлено информации для отображения",
                          "responsive": false,
                          "first": 0,
                          "rows": 10,
                          "lazy": true,
                          "paginator": true,
                          "rowsPerPageOptions": [
                            10,
                            20,
                            50
                          ],
                          "routerOptions": [
                            "first",
                            "rows"
                          ]
                        },
                        "class": {
                          "value": "data-table d-block mrg-b-lg"
                        },
                        "events": {
                          "lazyLoad": {
                            "$element-option": {
                              "path": "#data.services",
                              "option": "loading",
                              "value": true
                            }
                          }
                        },
                        "subscriptions": {
                          "reload-table": {
                            "$element-event": {
                              "event": "reload",
                              "value": true
                            }
                          },
                          "reload-service-table": {
                            "subscriber": "serviceTable",
                            "action": {
                              "$waterfall": {
                                "arrayFunctions": [
                                  {
                                    "$element-event": {
                                      "path": "#data.services",
                                      "event": "reload",
                                      "value": true
                                    }
                                  },
                                  {
                                    "$assign-context": {
                                      "path": "$costElements",
                                      "data": {
                                        "$fetch-object": {
                                          "path": "data",
                                          "data": {
                                            "$api-data": {
                                              "query": "event/get_total_cost",
                                              "variables": {
                                                "eventId": {
                                                  "$query-params": {
                                                    "name": "id"
                                                  }
                                                }
                                              },
                                              "id": {
                                                "$query-params": {
                                                  "name": "id"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  {
                                    "$populate": {
                                      "path": "#data.commonInfo.totalEventCost",
                                      "data": {
                                        "$sum": {
                                          "terms": [
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$not-empty": {
                                                    "data": {
                                                      "$from-context": {
                                                        "path": "$costElements.bookingsNoDiscountOrMarkup"
                                                      }
                                                    }
                                                  }
                                                },
                                                "then": {
                                                  "$array-sum": {
                                                    "data": {
                                                      "$from-context": {
                                                        "path": "$costElements.bookingsNoDiscountOrMarkup"
                                                      }
                                                    },
                                                    "coercion": true,
                                                    "keyPath": "allPrice"
                                                  }
                                                },
                                                "else": 0
                                              }
                                            },
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$not-empty": {
                                                    "data": {
                                                      "$from-context": {
                                                        "path": "$costElements.bookingsWithDiscountOrMarkup"
                                                      }
                                                    }
                                                  }
                                                },
                                                "then": {
                                                  "$array-sum": {
                                                    "data": {
                                                      "$from-context": {
                                                        "path": "$costElements.bookingsWithDiscountOrMarkup"
                                                      }
                                                    },
                                                    "coercion": true,
                                                    "keyPath": "allPriceWithDiscountOrMarkup"
                                                  }
                                                },
                                                "else": 0
                                              }
                                            },
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$not-empty": {
                                                    "data": {
                                                      "$from-context": {
                                                        "path": "$costElements.facilitiesNoDiscountOrMarkup"
                                                      }
                                                    }
                                                  }
                                                },
                                                "then": {
                                                  "$array-sum": {
                                                    "data": {
                                                      "$from-context": {
                                                        "path": "$costElements.facilitiesNoDiscountOrMarkup"
                                                      }
                                                    },
                                                    "coercion": true,
                                                    "keyPath": "totalPrice"
                                                  }
                                                },
                                                "else": 0
                                              }
                                            },
                                            {
                                              "$if": {
                                                "condition": {
                                                  "$not-empty": {
                                                    "data": {
                                                      "$from-context": {
                                                        "path": "$costElements.facilitiesWithDiscountOrMarkup"
                                                      }
                                                    }
                                                  }
                                                },
                                                "then": {
                                                  "$array-sum": {
                                                    "data": {
                                                      "$from-context": {
                                                        "path": "$costElements.facilitiesWithDiscountOrMarkup"
                                                      }
                                                    },
                                                    "coercion": true,
                                                    "keyPath": "totalPriceWithDiscountOrMarkup"
                                                  }
                                                },
                                                "else": 0
                                              }
                                            }
                                          ]
                                        }
                                      }
                                    }
                                  }
                                ]
                              }
                            }
                          }
                        }
                      },
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "serviceNumber": {
                            "type": "number",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "№",
                                "viewedValue": {
                                  "$collection": {
                                    "action": "row-number"
                                  }
                                }
                              },
                              "class": {
                                "header": "column_actions",
                                "cell": "column_actions"
                              }
                            }
                          },
                          "serviceId": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "additionalService": {
                            "type": "object",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Наименование услуги"
                              }
                            },
                            "properties": {
                              "name": {
                                "type": "string",
                                "widget": {
                                  "name": "info"
                                }
                              },
                              "servicesType": {
                                "type": "object",
                                "widget": {
                                  "name": "hidden"
                                },
                                "properties": {
                                  "name": {
                                    "type": "string",
                                    "widget": {
                                      "name": "info"
                                    }
                                  }
                                }
                              },
                              "unitPrice": {
                                "type": "string",
                                "widget": {
                                  "name": "hidden"
                                }
                              }
                            }
                          },
                          "servicesType": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Тип услуги",
                                "viewedValue": {
                                  "$from-context": {
                                    "path": "$rowData.additionalService.servicesType.name"
                                  }
                                }
                              }
                            }
                          },
                          "discountOrMarkupFlag": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "unitPrice": {
                            "type": "number",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "unitPriceWithDiscountOrMarkup": {
                            "type": "number",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "unitPriceView": {
                            "type": "object",
                            "model": false,
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Цена за единицу (руб.)"
                              }
                            },
                            "properties": {
                              "price": {
                                "type": "string",
                                "model": false,
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "number:'0.2-2':'ru'",
                                    "viewedValue": {
                                      "$if": {
                                        "condition": {
                                          "===": {
                                            "operand1": "no",
                                            "operand2": {
                                              "$from-context": {
                                                "path": "$rowData.discountOrMarkupFlag"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$from-context": {
                                            "path": "$rowData.additionalService.unitPrice"
                                          }
                                        },
                                        "else": {
                                          "$from-context": {
                                            "path": "$rowData.unitPriceWithDiscountOrMarkup"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "class": {
                                    "group": "p-text-right",
                                    "value": "p-jc-end"
                                  }
                                }
                              }
                            }
                          },
                          "quantity": {
                            "type": "number",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "quantityView": {
                            "type": "object",
                            "model": false,
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Количество"
                              }
                            },
                            "properties": {
                              "amount": {
                                "type": "string",
                                "model": false,
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "viewedValue": {
                                      "$subs": {
                                        "path": "#data.services[].quantity"
                                      }
                                    }
                                  },
                                  "class": {
                                    "group": "p-text-right",
                                    "value": "p-jc-end"
                                  }
                                }
                              }
                            }
                          },
                          "totalPrice": {
                            "type": "number",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "totalPriceWithDiscountOrMarkup": {
                            "type": "number",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "totalPriceView": {
                            "type": "object",
                            "model": false,
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Общая стоимость (руб.)"
                              }
                            },
                            "properties": {
                              "price": {
                                "type": "string",
                                "model": false,
                                "widget": {
                                  "name": "info",
                                  "options": {
                                    "formatter": "number:'0.2-2':'ru'",
                                    "viewedValue": {
                                      "$if": {
                                        "condition": {
                                          "===": {
                                            "operand1": "no",
                                            "operand2": {
                                              "$from-context": {
                                                "path": "$rowData.discountOrMarkupFlag"
                                              }
                                            }
                                          }
                                        },
                                        "then": {
                                          "$from-context": {
                                            "path": "$rowData.totalPrice"
                                          }
                                        },
                                        "else": {
                                          "$from-context": {
                                            "path": "$rowData.totalPriceWithDiscountOrMarkup"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "class": {
                                    "group": "p-text-right",
                                    "value": "p-jc-end"
                                  }
                                }
                              }
                            }
                          },
                          "bookingComment": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Комментарий"
                              }
                            }
                          },
                          "state": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "visible": false
                              }
                            }
                          },
                          "status": {
                            "type": "object",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Статус"
                              }
                            },
                            "properties": {
                              "stateView": {
                                "type": "string",
                                "value": {
                                  "$from-context": {
                                    "path": "$rowData.state"
                                  }
                                },
                                "widget": {
                                  "name": "badge",
                                  "options": {
                                    "defaultLabel": "Не заполнено",
                                    "displayMapping": [
                                      {
                                        "color": "badge_active",
                                        "label": "Заполнено",
                                        "value": "filled"
                                      },
                                      {
                                        "color": "badge_error",
                                        "label": "Не заполнено",
                                        "value": "not_filled"
                                      }
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          "actions_column": {
                            "type": "object",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Действия"
                              },
                              "class": {
                                "cell": "column_actions"
                              }
                            },
                            "properties": {
                              "actions": {
                                "type": "array",
                                "model": false,
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "title": {
                                      "type": "string",
                                      "widget": "hidden"
                                    }
                                  },
                                  "widget": {
                                    "name": "fieldset"
                                  }
                                },
                                "widget": {
                                  "name": "menu-button",
                                  "options": {
                                    "labelKey": "title"
                                  },
                                  "class": {
                                    "toggle": "actions-button"
                                  },
                                  "items": [
                                    {
                                      "title": "Редактировать",
                                      "command": {
                                        "$navigate": {
                                          "commands": [
                                            "/cabinet/additional_facilities/edit"
                                          ],
                                          "extras": {
                                            "queryParams": {
                                              "id": {
                                                "$var": {
                                                  "path": "#data.services[].id"
                                                }
                                              },
                                              "previousPage": {
                                                "$route-params": {
                                                  "name": "action"
                                                }
                                              },
                                              "eventId": {
                                                "$query-params": {
                                                  "name": "id"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "title": "Удалить",
                                      "command": {
                                        "$open-popup": {
                                          "workflow": "additional_facilities",
                                          "action": "delete",
                                          "id": {
                                            "$var": {
                                              "path": "#data.services[].id"
                                            }
                                          },
                                          "params": {
                                            "previousPage": {
                                              "object": "event",
                                              "action": "add"
                                            },
                                            "eventId": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "===": {
                                "operand1": 0,
                                "operand2": {
                                  "$length": {
                                    "data": {
                                      "$array-filter": {
                                        "array": {
                                          "$var": {
                                            "path": "#data.services"
                                          }
                                        },
                                        "filter": {
                                          "===": {
                                            "operand1": "not_filled",
                                            "operand2": {
                                              "$from-context": {
                                                "path": "$data.state"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "message": "Необходимо заполнить все брони дополнительных услуг"
                          },
                          "events": [
                            "onUpdate",
                            "onBackend"
                          ]
                        }
                      ]
                    }
                  }
                },
                "costCalculation": {
                  "type": "object",
                  "model": false,
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Расчет стоимости мероприятия"
                    },
                    "class": {
                      "label": "h2 mrg-b-md",
                      "value": "mrg-b-xl"
                    }
                  },
                  "properties": {
                    "discountOrMarkupFlag": {
                      "type": "string",
                      "model": "#data.commonInfo.discountOrMarkupFlag",
                      "value": {
                        "$if": {
                          "condition": {
                            "$not-empty": {
                              "data": {
                                "$from-context": {
                                  "path": "@preload.event.discountOrMarkupFlag"
                                }
                              }
                            }
                          },
                          "then": {
                            "$from-context": {
                              "path": "@preload.event.discountOrMarkupFlag"
                            }
                          },
                          "else": "no"
                        }
                      },
                      "widget": {
                        "name": "radio-button",
                        "options": {
                          "label": "Применить скидку/наценку на все мероприятие",
                          "valueKey": "code",
                          "optionLabel": "name",
                          "valueOptions": [
                            {
                              "code": "no",
                              "name": "Не применять"
                            },
                            {
                              "code": "discount",
                              "name": "Применить скидку"
                            },
                            {
                              "code": "markup",
                              "name": "Применить наценку"
                            }
                          ]
                        },
                        "class": {
                          "group": "form-item form-item_radio p-field p-grid p-fluid",
                          "label": "form-label form-label mrg-t-0 p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4 p-flex-column",
                          "item": "form-item_radio__item width-100"
                        },
                        "events": {
                          "change": {
                            "$waterfall": {
                              "arrayFunctions": [
                                {
                                  "$event-bus-publish": {
                                    "type": "flag-change",
                                    "publisher": "discountOrMarkupFlag",
                                    "next": {
                                      "$var": {
                                        "path": "#data.commonInfo.discountOrMarkupFlag"
                                      }
                                    }
                                  }
                                },
                                {
                                  "$populate": {
                                    "path": "#data.commonInfo.discountOrMarkup",
                                    "data": 0
                                  }
                                }
                              ]
                            }
                          }
                        }
                      }
                    },
                    "discountOrMarkup": {
                      "type": "number",
                      "model": "#data.commonInfo.discountOrMarkup",
                      "value": {
                        "$from-context": {
                          "path": "@preload.event.discountOrMarkup"
                        }
                      },
                      "widget": {
                        "name": "input",
                        "options": {
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "rightAlign": false,
                            "autoGroup": true,
                            "allowMinus": false,
                            "integerDigits": 3,
                            "digits": 2,
                            "radixPoint": ","
                          },
                          "label": {
                            "$switch": {
                              "condition": {
                                "$subs": {
                                  "path": "#data.commonInfo.discountOrMarkupFlag"
                                }
                              },
                              "default": "",
                              "cases": [
                                {
                                  "value": "discount",
                                  "action": "Скидка"
                                },
                                {
                                  "value": "markup",
                                  "action": "Наценка"
                                }
                              ]
                            }
                          },
                          "visible": {
                            "!==": {
                              "operand1": {
                                "$subs": {
                                  "path": "#data.commonInfo.discountOrMarkupFlag"
                                }
                              },
                              "operand2": "no"
                            }
                          }
                        },
                        "append": {
                          "type": "string",
                          "value": "%",
                          "widget": {
                            "name": "info",
                            "class": {
                              "group": "text-addon text-addon_right"
                            }
                          }
                        },
                        "class": {
                          "group": "form-item p-field p-grid p-fluid",
                          "label": "form-label form-label_required p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element p-xs-12 p-md-6 p-xl-4"
                        },
                        "events": {
                          "change": [
                            {
                              "$populate": {
                                "path": "#data.commonInfo.totalEventCostWithDiscountOrMarkup",
                                "emitEvent": false,
                                "data": {
                                  "$math-round": {
                                    "value": {
                                      "$add": {
                                        "multipliers": [
                                          {
                                            "$var": {
                                              "path": "#data.commonInfo.totalEventCost"
                                            }
                                          },
                                          {
                                            "$switch": {
                                              "condition": {
                                                "$var": {
                                                  "path": "#data.commonInfo.discountOrMarkupFlag"
                                                }
                                              },
                                              "cases": [
                                                {
                                                  "value": "discount",
                                                  "action": {
                                                    "$subtract": {
                                                      "operand1": 1,
                                                      "operand2": {
                                                        "$division": {
                                                          "operand1": {
                                                            "$var": {
                                                              "path": "#data.commonInfo.discountOrMarkup"
                                                            }
                                                          },
                                                          "operand2": 100
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                {
                                                  "value": "markup",
                                                  "action": {
                                                    "$sum": {
                                                      "terms": [
                                                        1,
                                                        {
                                                          "$division": {
                                                            "operand1": {
                                                              "$var": {
                                                                "path": "#data.commonInfo.discountOrMarkup"
                                                              }
                                                            },
                                                            "operand2": 100
                                                          }
                                                        }
                                                      ]
                                                    }
                                                  }
                                                },
                                                {
                                                  "value": "no",
                                                  "action": 1
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "exp": -2
                                  }
                                }
                              }
                            }
                          ]
                        },
                        "subscriptions": {
                          "total-price-w-change": {
                            "subscriber": "discountOrMarkup",
                            "action": {
                              "$populate": {
                                "path": "#data.commonInfo.discountOrMarkup",
                                "emitEvent": false,
                                "data": {
                                  "$math-round": {
                                    "value": {
                                      "$add": {
                                        "multipliers": [
                                          100,
                                          {
                                            "$switch": {
                                              "condition": {
                                                "$var": {
                                                  "path": "#data.commonInfo.discountOrMarkupFlag"
                                                }
                                              },
                                              "cases": [
                                                {
                                                  "value": "discount",
                                                  "action": {
                                                    "$subtract": {
                                                      "operand1": 1,
                                                      "operand2": {
                                                        "$division": {
                                                          "operand1": {
                                                            "$var": {
                                                              "path": "#data.commonInfo.totalEventCostWithDiscountOrMarkup"
                                                            }
                                                          },
                                                          "operand2": {
                                                            "$var": {
                                                              "path": "#data.commonInfo.totalEventCost"
                                                            }
                                                          }
                                                        }
                                                      }
                                                    }
                                                  }
                                                },
                                                {
                                                  "value": "markup",
                                                  "action": {
                                                    "$subtract": {
                                                      "operand1": {
                                                        "$division": {
                                                          "operand1": {
                                                            "$var": {
                                                              "path": "#data.commonInfo.totalEventCostWithDiscountOrMarkup"
                                                            }
                                                          },
                                                          "operand2": {
                                                            "$var": {
                                                              "path": "#data.commonInfo.totalEventCost"
                                                            }
                                                          }
                                                        }
                                                      },
                                                      "operand2": 1
                                                    }
                                                  }
                                                },
                                                {
                                                  "value": "no",
                                                  "action": 0
                                                }
                                              ]
                                            }
                                          }
                                        ]
                                      }
                                    },
                                    "exp": -2
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "validation": [
                        {
                          "type": "schema",
                          "params": {
                            "rule": {
                              "$if": {
                                "condition": {
                                  "===": {
                                    "operand1": "discount",
                                    "operand2": {
                                      "$var": {
                                        "path": "#data.commonInfo.discountOrMarkupFlag"
                                      }
                                    }
                                  }
                                },
                                "then": {
                                  "<": {
                                    "operand1": {
                                      "$var": {
                                        "path": "."
                                      }
                                    },
                                    "operand2": 100
                                  }
                                },
                                "else": true
                              }
                            },
                            "message": "Значение должно быть меньше 100"
                          },
                          "events": [
                            "onUpdate"
                          ]
                        }
                      ]
                    },
                    "total-cost-container": {
                      "type": "object",
                      "model": false,
                      "widget": {
                        "name": "container",
                        "options": {
                          "label": "Итоговая стоимость по мероприятию"
                        },
                        "class": {
                          "group": "form-item p-field p-grid",
                          "label": "form-label form-label_nds-label form-label_required p-xs-12 p-md-4 p-xl-3",
                          "value": "form-item-element form-item-element_view input-height-fit-content p-xs-12 p-md-6 p-xl-4 d-flex p-flex-wrap p-flex-md-nowrap pdd-l-0 pdd-r-0"
                        }
                      },
                      "properties": {
                        "totalEventCost": {
                          "type": "number",
                          "model": "#data.commonInfo.totalEventCost",
                          "value": {
                            "$from-context": {
                              "path": "@preload.event.totalEventCost"
                            }
                          },
                          "widget": {
                            "name": "input",
                            "options": {
                              "label": {
                                "$switch": {
                                  "condition": {
                                    "$subs": {
                                      "path": "#data.commonInfo.discountOrMarkupFlag"
                                    }
                                  },
                                  "default": " ",
                                  "cases": [
                                    {
                                      "value": "discount",
                                      "action": "без скидки"
                                    },
                                    {
                                      "value": "markup",
                                      "action": "без наценки"
                                    }
                                  ]
                                }
                              },
                              "disabled": true,
                              "inputmask": {
                                "alias": "integer",
                                "groupSeparator": " ",
                                "autoGroup": true,
                                "radixPoint": ",",
                                "integerDigits": 12,
                                "allowMinus": false,
                                "digits": 2
                              }
                            },
                            "append": {
                              "type": "string",
                              "value": "руб.",
                              "widget": {
                                "name": "info",
                                "class": {
                                  "group": "text-addon text-addon_right"
                                }
                              }
                            },
                            "class": {
                              "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                              "label": "text-secondary fw-500 mrg-b-0"
                            }
                          }
                        },
                        "totalEventCostWithDiscountOrMarkup": {
                          "type": "number",
                          "model": "#data.commonInfo.totalEventCostWithDiscountOrMarkup",
                          "value": {
                            "$from-context": {
                              "path": "@preload.event.totalEventCostWithDiscountOrMarkup"
                            }
                          },
                          "widget": {
                            "name": "input",
                            "options": {
                              "label": {
                                "$switch": {
                                  "condition": {
                                    "$subs": {
                                      "path": "#data.commonInfo.discountOrMarkupFlag"
                                    }
                                  },
                                  "default": "",
                                  "cases": [
                                    {
                                      "value": "discount",
                                      "action": "со скидкой"
                                    },
                                    {
                                      "value": "markup",
                                      "action": "с наценкой"
                                    }
                                  ]
                                }
                              },
                              "inputmask": {
                                "alias": "integer",
                                "groupSeparator": " ",
                                "autoGroup": true,
                                "radixPoint": ",",
                                "integerDigits": 12,
                                "allowMinus": false,
                                "digits": 2
                              },
                              "visible": {
                                "!==": {
                                  "operand1": "no",
                                  "operand2": {
                                    "$subs": {
                                      "path": "#data.commonInfo.discountOrMarkupFlag"
                                    }
                                  }
                                }
                              }
                            },
                            "append": {
                              "type": "string",
                              "value": "руб.",
                              "widget": {
                                "name": "info",
                                "class": {
                                  "group": "text-addon text-addon_right"
                                }
                              }
                            },
                            "class": {
                              "group": "p-xs-12 p-md-6 p-xl-6 mrg-b-xs",
                              "label": "text-secondary fw-500 mrg-b-0"
                            },
                            "events": {
                              "change": {
                                "$event-bus-publish": {
                                  "type": "total-price-w-change",
                                  "publisher": "totalEventCostWithDiscountOrMarkup",
                                  "next": {
                                    "$var": {
                                      "path": "#data.commonInfo.totalEventCostWithDiscountOrMarkup"
                                    }
                                  }
                                }
                              }
                            },
                            "subscriptions": {
                              "flag-change": {
                                "subscriber": "totalEventCostWithDiscountOrMarkup",
                                "action": {
                                  "$populate": {
                                    "path": "#data.commonInfo.totalEventCostWithDiscountOrMarkup",
                                    "emitEvent": false,
                                    "data": {
                                      "$var": {
                                        "path": "#data.commonInfo.totalEventCost"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "validation": [
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$if": {
                                    "condition": {
                                      "===": {
                                        "operand1": {
                                          "$var": {
                                            "path": "#data.commonInfo.discountOrMarkupFlag"
                                          }
                                        },
                                        "operand2": "discount"
                                      }
                                    },
                                    "then": {
                                      "<": {
                                        "operand1": {
                                          "$var": {
                                            "path": "."
                                          }
                                        },
                                        "operand2": {
                                          "$var": {
                                            "path": "#data.commonInfo.totalEventCost"
                                          }
                                        }
                                      }
                                    },
                                    "else": true
                                  }
                                },
                                "message": "Итоговая стоимость со скидкой не может превышать стоимость без скидки"
                              },
                              "events": [
                                "onUpdate"
                              ]
                            },
                            {
                              "type": "schema",
                              "params": {
                                "rule": {
                                  "$if": {
                                    "condition": {
                                      "===": {
                                        "operand1": {
                                          "$var": {
                                            "path": "#data.commonInfo.discountOrMarkupFlag"
                                          }
                                        },
                                        "operand2": "markup"
                                      }
                                    },
                                    "then": {
                                      ">": {
                                        "operand1": {
                                          "$var": {
                                            "path": "."
                                          }
                                        },
                                        "operand2": {
                                          "$var": {
                                            "path": "#data.commonInfo.totalEventCost"
                                          }
                                        }
                                      }
                                    },
                                    "else": true
                                  }
                                },
                                "message": "Итоговая стоимость с наценкой должна превышать стоимость без наценки"
                              },
                              "events": [
                                "onUpdate"
                              ]
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              }
            },
            "attachments": {
              "type": "object",
              "model": false,
              "widget": {
                "key": "attachments",
                "name": "tab-panel",
                "options": {
                  "label": "Вложения"
                }
              },
              "properties": {
                "eventWorkingHours": {
                  "type": "object",
                  "model": false,
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Документы по мероприятию"
                    },
                    "class": {
                      "label": "h2 mrg-b-md"
                    }
                  },
                  "properties": {
                    "documents": {
                      "type": "array",
                      "model": "#data.attachments",
                      "value": [
                        {
                          "title": "Логотип",
                          "requirements": "Файл в формате .png/.jpeg",
                          "filesUpload": {
                            "files": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "@preload.event.documents.fileLogo"
                                      }
                                    }
                                  }
                                },
                                "then": [
                                  {
                                    "$from-context": {
                                      "path": "@preload.event.documents.fileLogo"
                                    }
                                  }
                                ],
                                "else": []
                              }
                            }
                          }
                        },
                        {
                          "title": "Смета расходов",
                          "requirements": "Файл в формате .pdf",
                          "filesUpload": {
                            "files": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "@preload.event.documents.fileCostings"
                                      }
                                    }
                                  }
                                },
                                "then": [
                                  {
                                    "$from-context": {
                                      "path": "@preload.event.documents.fileCostings"
                                    }
                                  }
                                ],
                                "else": []
                              }
                            }
                          }
                        },
                        {
                          "title": "Перечень экспонентов (с кратким описанием компаний)",
                          "requirements": "Файл в формате .docx/.xls/.xslx",
                          "filesUpload": {
                            "files": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "@preload.event.documents.fileListOfExhibitors"
                                      }
                                    }
                                  }
                                },
                                "then": [
                                  {
                                    "$from-context": {
                                      "path": "@preload.event.documents.fileListOfExhibitors"
                                    }
                                  }
                                ],
                                "else": []
                              }
                            }
                          }
                        },
                        {
                          "title": "Экспоплан",
                          "requirements": "Файл в формате .pdf",
                          "filesUpload": {
                            "files": {
                              "$from-context": {
                                "path": "@preload.event.documents.filesExpoplan"
                              }
                            }
                          }
                        },
                        {
                          "title": "Протокол/сценарий",
                          "requirements": "Файл в формате .docx",
                          "filesUpload": {
                            "files": {
                              "$from-context": {
                                "path": "@preload.event.documents.filesProtocol"
                              }
                            }
                          }
                        },
                        {
                          "title": "График первых лиц",
                          "requirements": "Файл в формате .docx",
                          "filesUpload": {
                            "files": {
                              "$if": {
                                "condition": {
                                  "$not-empty": {
                                    "data": {
                                      "$from-context": {
                                        "path": "@preload.event.documents.filePresidentProgram"
                                      }
                                    }
                                  }
                                },
                                "then": [
                                  {
                                    "$from-context": {
                                      "path": "@preload.event.documents.filePresidentProgram"
                                    }
                                  }
                                ],
                                "else": []
                              }
                            }
                          }
                        },
                        {
                          "title": "Прочие документы",
                          "requirements": "",
                          "filesUpload": {
                            "files": {
                              "$from-context": {
                                "path": "@preload.event.documents.filesOther"
                              }
                            }
                          }
                        }
                      ],
                      "widget": {
                        "name": "table",
                        "options": {
                          "emptyMessage": "Не добавлено информации для отображения",
                          "first": 0,
                          "rows": 10,
                          "paginator": false
                        },
                        "class": {
                          "group": "form-item p-field p-grid",
                          "value": "p-xs-12"
                        }
                      },
                      "items": {
                        "type": "object",
                        "properties": {
                          "title": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Наименование документа"
                              }
                            }
                          },
                          "requirements": {
                            "type": "string",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Требования к документу"
                              }
                            }
                          },
                          "filesUpload": {
                            "type": "object",
                            "widget": {
                              "name": "table-column",
                              "options": {
                                "label": "Файлы"
                              }
                            },
                            "properties": {
                              "files": {
                                "type": "array",
                                "items": {
                                  "type": "file"
                                },
                                "widget": {
                                  "name": "file",
                                  "options": {
                                    "enableFilesUpload": true,
                                    "displayUploadedFiles": true,
                                    "displayParams": {
                                      "showSize": true,
                                      "enableFilesRemove": true,
                                      "enableFilesDownload": true
                                    },
                                    "objectId": {
                                      "$query-params": {
                                        "name": "id"
                                      }
                                    },
                                    "uploadParams": {
                                      "$switch": {
                                        "condition": {
                                          "$from-context": {
                                            "path": "$rowData.title"
                                          }
                                        },
                                        "default": "",
                                        "cases": [
                                          {
                                            "value": "Логотип",
                                            "action": {
                                              "workflow": "event",
                                              "action": "add-document-upload",
                                              "accept": " .png, .jpeg",
                                              "fileLimit": 1,
                                              "multiple": true,
                                              "maxFileSize": 62914560
                                            }
                                          },
                                          {
                                            "value": "Смета расходов",
                                            "action": {
                                              "workflow": "event",
                                              "action": "add-document-upload",
                                              "accept": " .pdf",
                                              "fileLimit": 1,
                                              "multiple": true,
                                              "maxFileSize": 62914560
                                            }
                                          },
                                          {
                                            "value": "Перечень экспонентов (с кратким описанием компаний)",
                                            "action": {
                                              "workflow": "event",
                                              "action": "add-document-upload",
                                              "accept": ".docx, .xls, .xslx",
                                              "fileLimit": 1,
                                              "multiple": true,
                                              "maxFileSize": 62914560
                                            }
                                          },
                                          {
                                            "value": "Экспоплан",
                                            "action": {
                                              "workflow": "event",
                                              "action": "add-document-upload",
                                              "accept": " .pdf",
                                              "fileLimit": 3,
                                              "multiple": true,
                                              "maxFileSize": 62914560
                                            }
                                          },
                                          {
                                            "value": "Протокол/сценарий",
                                            "action": {
                                              "workflow": "event",
                                              "action": "add-document-upload",
                                              "accept": " .docx",
                                              "fileLimit": 2,
                                              "multiple": true,
                                              "maxFileSize": 62914560
                                            }
                                          },
                                          {
                                            "value": "График первых лиц",
                                            "action": {
                                              "workflow": "event",
                                              "action": "add-document-upload",
                                              "accept": " .docx",
                                              "fileLimit": 1,
                                              "multiple": true,
                                              "maxFileSize": 62914560
                                            }
                                          },
                                          {
                                            "value": "Прочие документы",
                                            "action": {
                                              "workflow": "event",
                                              "action": "add-document-upload",
                                              "accept": " .docx, .xls, .xslx, .jpg, .png, .pdf, .jpeg",
                                              "fileLimit": 2,
                                              "multiple": true,
                                              "maxFileSize": 62914560
                                            }
                                          }
                                        ]
                                      }
                                    }
                                  },
                                  "class": {
                                    "value": "file-upload"
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "actions": {
          "type": "object",
          "model": "#actions",
          "widget": {
            "name": "form",
            "class": {
              "group": "form-actions p-field p-grid mrg-t-lg",
              "value": "p-jc-xs-end p-autolayout"
            }
          },
          "properties": {
            "button_add": {
              "widget": {
                "name": "button",
                "model": false,
                "options": {
                  "label": "Добавить"
                },
                "class": {
                  "value": "mrg-r-sm"
                },
                "events": {
                  "click": [
                    {
                      "$if": {
                        "condition": {
                          "$and": {
                            "operands": [
                              {
                                "$validate": {
                                  "path": "/"
                                }
                              }
                            ]
                          }
                        },
                        "then": [
                          "$ref:operation-frontend:snippets/element/_loading/onclick-loading-enable",
                          {
                            "$http-code": {
                              "200": [
                                {
                                  "$go": {
                                    "workflow": "event",
                                    "action": "view",
                                    "id": {
                                      "$query-params": {
                                        "name": "id"
                                      }
                                    }
                                  }
                                },
                                {
                                  "$message": {
                                    "severity": "success",
                                    "summary": "Добавление мероприятия",
                                    "detail": "Мероприятие успешно добавлено"
                                  }
                                }
                              ],
                              "client": {
                                "$api-workflow": {
                                  "workflow": "event",
                                  "action": "add",
                                  "data": {
                                    "$assign-object": {
                                      "path": "hasRequestAcceptPermission",
                                      "data": {
                                        "$active-user-has-permission": {
                                          "permission": "request.accept.new"
                                        }
                                      },
                                      "object": {
                                        "$exclude": {
                                          "data": {
                                            "$var": {
                                              "path": "#data"
                                            }
                                          },
                                          "exclude": [
                                            "addServiceFlag",
                                            "services",
                                            "bookings"
                                          ]
                                        }
                                      }
                                    }
                                  },
                                  "type": "post",
                                  "options": {
                                    "observe": "response"
                                  },
                                  "$query-params": {
                                    "name": "id"
                                  }
                                }
                              },
                              "default": "$ref:operation-frontend:snippets/element/_http_message/http-default-error-message-action",
                              "finalize": "$ref:operation-frontend:snippets/element/_loading/onclick-loading-disable"
                            }
                          }
                        ],
                        "else": [
                          {
                            "$message": {
                              "severity": "error",
                              "summary": "Добавление мероприятия",
                              "detail": "Форма содержит ошибки"
                            }
                          },
                          {
                            "$form-control-mark": {
                              "key": "tabs"
                            }
                          }
                        ]
                      }
                    }
                  ]
                }
              }
            },
            "button_cancel": {
              "widget": {
                "name": "button",
                "options": {
                  "label": "Отмена"
                },
                "events": {
                  "click": {
                    "$go": {
                      "workflow": "event",
                      "action": "list"
                    }
                  }
                },
                "class": {
                  "value": "button_outline mrg-r-0 mrg-b-0"
                }
              }
            }
          }
        }
      }
    },
    "selectRooms": {
      "type": "object",
      "model": "#formSelectRooms",
      "widget": {
        "name": "container",
        "options": {
          "visible": {
            "$subs": {
              "path": "#selectRoomsVisible"
            }
          }
        }
      },
      "properties": {
        "content": {
          "type": "object",
          "widget": {
            "name": "container"
          },
          "properties": {
            "header": {
              "type": "string",
              "widget": {
                "name": "container",
                "options": {
                  "label": "Выбор помещений"
                },
                "kind": "container-popup-with-h1-no-form-collapsed-style"
              }
            },
            "search": {
              "type": "object",
              "model": "#searchRooms",
              "widget": {
                "name": "container",
                "class": {
                  "value": "search-form search-form_expanded search-form_margin form-group_inline p-grid p-fluid"
                },
                "options": {
                  "displayNone": false,
                  "routerOptions": [
                    "displayNone"
                  ]
                }
              },
              "properties": {
                "numberOrName": {
                  "type": "string",
                  "validation": [
                    {
                      "type": "schema",
                      "params": {
                        "rule": "$ref:rule-validation:snippets/validation/checks/length-255"
                      },
                      "events": [
                        "onBackend",
                        "onUpdate"
                      ]
                    }
                  ],
                  "widget": {
                    "name": "input",
                    "options": {
                      "placeholder": "Наименование, номер помещения"
                    },
                    "events": {
                      "keypress-13": {
                        "$grid": {
                          "action": "lazyLoad",
                          "path": "#selectorRooms",
                          "filters": {
                            "$var": {
                              "path": "#searchRooms"
                            }
                          }
                        }
                      }
                    },
                    "kind": "input-search-form-expanded-search-input-style"
                  }
                },
                "clear-button": {
                  "widget": {
                    "name": "button",
                    "options": {
                      "label": "Сбросить"
                    },
                    "events": {
                      "click": [
                        {
                          "$populate": {
                            "path": "#searchRooms",
                            "data": {}
                          }
                        },
                        {
                          "$grid": {
                            "action": "lazyLoad",
                            "path": "#selectorRooms",
                            "filters": {
                              "$var": {
                                "path": "#searchRooms"
                              }
                            }
                          }
                        }
                      ]
                    },
                    "kind": "button-search-form-clear-button-style"
                  }
                },
                "search-button": {
                  "widget": {
                    "name": "button",
                    "options": {
                      "label": "Найти"
                    },
                    "events": {
                      "click": [
                        {
                          "$grid": {
                            "action": "lazyLoad",
                            "path": "#selectorRooms",
                            "filters": {
                              "$var": {
                                "path": "#searchRooms"
                              }
                            }
                          }
                        }
                      ]
                    },
                    "kind": "button-search-form-action-button-fill-style"
                  }
                },
                "type": {
                  "type": "any",
                  "widget": {
                    "name": "multiselect",
                    "options": {
                      "label": "Тип помещения",
                      "placeholder": "Выбрать",
                      "useEllipsisWhenDisplayFieldOverflows": false,
                      "filter": true,
                      "showClear": true,
                      "optionLabel": "name",
                      "valueKey": "id",
                      "dataKey": "id",
                      "valueOptions": {
                        "$fetch-object": {
                          "path": "data.items",
                          "data": {
                            "$api-data": {
                              "query": "room_type/get_for_dropdown",
                              "id": {
                                "$query-params": {
                                  "name": "id"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "kind": "multiselect-search-form-expanded-input-half-style"
                  }
                },
                "floor": {
                  "type": "any",
                  "widget": {
                    "name": "multiselect",
                    "options": {
                      "label": "Этаж",
                      "placeholder": "Выбрать",
                      "useEllipsisWhenDisplayFieldOverflows": false,
                      "filter": true,
                      "showClear": true,
                      "optionLabel": "title",
                      "valueKey": "code",
                      "dataKey": "code",
                      "valueOptions": [
                        {
                          "code": "open_area",
                          "title": "Открытая выставочная площадь"
                        },
                        {
                          "code": "1",
                          "title": "1 этаж"
                        },
                        {
                          "code": "1,5",
                          "title": "1,5 этаж"
                        },
                        {
                          "code": "2",
                          "title": "2 этаж"
                        }
                      ]
                    },
                    "kind": "multiselect-search-form-expanded-input-half-style"
                  }
                },
                "square": {
                  "model": false,
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Площадь (м²)"
                    },
                    "kind": "container-search-form-expanded-input-quarter-style"
                  },
                  "properties": {
                    "squareFrom": {
                      "type": "number",
                      "bindRouter": false,
                      "widget": {
                        "name": "input",
                        "options": {
                          "placeholder": "От",
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "autoGroup": true,
                            "radixPoint": ",",
                            "integerDigits": 10,
                            "allowMinus": false,
                            "digits": 2
                          }
                        },
                        "class": {
                          "group": "p-xl-5"
                        }
                      }
                    },
                    "divider": {
                      "type": "string",
                      "model": false,
                      "value": "—",
                      "widget": {
                        "name": "info",
                        "class": {
                          "group": "p-xl-2",
                          "value": "text-medium p-jc-center p-ai-center"
                        }
                      }
                    },
                    "squareTo": {
                      "type": "number",
                      "bindRouter": false,
                      "widget": {
                        "name": "input",
                        "options": {
                          "placeholder": "До",
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "autoGroup": true,
                            "radixPoint": ",",
                            "integerDigits": 10,
                            "allowMinus": false,
                            "digits": 2
                          }
                        },
                        "class": {
                          "group": "p-xl-5"
                        }
                      }
                    }
                  }
                },
                "roominess": {
                  "model": false,
                  "type": "object",
                  "widget": {
                    "name": "container",
                    "options": {
                      "label": "Вместительность (чел.)"
                    },
                    "kind": "container-search-form-expanded-input-quarter-style"
                  },
                  "properties": {
                    "roominessFrom": {
                      "type": "number",
                      "bindRouter": false,
                      "widget": {
                        "name": "input",
                        "options": {
                          "placeholder": "От",
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "autoGroup": true,
                            "radixPoint": ",",
                            "integerDigits": 10,
                            "allowMinus": false,
                            "digits": 0
                          }
                        },
                        "class": {
                          "group": "p-xl-5"
                        }
                      }
                    },
                    "divider": {
                      "type": "string",
                      "model": false,
                      "value": "—",
                      "widget": {
                        "name": "info",
                        "class": {
                          "group": "p-xl-2",
                          "value": "text-medium p-jc-center p-ai-center"
                        }
                      }
                    },
                    "roominessTo": {
                      "type": "number",
                      "bindRouter": false,
                      "widget": {
                        "name": "input",
                        "options": {
                          "placeholder": "До",
                          "inputmask": {
                            "alias": "integer",
                            "groupSeparator": " ",
                            "autoGroup": true,
                            "radixPoint": ",",
                            "integerDigits": 10,
                            "allowMinus": false,
                            "digits": 0
                          }
                        },
                        "class": {
                          "group": "p-xl-5"
                        }
                      }
                    }
                  }
                },
                "configuration": {
                  "type": "any",
                  "widget": {
                    "name": "multiselect",
                    "options": {
                      "label": "Возможность конфигурации",
                      "placeholder": "Выбрать",
                      "useEllipsisWhenDisplayFieldOverflows": false,
                      "filter": true,
                      "showClear": true,
                      "optionLabel": "title",
                      "valueKey": "code",
                      "dataKey": "code",
                      "valueOptions": [
                        {
                          "code": true,
                          "title": "Да"
                        },
                        {
                          "code": false,
                          "title": "Нет"
                        }
                      ]
                    },
                    "kind": "multiselect-search-form-expanded-input-quarter-style"
                  }
                },
                "transformation": {
                  "type": "any",
                  "widget": {
                    "name": "multiselect",
                    "options": {
                      "label": "Возможность трансформации",
                      "placeholder": "Выбрать",
                      "useEllipsisWhenDisplayFieldOverflows": false,
                      "filter": true,
                      "showClear": true,
                      "optionLabel": "title",
                      "valueKey": "code",
                      "dataKey": "code",
                      "valueOptions": [
                        {
                          "code": true,
                          "title": "Да"
                        },
                        {
                          "code": false,
                          "title": "Нет"
                        }
                      ]
                    },
                    "kind": "multiselect-search-form-expanded-input-quarter-style"
                  }
                }
              }
            },
            "selected-count": {
              "type": "string",
              "model": false,
              "widget": {
                "name": "html",
                "class": {
                  "value": "mrg-b-xs"
                }
              },
              "value": {
                "$replace": {
                  "template": "<p>Выбрано помещений: {{0}}</p>",
                  "data": [
                    {
                      "$if": {
                        "condition": {
                          "$not-empty": {
                            "data": {
                              "$element-option": {
                                "option": "selection$",
                                "path": "#selectorRooms"
                              }
                            }
                          }
                        },
                        "then": {
                          "$length": {
                            "data": {
                              "$element-option": {
                                "option": "selection$",
                                "path": "#selectorRooms"
                              }
                            }
                          }
                        },
                        "else": 0
                      }
                    }
                  ]
                }
              }
            },
            "selected-chips-rooms": {
              "type": "array",
              "items": {
                "type": "string",
                "widget": "info"
              },
              "model": "#selected-chips-rooms",
              "widget": {
                "name": "chips",
                "class": {
                  "value": "chips-invite-suppliers mrg-b-sm"
                },
                "options": {
                  "onlyRemove": true,
                  "allowDuplicate": false,
                  "disabled": true
                },
                "events": {
                  "onRemove": {
                    "$http-code": {
                      "200": {
                        "$element-option": {
                          "path": "#selectorRooms",
                          "option": "selection",
                          "value": {
                            "$array-filter": {
                              "array": {
                                "$element-option": {
                                  "path": "#selectorRooms",
                                  "option": "selection"
                                }
                              },
                              "filter": {
                                "!==": {
                                  "operand1": {
                                    "$from-context": {
                                      "path": "$data"
                                    }
                                  },
                                  "operand2": {
                                    "$from-context": {
                                      "path": "$response.body.data.pagination.items.0.roomId"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "client": {
                        "$api-data": {
                          "id": {
                            "$query-params": {
                              "name": "id"
                            }
                          },
                          "options": {
                            "observe": "response"
                          },
                          "query": "room/list_for_select",
                          "variables": {
                            "name": {
                              "$from-context": {
                                "path": "$event.event"
                              }
                            },
                            "first": 0,
                            "rows": 10
                          }
                        }
                      },
                      "default": {
                        "$message": {
                          "severity": "error",
                          "summary": "Ошибка",
                          "detail": "Не удалось получить данные c сервера, попробуйте позднее"
                        }
                      }
                    }
                  }
                }
              },
              "value": []
            },
            "table": {
              "value": {
                "$api-table-workflow-data": {
                  "model": "#selectorRooms",
                  "query": "room/list_for_select",
                  "id": {
                    "$query-params": {
                      "name": "id"
                    }
                  },
                  "variables": {
                    "$graphql-event-variables": {
                      "data": {
                        "$element-event": {
                          "event": "lazyLoad"
                        }
                      }
                    }
                  },
                  "errors": {
                    "default": {
                      "$message": {
                        "severity": "error",
                        "summary": "Ошибка",
                        "detail": "При загрузке данных произошла ошибка, повторите попытку позднее"
                      }
                    }
                  }
                }
              },
              "type": "array",
              "model": "#selectorRooms",
              "widget": {
                "name": "table-lazy",
                "options": {
                  "selectionMode": "multiple",
                  "selectionField": "selected",
                  "selectionKey": "roomId",
                  "first": 0,
                  "lazy": true,
                  "paginator": true,
                  "rows": 10,
                  "rowsPerPageOptions": [
                    10,
                    20,
                    50
                  ],
                  "routerOptions": [
                    "first",
                    "rows"
                  ],
                  "sortField": "name",
                  "sortOrder": 1
                },
                "events": {
                  "lazyLoad": {
                    "$element-option": {
                      "path": "#selectorRooms",
                      "option": "loading",
                      "value": true
                    }
                  },
                  "onRowSelect": {
                    "$populate": {
                      "path": "#selected-chips-rooms",
                      "data": {
                        "$array-push": {
                          "array": {
                            "$var": {
                              "path": "#selected-chips-rooms"
                            }
                          },
                          "data": {
                            "$from-context": {
                              "path": "$event.event.value.name"
                            }
                          }
                        }
                      }
                    }
                  },
                  "onRowUnselect": {
                    "$populate": {
                      "path": "#selected-chips-rooms",
                      "data": {
                        "$array-filter": {
                          "array": {
                            "$var": {
                              "path": "#selected-chips-rooms"
                            }
                          },
                          "filter": {
                            "!==": {
                              "operand1": {
                                "$from-context": {
                                  "path": "$data"
                                }
                              },
                              "operand2": {
                                "$from-context": {
                                  "path": "$event.event.value.name"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "onHeaderCheckboxToggle": {
                    "$if": {
                      "condition": {
                        "===": {
                          "operand1": {
                            "$from-context": {
                              "path": "$event.event"
                            }
                          },
                          "operand2": true
                        }
                      },
                      "then": {
                        "$populate": {
                          "path": "#selected-chips-rooms",
                          "data": {
                            "$apply-func": {
                              "func": "return [...new Set([...chipsArr, ...currPageRooms])]",
                              "args": {
                                "chipsArr": {
                                  "$var": {
                                    "path": "#selected-chips-rooms"
                                  }
                                },
                                "currPageRooms": {
                                  "$array-pluck": {
                                    "array": {
                                      "$var": {
                                        "path": "#selectorRooms"
                                      }
                                    },
                                    "key": "name"
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "else": {
                        "$populate": {
                          "path": "#selected-chips-rooms",
                          "data": {
                            "$apply-func": {
                              "func": "return chipsArr.filter( function( el ) { return currPageRooms.indexOf( el ) < 0; } )",
                              "args": {
                                "chipsArr": {
                                  "$var": {
                                    "path": "#selected-chips-rooms"
                                  }
                                },
                                "currPageRooms": {
                                  "$array-pluck": {
                                    "array": {
                                      "$var": {
                                        "path": "#selectorRooms"
                                      }
                                    },
                                    "key": "name"
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "subscriptions": {
                  "reload-table": {
                    "$element-event": {
                      "event": "reload",
                      "value": true
                    }
                  }
                }
              },
              "items": {
                "type": "object",
                "properties": {
                  "roomId": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    }
                  },
                  "selected": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    }
                  },
                  "name": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Наименование"
                      }
                    }
                  },
                  "roomType": {
                    "type": "object",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Тип"
                      }
                    },
                    "properties": {
                      "name": {
                        "type": "string",
                        "widget": {
                          "name": "info"
                        }
                      }
                    }
                  },
                  "number": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Номер",
                        "visible": true
                      }
                    }
                  },
                  "floor": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Этаж",
                        "visible": false
                      }
                    }
                  },
                  "floorView": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Этаж",
                        "visible": true
                      }
                    },
                    "value": {
                      "$if": {
                        "condition": {
                          "===": {
                            "operand1": {
                              "$subs": {
                                "path": "#selectorRooms[].floor"
                              }
                            },
                            "operand2": "open_area"
                          }
                        },
                        "then": "Открытая выставочная площадь",
                        "else": {
                          "$var": {
                            "path": "#selectorRooms[].floor"
                          }
                        }
                      }
                    }
                  },
                  "square": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    }
                  },
                  "squareView": {
                    "type": "object",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Площадь (м²)",
                        "visible": true,
                        "formatter": "number:'0.2-2':'ru'"
                      }
                    },
                    "properties": {
                      "square": {
                        "type": "string",
                        "widget": {
                          "name": "info",
                          "options": {
                            "formatter": "number:'0.2-2':'ru'"
                          },
                          "class": {
                            "value": "p-jc-end"
                          }
                        },
                        "value": {
                          "$from-context": {
                            "path": "$rowData.square"
                          }
                        }
                      }
                    }
                  },
                  "roominess": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    }
                  },
                  "roominessView": {
                    "type": "object",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Вместительность (чел.)",
                        "visible": true
                      }
                    },
                    "properties": {
                      "roominess": {
                        "type": "string",
                        "widget": {
                          "name": "info",
                          "options": {
                            "formatter": "number:'1.0-0':'ru'"
                          },
                          "class": {
                            "value": "p-jc-end"
                          }
                        },
                        "value": {
                          "$from-context": {
                            "path": "$rowData.roominess"
                          }
                        }
                      }
                    }
                  },
                  "configuration": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    }
                  },
                  "transformation": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "visible": false
                      }
                    }
                  },
                  "configuration_ru": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Конфигурация",
                        "visible": true
                      }
                    },
                    "value": {
                      "$switch": {
                        "condition": {
                          "$subs": {
                            "path": "#selectorRooms[].configuration"
                          }
                        },
                        "default": "",
                        "cases": [
                          {
                            "value": true,
                            "action": "Да"
                          },
                          {
                            "value": false,
                            "action": "Нет"
                          }
                        ]
                      }
                    }
                  },
                  "transformation_ru": {
                    "type": "string",
                    "widget": {
                      "name": "table-column",
                      "options": {
                        "label": "Трансформация",
                        "visible": true
                      }
                    },
                    "value": {
                      "$switch": {
                        "condition": {
                          "$subs": {
                            "path": "#selectorRooms[].transformation"
                          }
                        },
                        "default": "",
                        "cases": [
                          {
                            "value": true,
                            "action": "Да"
                          },
                          {
                            "value": false,
                            "action": "Нет"
                          }
                        ]
                      }
                    }
                  }
                }
              }
            },
            "actions": {
              "type": "object",
              "widget": {
                "name": "container",
                "class": {
                  "group": "form-actions p-field p-grid mrg-t-lg",
                  "value": "p-jc-xs-end p-autolayout"
                }
              },
              "properties": {
                "save": {
                  "widget": {
                    "name": "button",
                    "options": {
                      "label": "Добавить выбранные"
                    },
                    "events": {
                      "click": {
                        "$if": {
                          "condition": {
                            "$not-empty": {
                              "data": {
                                "$element-option": {
                                  "path": "#selectorRooms",
                                  "option": "selection"
                                }
                              }
                            }
                          },
                          "then": {
                            "$if": {
                              "condition": {
                                "$and": {
                                  "operands": [
                                    {
                                      "!==": {
                                        "operand1": {
                                          "$from-context": {
                                            "path": "@preload.event.state"
                                          }
                                        },
                                        "operand2": {
                                          "$fetch-object": {
                                            "path": "code",
                                            "data": {
                                              "$workflow-object-state": {
                                                "workflow": "event",
                                                "objectId": {
                                                  "$query-params": {
                                                    "name": "id"
                                                  }
                                                }
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    {
                                      "===": {
                                        "operand1": false,
                                        "operand2": {
                                          "$var": {
                                            "path": "#data.addServiceFlag"
                                          }
                                        }
                                      }
                                    }
                                  ]
                                }
                              },
                              "then": {
                                "$http-code": {
                                  "200": [
                                    {
                                      "$navigate": {
                                        "commands": [
                                          "/cabinet/event/edit"
                                        ],
                                        "extras": {
                                          "queryParams": {
                                            "id": {
                                              "$from-context": {
                                                "path": "$response.body.data.id.0"
                                              }
                                            },
                                            "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"rent\"}}"
                                          }
                                        }
                                      }
                                    }
                                  ],
                                  "422": [
                                    {
                                      "$validate": {
                                        "errors": {
                                          "$from-context": {
                                            "path": "$response.error.errors"
                                          }
                                        }
                                      }
                                    }
                                  ],
                                  "client": {
                                    "$api-workflow": {
                                      "type": "post",
                                      "options": {
                                        "observe": "response"
                                      },
                                      "workflow": "event",
                                      "action": "add_draft",
                                      "data": {
                                        "eventData": {
                                          "$exclude": {
                                            "data": {
                                              "$var": {
                                                "path": "#data"
                                              }
                                            },
                                            "exclude": [
                                              "addServiceFlag",
                                              "services",
                                              "bookings"
                                            ]
                                          }
                                        },
                                        "rooms": {
                                          "$element-option": {
                                            "path": "#selectorRooms",
                                            "option": "selection"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "default": [
                                    {
                                      "$message": {
                                        "severity": "error",
                                        "summary": "Добавление мероприятия",
                                        "detail": "Непредвиденная ошибка"
                                      }
                                    }
                                  ]
                                }
                              },
                              "else": {
                                "$http-code": {
                                  "200": [
                                    {
                                      "$navigate": {
                                        "commands": [
                                          "/cabinet/event/edit"
                                        ],
                                        "extras": {
                                          "queryParams": {
                                            "id": {
                                              "$query-params": {
                                                "name": "id"
                                              }
                                            },
                                            "widgets_options": "{\"form.tabs\":{\"selectedKey\":\"rent\"}}"
                                          }
                                        }
                                      }
                                    }
                                  ],
                                  "422": [
                                    {
                                      "$validate": {
                                        "errors": {
                                          "$from-context": {
                                            "path": "$response.error.errors"
                                          }
                                        }
                                      }
                                    }
                                  ],
                                  "client": {
                                    "$api-workflow": {
                                      "type": "post",
                                      "options": {
                                        "observe": "response"
                                      },
                                      "workflow": "booking",
                                      "action": "mass_add",
                                      "data": {
                                        "rooms": {
                                          "$element-option": {
                                            "path": "#selectorRooms",
                                            "option": "selection"
                                          }
                                        },
                                        "eventId": {
                                          "$query-params": {
                                            "name": "id"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "default": [
                                    {
                                      "$message": {
                                        "severity": "error",
                                        "summary": "Добавление помещения",
                                        "detail": "Непредвиденная ошибка"
                                      }
                                    }
                                  ]
                                }
                              }
                            }
                          },
                          "else": {
                            "$populate": {
                              "path": "#selectRoomsVisible",
                              "data": true
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "cancel": {
                  "widget": {
                    "name": "button",
                    "options": {
                      "label": "Отмена"
                    },
                    "events": {
                      "click": {
                        "$populate": {
                          "path": "#selectRoomsVisible",
                          "data": false
                        }
                      }
                    },
                    "kind": "button-search-form-clear-button-right-style"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
